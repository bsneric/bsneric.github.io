<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>peft （Parameter-Efficient Fine-Tuning）高效大模型微调框架</title>
      <link href="/2026/01/14/81-peft-%EF%BC%88Parameter-Efficient-Fine-Tuning%EF%BC%89%E9%AB%98%E6%95%88%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E6%A1%86%E6%9E%B6/"/>
      <url>/2026/01/14/81-peft-%EF%BC%88Parameter-Efficient-Fine-Tuning%EF%BC%89%E9%AB%98%E6%95%88%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p><code>peft</code>（Parameter-Efficient Fine-Tuning）是 Hugging Face 开发的一个<strong>高效微调大语言模型</strong>的库，核心目标是在<strong>不训练完整模型参数</strong>的前提下，通过仅调整少量额外参数实现模型的任务适配，从而大幅降低计算资源消耗和内存需求。</p><h3 id="一、PEFT-的核心优势"><a href="#一、PEFT-的核心优势" class="headerlink" title="一、PEFT 的核心优势"></a>一、PEFT 的核心优势</h3><ul><li><strong>参数效率</strong>：仅训练 0.1%~5% 的模型参数，大幅减少计算量和存储需求</li><li><strong>低资源友好</strong>：支持在消费级 GPU（如单张 RTX 3090）上微调 7B+ 参数的大模型</li><li><strong>兼容量化</strong>：无缝结合 4&#x2F;8 位量化技术，进一步降低内存占用</li><li><strong>性能接近全量微调</strong>：在多数任务上，PEFT 方法的效果与全量微调相当</li><li><strong>易于部署</strong>：微调后的模型可以高效合并或推理</li></ul><h3 id="二、你提到的三个核心组件详解"><a href="#二、你提到的三个核心组件详解" class="headerlink" title="二、你提到的三个核心组件详解"></a>二、你提到的三个核心组件详解</h3><h4 id="1-LoraConfig：配置-LoRA-方法的参数"><a href="#1-LoraConfig：配置-LoRA-方法的参数" class="headerlink" title="1. LoraConfig：配置 LoRA 方法的参数"></a>1. <code>LoraConfig</code>：配置 LoRA 方法的参数</h4><p>LoRA（Low-Rank Adaptation）是 PEFT 中最常用的方法，通过在原始权重矩阵旁添加低秩分解的矩阵来减少可训练参数。<code>LoraConfig</code> 用于定义 LoRA 的具体配置：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> LoraConfig</span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">8</span>,                    <span class="comment"># LoRA 的秩（低秩矩阵的维度），r 越小效率越高（常见值：4~64）</span></span><br><span class="line">    lora_alpha=<span class="number">32</span>,          <span class="comment"># LoRA 的缩放因子（通常是 r 的 2~4 倍）</span></span><br><span class="line">    target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],  <span class="comment"># 应用 LoRA 的目标模块（如注意力层的查询/值投影）</span></span><br><span class="line">    lora_dropout=<span class="number">0.05</span>,      <span class="comment"># LoRA 层的 dropout 率，避免过拟合</span></span><br><span class="line">    bias=<span class="string">&quot;none&quot;</span>,            <span class="comment"># 是否训练偏置参数（&quot;none&quot;/&quot;all&quot;/&quot;lora_only&quot;）</span></span><br><span class="line">    task_type=<span class="string">&quot;CAUSAL_LM&quot;</span>   <span class="comment"># 任务类型（如因果语言模型、序列分类等）</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>关键参数说明</strong>：</p><ul><li><code>r</code>：决定 LoRA 低秩矩阵的大小，直接影响可训练参数数量（参数量与 <code>r</code> 成正比）</li><li><code>target_modules</code>：必须指定应用 LoRA 的模块，LLM 中通常选择注意力层的投影矩阵（如 <code>q_proj</code>、<code>v_proj</code>、<code>k_proj</code>）</li></ul><h4 id="2-prepare-model-for-kbit-training：准备模型进行低精度训练"><a href="#2-prepare-model-for-kbit-training：准备模型进行低精度训练" class="headerlink" title="2. prepare_model_for_kbit_training：准备模型进行低精度训练"></a>2. <code>prepare_model_for_kbit_training</code>：准备模型进行低精度训练</h4><p>当使用 <strong>4&#x2F;8 位量化</strong> 技术加载模型时（如通过 <code>bitsandbytes</code>），需要调用此函数对模型进行预处理，确保其结构适合低精度训练：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> prepare_model_for_kbit_training</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设 model 是通过 4 位量化加载的（如 quantization_config=bnb_config）</span></span><br><span class="line">model = prepare_model_for_kbit_training(model)</span><br></pre></td></tr></table></figure><p><strong>核心作用</strong>：</p><ul><li>启用梯度检查点（gradient checkpointing）以减少内存使用</li><li>调整模型的嵌入层（embeddings）和语言模型头（lm_head）的参数类型，确保与量化兼容</li><li>处理模型的偏置项，使其适合低精度训练</li></ul><h4 id="3-get-peft-model：将-PEFT-方法应用到基础模型"><a href="#3-get-peft-model：将-PEFT-方法应用到基础模型" class="headerlink" title="3. get_peft_model：将 PEFT 方法应用到基础模型"></a>3. <code>get_peft_model</code>：将 PEFT 方法应用到基础模型</h4><p>最后，通过此函数将配置好的 PEFT 方法（如 LoRA）与基础模型结合，返回可以直接微调的 PEFT 模型：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> get_peft_model</span><br><span class="line"></span><br><span class="line">peft_model = get_peft_model(model, lora_config)</span><br></pre></td></tr></table></figure><p><strong>核心作用</strong>：</p><ul><li>自动在 <code>target_modules</code> 指定的层旁插入 LoRA 适配器</li><li>冻结原始模型的大部分参数，仅保留 LoRA 相关参数可训练</li><li>返回的 <code>peft_model</code> 可以像普通模型一样进行训练（如使用 <code>Trainer</code> API）</li></ul><h3 id="三、典型使用流程（结合量化-LoRA）"><a href="#三、典型使用流程（结合量化-LoRA）" class="headerlink" title="三、典型使用流程（结合量化 + LoRA）"></a>三、典型使用流程（结合量化 + LoRA）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 4 位量化加载基础模型</span></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(</span><br><span class="line">    <span class="string">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span>,</span><br><span class="line">    quantization_config=bnb_config,  <span class="comment"># 4 位量化配置</span></span><br><span class="line">    device_map=<span class="string">&quot;cuda:0&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 准备模型进行低精度训练</span></span><br><span class="line">model = prepare_model_for_kbit_training(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置 LoRA 参数</span></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">16</span>,</span><br><span class="line">    lora_alpha=<span class="number">32</span>,</span><br><span class="line">    target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],</span><br><span class="line">    bias=<span class="string">&quot;none&quot;</span>,</span><br><span class="line">    task_type=<span class="string">&quot;CAUSAL_LM&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 应用 LoRA 到模型</span></span><br><span class="line">peft_model = get_peft_model(model, lora_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 查看可训练参数比例（通常 &lt; 1%）</span></span><br><span class="line">peft_model.print_trainable_parameters()</span><br></pre></td></tr></table></figure><h3 id="四、PEFT-支持的其他方法"><a href="#四、PEFT-支持的其他方法" class="headerlink" title="四、PEFT 支持的其他方法"></a>四、PEFT 支持的其他方法</h3><p>除了 LoRA，PEFT 还支持多种高效微调方法：</p><ul><li><strong>Prefix Tuning</strong>：仅调整输入序列的前缀嵌入</li><li><strong>Prompt Tuning</strong>：学习软提示（soft prompt）嵌入</li><li><strong>P-Tuning v2</strong>：结合前缀调整和多层适配</li><li><strong>Adapter</strong>：在模型层间插入小型适配器模块</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>PEFT 库通过 <code>LoraConfig</code>、<code>prepare_model_for_kbit_training</code> 和 <code>get_peft_model</code> 等核心组件，实现了<strong>大模型的高效微调</strong>。它特别适合在资源受限的环境下（如单张 GPU）微调 7B+ 参数的大模型，同时保持接近全量微调的性能。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PEFT </tag>
            
            <tag> 微调 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何和贵人相处</title>
      <link href="/2025/12/29/80-%E5%A6%82%E4%BD%95%E5%92%8C%E8%B4%B5%E4%BA%BA%E7%9B%B8%E5%A4%84/"/>
      <url>/2025/12/29/80-%E5%A6%82%E4%BD%95%E5%92%8C%E8%B4%B5%E4%BA%BA%E7%9B%B8%E5%A4%84/</url>
      
        <content type="html"><![CDATA[<p>今天在视频网站上看到一段内容，觉得非常发人深省，以下是AI提取的视频文字内容。然后还有我的一些感想。</p><p>以下是为您提取的视频全部文字稿（基于视频字幕整理）：</p><p>[00:00] 我在你那一段描述里面，一个字的感恩都没有念出来。世界的真相是谁他妈告诉你是平等的？谁他妈就是个坏逼，或者他自己是个傻逼。这个就是你怎么跟贵人来往，怎么跟比你高得多的人来往。</p><p>[00:16] 你好，我是您强烈的忠实观众，一开始是当做下饭料，没想到越看越有滋味，渐渐品出您藏在插科打诨里的通达智慧，让我受益匪浅。如今我正被一些问题所困扰，冒昧地想向您请教一二，望您赐教。</p><p>[00:36] 首先我交代一下背景当读故事吧。我出生在山西的一个小山城的小山村里，从小没上过学，一天学没上过。跟我的父亲识字念书，为什么？因为我父亲是我们那个村唯二的70后大专生。但是他念书的时候喜欢上了禅宗，毕业之后工作不得志，于是在我出生之后（这孩子应该是00后的啊），举家离开城市住进了山里，类似终南山修行者那样，有一群带小孩的夫妻两个一块修，一住就是十多年。依靠种田、卖药材维持生计。听妈妈说他不和外人来往。</p><p>[01:16] 我父亲从小教我的只有识字和读英语。当然我英语的底子学得不太好，因为我父亲的英语水平也一般，毕竟是个大专生，英语老师水平不行。他不允许我看电视节目，因为我们家根本没电视，也不让我看小说。我能看的书只有家里好几柜子的散装书，里面是散文、禅宗公案和一堆中医书。15岁的时候，我爸爸送了我一只吉他，算是难得的娱乐项目。</p><p>[01:47] 我18岁了，走出山村进入社会，去南方投奔我父亲的朋友。他在一所中流的985高校当教职工，管着一个新闻实践中心，我就在那蹭课，一边玩一边蹭。这段经历给我的影响很难用言语描述，也许像是悉达多法王子在20岁第一次跑出皇宫后的那种感觉吧，只不过我不是王子。</p><p>[02:13] 那个大学的新闻实践中心里有录音棚、摄影棚和演播厅，也是学校影协的活动场所。平时就有很多学生们来这，而我比想象的更擅长和人打交道。这男孩没有社交恐惧，头一个学期我就和大家打成了一片。我对技术非常感兴趣，影音器材、摄影器材，我在第一个学期里，就在这些大学生的带领下学得非常熟，这让我感到充实和自豪，信心也开始建立了。</p><p>[02:44] 这也是唯一让我感到自信的事情。平时我就听大叔推荐的广告学和传播学，我听的是云里雾里。广播电视学总会涉及到一些理工科的项目，我是完全听不懂。看到同龄人举一反三的样子，我的自卑感会冒出来。平时和他们相处，虽然表面上对我很友好，但有些话我总是插不进，比如大家在聊流行歌曲、追星、电影流派、戏剧艺术，我是一窍不通。</p><p>[03:12] 这些都给我造成了很大困扰。我在这位叔叔的建议下做了大量补充，谢天谢地我还看得进去书。总之这段经历我补充了大量来自社会的信息，也让我察觉到了我和别人的差距。还锻炼了自认为不错的表达能力，这也是在我叔的建议下去刻意练习的。因为后来两年我需要为影视的新生讲一些关于技术的兴趣课。第一次我磕磕巴巴搞砸了，那时候他建议我学习一下表达，看网课书，学习日本的“三分钟表达要义”。这项技能对我后来找工作起到了决定性的作用。</p><p>[03:48] 在这所学校待了五年之后，我离开了，决定独自去北京。学历的限制让我找工作举步维艰，好在学校期间我做出了一些不错的学生作品，又赶上自媒体爆发的2020年，所以我还是找到了一份工作。简短说吧，这份两年的工作让我变得更加了解世界。2022年疫情结束，我又回南方和学校认识的同学开了一间工作室开始创业，结果赔得一塌糊涂。</p><p>[04:14] 去年我回到老家。故事到此告一段落，讲讲我的困惑吧。我回老家之后躺了半年，然后自己在做自媒体。也是巧合，我大约在700粉的时候做了一期视频，被当地旅游文旅局的领导看到了。他找了好多人私信我让我去，于是我就去了。去了之后我才了解到他是个副厅级干部，还是北师大的客座教授，讲历史的。而我所赞扬的那个景区是由他设计的，我理解的好正是他要表达的意图。他那个视频完全是伯牙和钟子期，他觉得相遇到知己了。</p><p>[04:52] 当然重点在后面。我从他口里意外得知，我的表哥是医院的主任医师，是有军衔的，在当地很有影响力，也是他的朋友。这个表哥是我爷爷和他爷爷是亲兄弟，那是比较远的远房表哥。在此之前，我们只知道确实有一个远房亲戚在北京当医生，是我们村里唯二读了大学的人。他很热情，我爸妈都找他看过病，都是蛮严重的病。去北京301的农村人，病都不轻。但并不知到底他有多大能耐。</p><p>[05:29] 大概是由于这个关系，文旅局领导提出给我提供场地，让我有更好的条件去做自媒体。当然我拒绝了，这就是穷人的倔强又来了，偶像包袱又来了。我回家说了这件事，我爸说你怎么想就怎么做吧。我当时脑子一热，就说那我给我这个表哥打个电话问他意见吧，我爸就同意了。</p><p>[05:51] 第一次给我表哥打电话，他确实像我爸说的那样热情，一下子通了半个来小时电话，询问了我各种详细情况。我把大概经历跟他讲了一次，他听完说了一句“好可惜”。看，跟我说的一样吧。之后转头问我有什么事，我就询问他是否认识文旅局领导，这份好意是否应接受。表哥说可以，你看，比你强的人认识的都是一样的层次。表哥说放心跟着他去做，虽然他快退休了，但人很好。</p><p>[06:21] 于是我就搬到了那个办公室，几乎天天和他碰面。后来他还给了我一个长期的广告项目，我虽然没赚多少钱，但足够养活自己了，大概30来万的样子。你看，这就是穷家小子的以后问题。你在那个村里出来，连一天大学都没上，人家给你个项目，一两年挣了30多万人民币，你还说没赚多少钱，一副好像都是我的能力、我很重要的样子。</p><p>[06:54] 这就是穷人。一会我好好给你上一课。你们都是穷孩子，没见过世面，身边的爸爸妈妈根本不能起到人生指路人的作用。你人生就像胡春华遇到了李克强，你遇到了两个贵人：一个是父亲那个朋友，在985大学给你容身之所，人家可以不给你，不是欠你的。我在你那段描述里，一个字的感恩都没有。全是势力。包括文旅局老先生欣赏你的才华，我也没看出你对他有什么感恩之情。</p><p>[07:56] 我也就项目这件事谢过他，但他肯定不要居间费。跟这些比你高得多的贵人交往，要用什么样的心情？小礼物我觉得他大概不要，我也没送，就送过一次书。后来这位领导退休了。穷孩子最大的问题是一句概括：你心里的平等意识害了你。你莫名其妙产生“普天之下人平等”的想法，世界真相是谁他妈告诉你是平等的？谁他妈就是个坏逼，或者是傻逼。</p><p>[08:56] 这个世界是不平等的。你要知道世界就像电子游戏，在打怪升级。不平等在于：人家爷爷在努力，爹在努力，他自己又在努力，积累到今天的宝箱，你凭什么拿过来跟他平等？平等在于：只要你认真付出，你的宝箱也会越来越大。这种穷家死孩子没有贵人点醒，就纠结于“平衡”，看我眼神不对了我就不跟他玩了。</p><p>[10:34] 有个小姑娘写信，应聘文秘连大专都没念，老板让她酒场帮忙搬酒她就觉得累，在信里骂老板，毫无感恩之心。第二，如何做到跟贵人交往如沐春风？忘了钱。听明白了吗？你跟老王来往就忘了钱，因为我肯定比你有钱。我身边很多人动不动就说“老王帮了我忙，我挣了一万得给老王拿两千”，这种朋友我不想交。钱在我脑子里只是个数字。</p><p>[11:47] 封信里装两千块给我的快感，远不如一张用心画的贺卡，或者投我所好买一张200块的星巴克卡。不要用你的钱数和权力去对等，贫穷限制了你的想象力。你唯一有而对方没有的，是年轻、时间和经历。对方已经老了，多少钱都买不回来。</p><p>[12:31] 还有个逻辑叫“利用价值最大化”。你的贵人利用你，不要觉得“凭什么利用我”，你他妈只有这点价值。被利用你才能学到东西。当你回馈恩人，如果他不缺钱，你就送你那地方的特产，精美的手工艺品。他会非常感激，因为你用心了。用心，明白吧？现金拍在那，人家可能不动心，但用心做的东西他会永远记着你。</p><p>[13:30] 千万不要以为每次把钱给了就两清了，没意思。人家是因为欣赏你，不是为了那点佣金。你要有感恩之心，要把他像自己家长辈一样想着，才能真正混入圈子。会手工的给老王缝个环保袋，我真的非常感激，20块钱的东西比两三千块钱让我感动100倍。</p><p>[14:17] 我希望这些经验能对年轻人起作用，我20岁时如果知道这些，完全不是今天这个状态。这位领导退休了，我跟他一起搬到商会办公楼，每天见面但几乎没话，就是笑一笑。你说这事你感觉不对，他可是你人生的恩主。你见过贵人只笑不说话？你可能就是个“白眼狼”。你要惦记着人家。老头喜欢抽烟，带两条烟；喜欢喝酒，收集点家乡纯粮酒；喜欢吃肉，找点好的农家猪肉送到家里。</p><p>[15:27] 总之就是用心、用时间。什么叫心？就是时间。你自私到连自己的时间都不给。人家老人缺的就是时间。另外，如何拉近和表哥的距离？因为阶级差距太大。老王告诉你：还是用心。钱你比不了，权也比不了。</p><p>[16:11] 你的成长历程很奇妙，18岁之前你什么都不知道，像杨过和小龙女。反璞归真是最难的。你表哥在301做大主任，什么都见过，唯独没见过纯真纯朴。回想一下，985大学那些人为什么不歧视你？因为你闪着无邪的眼神问“哥哥你能教我吗？”这是人之本能。如果你动心眼去设计，反而交往不了，因为你缺了十几年的斗争经验，学不会。你最有优秀的，是他们已经忘了的那个东西。反璞归真方得至交，不要用钱衡量。</p><p>– 以下是一些总结感想</p><p>视频的主要内容是一名有着特殊成长背景（从小在山里长大，未受正规学校教育）的年轻人向博主请教如何与社会地位比自己高很多的“贵人”相处。</p><p>以下是根据视频内容整理的文字摘要及老王的核心观点：</p><ol><li>来信背景<br>成长经历： 投稿人出生在山西小山城，父母在山里隐居修行，他从小随父读书，没上过学。18岁出山，投奔父亲的朋友（某985高校职工）并在学校蹭课。</li></ol><p>职业现状： 虽无学历，但通过自学摄影和表达，在2020年自媒体爆发期找到工作。后回老家做自媒体，机缘巧合结识了当地文旅局的一位副厅级领导（也是其表哥的朋友）。</p><p>困惑： 这位领导给了他很多帮助（提供场地、介绍广告项目等），但他不知道如何回馈，也觉得阶级差距太大，无法深入交流，甚至与领导见面也只是尴尬地笑笑，不知如何开口。</p><ol start="2"><li>老王的核心观点（文字稿精华）<br>关于“世界不平等”的真相 老王犀利指出，世界真相从来不是平等的。他认为心里揣着“莫名其妙的平等意识”会害了穷孩子。</li></ol><p>“这个世界是不平等的。你要知道这个世界就像你玩的电子游戏，是打怪升级的过程。不平等在于你拼爹拼爷都输了，人家几代人的积累凭什么拿过来跟你平等？但平等在于只要你认真付出，你的‘宝箱’也会越来越大。”</p><p>向上社交的秘密：忘掉钱和权。 博主建议，在与比自己高得多的人交往时，要“忘了钱”或“忘了权”。</p><p>“因为我肯定比你有钱，你的叔叔肯定也比你有钱。如果你挣了一万想分两千给我，这种朋友我不想交。因为那点钱对我只是数字，带不来快感。”</p><p>如何真正打动“贵人”？ 博主强调，贵人缺的是“心、时间、经历”，而不是钱。</p><p>用“心”： 送两千块现金，不如送一件用心挑选、有家乡特色或手工制作的精美小物件。贵人能感受到你花了心思，这是钱买不到的。</p><p>被利用价值最大化： 不要抗拒被利用，因为你只有有价值才会被提携。</p><p>不要做“白眼狼”： 对方是你的恩人，见面却不说话。老王批评这种行为是自私，连自己的时间都不愿分享给老人（长辈）。</p><p>穷孩子的优势：反璞归真 老王认为，投稿人最大的优势是未受体制教育污染的“纯真”。</p><p>“你缺了18年从幼儿园到大学的斗争经验，学不回来了。你最优秀的反而是他们已经忘了的那个东西。反璞归真方得至交，不要算计，用你的心和时间去衡量。”</p><p>总结<br>老王给出的建议是：下等人跟上等人交朋友，不是用钱，而是用“心”和“时间”。 面对退休的领导或位高权重的亲戚，应像对待自家慈祥的长辈一样去关心和陪伴，提供他们缺失的情感价值和纯朴的互动，而非纠结于金钱回报或刻意讨好。</p>]]></content>
      
      
      <categories>
          
          <category> 随想 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 醒悟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据流通新风口：可信空间解密</title>
      <link href="/2025/12/29/79-%E6%95%B0%E6%8D%AE%E6%B5%81%E9%80%9A%E6%96%B0%E9%A3%8E%E5%8F%A3%EF%BC%9A%E5%8F%AF%E4%BF%A1%E7%A9%BA%E9%97%B4%E8%A7%A3%E5%AF%86/"/>
      <url>/2025/12/29/79-%E6%95%B0%E6%8D%AE%E6%B5%81%E9%80%9A%E6%96%B0%E9%A3%8E%E5%8F%A3%EF%BC%9A%E5%8F%AF%E4%BF%A1%E7%A9%BA%E9%97%B4%E8%A7%A3%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>手里有数据却不敢共享，怕泄露，怕用乱想变现，又卡在格式不兼容，不知道值多少钱，你是不是也被这些数据难题卡了好久，今天这条视频咱不绕弯子。专门来给大家拆解可信数据空间。这个新风口为啥现在国家都在推？到底能解决数据流通的哪些老大难，还有怎么落地才能真拿到万亿价值红利全给你讲透。<br>现在经济社会早就进入数据驱动的新时代了，数据也成了实打实的关键生产要素。有组数据很能说明问题。数据流动量每多10%就能带动 GDP 增长0.2个百分点。而且数据流动对各个行业的利润增长平均促进率能达到10%左右，这足以看出数据流通的重要性。<br>我国一直特别重视数据要素市场的建设。从数字经济发展规划到关于深化改革的有关决定，都明明确确提出要加快数据要素市场建设。国家数据局成立之后，更是在全面推进数据交易市场的建设。今年还专门出台了关于可信数据空间的相关文件，这么看下来，数据空间绝对是当前的新风口。<br>说到这儿，可能有人会问咱们为啥非得要数据空间呢？核心原因其实很简单，数据的价值本来就来自流通和利用，但这么多年下来，数据流通一直绕不开三个难题。</p><ul><li>第一个是不敢共享，大家对数据提供方的来源，数据主体身份还有数据交出去之后的使用过程都有不少不了解不清晰的地方。心里总揣着顾虑，自然不敢轻易把数据共享出去。</li><li>第二个是不愿共享。咱们对数据的价值怎么界定权限怎么划分一直没理的太清楚，也没找到围绕特定场景开发高价值应用的路子，就算把数据拿出来了，也找不到匹配的价值没动力，当然不愿意共享。</li><li>第三个是难以互通，大量数据存在格式不统一，标准不一致的问题，就像不同牌子的插头插不进同一个插座似的。直接把数据互联互通的路给堵死了。<br>所以要解决数据流通里信任价值互通这三个核心问题，就得有个全新的方法路径来推动数据高效流通，充分利用，这就是可信数据空间为啥会应运而生的背景.那么到底什么是可信数据空间呢？<br>简单说，它是一个由可信管控资源交互价值共创这三大核心特征的新型数据生态体系，而且有两重关键属性。<br>一方面是基础设施属性。靠大家达成共识的规则，把多方主体连起来，给数据共享，利用，搭好底层架子；另一方面是数据要素应用生态属性。在这个体系里，我们靠三个机制释放数据价值：</li><li>一是建可信机制，确保数据使用的全流程都能可信存证可控，可追溯，让各方愿意把数据拿出来。</li><li>二是做统一数据目录，帮数据搞定格式转换的问题，支撑大规模的流通利用。</li><li>三是搭多元应用场景，推动大家一起用数据创造价值，总结一下就是可信数据空间的核心，就是一个以价值共创为导向的数据生态体系。<br>另外。可信数据空间主要包含五个核心组成部分。在实际构建的时候，有三个关键点得重点抓。<br>第一，先把场景应用明确好，要细化到每个场景需要哪些数据来源，哪些主体参与，还有这些主体聚到一起，要打造什么样的应用价值。这是建数据空间的前提；<br>第二，核心是做好数据规则机制，这跟咱们以前做的信息化项目不一样。过去咱们常犯重建设，轻运营，重软件，轻数据的毛病，但数据空间的建设和推进，核心得盯着规则设计，盯着数据资源本身的开发和利用。<br>第三，得有技术系统做支撑，靠多种技术组合起来的体系化安排，把相关规则落到实处。说到底，可信数据空间不是虚概念，而是解决数据流通痛点，解锁万亿价值的实际方案，未来数据要素市场的机会大概率就藏在这里。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 方案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> 可信数据空间 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>不用逼自己合群，真的</title>
      <link href="/2025/11/18/78-%E4%B8%8D%E7%94%A8%E9%80%BC%E8%87%AA%E5%B7%B1%E5%90%88%E7%BE%A4%EF%BC%8C%E7%9C%9F%E7%9A%84/"/>
      <url>/2025/11/18/78-%E4%B8%8D%E7%94%A8%E9%80%BC%E8%87%AA%E5%B7%B1%E5%90%88%E7%BE%A4%EF%BC%8C%E7%9C%9F%E7%9A%84/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿：</p><p>今天想跟你聊个你可能常碰到的事 —— 比如课间看到同学凑堆聊某款游戏，你插不上话时会有点慌；或者为了跟大家一起买同款文具，委屈自己省了买漫画的钱。其实爸爸想告诉你：<strong>不用逼自己 “合群”，真的没关系</strong>。</p><p>你有没有发现，小学时玩得特别好的几个同学，现在是不是很少联系了？初中这几年的同学，等将来大家考去不同高中、大学，慢慢也会有新的生活圈子，很多人可能就渐渐不常来往了。就像你之前养的小仓鼠，刚开始觉得特别好，后来你就有了新的爱好和其他的伙伴，他们后来相继离开了，也没觉得有那么难过。</p><p>如果为了 “合群” 委屈自己，比如明明想写作业，却硬着头皮陪同学去小卖部；明明不喜欢说别人八卦，却跟着附和以免被排挤 —— 这些消耗你时间、让你不开心的事，其实不值得。就像你不爱吃青椒，总不能为了别人说 “吃青椒才合群” 就硬吃，最后肚子不舒服，多不值呀。</p><p>爸爸不是让你不跟同学说话，而是想告诉你：<strong>朋友不是 “凑数量”，是 “对胃口”</strong>。就像你看视频，有的人只喜欢枪战片的，你却偏爱综艺节目的，硬要一起聊，肯定聊不到一块儿。真正的朋友，是你们能一起为解出一道难题开心，能聊到喜欢的动画眼睛发光，就算安静坐着不说话也不尴尬 —— 这种 “同频” 的感觉，比凑在一堆热闹重要多了。</p><p>另外想说的就是，朋友是有 “层次”的，其实就是 “你们想的、做的是不是差不多”。比如你想周末去游泳或者做手工，但有的同学只想去网吧打游戏，这不是谁好谁坏，只是大家要走的路不一样。就像爬山，有人想慢慢爬看风景，有人想快点冲去山顶，强行一起走，只会互相拖累。反而跟那些愿意陪你游泳、和你做手工的人在一起，你会更开心，也能学到东西。</p><p>当然啦，要是碰到愿意听你讲心事、在你忘带文具时主动借给你、陪你一起进步的同学，一定要珍惜 —— 这样的朋友，就算将来不常见面，也会是你心里的宝藏。</p><p>最后想跟你说：初中最重要的，是把时间留给让你舒服的事、值得的人，还有不断变优秀的自己。不用怕 “不合群”，你本来就很特别呀。</p><p align="right">爱你的爸爸</p><p align="right">2025年11月18日</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 交友 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《以日为鉴：衰退时代生存指南》读书笔记</title>
      <link href="/2025/11/13/77-%E3%80%8A%E4%BB%A5%E6%97%A5%E4%B8%BA%E9%89%B4%EF%BC%9A%E8%A1%B0%E9%80%80%E6%97%B6%E4%BB%A3%E7%94%9F%E5%AD%98%E6%8C%87%E5%8D%97%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/11/13/77-%E3%80%8A%E4%BB%A5%E6%97%A5%E4%B8%BA%E9%89%B4%EF%BC%9A%E8%A1%B0%E9%80%80%E6%97%B6%E4%BB%A3%E7%94%9F%E5%AD%98%E6%8C%87%E5%8D%97%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="一、书籍核心脉络"><a href="#一、书籍核心脉络" class="headerlink" title="一、书籍核心脉络"></a>一、书籍核心脉络</h2><p>《以日为鉴：衰退时代生存指南》聚焦日本泡沫经济破裂后40年的社会变迁，跳出宏观经济叙事，从普通个体视角切入，通过五大核心维度（失业潮、大学生困境、财政与就业选择、老龄化冲击、全民出海潮），剖析日本在“增长型社会”转向“存量型社会”过程中的政策抉择、行业阵痛与个体命运，为面临相似发展阶段的经济体提供镜鉴。</p><p>全书结构清晰，分为五大部分：第一部分围绕失业潮展开，讲述日本政府“保就业”政策的利弊，以及对老员工与新生代的差异化影响；第二部分聚焦“失落的一代人”，呈现泡沫破裂后大学生就业冰河期、学历贬值与硕博扩招的后遗症；第三部分探讨就业众生相，涵盖考公热、教师过剩、医疗崩坏等职业领域的变迁；第四部分深挖老龄化对医疗体系的冲击，分析医药寒冬与后续改革路径；第五部分聚焦全民出海潮，展现日本企业与个体在本土内卷下的海外突围之路。</p><h2 id="二、关键洞察与核心观点"><a href="#二、关键洞察与核心观点" class="headerlink" title="二、关键洞察与核心观点"></a>二、关键洞察与核心观点</h2><h3 id="1-政策抉择的两难：短期稳定与长期发展的失衡"><a href="#1-政策抉择的两难：短期稳定与长期发展的失衡" class="headerlink" title="1. 政策抉择的两难：短期稳定与长期发展的失衡"></a>1. 政策抉择的两难：短期稳定与长期发展的失衡</h3><p>日本泡沫破裂后，为维持社会稳定，政府采取“保就业优先”策略，通过企业重组、劳务派遣制等方式将失业率控制在5%以下，但代价惨重：大量“僵尸企业”占据资源，拖累经济活力；银行体系因救助企业积累巨额不良资产，引发后续破产潮；新生代大学生沦为牺牲品，成为低薪临时工，形成“冰河世代”，30年未能摆脱收入低谷。这种“牺牲下一代保现有群体”的抉择，导致日本社会出现格差扩大、地方不振等长期问题。</p><h3 id="2-个体命运的沉浮：时代洪流下的职业与人生选择"><a href="#2-个体命运的沉浮：时代洪流下的职业与人生选择" class="headerlink" title="2. 个体命运的沉浮：时代洪流下的职业与人生选择"></a>2. 个体命运的沉浮：时代洪流下的职业与人生选择</h3><ul><li>就业市场：从泡沫时期“企业争抢大学生”到冰河期“百投无果”，终身雇佣制瓦解，劳务派遣制普及，“窗边族”“啃老族”“漂流一族”等群体涌现，职业稳定性彻底重构。</li><li>教育领域：学历从“阶层跃升阶梯”沦为“贬值资产”，大学扩招、硕博倍增计划导致高学历贫困，考公热从狂热走向寂灭，教师职业从尊崇沦为“黑色职业”。</li><li>医疗行业：老龄化与财政紧缩叠加引发“医疗崩坏”，医生超负荷工作、医患矛盾激化，医药行业因控费陷入寒冬，后续通过医保改革、药剂师体系重建才逐步复苏。</li></ul><h3 id="3-破局之路：从本土内卷到海外突围"><a href="#3-破局之路：从本土内卷到海外突围" class="headerlink" title="3. 破局之路：从本土内卷到海外突围"></a>3. 破局之路：从本土内卷到海外突围</h3><p>面对本土市场萎缩，日本启动长达20年的全民出海潮，通过“产业抱团出海—全产业链延伸—文化出海”三步走战略，实现“海外再造日本”。企业层面，汽车、电子等优势产业向东南亚与中国转移产能，中小企业跟进配套；个体层面，大量从业者跟随企业出海，通过本土化扎根海外市场，文化产业（动漫、旅游）的出海也创造了新的就业机会，成为衰退中的少数黄金赛道。</p><h2 id="三、读后感：在周期轮回中把握确定性"><a href="#三、读后感：在周期轮回中把握确定性" class="headerlink" title="三、读后感：在周期轮回中把握确定性"></a>三、读后感：在周期轮回中把握确定性</h2><p>读完这本书，最深刻的感受是“历史虽不重复，但押韵”。日本泡沫经济破裂后的社会现象——就业内卷、学历贬值、考公热、老龄化压力、出海热潮，如今正在多个东亚经济体上演，这本书的价值便在于提供了一份“完整的衰退样本”，让我们在时代变局中看清方向。</p><p>日本的经历告诉我们，衰退时代的核心矛盾是“存量竞争”取代“增量红利”，但这并不意味着全面停滞。政策层面，日本“保就业却牺牲创新”“财政扩张却积累债务”的教训警示我们，平衡短期稳定与长期发展至关重要，避免为一时安稳埋下更深隐患；个体层面，“冰河世代”的困境印证了“时代选择大于个人努力”，但同时，出海潮中成功突围的企业与个体也证明，困境中总有新机遇。</p><p>对当下的我们而言，这本书的启示尤为现实：其一，放弃“稳定幻觉”，无论是职业选择还是能力积累，都需具备“抗周期思维”，避免依附于短期红利行业；其二，理性看待教育与学历，聚焦核心技能培养，而非盲目追求高学历；其三，拥抱全球化视野，无论是企业布局还是个人发展，海外市场的增量空间值得重视；其四，关注老龄化带来的产业机会，医疗康养、银发经济等领域暗藏长期生机。</p><p>衰退从来不是终点，而是结构重构的起点。日本用40年时间在衰退中摸索出适应存量社会的生存模式，而我们所能做的，便是以史为鉴，看清周期的力量，避开前人的陷阱，在不确定性中锚定确定性——无论是个人技能的沉淀、职业赛道的选择，还是企业的战略布局，唯有顺应趋势、主动求变，才能在衰退时代走出属于自己的生机之路。</p><h2 id="四、日本衰退期关键政策与个体应对策略对照表"><a href="#四、日本衰退期关键政策与个体应对策略对照表" class="headerlink" title="四、日本衰退期关键政策与个体应对策略对照表"></a>四、日本衰退期关键政策与个体应对策略对照表</h2><table><thead><tr><th>核心领域</th><th>关键政策&#x2F;社会现象</th><th>政策目标与短期效果</th><th>长期问题与后遗症</th><th>个体应对策略（书中案例&#x2F;启示）</th></tr></thead><tbody><tr><td><strong>就业市场</strong></td><td>1. 企业重组与“僵尸企业”救助</td><td>目标：避免企业大规模破产，维持就业稳定；短期效果：失业率控制在5%以下，减少社会动荡</td><td>1. 僵尸企业占据资源，拖累经济活力；2. 银行积累巨额不良资产，引发1998年银行破产潮</td><td>1. 优先选择抗周期行业（如医疗、基础设施相关）；2. 避免依附单一企业，主动学习跨领域技能，降低被淘汰风险</td></tr><tr><td></td><td>2. 劳务派遣制推广（《劳务派遣法》）</td><td>目标：灵活调整用工成本，缓解企业压力；短期效果：快速吸纳失业人口，填补岗位空缺</td><td>1. 新生代沦为“临时工”，收入低、无保障，形成“冰河世代”；2. 职业稳定性彻底瓦解</td><td>1. 争取进入核心业务部门，避免长期从事边缘派遣岗位；2. 利用业余时间考取职业资格证（如会计、IT认证），提升转正概率</td></tr><tr><td></td><td>3. 乡村基建计划（分流城市人口）</td><td>目标：创造乡村就业，缓解城市失业压力；短期效果：3年分流30万大学生至乡村</td><td>1. 基建依赖举债，引发地方财政危机；2. 平成大合并后岗位消失，人口返城加剧城市就业压力</td><td>1. 若参与乡村基建，优先选择有长期运营价值的项目（如旅游配套）；2. 提前积累城市人脉，为返城就业铺垫</td></tr><tr><td><strong>教育与学历</strong></td><td>1. 大学扩招与硕博“倍增计划”</td><td>目标：延缓大学生就业，储备高学历人才；短期效果：3年大学生数量从237万增至310万</td><td>1. 学历快速贬值，大学生起薪负增长；2. 高学历贫困涌现，博士就业率不足60%</td><td>1. 选择应用型专业（如护理、IT），避免纯文科或过度理论化专业；2. 读研期间积累实习经验，避免盲目追求学历</td></tr><tr><td></td><td>2. 考公热（1995-2005年）</td><td>目标：吸纳失业人口，提供稳定岗位；短期效果：报考人数达65万，部分岗位录取率1:30</td><td>1. 公务员薪酬下降、工作强度飙升；2. 2024年报考率跌至1:3，成“冷门选择”</td><td>1. 考公需评估长期性价比，避免仅因“稳定”盲目报考；2. 若进入公职体系，主动参与核心业务（如政策制定），提升不可替代性</td></tr><tr><td></td><td>3. 教师扩招与后续缩编</td><td>目标：应对“第三次婴儿潮”预期；短期效果：1991年教师总数达105万</td><td>1. 婴儿潮未现，教师过剩，临时教师占比升至1&#x2F;6；2. 工作强度飙升，教师成“过劳重灾区”</td><td>1. 避免盲目进入教育行业，优先选择生源稳定的核心城市学校；2. 提升跨学科教学能力（如全科教师技能），适应政策要求</td></tr><tr><td><strong>医疗体系</strong></td><td>1. 医保控费与药品降价</td><td>目标：缓解医保赤字，控制医疗支出；短期效果：10年药品支出占比从1&#x2F;3降至1&#x2F;5</td><td>1. 医药企业利润暴跌，新药研发停滞；2. 药品质量下降，引发“平成艾滋药害事件”</td><td>1. 医药从业者可转向医疗器械、医疗服务领域，避开单纯药品生产；2. 医生可提升专科能力（如老年病、慢性病），适应老龄化需求</td></tr><tr><td></td><td>2. 医疗“定额制”（按病种付费）</td><td>目标：避免过度医疗，降低住院成本；短期效果：平均住院天数从40天降至18天</td><td>1. 医院为控成本缩短患者住院时间，术后并发症率上升；2. 医患矛盾激化，医生离职潮</td><td>1. 患者选择医院时优先考察术后护理水平，而非单纯追求“出院快”；2. 医生提升沟通能力，减少医患误解</td></tr><tr><td></td><td>3. 药剂师体系重建（“第二医生”）</td><td>目标：弥补医患沟通缺口，推广仿制药；短期效果：仿制药替代率从30%升至85%</td><td>1. 药剂师工作强度加大，抑郁率达30%；2. 基层医疗资源仍向核心城市集中</td><td>1. 药剂师可深耕社区药房，参与居家养老服务，拓展收入来源；2. 患者通过固定药剂师建立用药档案，保障用药安全</td></tr><tr><td><strong>全民出海</strong></td><td>1. 优势产业抱团出海（汽车&#x2F;电子）</td><td>目标：转移过剩产能，开拓海外市场；短期效果：2000年头部企业海外收入占比超20%</td><td>1. 本土制造业空心化，中低端岗位流失；2. 海外子公司与本土供应链脱节</td><td>1. 技术工程师可跟随企业出海，参与海外工厂建设，争取本土化管理岗位；2. 关注东南亚、中国等新兴市场，提前学习当地语言文化</td></tr><tr><td></td><td>2. 全产业链出海（中小企业配套）</td><td>目标：延伸产业链，提升海外利润；短期效果：2010年中小企业海外市场占比达70%</td><td>1. 中小企业依赖头部企业订单，抗风险能力弱；2. 部分企业因文化差异遭遇海外失败</td><td>1. 中小企业从业者可聚焦细分领域（如汽车零部件），成为“隐形冠军”；2. 出海前调研当地政策（如税收、劳工法），避免合规风险</td></tr><tr><td></td><td>3. 文化出海（动漫&#x2F;旅游）</td><td>目标：提升品牌溢价，创造服务业岗位；短期效果：2019年访日游客消费超4.8万亿日元</td><td>1. 文化产品同质化严重，海外竞争力下滑；2. 旅游从业者过度依赖旺季，收入不稳定</td><td>1. 文化从业者可结合海外受众偏好（如欧美对“二次元”的兴趣），定制内容；2. 旅游从业者拓展“淡季业务”（如商务接待、研学旅行）</td></tr></tbody></table><h2 id="五、对照表使用说明"><a href="#五、对照表使用说明" class="headerlink" title="五、对照表使用说明"></a>五、对照表使用说明</h2><ol><li><strong>政策复盘</strong>：可通过“短期效果-长期问题”对比，理解衰退期政策的“双刃剑”效应，避免陷入“短期维稳&#x3D;长期利好”的误区；  </li><li><strong>个体参考</strong>：结合自身领域（如就业、教育、医疗），对应查找书中案例，规避高风险选择（如盲目考公、扎堆纯理论专业），优先布局抗周期赛道；  </li><li><strong>趋势预判</strong>：关注日本从“本土内卷”到“海外突围”的转型逻辑，可迁移至当下出海热潮，例如：技术人才跟随新能源企业出海、文化从业者布局东南亚市场等。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日本 </tag>
            
            <tag> 经济 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《凡事发生，皆有利于我》读书笔记</title>
      <link href="/2025/11/13/76-%E3%80%8A%E5%87%A1%E4%BA%8B%E5%8F%91%E7%94%9F%EF%BC%8C%E7%9A%86%E6%9C%89%E5%88%A9%E4%BA%8E%E6%88%91%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/11/13/76-%E3%80%8A%E5%87%A1%E4%BA%8B%E5%8F%91%E7%94%9F%EF%BC%8C%E7%9A%86%E6%9C%89%E5%88%A9%E4%BA%8E%E6%88%91%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="一、书籍概况"><a href="#一、书籍概况" class="headerlink" title="一、书籍概况"></a>一、书籍概况</h2><ul><li><strong>书名</strong>：《凡事发生，皆有利于我》</li><li><strong>作者</strong>：<code>[日]</code>喜多川泰</li><li><strong>核心主旨</strong>：以寿险业务员冈田修一的人生困境与转折为主线，通过“神奇出租车司机”这一充满隐喻的角色，传递“运气无好坏，关键在累积与转化”“保持好心情是捕捉人生转机的天线”“人生是绵延不绝的生命故事，个体需承担传承与累积的使命”等核心观点，引导读者以正向视角看待困境，在接纳与行动中寻找人生新可能。</li><li><strong>阅读日期</strong>：2025年11月4日</li></ul><h2 id="二、核心内容提炼"><a href="#二、核心内容提炼" class="headerlink" title="二、核心内容提炼"></a>二、核心内容提炼</h2><h3 id="1-困境：成年人的“绝境”与“执念”"><a href="#1-困境：成年人的“绝境”与“执念”" class="headerlink" title="1. 困境：成年人的“绝境”与“执念”"></a>1. 困境：成年人的“绝境”与“执念”</h3><p>书中主角冈田修一的人生，是无数普通人中年困境的缩影：</p><ul><li><strong>事业危机</strong>：作为寿险业务员，他遭遇20张保单集体解约，不仅下个月薪水减半，还需退还此前10个月的佣金，奖金泡汤，甚至要动用女儿升学储备金，陷入“业绩焦虑—客户流失—经济崩溃”的恶性循环。</li><li><strong>家庭矛盾</strong>：女儿梦果进入初二后拒学，每天在家刷手机，亲子间沟通失效；妻子优子期待已久的巴黎旅行因经济危机被迫取消，夫妻间隐藏着未说出口的压力；老家母亲民子独居，面临养老与老宅处理难题，修一却因自身困境无暇顾及。</li><li><strong>自我否定</strong>：修一长期陷入负面思考，将事业失败归咎于“运气差”，认为自己“不适合做保险”“育儿失败”，甚至在遭遇连番打击后质疑“为什么只有我这么倒霉”，陷入自我怀疑的内耗中。</li></ul><p>这些困境的本质，是修一对“结果”的执念——他执着于“立刻看到回报”“当下必须顺利”，却忽略了困境背后隐藏的成长契机，也忘记了“人生不是孤立的个体故事，而是家族与时代的延续”。</p><h3 id="2-转折：神奇出租车与“运气哲学”"><a href="#2-转折：神奇出租车与“运气哲学”" class="headerlink" title="2. 转折：神奇出租车与“运气哲学”"></a>2. 转折：神奇出租车与“运气哲学”</h3><p>改变修一人生的关键，是一位神秘的出租车司机（“转运者”）。司机通过一系列“反常”举动，向修一传递了颠覆认知的“运气观”与“人生哲学”，成为他的“人生导师”：</p><h4 id="（1）运气：不是“天降好事”，而是“累积与使用”"><a href="#（1）运气：不是“天降好事”，而是“累积与使用”" class="headerlink" title="（1）运气：不是“天降好事”，而是“累积与使用”"></a>（1）运气：不是“天降好事”，而是“累积与使用”</h4><p>司机用修一老家文具店的“集点卡”作喻，打破“运气有好坏”的固有认知：</p><ul><li>运气像集点卡，没有“好”与“坏”之分，只有“累积”与“使用”。有人看似“运气好”，实则是在使用过去累积的点数；有人暂时“不顺”，实则是在为未来累积运气。</li><li>累积运气的核心方式有两种：一是“保持好心情”，坏心情会关闭“捕捉转机的天线”，即使好运近在眼前也会错过（如修一因不耐烦，错失与女儿班主任签约、进而拓展50份保单的机会）；二是“为他人创造价值而不求即时回报”——帮朋友搬家却未获感谢、工作付出远超薪水，这些“看似吃亏的事”，实则是在为人生“存运气”。</li></ul><h4 id="（2）困境：不是“绝境”，而是“生命故事的必要章节”"><a href="#（2）困境：不是“绝境”，而是“生命故事的必要章节”" class="headerlink" title="（2）困境：不是“绝境”，而是“生命故事的必要章节”"></a>（2）困境：不是“绝境”，而是“生命故事的必要章节”</h4><p>司机通过修一祖父良藏（二战中牺牲，临终前仍期待儿子能吃到家乡荞麦面）与父亲政史（商店街没落後，默默练习25年手工荞麦面，想为儿子留一条后路）的故事，让修一明白：</p><ul><li>人生不是孤立的“个体剧本”，而是“家族生命故事的延续”。修一的困境，本质是“父辈累积的运气已用至临界点，需由他开启新的累积”。</li><li>所有困境都是“必要经验”：政史商店街倒闭，却在练习荞麦面的过程中为修一埋下“人生新方向”的种子；修一保单解约，却因寻找转机的过程，重新理解“保险是相互扶持的工具”，甚至发现自己对“传承手工荞麦面”的热爱。正如司机所说：“人生在世，无论发生任何事，都要把它变成自己人生中必要的经验——可以是正面的养分，也可以是负面的包袱，选择权在自己。”</li></ul><h4 id="（3）行动：从“纠结结果”到“享受过程”"><a href="#（3）行动：从“纠结结果”到“享受过程”" class="headerlink" title="（3）行动：从“纠结结果”到“享受过程”"></a>（3）行动：从“纠结结果”到“享受过程”</h4><p>司机没有直接给修一“解决问题的答案”，而是引导他“改变看待问题的视角”：</p><ul><li>停止“与他人比较”：修一总羡慕同事“边玩边签单”，却忽略同事背后可能的“运气累积”（如早年为客户付出的额外帮助）。司机提醒他“专注自己的人生，每个人的‘集点卡’点数不同，无需比较”。</li><li>用“微小行动”打破内耗：修一因害怕失败不敢行动，司机却带他从“尝试吃一块戚风蛋糕”“主动和陌生人打招呼”“买一把吉他练习”等小事开始，让他明白“保持好心情不是期待好事发生，而是决定享受即将发生的事”，行动本身就是在“激活运气天线”。</li></ul><h3 id="3-蜕变：从“内耗者”到“传承者”"><a href="#3-蜕变：从“内耗者”到“传承者”" class="headerlink" title="3. 蜕变：从“内耗者”到“传承者”"></a>3. 蜕变：从“内耗者”到“传承者”</h3><p>在司机的引导下，修一逐渐完成心态与行动的双重蜕变：</p><ul><li><strong>心态转变</strong>：从“抱怨困境”到“接纳并转化困境”——他不再纠结“保单解约的损失”，而是思考“如何用保险的‘相互扶持’本质帮助更多人”；不再焦虑“女儿拒学”，而是理解“孩子的成长需要时间，自己的积极改变会影响孩子”。</li><li><strong>行动突破</strong>：从“逃避问题”到“主动创造价值”——他带着父亲留下的荞麦面工具，开始学习手工荞麦面，将“传承家族故事”作为新的人生目标；甚至在决定辞职时，还为公司推荐优质客户，用“为他人着想”的行动累积运气；最终，他接受山本先生的演讲邀请，用自己对“保险本质”的理解帮助更多年轻人，意外开启了“理财顾问+荞麦面传承”的双重人生可能。</li><li><strong>家庭和解</strong>：修一向妻子坦诚经济困境，意外得到优子的理解；他带荞麦面工具回家的举动，也让母亲民子打开心扉，讲述父亲政史25年练习荞麦面的秘密——原来父亲早已为他铺好“退路”，只是修一此前从未察觉。家庭关系从“隐藏压力”变为“彼此支撑”。</li></ul><h2 id="三、读后感：困境是“包装丑陋的礼物”，关键在你是否愿意拆开"><a href="#三、读后感：困境是“包装丑陋的礼物”，关键在你是否愿意拆开" class="headerlink" title="三、读后感：困境是“包装丑陋的礼物”，关键在你是否愿意拆开"></a>三、读后感：困境是“包装丑陋的礼物”，关键在你是否愿意拆开</h2><p>读完《凡事发生，皆有利于我》，最触动我的不是“神奇出租车”的奇幻设定，而是它对“普通人困境”的真实刻画与温柔解构——我们每个人都曾是“冈田修一”：为事业焦虑、为家庭疲惫、为未来迷茫，习惯性将“不顺”归咎于“运气差”，却忽略了困境背后的“礼物”。</p><p>书中“运气像集点卡”的比喻，彻底打破了我对“运气”的执念。以前总觉得“好运是天降的”，遇到挫折就陷入“我为什么这么倒霉”的内耗；现在才明白，那些“看似吃亏的付出”（如帮同事加班、耐心听朋友倾诉、甚至是失败的尝试），都是在为人生“存点数”。就像修一的父亲政史，25年默默练习荞麦面，看似“毫无回报”，却为修一留下了“人生新方向”的种子——这不是“运气好”，而是“长期累积后的必然结果”。</p><p>更让我共鸣的，是书中对“成年人情绪”的理解。修一因业绩压力对妻子发脾气、因女儿拒学感到无力，这些场景太真实了。我们总习惯在家人面前隐藏脆弱，却忘了“保持好心情不是强装乐观，而是坦诚接纳自己的情绪后，仍愿意向前走一小步”。就像司机带修一做的那样：不用一下子“解决所有问题”，从“好好吃一顿饭”“对陌生人笑一下”开始，微小的积极行动，终将汇聚成改变人生的力量。</p><p>最后，书中“人生是绵延不绝的生命故事”的观点，让我重新理解“传承”的意义。修一从“忽略父亲的付出”到“传承荞麦面技艺”，本质上是从“被动接受人生”到“主动承担使命”——我们每个人都是“家族故事”的一环，父辈的困境与坚持，都是留给我们的“隐形集点卡”；而我们今天的每一次“累积”，也会成为下一代的“运气储备”。</p><p>生活中没有“神奇出租车”，但我们可以成为自己的“转运者”：当困境来临时，别着急抱怨“为什么是我”，试着问自己“这件事想教会我什么”；当内耗时，别陷入“什么都不做”的泥潭，试着从一件“微小的积极行动”开始。因为“凡事发生，皆有利于我”不是一句鸡汤，而是一种选择——选择相信困境背后有礼物，选择用行动激活运气，选择成为自己人生的“主动创造者”。</p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 社科 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第七章阅读笔记</title>
      <link href="/2025/11/03/75%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%83%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/11/03/75%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%83%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一女儿的家长，读完《解码青春期》第七章“和孩子一起成长，有些特殊的青春期问题值得关注”，我深刻意识到：初一不仅是孩子学业适应、个性发展的关键期，也是“特殊问题高发期”。从“吃不下或吃太多”的饮食问题，到睡眠紊乱、性教育困惑，再到家庭变故（如父母离婚）、留守或留学的环境变化，甚至直面“死亡”这样沉重的话题，这些问题看似“特殊”，却可能悄悄影响孩子的身心健康。如果家长只关注“常规问题”（如成绩、叛逆），忽视这些“特殊情况”，很可能错过干预的最佳时机。以下结合章节内容提炼重点，并给出与初一女儿的具体相处建议，帮她平稳应对青春期的“特殊挑战”。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>“贪吃”或“不吃”不是“嘴馋”或“爱美”，可能是心理或生理问题</strong><br>初一孩子可能因学业压力、情绪波动出现饮食异常：有的像案例中15岁的小辛，“吃饱还想吃”，体重飙升至170斤，实则是“食物成瘾”（明知肥胖仍控制不住进食）；有的像高一的乐乐，因失恋觉得“胖”，节食、催吐，最终发展成“神经性厌食”（吃不下东西、内分泌紊乱）。书中强调：“贪吃”可能是为了寻求心理满足，“不吃”可能是自我认同偏差（如觉得“瘦才好看”），两者都需警惕——若孩子短期内体重波动超过10%、出现“吃完催吐”“只吃固定食物”等行为，或伴随情绪低落、失眠，一定要及时关注，而非简单批评“嘴馋”“矫情”。</p></li><li><p><strong>睡眠问题不是“熬夜玩手机”那么简单，背后藏着心理压力</strong><br>初一孩子作业增多、学业压力大，容易出现“睡不着、睡不沉、早醒”等问题。书中案例中高一女孩因“担心睡不好”陷入恶性循环：越焦虑越睡不着，越睡不着越焦虑，白天精力差、成绩下滑。很多家长只看到“孩子熬夜玩手机”，却没发现背后的心理原因——可能是担心作业写不完、害怕考试考砸，甚至是隐藏的抑郁、焦虑情绪。睡眠问题不是“作息习惯”问题，而是孩子心理状态的“晴雨表”，长期睡眠不好会影响记忆力、情绪调节能力，进而加重学业和心理压力。</p></li><li><p><strong>青春期性教育：不主动提但不回避，关键是“不撒谎、不敷衍”</strong><br>初一孩子开始经历身体发育（如月经初潮），会对“性”产生好奇或困惑，可能偷偷查资料、听同学议论，若得不到正确引导，容易被错误信息误导。书中案例中的男孩小俊，因看了同性恋影片怀疑自己“性取向异常”，直到父亲借电视镜头坦诚聊“性取向多元化”，才解开困惑。这提醒我：性教育不用刻意“开课”，但当孩子主动问“我是怎么来的”“为什么来月经”，或遇到相关话题（如电视里的亲密镜头）时，要大方回应——不回避“性器官”“生理期”等关键词，不编造“你是捡来的”这类谎言，用孩子能理解的语言传递“科学、尊重”的观念，比如“月经是女孩长大的正常表现，说明你的身体在为未来做准备”。</p></li><li><p><strong>家庭变故（离婚、亲人离世）对孩子的影响，比想象中更深</strong><br>初一孩子对“家庭完整性”很敏感，父母离婚、亲人离世等变故，可能让她陷入“自我怀疑”（如“是不是我不好，爸妈才离婚”）或“过度悲伤”（如案例中12岁的小梦，因母亲去世陷入抑郁，休学5年）。书中强调：面对家庭变故，家长最不该做的是“隐瞒”或“敷衍”——比如离婚时骗孩子“爸妈只是分开住”，亲人离世时说“他去很远的地方了”，反而会让孩子因“被欺骗”更痛苦。正确的做法是“坦诚沟通+接纳情绪”，让孩子知道“变故不是你的错，爸妈依然爱你”。</p></li><li><p><strong>留守或留学：环境突变+青春期冲突，易引发适应障碍</strong><br>初一孩子若面临“留守家乡”或“出国留学”的环境变化，容易遭遇“双重挑战”：留守的孩子可能因缺乏父母陪伴，用“奇装异服”（如案例中穿洛丽塔的小枣儿）掩饰孤独；留学的孩子可能因文化差异、学业压力，从“学霸”变成“门门不及格”（如案例中的然然）。书中指出：这类问题的核心是“安全感缺失+适应能力不足”——留守孩子缺的是父母的情感陪伴，留学孩子缺的是“自主选择”（很多时候是家长替孩子决定出国），若不提前做心理准备，很可能引发厌学、自闭等问题。</p></li><li><p><strong>“死亡”不是“禁忌话题”，回避会让孩子更恐惧</strong><br>初一孩子可能通过宠物离世、亲人去世、新闻事件首次接触“死亡”，容易产生困惑甚至恐惧。案例中12岁的小梦因母亲去世，陷入“世界虚无”的抑郁，觉得“不如早点死”，正是因为没得到正确的死亡教育。书中强调：死亡是“人生必修课”，家长不用刻意回避，而是用孩子能理解的方式解释——比如借《寻梦环游记》告诉她“死亡不是消失，记住TA的人还在，TA就一直活着”，帮她接纳悲伤，而非压抑情绪。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-应对饮食问题：不贴标签，先“找原因”"><a href="#1-应对饮食问题：不贴标签，先“找原因”" class="headerlink" title="1. 应对饮食问题：不贴标签，先“找原因”"></a>1. 应对饮食问题：不贴标签，先“找原因”</h3><ul><li><p><strong>场景1：孩子最近总吃零食，体重两周涨了5斤，说“不吃就难受”</strong><br>❌ 别这样说：“你怎么这么嘴馋！再吃就成胖子了！”（贴标签+批评）<br>✅ 试试这样说：“妈妈发现你最近总吃零食，是不是学习太累，想通过吃东西放松呀？（共情+找原因）咱们一起看看——如果是饿了，咱们可以准备水果、坚果当健康零食；如果是压力大，咱们也可以试试散步、听音乐缓解，好吗？（给替代方案）”<br><em>作用：不否定孩子的行为，而是帮她找到背后的心理需求（如缓解压力），避免因“批评”让她更依赖食物解压。</em></p></li><li><p><strong>场景2：孩子因“觉得胖”，晚餐只吃蔬菜，拒绝主食，说“吃多了会胖”</strong><br>✅ 试试这样说：“你觉得‘瘦一点好看’，妈妈能理解（共情）。但初一正是长身体的时候，主食能给你提供学习需要的能量，不吃主食会没力气写作业哦。咱们可以约定‘晚餐吃小半碗米饭+蔬菜+蛋白质’，既不会胖，又能保证营养，你觉得怎么样？（具体建议）”<br><em>作用：不否定她“爱美”的需求，而是用“健康+学业”的关联让她理解“吃主食的必要性”，避免激化“对抗情绪”。</em></p></li></ul><h3 id="2-改善睡眠问题：不指责“熬夜”，先“解压力”"><a href="#2-改善睡眠问题：不指责“熬夜”，先“解压力”" class="headerlink" title="2. 改善睡眠问题：不指责“熬夜”，先“解压力”"></a>2. 改善睡眠问题：不指责“熬夜”，先“解压力”</h3><ul><li><p><strong>场景：孩子连续一周凌晨1点才睡，说“作业写不完，越想越睡不着”</strong><br>❌ 别这样说：“谁让你白天不写作业！熬夜玩手机还找借口！”（指责+误解）<br>✅ 试试这样说：“作业太多写不完，你一定很着急，越着急越睡不着，对吗？（共情）咱们一起看看作业：先把‘简单的基础题’做完，难的题明天问老师，这样能节省时间。咱们约定‘晚上11点前必须停笔’，哪怕没写完，妈妈和老师沟通，好不好？（拆解任务+给安全感）”<br><em>作用：不纠结“是否熬夜玩手机”，而是帮她拆解作业压力，传递“完不成作业有妈妈帮你”的安全感，打破“焦虑-失眠”的循环。</em></p></li><li><p><strong>日常小技巧：帮孩子建立“睡眠仪式感”</strong><br>每天睡前30分钟，和孩子一起做“放松活动”：比如关掉手机，陪她读10分钟轻松的课外书、泡5分钟脚，或者听一段舒缓的音乐。用固定的“仪式”让身体形成“条件反射”，告诉大脑“该睡觉了”，比反复催“快睡”更有效。</p></li></ul><h3 id="3-性教育：不回避、不敷衍，用“孩子能懂的语言”回应"><a href="#3-性教育：不回避、不敷衍，用“孩子能懂的语言”回应" class="headerlink" title="3. 性教育：不回避、不敷衍，用“孩子能懂的语言”回应"></a>3. 性教育：不回避、不敷衍，用“孩子能懂的语言”回应</h3><ul><li><p><strong>场景1：孩子第一次来月经，紧张地问“妈妈，我是不是生病了”</strong><br>✅ 试试这样说：“宝贝，这不是生病，是‘月经’，说明你长大了，身体在为未来做准备呢（科学解释）。妈妈给你准备了卫生巾，教你怎么用，如果肚子不舒服，咱们可以贴个暖宝宝、喝杯红糖姜茶（提供具体帮助）。以后有任何不舒服，都可以跟妈妈说。”<br><em>作用：用“长大”替代“生病”，减少孩子的恐惧，同时用实际帮助让她有安全感，避免因“不好意思说”导致处理不当。</em></p></li><li><p><strong>场景2：孩子看到电视里的亲密镜头，好奇地问“他们为什么要抱在一起”</strong><br>✅ 试试这样说：“抱在一起是表达喜欢的方式，但这种方式只有对‘很亲近、互相喜欢的成年人’才可以（明确边界）。你现在和同学之间的喜欢，比如一起分享零食、帮忙讲题，就是很美好的相处方式呀（联系孩子的生活）。”<br><em>作用：不回避“亲密行为”，但明确“年龄边界”，同时引导她理解“喜欢有很多种方式”，避免她对“亲密关系”产生误解。</em></p></li></ul><h3 id="4-应对家庭变故（以父母离婚为例）：不隐瞒、不推诿，给孩子“确定感”"><a href="#4-应对家庭变故（以父母离婚为例）：不隐瞒、不推诿，给孩子“确定感”" class="headerlink" title="4. 应对家庭变故（以父母离婚为例）：不隐瞒、不推诿，给孩子“确定感”"></a>4. 应对家庭变故（以父母离婚为例）：不隐瞒、不推诿，给孩子“确定感”</h3><ul><li><strong>场景：若父母决定离婚，需要告诉孩子</strong><br>❌ 别这样说：“都是你爸&#x2F;妈不好，才让咱们家散了”（指责对方）或“别问了，小孩子懂什么”（敷衍隐瞒）。<br>✅ 试试这样说：“爸爸妈妈因为一些大人的问题，决定分开住，但这不是你的错，也不是你不够好（消除自我怀疑）。以后你想跟妈妈住，周末可以去爸爸那里，爸爸妈妈依然会像以前一样爱你，你有任何事都可以找我们（给确定感）。”<br><em>作用：不把离婚的责任推给孩子或对方，而是强调“爱不变”，减少她的恐惧和愧疚感，避免她因“家庭变故”否定自己。</em></li></ul><h3 id="5-若孩子面临留守或留学：提前做“心理准备”，不强行“替她决定”"><a href="#5-若孩子面临留守或留学：提前做“心理准备”，不强行“替她决定”" class="headerlink" title="5. 若孩子面临留守或留学：提前做“心理准备”，不强行“替她决定”"></a>5. 若孩子面临留守或留学：提前做“心理准备”，不强行“替她决定”</h3><ul><li><p><strong>场景1：若因工作原因，孩子可能需要暂时留守老家</strong><br>✅ 这样做：① 提前和孩子沟通：“妈妈需要去外地工作半年，这段时间你和姥姥住，但妈妈每天会给你打视频电话，周末也会尽量回来陪你（明确陪伴方式）；② 帮她建立“支持系统”：和老家的老师、邻居打好招呼，告诉孩子“遇到困难可以找王老师&#x2F;张阿姨”；③ 定期关注情绪：每次视频不只问“作业写了吗”，多问“今天有没有开心的事”“有没有想跟妈妈说的小烦恼”，避免她因“孤独”封闭自己。  </p></li><li><p><strong>场景2：若考虑让孩子将来留学，提前试探她的意愿</strong><br>✅ 试试这样说：“妈妈看到有同学去国外上学，你觉得如果将来去国外读书，会有什么让你期待的事？又有什么担心的事呀（了解意愿）？咱们可以先参加一次短期游学，看看你能不能适应那里的生活，再做决定（给体验机会）。”<br><em>作用：不“一言堂”替孩子决定，而是通过“提问+体验”让她参与决策，减少将来因“不适应”产生的抵触情绪。</em></p></li></ul><h3 id="6-直面“死亡”话题：不回避悲伤，帮她“记住美好”"><a href="#6-直面“死亡”话题：不回避悲伤，帮她“记住美好”" class="headerlink" title="6. 直面“死亡”话题：不回避悲伤，帮她“记住美好”"></a>6. 直面“死亡”话题：不回避悲伤，帮她“记住美好”</h3><ul><li><strong>场景：若孩子的宠物（如小狗）去世，她伤心大哭</strong><br>❌ 别这样说：“不就是一只狗吗，再给你买一只就好了”（否定悲伤）。<br>✅ 试试这样说：“小狗不在了，你一定很伤心，妈妈知道你很爱它（共情悲伤）。咱们可以一起把小狗的照片整理成相册，再写几句话告诉它‘谢谢你陪我长大’（留存美好）。以后想它了，咱们就看看相册，好不好？”<br><em>作用：不否定孩子的悲伤，而是用“留存回忆”的方式帮她接纳“失去”，避免她因“不敢哭”压抑情绪，同时传递“死亡不是消失，美好回忆会一直在”的观念。</em></li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>初一女儿面临的“特殊问题”，本质是“安全感与适应力的考验”——无论是饮食、睡眠问题，还是家庭变故、环境变化，背后都藏着她对“自我认同”“情感联结”“未来确定感”的渴望。第七章让我明白：家长不要做“问题的回避者”，而要做“孩子的同盟者”——不轻视“特殊问题”，不敷衍“敏感话题”，用“坦诚沟通、实际帮助、稳定的爱”给她支撑。当孩子感受到“不管遇到什么事，妈妈都会和我一起面对”，她才能在青春期的“特殊挑战”中不迷茫、不退缩，真正和家长一起成长。</p><p>如果你的家庭正面临某类“特殊情况”（如亲人离世、计划留学），可以告诉我具体场景，我可以帮你细化更针对性的沟通和应对方案。</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>女儿你好：我们来聊聊“自私”与“无私”</title>
      <link href="/2025/10/31/74-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E6%88%91%E4%BB%AC%E6%9D%A5%E8%81%8A%E8%81%8A%E8%87%AA%E7%A7%81%E4%B8%8E%E6%97%A0%E7%A7%81/"/>
      <url>/2025/10/31/74-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E6%88%91%E4%BB%AC%E6%9D%A5%E8%81%8A%E8%81%8A%E8%87%AA%E7%A7%81%E4%B8%8E%E6%97%A0%E7%A7%81/</url>
      
        <content type="html"><![CDATA[<p>女儿，你好：</p><p>今天爸爸想跟你说一说关于“自私与无私”，以及如何拒绝别人和谈判的话题。</p><p>爸爸记得我小的时候，学校的墙上有一个叫“赖宁”的孩子的画像。他是一个小学生，因为在一次抢救学校附近树林里的火灾时失去了生命。在爸爸小时候的那个年代，他被歌颂我英雄，是鼓励我们见义勇为的学习榜样。但是，几年前他的画像从各个学校的墙上被取了下来，你知道为什么吗？<br>因为人们意识到，像他那么小的年纪，首先应该做的是保护好自己的生命安全，而不是去救火。</p><p>所以，这其实涉及到一个话题，自私和无私，以及我们在生活中什么时候应该自私，什么时候应该无私。</p><p>首先，人生来就是自私的。你也许在学校学过“人之初，性本善”这样的话。但是这和人本性自私没有冲突。我们可以选择善良，可以选择无私奉献。但是前提是满足了自己的需求。</p><p>有一个著名的心理学家加马斯洛，他总结出了人的5层需求，后来被全世界的人都认同。就像下面这张图：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251031135907927.png" alt="image.png"></p><p>我们的生活中，首先要满足的是生存需求，也就是我们要吃饱穿暖、要结婚生子，这是第一层，也是最基本的需求；然后我们希望生活在一个安全的环境里，住着暖和的大房子、有钱去旅游、购物、学习，这是第二层；接着我们希望有社交，希望有朋友、家人、爱人、同事的关怀，这是社交需求；然后我们希望朋友尊重我们、家人爱护我们、自己的另一半爱自己、自己的同事尊重我们（也许是在公司里当个“领导”），这是第四层需求。<br>前面这四种需求，其实都是一种自私。而满足了这些需求后，我们希望得到某种自我实现，比如做个科学家，发明某种技术造福社会；有比如给需要的人捐款，让他们过得好一点；这类需求是为了让我们自己“感觉好”，本质上还是自私的，但是别人看来这就是一种无私的行动。</p><p>顺着这个话题，爸爸跟你聊聊日常的一类小事：如何拒绝别人。<br>假如你的一个好朋友或者同学老师等，他们要求你做一件事，但是这个事你本身并不想做。你改怎么办？我觉得这类可以参考上面的5个层次的需求，其实简单说就是，这个事情首先要不影响你自己的利益，然后你也愿意就可以答应。如果影响了你的利益，并且你本身也不情愿，那么直接拒绝就好了。当然，有时候直接拒绝会让你觉得“不好意思”，那么我们可以选择“谈判”的方式，可以让对方知难而退或者你们商量一个“折中”的方案。</p><p>我来给你举一个例子。</p><p>比如你的闺女要约今天下午你去看电影，但是你可能看过那个电影，或者你正好下午要去上一个美术课。你可以选择直接告诉你去不了，也可以先问问她为什么要今天下午去看电影，她可能会说正好有一个优惠券，那么你可以和她商量能不能改在明天上午再去。这样，对方就知道了你的难处，他们会考虑你的感受，如果对方就是不考虑你的感受，非要强迫你，那么你直接拒绝吧，对方不尊重你的感受，你也没必要尊重对方的感受。如果对方同意第二天上午去看，那么你们就有了一个“折中”的方案，这样更好。</p><p>当然了，如果对方要求你去做一些危险的事情，那么根本没商量，直接拒绝他们，并且以后要远离这些人。</p><p>今天就唠叨到这里啦，哈哈哈。</p><p>爱你的爸爸</p><p>2025年10月31日</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第六章阅读笔记</title>
      <link href="/2025/10/31/72-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E5%85%AD%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/31/72-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E5%85%AD%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一女儿的家长，读完《解码青春期》第六章“社交能力是必备能力，人际关系对青春期孩子很重要”，我深刻意识到：初一不仅是学业适应期，更是孩子社交能力成型的关键期。同学矛盾、朋友误会、对他人看法的过度在意，都可能让她陷入孤独、敏感甚至自我否定。这个阶段的孩子渴望融入集体，却又不懂如何处理人际冲突，很容易因“不会交朋友”产生心理压力。以下结合章节内容提炼重点，并给出与初一女儿的具体相处建议，帮她建立健康的人际关系。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>信任是社交的基石，孩子不信任他人，根源是缺乏安全感</strong><br>初一孩子可能因小事猜忌同学（如怀疑同桌偷喝自己的水、背后说自己坏话），很多家长觉得是“小心眼”，其实是内心安全感不足。书中案例中的小冰因妈妈离异后过度保护，从不允许她和邻居孩子玩耍，导致她初三时因怀疑同桌“恶作剧”而不敢上学。孩子的信任感源于家长的无条件爱与承诺，若总对她说“不要轻信别人”，会让她陷入“人人都不可信”的误区；反之，传递“妈妈永远爱你，不会因为任何事抛弃你”，才能帮她建立内心安全感，敢于信任他人。</p></li><li><p><strong>会倾听的孩子更受欢迎，家长要先做孩子的“倾听榜样”</strong><br>很多初一孩子想融入集体，却因不会倾听（如打断同学说话、不关注他人话题）被孤立。书中的方方想和同学做闺蜜，却因没记住对方“喜欢千纸鹤”的细节，精心准备的礼物不如他人手工制作的受欢迎。倾听不是“光听不说”，而是全身心体会对方的感受。家长要先学会倾听孩子（比如她吐槽同学时，不急于评判“是你不对”），再教她倾听技巧，比如“同学说话时不打断，听完后重复一句‘你是说你因为没买到喜欢的文具不开心，对吗’”，让对方感受到被重视。</p></li><li><p><strong>太在乎他人看法，会让孩子失去自我</strong><br>初一孩子容易因同学的一句评价（如“你穿这件衣服不好看”“你唱歌跑调”）否定自己，甚至刻意迎合他人。书中的蓓蓓因担心娇娇妈妈“讨厌自己”，从“支支吾吾”到“完全不说话”，本质是自我认同依赖他人评价。家长要帮她明白“别人的看法只是参考，你不必讨好所有人”，比如告诉她“你觉得自己穿这件衣服舒服、好看就够了，不用在意别人怎么说”，引导她建立内在评价标准，而非被他人看法左右。</p></li><li><p><strong>自私与无私要把握“度”，健康的自私才利于社交</strong><br>初一孩子可能因“怕同学成绩超过自己”不分享解题方法，或因“想讨好所有人”无底线迁就朋友，这两种极端都不利于人际关系。书中的李玉因不分享学习方法、不借玩具被同学孤立，其实是没把握好自私与无私的“度”。健康的社交不是“完全无私”，而是在满足自身需求的前提下帮助他人，比如“你可以先完成自己的作业，再帮同学讲题”“不想借玩具可以坦诚说‘我怕你弄坏，咱们可以一起玩我的拼图’”，既不委屈自己，也不伤害他人。</p></li><li><p><strong>社交恐怖不可怕，关键是帮孩子接纳自己、聚焦社交内容</strong><br>有些初一孩子因胆小、怕被嘲笑，不敢在课堂发言、不愿参加集体活动，甚至回避与人交流，这是社交恐怖的倾向。书中的小田因童年时被男生取笑“不是男人”，转学后仍不敢和男生相处，甚至不想上学。家长不要逼她“大胆一点”，而是先帮她接纳“不善交际也没关系”，再引导她把注意力放在社交内容上（比如和同学聊天时，关注“对方说的兴趣爱好”，而非“自己会不会说错话”），逐渐降低对“被评价”的恐惧。</p></li><li><p><strong>换位思考是人际黄金法则，帮孩子学会理解他人</strong><br>初一孩子常因“同学不顺着自己”闹矛盾（如小组合作时意见不合、朋友临时改计划），其实是不会换位思考。书中的小昭因班长中途离开准备晚会而生气，却没考虑到班长可能有苦衷。换位思考不是“强迫自己认同他人”，而是理解“每个人的想法不同”。家长要引导她多问“如果我是他，我会怎么做”，比如“班长突然离开，可能是家里有急事，咱们可以问问他，而不是直接生气”，帮她用弹性思维看待人际冲突。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-培养信任他人的能力：先给孩子安全感，再教她分辨可信之人"><a href="#1-培养信任他人的能力：先给孩子安全感，再教她分辨可信之人" class="headerlink" title="1. 培养信任他人的能力：先给孩子安全感，再教她分辨可信之人"></a>1. 培养信任他人的能力：先给孩子安全感，再教她分辨可信之人</h3><ul><li><p><strong>场景1：孩子说“我怀疑同桌背后说我坏话，因为她今天没跟我一起走”</strong><br>❌ 别这样说：“肯定是你想多了，别这么小心眼！”（否定感受+贴标签）<br>✅ 试试这样说：“你因为同桌没跟你一起走，就担心她背后说你坏话，心里一定不好受吧？（共情）不如放学后找个机会问问她‘今天怎么没一起走呀’，说不定她只是有急事，咱们弄清楚真相再下判断，好吗？（教沟通方法）”<br><em>作用：不否定孩子的猜忌，而是教她通过沟通化解误会，避免陷入“自我想象的矛盾”。</em></p></li><li><p><strong>场景2：孩子因被朋友欺骗（如约定一起玩却临时爽约且撒谎），说“我再也不信任何人了”</strong><br>✅ 试试这样说：“被朋友欺骗，你一定很失望、很伤心（共情）。不是所有人都不值得信任，只是这个朋友这次做得不对。咱们可以看看，平时她是不是经常失信？如果只是偶尔一次，咱们可以跟她说说‘你撒谎我很不舒服，下次有事可以直接告诉我’；如果经常这样，咱们可以慢慢疏远她，找更靠谱的朋友（教分辨方法）。”<br><em>作用：帮孩子明白“一次欺骗不代表所有人都不可信”，避免因个别事件封闭自己。</em></p></li></ul><h3 id="2-教孩子学会倾听：从家长倾听孩子开始，再练倾听技巧"><a href="#2-教孩子学会倾听：从家长倾听孩子开始，再练倾听技巧" class="headerlink" title="2. 教孩子学会倾听：从家长倾听孩子开始，再练倾听技巧"></a>2. 教孩子学会倾听：从家长倾听孩子开始，再练倾听技巧</h3><ul><li><p><strong>日常练习：做孩子的“专属听众”</strong><br>当孩子吐槽同学、分享校园趣事时，放下手机，眼神专注地听她说，不打断、不急于评判。比如她说到“同学今天跟我分享了喜欢的明星”，回应“她跟你说喜欢这个明星的原因是什么呀”，而非“这有什么好聊的，不如多花时间学习”。让孩子感受到“被倾听的美好”，自然会模仿这种沟通方式。</p></li><li><p><strong>场景：孩子说“我想和XX做朋友，但她总不怎么理我”</strong><br>✅ 试试这样说：“你想和她做朋友，却不知道怎么靠近，对吗？（共情）下次她聊自己喜欢的漫画时，你可以认真听，然后说‘我也看过这本，里面那个角色我特别喜欢’，关注她的话题，她会觉得你很重视她，慢慢就愿意跟你亲近了（教倾听技巧）。”<br><em>作用：给孩子具体的行动方法，而非笼统地说“你要主动一点”。</em></p></li></ul><h3 id="3-引导孩子不被他人看法绑架：建立内在评价标准"><a href="#3-引导孩子不被他人看法绑架：建立内在评价标准" class="headerlink" title="3. 引导孩子不被他人看法绑架：建立内在评价标准"></a>3. 引导孩子不被他人看法绑架：建立内在评价标准</h3><ul><li><p><strong>场景：孩子因同学说“你剪的短发不好看”，回家后哭闹着要留长发</strong><br>❌ 别这样说：“别人说不好看就不好看？你怎么这么没主见！”（指责+否定）<br>✅ 试试这样说：“同学说你短发不好看，你是不是觉得很委屈、很在意他们的看法？（共情）可是短发是你自己喜欢才剪的，你觉得剪完方便、清爽，这才是最重要的呀！每个人的审美不一样，不用因为别人的一句话否定自己的喜好（引导关注自我感受）。”<br><em>作用：帮孩子建立“自我感受优先”的认知，不被他人的单一评价左右。</em></p></li><li><p><strong>日常小技巧：每周和孩子聊“我今天做得好的地方”</strong><br>比如让她说说“今天我主动帮同学捡了笔，我觉得自己很友善”“今天我坚持完成了作业，我觉得自己很有毅力”，让她关注自身的优点和进步，逐渐建立内在自信，减少对他人看法的依赖。</p></li></ul><h3 id="4-把握自私与无私的“度”：教孩子坦诚表达需求"><a href="#4-把握自私与无私的“度”：教孩子坦诚表达需求" class="headerlink" title="4. 把握自私与无私的“度”：教孩子坦诚表达需求"></a>4. 把握自私与无私的“度”：教孩子坦诚表达需求</h3><ul><li><p><strong>场景1：孩子因“怕同学学会解题方法超过自己”，不分享学习技巧</strong><br>❌ 别这样说：“你怎么这么自私！同学之间要互相帮助！”（道德评判+指责）<br>✅ 试试这样说：“你担心同学学会后超过你，这种心情妈妈能理解（共情）。其实分享解题方法不仅不会让你落后，还能帮你巩固知识点。如果实在不想分享，也可以坦诚说‘我还没完全掌握，等我弄明白再跟你一起讨论’，不用勉强自己，也不用找借口（教坦诚表达）。”<br><em>作用：不否定孩子的真实想法，而是帮她看到分享的好处，同时允许她有“自私”的空间。</em></p></li><li><p><strong>场景2：孩子因想讨好朋友，无底线迁就（如朋友让她帮忙写作业，她不想却不敢拒绝）</strong><br>✅ 试试这样说：“你不想帮她写作业，却怕拒绝后她不跟你做朋友，对吗？（共情）真正的朋友不会强迫你做不想做的事。你可以说‘写作业是自己的事，我不能帮你写，但我可以帮你讲题’，既守住了自己的底线，也帮了她（教拒绝技巧）。”<br><em>作用：帮孩子明白“讨好换不来真正的友谊”，学会有边界地付出。</em></p></li></ul><h3 id="5-应对社交恐怖倾向：接纳孩子的性格，再逐步引导"><a href="#5-应对社交恐怖倾向：接纳孩子的性格，再逐步引导" class="headerlink" title="5. 应对社交恐怖倾向：接纳孩子的性格，再逐步引导"></a>5. 应对社交恐怖倾向：接纳孩子的性格，再逐步引导</h3><ul><li><p><strong>场景：孩子因“怕发言说错被同学笑”，课堂上从不举手</strong><br>❌ 别这样说：“有什么好怕的？大胆一点！你就是太懦弱了！”（指责+贴标签）<br>✅ 试试这样说：“在全班同学面前发言，你是不是担心说错被嘲笑，心里很紧张？（共情）咱们可以先从小组讨论开始，试着说自己的想法，小组里人少，就算说错也没关系。慢慢习惯后，再尝试举手回答简单的问题，妈妈相信你可以的（循序渐进引导）。”<br><em>作用：不强迫孩子“立刻改变”，而是用小步骤降低难度，帮她积累社交信心。</em></p></li><li><p><strong>日常小技巧：鼓励孩子参与“低压力社交”</strong><br>比如让她参加兴趣小组（如绘画、书法小组），和有共同爱好的同学相处，话题有共鸣，社交压力会更小。在兴趣小组中获得的正面反馈（如“你画得真好看”），能帮她逐渐克服对社交的恐惧。</p></li></ul><h3 id="6-教孩子换位思考：用弹性思维处理人际冲突"><a href="#6-教孩子换位思考：用弹性思维处理人际冲突" class="headerlink" title="6. 教孩子换位思考：用弹性思维处理人际冲突"></a>6. 教孩子换位思考：用弹性思维处理人际冲突</h3><ul><li><strong>场景：孩子因朋友临时改计划（约定一起逛书店，朋友却去陪家人）而生气</strong><br>❌ 别这样说：“她太不把你当回事了，以后别跟她玩了！”（激化矛盾+否定友谊）<br>✅ 试试这样说：“朋友临时改计划，你一定很失望，毕竟你期待了很久（共情）。不如问问她是不是家里有急事，换个时间再一起去逛书店。如果是你遇到急事，是不是也希望朋友能理解你呀？（引导换位思考）”<br><em>作用：帮孩子理解他人的处境，避免因一点小事否定整段友谊，培养弹性思维。</em></li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>初一女儿的社交问题，本质是“自我认同与集体融入的平衡问题”——她既想保持自我，又渴望被集体接纳。第六章让我明白：家长不要做“社交裁判”（评判“谁对谁错”“你应该跟谁玩”），而要做“社交教练”——教她信任他人的技巧、倾听的方法、换位思考的思维，同时接纳她的性格特点（内向或外向）。当孩子学会“真诚表达自己、理解他人、守住边界”，就能建立健康的人际关系，在集体中找到归属感，这对她的心理健康和学业适应都至关重要。</p><p>要不要我结合你女儿的具体社交场景（比如和同学闹矛盾、不敢主动交朋友等），帮你定制更细化的沟通话术和应对方案？</p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>女儿你好：如果别人欺骗了你该怎么办？</title>
      <link href="/2025/10/31/73-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%88%AB%E4%BA%BA%E6%AC%BA%E9%AA%97%E4%BA%86%E4%BD%A0%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/"/>
      <url>/2025/10/31/73-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%88%AB%E4%BA%BA%E6%AC%BA%E9%AA%97%E4%BA%86%E4%BD%A0%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="date-2025-10-31-13-50-25"><a href="#date-2025-10-31-13-50-25" class="headerlink" title="date: 2025-10-31 13:50:25"></a>date: 2025-10-31 13:50:25</h2><p>女儿，你好：</p><p>今天爸爸想跟你聊一聊关于被欺骗或者背叛的话题。背叛和欺骗其实本质上是另一个人失信于你，只不过这个失信的程度很严重。<br>这种失信的事情生活中有很多，比如别人跟你约好了时间确迟到了，答应你的事情没有完成，这两种可能是无心的，如果是故意的，那么就涉及到欺骗和背叛了。<br>那么，遇到这样的事情我们应该怎么办呢？常见的做法有：</p><ul><li>气急败坏，直接指责他们</li><li>询问对方失信的原因是什么</li><li>站在对方的立场，尝试理解他们</li><li>默默的接受</li><li>其它</li></ul><p>当然，很多时候我们选择的是第一种，因为从当时的感觉来看，实在是太气愤了。比如，你们班要要小组完成一个活动，本来应该大家一起出力的，但是就是有那么一两人什么都不愿意干，但是最后还要把他们记到功劳簿上。那我们可以直接对他们说：“你们这样做太过分了，答应一起做的事情，为什么偷懒不干？”。<br>当然，我们也可以采用第二种做法，在生气发怒之前，先问一下对方为什么这样做，知道原因。或许他们是真的不会，感觉帮不上忙，又或者他们家里有什么特殊的事情而参与不了。在了解了原因滞后，我们可以选择站在他们的立场上“理解”他们。但是要注意，这里的“理解”，并不代表“赞同”。<br>理解和赞同是有区别的。比如，有人跟你约会，但是迟到了，你问了原因后，原来她昨天晚上睡晚了早上没听到闹钟。这个时候，你可以理解她，但是这种迟到的行为是不能赞同的。也就是说，对于对方做错了的事情，不能“默默接受”，因为这样会给对方养成“坏毛病”，以后可能对你的事情会经常性“失信”。</p><p>上面说这些都是相对小的事情，虽然失信于你，但是造成的后果并不会太严重。但是，如果是一些让人无法原谅的欺骗或者是背叛呢？</p><p>爸爸觉得，我们首先要做的还是下面两个步骤：</p><ol><li>了解原因</li><li>尝试站在对方的立场，理解他们的行为</li></ol><p>然后，我们可以选择两种应对方式：</p><ol><li>原谅他们</li><li>惩罚他们</li></ol><p>先说惩罚吧。惩罚是最容易想要做的事情。因为这个“快意恩仇”吗？你打我一下，我也打回去。这样本身没什么错。如果是平常我们收到了伤害，那么必须要让对方得到一定的惩罚。</p><p>但是，爸爸想说，大多数时候我们应该选择原谅对方，这个原谅其实最后是让我们自己心灵得到自由。你想想，如果我们一直对那个欺骗背叛我们的人耿耿于怀，甚至惩罚了他们之后还是气的要死。</p><p>那么精神上受到伤害的是谁呢？是我们自己！</p><blockquote><p>宽容并不是为了得到他人的美誉，而是为了获得自己心灵的自由。愤怒与仇恨越少，内心的自由就越多，因为这时候我们的心绪将不被他人左右。</p></blockquote><p>对了，昨天晚上爸爸给你辅导数学作业的时候，跟你发脾气了，这是我的不对，我应该对你耐心，我应该做个温柔的爸爸。请女儿原谅我。</p><p>永远爱你的爸爸<br>2025年10月31日</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第五章阅读笔记</title>
      <link href="/2025/10/30/71-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%BA%94%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/30/71-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%BA%94%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一女儿的家长，读完《解码青春期》第五章“平稳度过青春期，重视孩子的情绪变化”，我深刻意识到：初一正是孩子情绪波动的“暴风期”。学业压力、人际敏感、自我认同困惑，会让她频繁陷入抑郁、焦虑、嫉妒等情绪中。更关键的是，这个阶段的孩子往往不会直接说“我很难过”，而是用“不想上学”“发脾气”“报喜不报忧”等行为掩饰情绪。如果家长只盯着“纠正行为”，忽视情绪背后的心理需求，只会让孩子把心门越关越紧。以下结合章节内容提炼重点，并给出与初一女儿的具体相处建议，帮她学会与情绪和平相处。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>抑郁不是“矫情”，是需要重视的心理信号</strong><br>初一孩子可能因学业压力（如数学跟不上）、人际挫折（如被同学孤立）陷入抑郁，表现为情绪低落、失眠、厌学，甚至出现自伤想法。书中案例中的初三学生因数学考试“突然看不见卷子”陷入抑郁，家长却认为是“矫情”，直到孩子割腕才重视。这提醒我：抑郁不是“装的”，当孩子出现持续两周以上的负面情绪，或伴随躯体反应（如头痛、腹痛），一定要警惕，先共情再寻求专业帮助，而非指责“你就是抗压能力差”。</p></li><li><p><strong>焦虑不用“对抗”，要教孩子“共处”</strong><br>很多初一孩子会因小事焦虑：担心背不出英语课文被嘲笑、害怕考试排名下滑。书中案例中的晓桐因担心背错段落彻夜失眠，越强迫自己“别想”越焦虑。其实焦虑像“粉红色大象”——越抗拒越清晰。家长要做的不是让孩子“别焦虑”，而是帮她接纳“焦虑很正常”，再一起找应对方法（如把大任务拆成小步骤），而非说“这点小事有什么好怕的”。</p></li><li><p><strong>嫉妒是中性情绪，引导好了能变成动力</strong><br>初一孩子容易嫉妒同学（如嫉妒同桌成绩好、被老师喜欢），很多家长觉得是“小心眼”，其实是孩子对“优秀”的渴望。书中案例中的小华因新同学抢走“班花”头衔，故意送破娃娃报复，最终不敢上学。如果家长直接批评“你怎么这么恶毒”，会让孩子觉得“嫉妒很羞耻”；若引导她发现自己的优势（如小华擅长画画），把嫉妒转化为“我也能在擅长的领域变优秀”，反而能激发动力。</p></li><li><p><strong>“报喜不报忧”背后，是孩子怕“让家长失望”</strong><br>很多初一孩子只跟家长说“被老师表扬了”，却隐瞒“作业没写完被批评”，不是“故意撒谎”，而是怕家长失望、被指责。书中的小菲出国后只报喜，直到老师反馈才暴露问题，背后是怕父母觉得“我连这点事都做不好”。如果家长总说“你怎么又出错”，孩子会更不敢说真话；若用“不管你做得怎么样，都可以跟妈妈说”传递包容，孩子才敢敞开心扉。</p></li><li><p><strong>暴躁不是“脾气差”，是孩子不会表达愤怒</strong><br>初一孩子可能因小事发脾气（如妈妈催起床就摔杯子），很多家长觉得是“叛逆”，其实是她不知道如何表达情绪。书中的小琳抑郁发作时冲妈妈扔水杯，事后也很后悔——她只是被“无法控制的情绪”困住了。此时强行压制“你不许发脾气”只会让情绪积压，教她用“我感到生气，因为我想自己安排起床时间”表达需求，才是关键。</p></li><li><p><strong>发现情绪模式，帮孩子找到“情绪出口”</strong><br>每个孩子的情绪反应模式不同：有的孩子焦虑时会沉默，有的会暴躁，有的会回避。书中将情绪模式分为“安全型”“回避型”“焦虑型”，比如“回避型”孩子难过时会躲进房间，“焦虑型”会反复吐槽同一件事。家长要先观察孩子的情绪模式（如女儿焦虑时会抠指甲），再针对性提供支持，而非用统一标准要求“你要开朗一点”。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-应对抑郁情绪：先“接住情绪”，再“找办法”"><a href="#1-应对抑郁情绪：先“接住情绪”，再“找办法”" class="headerlink" title="1. 应对抑郁情绪：先“接住情绪”，再“找办法”"></a>1. 应对抑郁情绪：先“接住情绪”，再“找办法”</h3><ul><li><p><strong>场景1：孩子说“数学太难了，我根本学不会，不如不上学了”</strong><br>❌ 别这样说：“别人都能学会，就你学不会，就是没用心！”（否定感受+指责）<br>✅ 试试这样说：“数学跟不上，你一定很着急吧？甚至觉得有点无助，对吗？（共情）咱们一起看看课本，先从最简单的例题开始，妈妈陪你一起想办法，哪怕每天只弄懂1道题，也是进步（具体帮助）。”<br><em>作用：不否定孩子的挫败感，用“小目标”帮她重建信心，避免因“学不会”陷入自我否定。</em></p></li><li><p><strong>场景2：孩子持续两周情绪低落，不想出门、不想写作业</strong><br>✅ 这样做：先温和表达关心“妈妈发现你最近不太开心，是不是有什么事压在心里？如果不想说也没关系，妈妈会一直陪着你”；若情况没改善，坦诚说“咱们一起去看看心理老师，不是你有问题，是我们一起找个专业的人帮你梳理情绪”，避免用“你必须去”施压。<br><em>作用：让孩子知道抑郁不可怕，寻求帮助是正常的，而非“我有病”。</em></p></li></ul><h3 id="2-缓解焦虑：教孩子“与焦虑共处”，而非“消灭焦虑”"><a href="#2-缓解焦虑：教孩子“与焦虑共处”，而非“消灭焦虑”" class="headerlink" title="2. 缓解焦虑：教孩子“与焦虑共处”，而非“消灭焦虑”"></a>2. 缓解焦虑：教孩子“与焦虑共处”，而非“消灭焦虑”</h3><ul><li><p><strong>场景：孩子因担心“背不出英语课文被老师点名”失眠</strong><br>❌ 别这样说：“背个课文有什么好怕的？赶紧背，背完就能睡了！”（否定焦虑+施压）<br>✅ 试试这样说：“担心背错被嘲笑，这种感觉确实不好受（共情）。咱们先深呼吸3次，再把课文分成3段，每段背5分钟就休息2分钟，背完后妈妈当老师，你试着背给我听，就算错了也没关系（拆解任务）。”<br><em>作用：帮孩子接纳“焦虑很正常”，用具体方法降低任务难度，减少焦虑感。</em></p></li><li><p><strong>日常小技巧：教孩子“焦虑日记”</strong><br>让孩子每天花5分钟写下“今天让我担心的事”“我担心的结果真的会发生吗”“如果发生了，我能怎么应对”。比如孩子担心“考试考砸”，引导她写“考砸的话，我可以看错题本，下次重点复习”，帮她从“灾难化想象”回到“解决问题”。</p></li></ul><h3 id="3-疏导嫉妒：把“负面情绪”转化为“正向动力”"><a href="#3-疏导嫉妒：把“负面情绪”转化为“正向动力”" class="headerlink" title="3. 疏导嫉妒：把“负面情绪”转化为“正向动力”"></a>3. 疏导嫉妒：把“负面情绪”转化为“正向动力”</h3><ul><li><strong>场景：孩子嫉妒同桌“每次数学都考90分，老师总表扬她”</strong><br>❌ 别这样说：“你就是小心眼，人家努力你怎么不学？”（贴标签+批评）<br>✅ 试试这样说：“看到同桌被老师表扬，你是不是也希望自己能像她一样优秀？（共情）咱们可以观察一下，她上课是不是会记笔记？或者作业有什么好方法，你也可以试试，妈妈相信你也能找到适合自己的学习节奏（引导转化）。”<br><em>作用：不否定嫉妒情绪，而是帮孩子看到“嫉妒背后是对优秀的渴望”，再引导她向榜样学习，而非敌视对方。</em></li></ul><h3 id="4-应对“报喜不报忧”：让孩子知道“不完美也值得被爱”"><a href="#4-应对“报喜不报忧”：让孩子知道“不完美也值得被爱”" class="headerlink" title="4. 应对“报喜不报忧”：让孩子知道“不完美也值得被爱”"></a>4. 应对“报喜不报忧”：让孩子知道“不完美也值得被爱”</h3><ul><li><strong>场景：孩子只说“老师夸我作文写得好”，却隐瞒“英语作业没写完被批评”</strong><br>❌ 别这样说：“你怎么只挑好的说？没写完作业怎么不告诉我？”（指责+质问）<br>✅ 试试这样说：“作文被表扬，妈妈真为你开心！（肯定好消息）对了，英语作业是不是遇到困难了？如果没写完，咱们可以一起看看怎么补，就算犯错也没关系，妈妈更想知道你需要什么帮助（主动打开话题）。”<br><em>作用：不追究“为什么隐瞒”，而是传递“不管你做得好不好，都可以跟我讲”，让孩子放下“怕失望”的顾虑。</em></li></ul><h3 id="5-处理暴躁情绪：教孩子“表达愤怒”，而非“发泄愤怒”"><a href="#5-处理暴躁情绪：教孩子“表达愤怒”，而非“发泄愤怒”" class="headerlink" title="5. 处理暴躁情绪：教孩子“表达愤怒”，而非“发泄愤怒”"></a>5. 处理暴躁情绪：教孩子“表达愤怒”，而非“发泄愤怒”</h3><ul><li><strong>场景：孩子因妈妈催起床，冲妈妈大喊“别管我”，还摔了杯子</strong><br>❌ 别这样说：“你敢跟我发脾气？还摔东西，反了你了！”（对抗+指责）<br>✅ 试试这样说：“妈妈催你，你是不是觉得不舒服，甚至有点生气？（共情）如果不想被催，你可以跟妈妈说‘我想自己定闹钟，再给我10分钟’，摔杯子会吓到妈妈，咱们用说话的方式解决，好吗？（教表达方法）”<br><em>作用：先接纳孩子的愤怒，再教她正确表达需求，而非用“发脾气”宣泄，避免亲子冲突升级。</em></li></ul><h3 id="6-发现情绪模式：针对性提供支持"><a href="#6-发现情绪模式：针对性提供支持" class="headerlink" title="6. 发现情绪模式：针对性提供支持"></a>6. 发现情绪模式：针对性提供支持</h3><ul><li><strong>步骤1：观察孩子的情绪信号</strong><br>记录孩子情绪不好时的行为：比如焦虑时会“抠指甲、反复检查书包”，难过时会“躲进房间听音乐”，暴躁时会“摔笔、不说话”。  </li><li><strong>步骤2：匹配对应支持</strong>  <ul><li>若孩子是“回避型”（难过时躲房间）：不强行让她“出来说”，而是放一张纸条“妈妈知道你现在不想说话，桌上有你喜欢的草莓，想吃的时候出来拿”，给她空间的同时传递关心；  </li><li>若孩子是“焦虑型”（反复吐槽同一件事）：不打断“别想了”，而是耐心听她说完，再一起梳理“这件事里，哪些是你能控制的（比如复习方法），哪些是控制不了的（比如别人的看法）”，帮她聚焦可控的部分。</li></ul></li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>初一女儿的情绪问题，本质是“自我探索期的迷茫”——她既想做好学生、好女儿，又不知道如何应对挫折和压力。第五章让我明白：家长不要做“情绪裁判”（判断“你不该焦虑”“你太矫情”），而要做“情绪容器”——先接住她的情绪，再陪她一起找方法。当孩子感受到“我的情绪被理解、被接纳”，她才会愿意打开心门，逐渐学会与情绪和平相处，真正平稳度过青春期。</p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第四章阅读笔记</title>
      <link href="/2025/10/29/70-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/29/70-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一女儿的家长，读完《解码青春期》第四章“别让青春期变成‘惹祸期’，积极关注孩子的个性发展”，我深刻意识到：初一正是孩子个性成型的关键期，独立、决策力、毅力等品质的培养，比成绩更影响长远发展。<br>这个阶段的孩子不再是“听话的小学生”，他们开始用“叛逆”“任性”表达自我，用“逃避”“依赖”掩饰不安。如果家长只盯着“纠正问题”，忽视个性背后的心理需求，只会让孩子更抵触。以下结合章节内容提炼重点，并给出与初一女儿的具体相处建议，帮她在个性发展中找到平衡。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>独立不是“不管”，而是帮孩子“试错”</strong><br>初一孩子开始渴望“自己做主”，比如自己选衣服、安排周末时间，但很多家长怕孩子“走弯路”，仍习惯包办（比如“这件衣服不好看，听我的”“周末必须去补数学”）。书中案例显示，过度干预会让孩子失去自我判断能力，甚至用“休学”“自伤”反抗。真正的独立培养，是给孩子“试错空间”——允许她选不那么合适的衣服、安排周末时偶尔拖延，再一起分析问题，而不是直接否定。</p></li><li><p><strong>决策力是“练”出来的，不是“教”出来的</strong><br>很多家长觉得“孩子太小，不会做决定”，比如替孩子选兴趣班、定学习计划。但书中强调，决策力需要从小事练起：让孩子选早餐吃面包还是包子、决定先写语文还是数学作业。如果长期替孩子做决定，她会变得依赖、犹豫，甚至成年后仍不敢为自己的选择负责。初一正是练决策力的黄金期，家长要从“决策者”变成“参谋”。</p></li><li><p><strong>“任性”背后是“自我需求”的呐喊</strong><br>孩子偶尔“任性”（比如坚持买某款文具、非要穿破洞裤），很多家长觉得是“不听话”，其实是孩子在探索“我是谁”。比如孩子坚持穿破洞裤，可能是想融入同学圈子；非要买某款文具，可能是觉得“这能体现我的审美”。如果直接否定“你这是瞎折腾”，会让孩子觉得“我的想法不重要”，反而更叛逆。</p></li><li><p><strong>毅力不是“逼出来的”，是“成就感”堆出来的</strong><br>很多家长用“坚持就是胜利”逼孩子练琴、刷题，却没意识到：孩子放弃，往往是因为看不到“努力的意义”（比如练琴总错、刷题总不会）。书中巴赫练琴的案例说明，毅力的核心是“小进步带来的成就感”——先让孩子完成“每天练10分钟琴”“每天做1道数学基础题”，在小目标达成中积累信心，比“必须练1小时”“必须刷10道题”更有效。</p></li><li><p><strong>叛逆是“压力的出口”，不是“故意作对”</strong><br>孩子的叛逆（比如顶嘴、故意拖延），大多是因为压力没处宣泄：可能是作业太多、可能是觉得家长不理解自己。书中案例中的孩子用“染五颜六色的头发”“逃学”反抗，背后是妈妈长期的“高压管控”。如果家长只批评“你怎么这么不听话”，不找压力源头，叛逆只会更严重。</p></li><li><p><strong>逃避不是“懒”，是“怕失败”</strong><br>孩子遇到困难就逃避（比如数学题不会就不写、和同学吵架就躲着），很多家长觉得是“没毅力”，其实是孩子怕“做不好被嘲笑”。比如孩子不写数学题，可能是怕“写错了被妈妈说笨”；躲着同学，可能是怕“再吵架更丢人”。此时强行逼孩子“面对”，只会让她更恐惧；帮她拆解困难、接纳“暂时做不好”，才是关键。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-培养独立：给“选择权”，陪“复盘错”"><a href="#1-培养独立：给“选择权”，陪“复盘错”" class="headerlink" title="1. 培养独立：给“选择权”，陪“复盘错”"></a>1. 培养独立：给“选择权”，陪“复盘错”</h3><ul><li><p><strong>场景1：孩子想自己选周末兴趣班</strong><br>❌ 别这样说：“画画没用，听我的，去学数学！”（否定需求，包办决定）<br>✅ 试试这样说：“你想选画画，是因为喜欢涂颜色，还是觉得能交到朋友呀？（了解原因）我们可以先体验1节课，如果你觉得有意思，就坚持；如果觉得不合适，咱们再换，怎么样？（给试错空间）”<br><em>作用：不直接否定孩子的选择，用“体验+复盘”帮她学会独立判断，而不是依赖家长。</em></p></li><li><p><strong>场景2：孩子自己安排周末，结果作业没写完</strong><br>❌ 别这样说：“让你听我的你不听，现在知道错了吧！”（指责+嘲讽）<br>✅ 试试这样说：“周末你先去玩了再写作业，结果没写完，是不是有点后悔？（共情）咱们一起看看，下次怎么安排能既玩到又不耽误作业，比如先写1小时作业再出去玩？（一起找方法）”<br><em>作用：不把“没做好”当成“独立的错”，而是帮她从错误中学会规划，强化独立的信心。</em></p></li></ul><h3 id="2-锻炼决策力：从小事入手，不做“完美要求”"><a href="#2-锻炼决策力：从小事入手，不做“完美要求”" class="headerlink" title="2. 锻炼决策力：从小事入手，不做“完美要求”"></a>2. 锻炼决策力：从小事入手，不做“完美要求”</h3><ul><li><p><strong>日常小事练决策</strong>：  </p><ul><li>早餐：“今天想吃面包配牛奶，还是包子配豆浆？”  </li><li>穿搭：“你想穿蓝色卫衣还是粉色外套？妈妈觉得蓝色更显精神，你可以参考我的想法。”  </li><li>作业：“你想先写语文阅读，还是先背英语单词？”<br>每次孩子做决定后，不管结果如何，都问一句“你觉得这样安排怎么样？下次想不想试试别的方式？”，让她习惯“做决定+反思”。</li></ul></li><li><p><strong>重要事当“参谋”</strong>：<br>比如孩子想参加学校合唱队，担心影响学习：<br>✅ 这样说：“参加合唱队能让你开心，也能锻炼胆量，这是好处；但可能会占用每天30分钟作业时间，这是需要考虑的地方。（分析利弊）你觉得怎么平衡作业和合唱队呢？（引导决策）”<br><em>作用：不替孩子定“能或不能”，而是教她分析利弊，慢慢学会为自己的选择负责。</em></p></li></ul><h3 id="3-应对“任性”：先“接纳需求”，再“找折中方案”"><a href="#3-应对“任性”：先“接纳需求”，再“找折中方案”" class="headerlink" title="3. 应对“任性”：先“接纳需求”，再“找折中方案”"></a>3. 应对“任性”：先“接纳需求”，再“找折中方案”</h3><ul><li><strong>场景：孩子非要买某款很贵的联名文具</strong><br>❌ 别这样说：“这文具又贵又不实用，你就是跟风！”（否定需求+贴标签）<br>✅ 试试这样说：“你想要这款文具，是不是因为同学都有，你想和他们一样？（共情需求）妈妈觉得有点贵，咱们可以约定‘这个月你每天认真整理书包，周末就买’，或者选一款性价比高的类似款式，你觉得哪个可行？（折中方案）”<br><em>作用：不否定孩子“想融入、想审美”的需求，用“约定+替代”满足她的心理，同时教她理解“不是所有想要的都能立刻得到”。</em></li></ul><h3 id="4-培养毅力：用“小目标-小奖励”积累成就感"><a href="#4-培养毅力：用“小目标-小奖励”积累成就感" class="headerlink" title="4. 培养毅力：用“小目标+小奖励”积累成就感"></a>4. 培养毅力：用“小目标+小奖励”积累成就感</h3><ul><li><p><strong>针对“练琴总放弃”</strong>：<br>❌ 别这样说：“必须练够1小时，不然不准玩！”（强制+施压）<br>✅ 试试这样说：“今天我们先练10分钟，把这首短曲子练会（小目标），练完后咱们一起看5分钟你喜欢的动画（小奖励）。如果觉得轻松，下次可以试着练15分钟。”<br><em>作用：用“小目标”降低难度，用“小奖励”强化成就感，让孩子觉得“坚持不难”，慢慢积累毅力。</em></p></li><li><p><strong>针对“刷题总错就不想写”</strong>：<br>✅ 这样做：和孩子一起把数学题分成“基础题”“中档题”“难题”，每天只做2道基础题+1道中档题。做对后，在错题本上画“星星”，集满5颗星星换一次“自主安排1小时”的机会。让她在“能做到”的范围内，逐渐愿意面对困难。</p></li></ul><h3 id="5-疏导叛逆：先“找压力源”，再“给出口”"><a href="#5-疏导叛逆：先“找压力源”，再“给出口”" class="headerlink" title="5. 疏导叛逆：先“找压力源”，再“给出口”"></a>5. 疏导叛逆：先“找压力源”，再“给出口”</h3><ul><li><strong>场景：孩子因为作业多，故意顶嘴、拖延</strong><br>❌ 别这样说：“作业多就更该抓紧，你还顶嘴，越来越不懂事！”（指责+无视压力）<br>✅ 试试这样说：“作业太多，你是不是觉得有点烦躁，想发泄一下？（共情压力）咱们可以先歇5分钟，吃点水果，再一起看看作业能不能分优先级，先写简单的，难的妈妈陪你一起想（给出口）。”<br><em>作用：不把“叛逆”当成“故意作对”，先接住孩子的情绪，再帮她找解决办法，让她知道“压力可以说出来，不用靠顶嘴发泄”。</em></li></ul><h3 id="6-应对逃避：先“接纳不完美”，再“拆困难”"><a href="#6-应对逃避：先“接纳不完美”，再“拆困难”" class="headerlink" title="6. 应对逃避：先“接纳不完美”，再“拆困难”"></a>6. 应对逃避：先“接纳不完美”，再“拆困难”</h3><ul><li><strong>场景：孩子数学题不会，就把作业扔一边</strong><br>❌ 别这样说：“不会就问啊，扔一边算什么本事！”（指责+施压）<br>✅ 试试这样说：“这道题看起来有点难，你是不是怕做错了被说？（共情恐惧）咱们先看看题目里的关键信息，把能看懂的部分画出来，要是还不会，妈妈陪你一起查课本例题，慢慢想（拆困难）。”<br><em>作用：不否定孩子“怕失败”的心理，用“拆题+陪伴”帮她降低恐惧，让她知道“暂时不会没关系，我们可以一起解决”。</em></li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>孩子的个性发展，本质是“寻找自我”的过程——她需要通过独立判断、做决策、面对困难，弄清楚“我是谁”“我能做什么”。第四章让我明白：家长不要做“个性的纠正者”，而要做“个性的守护者”——允许她试错、陪她复盘、接纳她的不完美。当孩子感受到“我的想法被尊重、我的困难有人陪”，她才会在个性发展中更自信、更从容，真正成长为“有主见、能负责”的人。</p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第三章阅读笔记</title>
      <link href="/2025/10/28/69-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/28/69-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一女儿的家长，读完《解码青春期》第三章“正视成绩波动，寻找影响孩子学习成绩的因素”，我深刻意识到：初一孩子的成绩问题，从来不是“懒”“笨”那么简单，背后藏着心理状态、学习方法、兴趣动力等多重因素。初一正是适应初中学习节奏、打基础的关键期，盲目催促成绩、指责孩子，只会让孩子陷入“成绩差→自卑→更厌学”的恶性循环。以下结合章节内容提炼重点，并给出与初一女儿的具体相处建议，帮自己科学应对孩子的学习问题。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>先理解“苦累”，再谈“努力”</strong><br>初一孩子刚从小学过渡到初中，科目从3科增至7科，作业量翻倍，还要适应早自习、晚自习的节奏，心理和身体都在承受压力。很多家长觉得“学生哪有上班累”，但对孩子来说，陌生的知识、频繁的考试、排名的压力，已经是“极限挑战”。不先共情孩子的“苦”，只说“加油”“再努力点”，只会让孩子觉得“家长不理解我”，逐渐抵触学习。</p></li><li><p><strong>心理状态是成绩的“隐形开关”</strong><br>书中“罗森塔尔效应”案例让我警醒：当家长总说“你数学就是不行”“你太粗心”，孩子会逐渐认同这种负面暗示，真的觉得“我学不好”；反之，若能肯定孩子的努力（“这道题你上次错了3道，这次只错1道，进步了”），孩子会更有信心突破困难。初一孩子的自我认知还不稳定，家长的态度直接影响他们的学习心态——心态崩了，成绩自然好不了。</p></li><li><p><strong>作业拖拉不是“懒”，是“满足感缺失”</strong><br><strong>很多家长觉得孩子写作业拖拉是“故意磨蹭”，其实可能是孩子在学习中找不到成就感</strong>。比如一道数学题卡半小时，越写越烦躁，干脆玩橡皮、上厕所拖延；或者先写喜欢的语文，把难的数学留到最后，结果越拖越晚。强行催促、指责，只会让孩子更抵触；帮孩子找到“小成就感”（比如先做简单题、拆分成小任务），才能让他们主动推进。</p></li><li><p><strong>偏科不可怕，可怕的是“贴标签”</strong><br>初一孩子容易出现偏科，比如语文每次90分，数学却总在70分徘徊。很多家长一看到偏科就焦虑：<strong>“你怎么偏科这么严重！”“数学拉分太厉害，必须补！”这种态度会让孩子觉得“我就是学不好数学”，逐渐放弃努力</strong>。其实偏科可能是兴趣差异、方法不当，甚至是对老师的喜好导致的，找到原因比贴“偏科生”标签更重要。</p></li><li><p><strong>和老师关系差，会直接影响学科兴趣</strong><br>初一孩子开始有“喜恶偏好”，如果不喜欢某个老师（比如觉得老师太严厉、讲课无聊），可能会连带讨厌这门课——上课不听、作业应付，成绩自然下滑。很多家长觉得“是你不认真，跟老师没关系”，但对孩子来说，对老师的负面情绪会直接“屏蔽”这门学科，此时需要家长搭桥沟通，而不是一味指责孩子“不懂事”。</p></li><li><p><strong>科学看待游戏，别把它当“洪水猛兽”</strong><br>很多初一孩子开始接触游戏，家长的第一反应是“玩游戏影响学习，必须禁了”。但书中案例显示，很多孩子玩游戏是因为“学习压力太大，只有游戏能放松”，或者“家长不让出门、不让交朋友，只能玩游戏解闷”。<strong>完全禁止只会让孩子偷偷玩、更沉迷</strong>；和孩子约定“玩游戏的时间和规则”（比如写完作业玩30分钟），才是理性的做法。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-共情学习压力：先“接住情绪”，再“解决问题”"><a href="#1-共情学习压力：先“接住情绪”，再“解决问题”" class="headerlink" title="1. 共情学习压力：先“接住情绪”，再“解决问题”"></a>1. 共情学习压力：先“接住情绪”，再“解决问题”</h3><ul><li><p><strong>场景1：孩子说“作业太多，写不完了”</strong><br>❌ 别这样说：“别人都能写完，就你写不完，肯定是你上课没认真听！”（否定努力+对比打击）<br>✅ 试试这样说：“爸爸看你写了2小时还没歇，确实挺累的（共情）。咱们一起看看作业，先写语文这种你擅长的，把数学难题留到最后，爸爸陪你一起想（具体帮助）。”<br><em>作用：先认可孩子的辛苦，再提供实际帮助，比单纯指责更能激发孩子的动力。</em></p></li><li><p><strong>场景2：孩子考砸了，哭着说“我太笨了”</strong><br>❌ 别这样说：“哭有什么用？早知道平时多复习！”（否定情绪+说教）<br>✅ 试试这样说：“没考好肯定很委屈吧（共情）？咱们一起看看试卷，哪些题是因为没学懂，哪些是粗心（客观分析）。这道题你上次也错了，这次思路对了一半，已经有进步了（肯定努力）。”<br><em>作用：帮孩子从“自我否定”中走出来，聚焦“如何改进”，而不是陷入情绪内耗。</em></p></li></ul><h3 id="2-应对作业拖拉：用“小目标-小奖励”培养成就感"><a href="#2-应对作业拖拉：用“小目标-小奖励”培养成就感" class="headerlink" title="2. 应对作业拖拉：用“小目标+小奖励”培养成就感"></a>2. 应对作业拖拉：用“小目标+小奖励”培养成就感</h3><ul><li><strong>帮孩子拆分任务</strong>：比如周末作业，和孩子一起列清单：  <ol><li>周六上午9:00-10:00 写语文阅读（2篇）  </li><li>10:15-11:00 写数学基础题（10道）  </li><li>下午2:00-3:00 背英语单词（20个）+ 默写课文片段<br>每完成一项，打个勾，允许孩子玩15分钟（看漫画、听歌曲），让她在“完成-奖励”中找到满足感。</li></ol></li><li><strong>不催“速度”，看“进度”</strong>：如果孩子写数学时卡壳，不说“怎么这么慢”，而是问“这道题哪里不懂？是公式没记住，还是思路没理清？”，帮她拆解困难，而不是用“速度”施压。</li></ul><h3 id="3-面对偏科：不贴标签，用“优势带动劣势”"><a href="#3-面对偏科：不贴标签，用“优势带动劣势”" class="headerlink" title="3. 面对偏科：不贴标签，用“优势带动劣势”"></a>3. 面对偏科：不贴标签，用“优势带动劣势”</h3><ul><li><strong>场景：孩子语文好、数学差</strong><br>❌ 别这样说：“你怎么偏科这么严重！数学再不好，中考肯定完蛋！”（焦虑施压+贴标签）<br>✅ 试试这样说：“你语文阅读理解特别厉害，能从文章里找重点（肯定优势）。其实数学题也像读文章，咱们一起把题目里的关键信息画出来，说不定你会发现数学也没那么难（关联优势）。”<br><em>作用：用孩子擅长的学科建立信心，再引导她用类似方法攻克弱科，比直接补弱科更易接受。</em>  </li><li><strong>找“弱科小突破”</strong>：比如孩子数学几何差，每天让她做1道几何基础题，做对了就夸“这道辅助线画得特别对，比上次思路清晰多了”，让她觉得“我能学好数学”，逐渐积累信心。</li></ul><h3 id="4-改善师生关系：当孩子的“桥梁”，不做“裁判”"><a href="#4-改善师生关系：当孩子的“桥梁”，不做“裁判”" class="headerlink" title="4. 改善师生关系：当孩子的“桥梁”，不做“裁判”"></a>4. 改善师生关系：当孩子的“桥梁”，不做“裁判”</h3><ul><li><strong>场景：孩子说“我讨厌数学老师，她总批评我”</strong><br>❌ 别这样说：“老师批评你肯定是你错了！你怎么这么小心眼！”（否定感受+站队老师）<br>✅ 试试这样说：“老师总批评你，你肯定觉得委屈吧（共情）？要不要和爸爸说说，老师一般什么时候批评你？是因为作业没写完，还是上课没举手（引导倾诉）？”<br>等孩子说完，再建议：“如果下次作业认真写，上课试着举一次手，说不定老师会注意到你的努力（具体建议）。如果还是觉得委屈，妈妈可以和老师聊聊你的情况（提供支持）。”<br><em>作用：先站在孩子这边理解情绪，再引导她尝试改变，必要时家长出面沟通，让孩子知道“我有后盾”。</em></li></ul><h3 id="5-科学管理游戏：约定规则，不“一刀切”"><a href="#5-科学管理游戏：约定规则，不“一刀切”" class="headerlink" title="5. 科学管理游戏：约定规则，不“一刀切”"></a>5. 科学管理游戏：约定规则，不“一刀切”</h3><ul><li><strong>一起制定“游戏公约”</strong>：  <ol><li>时间：每天写完所有作业后，玩30分钟手机（周末可延长到1小时）；  </li><li>规则：如果当天作业错太多、拖延超过1小时，取消当天游戏时间；如果一周都遵守规则，周末多奖励10分钟；  </li><li>替代：如果孩子想玩游戏但时间没到，可用“一起拼乐高”“下楼跳绳10分钟”替代，满足她的放松需求。</li></ol></li><li><strong>不把游戏当“惩罚工具”</strong>：不说“你这次没考好，一周不许玩游戏”，而是说“这周作业总拖延，咱们先调整写作业效率，等效率提上来，再恢复游戏时间”，让孩子知道“限制游戏是因为行为，不是因为成绩”，减少抵触。</li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>初一女儿的学习问题，本质是“适应+信心”的问题——适应初中节奏、建立学科信心。<strong>第三章让我明白：家长不能只盯着分数，要做孩子的“学习伙伴”：先共情她的压力，再帮她找方法；先肯定她的努力，再引导她突破困难。少点焦虑的“催促”，多点具体的“帮助”，孩子才能在学习中找到成就感，主动往前走。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人生要完成的两个任务</title>
      <link href="/2025/10/27/68-%E4%BA%BA%E7%94%9F%E8%A6%81%E5%AE%8C%E6%88%90%E7%9A%84%E4%B8%A4%E4%B8%AA%E4%BB%BB%E5%8A%A1/"/>
      <url>/2025/10/27/68-%E4%BA%BA%E7%94%9F%E8%A6%81%E5%AE%8C%E6%88%90%E7%9A%84%E4%B8%A4%E4%B8%AA%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p> “那么，是什么让一个人摆脱束缚、独立自主呢？财富做不到，高官厚禄、国家或王权也做不到 —— 相反，必须找到别的东西…… 就生活而言，那就是懂得如何生活。”</p></blockquote><p>人生中有两项至关重要的任务：<strong>成为一个好人，并从事自己热爱的职业</strong>。其他一切都是精力的浪费和自身潜力的挥霍。</p><p>要如何做到呢？好吧，这是个更棘手的问题。但从斯多葛派哲学中，我们能找到足够简单的答案：</p><ul><li><strong>对分心之事说不</strong></li><li><strong>对破坏性情绪说不</strong></li><li><strong>对外部压力说不</strong></li></ul><p>问问自己：有什么是只有我能做的？在这世上，怎样才能最充分地利用我有限的时间？</p><p><strong>当形势需要时，努力去做正确的事</strong>。<strong>以你希望被对待的方式去对待他人</strong>。并且要明白，<strong>每一个小选择、每一件小事，都是践行这些宏大原则的机会</strong>。</p><p>就是这样。这就是所有技能中最重要的一项 —— 如何生活 —— 所包含的内容。</p>]]></content>
      
      
      <categories>
          
          <category> 思考 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人生 </tag>
            
            <tag> 任务 </tag>
            
            <tag> 自由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>女儿你好：这五件事一定要告诉爸爸妈妈</title>
      <link href="/2025/10/24/67-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E8%BF%99%E4%BA%94%E4%BB%B6%E4%BA%8B%E4%B8%80%E5%AE%9A%E8%A6%81%E5%91%8A%E8%AF%89%E7%88%B8%E7%88%B8%E5%A6%88%E5%A6%88/"/>
      <url>/2025/10/24/67-%E5%A5%B3%E5%84%BF%E4%BD%A0%E5%A5%BD%EF%BC%9A%E8%BF%99%E4%BA%94%E4%BB%B6%E4%BA%8B%E4%B8%80%E5%AE%9A%E8%A6%81%E5%91%8A%E8%AF%89%E7%88%B8%E7%88%B8%E5%A6%88%E5%A6%88/</url>
      
        <content type="html"><![CDATA[<p>女儿，你好：</p><p>今天爸爸看到一个视频，她分享了学校里的孩子有五件事一定要告诉爸爸妈妈。<br>我觉得有点道理，分享给你。</p><ol><li>被小猫小狗抓伤或者咬伤，一并不要害怕被责骂而选择隐瞒。<br>因为，这种情况可能会感染上狂犬病。要知道一单感染上狂犬病，死亡率是100%，但是只要我们及时的去医院用药就一点事都没有。</li><li>如果在外面玩的时候不小心磕到后脑勺，即使不疼也一定要告诉爸妈。<br>因为，这可能导致脑血管破裂（开始的时候可能是没有感觉的），在72小时内都是非常危险的。</li><li>被生锈的利器（比如铁钉、剪刀、铁皮等）划伤，也一定要告诉爸妈。<br>因为要马上打针，避免感染“破伤风”，破伤风是很严重的病，不能耽误。</li><li>误食了不明物体，也一定要告诉爸妈。<br>因为有可能导致食物中毒。比如：电池、水晶泥、弹力珠、荧光棒、荧光笔，这些其实含有有毒成分。</li><li>不管是同学还是朋友，怂恿你去做一些危险的事情或者让你做一下你认为不好的事情，还不让你告诉爸妈，这时候你一定要赶紧远离，并且及时告诉爸爸妈妈。<br>因为爸爸妈妈才是这个世界上最爱你的人。</li></ol><p>爱你的爸爸<br>2025年10月24日</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 危险的事 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第二章阅读笔记</title>
      <link href="/2025/10/23/66-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%BA%8C%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/23/66-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%BA%8C%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>作为初一孩子的家长，读完《解码青春期》第二章“别和孩子较劲，与青春期孩子沟通有方法”，我深刻意识到：青春期亲子沟通的核心不是“说服孩子听话”，而是“让孩子愿意开口”。<strong>初一的孩子正处于“半独立半依赖”的特殊阶段，既渴望被尊重，又需要家长的支撑，稍有沟通不当，就容易让她关上心门</strong>。</p><h2 id="一、核心重点提炼"><a href="#一、核心重点提炼" class="headerlink" title="一、核心重点提炼"></a>一、核心重点提炼</h2><ol><li><p><strong>拒绝“道德评判”，只描述事实</strong><br>家长最容易犯的错，是把“孩子的行为”和“孩子的人品”绑定。比如孩子忘记叠被子，不说“你怎么总这么懒”（道德评判），而说“我看到你的被子还没叠，早晨出门急的话，晚上回来咱们一起整理？”（描述事实+提供帮助）。<strong>初一孩子开始有强烈的自尊心，定性式的批评（“你自私”“你不懂事”）会让她觉得“家长不理解我，只看我做错的地方”，进而抵触沟通</strong>。</p></li><li><p><strong>爱和陪伴是沟通的“敲门砖”</strong><br>很多家长觉得“我为孩子赚钱、报补习班就是爱”，但孩子更需要“看得见的陪伴”。比如放下手机听她聊学校的八卦、陪她一起吐槽难搞的老师，比单纯说“爸爸妈妈爱你”更有用。书中案例里，长期缺乏陪伴的孩子会用“买贵东西、自残”来“讨爱”，这提醒我：<strong>孩子需要的不是物质补偿，而是每天15分钟“不被打扰的专属时间”。</strong></p></li><li><p><strong>“信任”是沟通的基础，失信一次就可能崩塌</strong><br>孩子对家长的信任，藏在“答应的事是否做到”里。比如承诺“考好了带她去看演唱会”，就不能因“作业没写完”临时反悔；说“4点来接她”，就不能让她等到6点。初一孩子开始记“账”，<strong>一次失信可能让她觉得“家长的话都是假的”，之后再想聊心事，她会下意识封闭自己。</strong></p></li><li><p><strong>强势父母只会把孩子推远，“商量”比“命令”更有效</strong><br>很多家长觉得“我是为她好，她必须听我的”，比如强制要求“放学先写数学作业”，却不问她“是不是想先歇会儿，因为今天体育课跑了800米”。<strong>初一孩子开始有自己的“小逻辑”，强势安排会让她觉得“家长不在乎我的感受”，即便表面顺从，心里也会积累抵触，早晚爆发冲突。</strong></p></li><li><p><strong>先“共情感受”，再“解决问题”</strong><br>孩子说“我讨厌这个老师”，别急着反驳“老师都是为你好”，先回应“你是不是觉得老师批评你的时候，让你没面子了？”（共情感受）。<strong>初一孩子的情绪优先于道理，先接住她的情绪，她才会愿意听你说“那咱们想想，下次怎么和老师沟通会更舒服”。如果跳过情绪直接讲道理，她只会觉得“你根本不懂我”。</strong></p></li><li><p><strong>别把自己的不愉快归咎于孩子</strong><br>工作不顺、夫妻吵架后，别对孩子说“都怪你不省心，我才这么累”。孩子会把家长的负面情绪“内归因”，觉得“是我不好，才让爸爸妈妈不开心”，进而变得小心翼翼、不敢说话。正确的做法是说“爸爸今天工作有点累，想先歇10分钟，之后咱们再聊你的作业，好吗？”，让她知道“家长的情绪和她无关”。</p></li></ol><h2 id="二、与初一女儿的具体相处建议"><a href="#二、与初一女儿的具体相处建议" class="headerlink" title="二、与初一女儿的具体相处建议"></a>二、与初一女儿的具体相处建议</h2><h3 id="1-日常沟通：用“事实-感受”代替“评判-指责”"><a href="#1-日常沟通：用“事实-感受”代替“评判-指责”" class="headerlink" title="1. 日常沟通：用“事实+感受”代替“评判+指责”"></a>1. 日常沟通：用“事实+感受”代替“评判+指责”</h3><ul><li><p><strong>场景1：孩子放学回家没先写作业，先刷短视频</strong><br>❌ 别这样说：“你怎么总这么不自觉！就知道玩手机，以后肯定考不上高中！”（道德评判+夸大后果）<br>✅ 试试这样说：“我看到你回家先刷了20分钟短视频（事实），爸爸有点担心你晚上写作业会熬夜（感受），咱们要不要约定‘每天回家先写30分钟作业，再玩15分钟手机’？（具体建议）”<br><em><strong>作用：不否定孩子的需求（想放松），同时传递关心，孩子更愿意接受约定。</strong></em></p></li><li><p><strong>场景2：孩子抱怨“同桌总借我文具不还”</strong><br>❌ 别这样说：“你怎么这么小气！借个文具而已，至于吗？”（否定感受+道德评判）<br>✅ 试试这样说：“同桌总借走文具不还，你是不是觉得‘我的东西没被尊重’（共情感受）？下次她借的时候，咱们可以说‘这个笔我等会儿要用，你先用另一支，记得用完还我哦’（具体方法），要不要试试？”<br><em><strong>作用：先认可孩子的委屈，再教她如何表达需求，比单纯“劝大度”更有用。</strong></em></p></li></ul><h3 id="2-建立信任：“说到做到-失信补救”双管齐下"><a href="#2-建立信任：“说到做到-失信补救”双管齐下" class="headerlink" title="2. 建立信任：“说到做到+失信补救”双管齐下"></a>2. 建立信任：“说到做到+失信补救”双管齐下</h3><ul><li><strong>做到“小事有回应”</strong>：比如她让你“帮她买一本漫画书”，记在手机备忘录里，买回来后说“你上次提的漫画书，妈妈今天路过书店帮你带了”，让她知道“我说的话家长放在心上”。  </li><li><strong>失信后及时补救</strong>：如果答应带她去公园，却因临时加班爽约，别只说“下次吧”，可以说“妈妈今天没做到，特别抱歉（道歉），咱们把公园之行改到周日，再额外陪你去吃你喜欢的冰淇淋（补偿），可以吗？”，让她知道“家长失信会弥补，不是故意的”。</li></ul><h3 id="3-避免强势：给孩子“有限选择权”，让她觉得“我有话语权”"><a href="#3-避免强势：给孩子“有限选择权”，让她觉得“我有话语权”" class="headerlink" title="3. 避免强势：给孩子“有限选择权”，让她觉得“我有话语权”"></a>3. 避免强势：给孩子“有限选择权”，让她觉得“我有话语权”</h3><ul><li><p><strong>场景1：安排周末时间</strong><br>❌ 别直接说：“周六上午补数学，下午学英语，周日在家写作业！”（强制安排）<br>✅ 试试这样说：“周末要补数学和英语，你想上午补数学、下午学英语，还是上午学英语、下午补数学？（二选一）写完作业后，咱们还能留1小时去逛文具店（附加福利）。”<br><em><strong>作用：在家长的底线内（必须补两门课）给孩子选择权，她会觉得“家长尊重我的想法”，减少抵触。</strong></em></p></li><li><p><strong>场景2：孩子想染浅色头发</strong><br>❌ 别直接说：“初中生染头发像什么样子！绝对不行！”（强势拒绝）<br>✅ 试试这样说：“妈妈知道浅色头发很好看（认可需求），但学校规定不能染夸张颜色（客观规则），咱们可以约定‘等放暑假，咱们一起选一个浅棕色，既好看又不违反规定’（折中方案），怎么样？”<br><em><strong>作用：不否定孩子的审美，用“延迟满足+规则”达成共识，比直接拒绝更易接受</strong>。</em></p></li></ul><h3 id="4-倾听技巧：“不打断、不反驳、多提问”，让她愿意说更多"><a href="#4-倾听技巧：“不打断、不反驳、多提问”，让她愿意说更多" class="headerlink" title="4. 倾听技巧：“不打断、不反驳、多提问”，让她愿意说更多"></a>4. 倾听技巧：“不打断、不反驳、多提问”，让她愿意说更多</h3><ul><li><strong>当孩子聊学校的事时</strong>：  <ul><li>不打断：哪怕她聊的“同桌的八卦”很无聊，也别中途说“别聊这些没用的，说说你考试的事”，先听完她的话，再慢慢引导到学习上。  </li><li>不反驳：她吐槽“数学老师讲课太无聊”，别急着说“老师讲得挺好，是你没认真听”，先回应“听起来你上数学课的时候有点走神（共情），是老师讲得太快，还是你没跟上？（提问）”。  </li><li>多提问：用“后来呢？”“你当时是什么感觉？”“你希望妈妈帮你做些什么吗？”引导她多说，少用“嗯”“哦”敷衍。<br><em><strong>作用：初一孩子愿意聊“小事”，是因为她觉得“家长愿意听”，长期下来，她才会主动聊“大事”（比如和朋友吵架、考试压力）。</strong></em></li></ul></li></ul><h3 id="5-区分“要求”和“命令”：给孩子“拒绝的权利”"><a href="#5-区分“要求”和“命令”：给孩子“拒绝的权利”" class="headerlink" title="5. 区分“要求”和“命令”：给孩子“拒绝的权利”"></a>5. 区分“要求”和“命令”：给孩子“拒绝的权利”</h3><ul><li><strong>场景：让孩子帮忙做家务</strong><br>❌ 别用命令：“快去把碗洗了！我上班这么累，你就该帮忙！”（没给拒绝空间，道德绑架）<br>✅ 试试提要求：“妈妈今天有点累，想请你帮忙洗下碗（表达需求），如果你现在不想洗，咱们可以约定‘你写完作业再洗，妈妈先擦桌子’（给拒绝后的替代方案）。”<br><em>作用：要求是“商量”，命令是“强迫”。给孩子拒绝的权利，她反而更愿意主动帮忙，因为“这是我选的，不是被强迫的”。</em></li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p><strong>初一孩子的沟通需求，本质是“被看见、被尊重、被信任”。第二章的核心不是教家长“怎么让孩子听话”，而是教我们“怎么让孩子愿意和我们说话”。少一点评判，多一点共情；少一点强势，多一点商量；少一点敷衍，多一点倾听，孩子才会愿意把心里的“小秘密”分享给我们，亲子沟通才能真正顺畅。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《解码青春期》第一章-读书笔记</title>
      <link href="/2025/10/22/65-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/10/22/65-%E3%80%8A%E8%A7%A3%E7%A0%81%E9%9D%92%E6%98%A5%E6%9C%9F%E3%80%8B%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>读完《解码青春期》第一章，我意识到青春期孩子的心理变化远比“叛逆”二字复杂，家长的教育方式直接影响孩子的心智成熟。</p><h2 id="一、书中重点摘录"><a href="#一、书中重点摘录" class="headerlink" title="一、书中重点摘录"></a>一、书中重点摘录</h2><ol><li><strong>警惕“假性关爱”，避免过度包办</strong><br>很多家长误以为“无微不至的照顾”就是爱，比如帮孩子挤牙膏、整理书包，甚至还帮孩子安排所有生活细节。但书中案例显示，这种过度包办会让孩子失去独立能力，还可能让孩子觉得“父母的爱有控制欲”，进而产生不信任感。孩子正处于独立意识萌芽期，过度照顾反而会阻碍她的自我成长。</li><li><strong>尊重孩子的“独立个体”属性</strong><br>不要总说“你跟我小时候一样”“这点随你爸爸”，这类话会让孩子觉得自己不是“独立的人”，而是父母的“延伸”。孩子开始在意“自我独特性”，比如喜欢小众的文具、有自己的穿搭风格，家长若用自己的标准否定她，会让她觉得“父母不理解我”，逐渐关闭心门。</li><li><strong>教育无捷径，拒绝“急功近利”</strong><br>面对孩子成绩波动、人际矛盾，不要总问“多久能好”“怎么快速解决”。书中提到，孩子的心理问题和行为习惯不是一天形成的，比如孩子厌学，可能是长期压力积累的结果，家长需要耐心陪孩子找原因，而不是急于“纠错”。<br>初一正是打基础的阶段，急于求成反而会让孩子焦虑。</li><li><strong>放弃“完美期待”，接受孩子的“不完美”</strong><br>不要拿孩子跟“别人家的孩子”比，也不要用自己的“未竟梦想”要求孩子。比如希望孩子数学考满分，却忽视她擅长语文的优势，会让孩子觉得“我永远不够好”。<br>孩子的自我认知还不稳定，过度期待会打击她的自信心，甚至让她产生“我没用”的负面评价。</li><li><strong>平衡“自由”与“自律”，不搞极端</strong><br>既不要完全放任孩子（比如让她无节制玩手机），也不要过度控制（比如规定每分每秒做什么）。孩子需要“有边界的自由”，比如允许她自主安排周末时间，但要约定“完成作业后才能玩游戏，且每天不超过1小时”，让她在自由中学会自律。</li><li><strong>控制“怒气”，批评要讲方法</strong><br>孩子磨磨蹭蹭、作业出错时，不要动辄大吼大叫。书中建议家长先给怒气“打分”（0-100分），比如孩子早晨迟到，先想想“这件事值得我发80分的脾气吗”，再冷静沟通。初一孩子开始有“自尊心”，当众批评、翻旧账会让她觉得“父母不尊重我”，反而更叛逆。</li></ol><h2 id="二、与孩子的相处建议"><a href="#二、与孩子的相处建议" class="headerlink" title="二、与孩子的相处建议"></a>二、与孩子的相处建议</h2><ol><li><strong>减少包办，让她“自己的事自己做”</strong></li></ol><ul><li>从生活细节入手：不再帮她整理书包、准备第二天的衣服，而是前一晚提醒她“检查好书包，把明天要穿的衣服放在床头”，如果她忘记带课本，不帮她送，让她自己跟老师沟通解决，体会“自己负责”的后果。</li><li>允许她“试错”：比如她想自己规划周末作业时间，即使安排得不合理（比如先玩再写导致熬夜），也先不否定，等她体验到“熬夜写作业效率低”后，再跟她一起调整计划，比直接说教更有效。</li></ul><ol start="2"><li><strong>尊重她的“小独特”，不随意否定</strong></li></ol><ul><li>面对她的“小众喜好”：如果她喜欢收集卡通贴纸、听小众歌手的歌，不贬低“这有什么用”，而是主动问“这个贴纸的图案有什么故事吗”，甚至跟她一起聊喜欢的歌手，让她觉得“父母愿意了解我的世界”。</li><li>不强行“贴标签”：她偶尔一次没考好，不说“你就是粗心”，而是说“爸爸看到你这次计算错了几道题，我们一起看看怎么能更细心”，避免用“粗心”“笨”等定性的词否定她。</li></ul><ol><li><strong>用“具体赞美”代替“裁判式表扬”</strong></li></ol><ul><li>避免空洞的赞美：不说“你真棒”“你真乖”，而是具体描述她的行为和影响，让她知道“自己的优点被看到了”，而不是觉得“爸爸妈妈的赞美有目的”。</li><li>不把赞美和“要求”绑定：不说“你这次考得好，爸爸妈妈才喜欢你”，而是说“不管你考多少分，爸爸妈妈都喜欢你，因为你是我的女儿”，让她明白“父母的爱是无条件的”，减少她对“成绩的焦虑”。</li></ul><ol><li><strong>批评时“对事不对人”，先共情再沟通</strong></li></ol><ul><li>孩子犯错时先共情：比如她跟同学吵架，不说“你怎么总跟人闹矛盾”，而是说“爸爸妈妈知道你现在肯定很生气，能跟我们说说发生了什么吗”，等她情绪平复后，再一起分析“下次遇到这种情况，有没有更好的解决办法”。</li><li>不翻旧账：批评只针对当下的事，比如她这次作业拖拉，不说“你上次也拖拉”，而是说“现在已经8点了，作业还没写完，我们一起看看怎么能提高速度”，避免让她觉得“父母总盯着我的错”。</li></ul><ol start="5"><li><strong>陪她“平衡”自由与自律，一起定规则</strong></li></ol><ul><li>一起制定“手机使用规则”：跟她商量“每天写完作业后可以玩30分钟手机，晚上9点半后交手机”，如果她遵守，周末多给10分钟；如果违反，下周减少10分钟，让她知道“规则是双方约定的，不是父母强加的”。</li><li>给她“自主选择权”：比如报兴趣班，不直接说“你必须学XX”，而是带她体验兴趣课，让她选自己喜欢的，告诉她“你选的课，我们一起坚持，但不能半途而废”，培养她的决策能力和责任感。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 青春期 </tag>
            
            <tag> 教育 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>64 安装Gradle 6.3</title>
      <link href="/2025/10/20/64-%E5%AE%89%E8%A3%85Gradle-6-3/"/>
      <url>/2025/10/20/64-%E5%AE%89%E8%A3%85Gradle-6-3/</url>
      
        <content type="html"><![CDATA[<p>因为打算开发Fisco的合约应用，所以按照官方文档的要求，需要安装Gradle6.3版本（7以上的版本会报错。）</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p>首先，下载Gradle6.3的压缩包 <a href="https://mirrors.cloud.tencent.com/gradle/gradle-6.3-all.zip">gradle-6.3-all.zip</a></p><p>然后解压缩到某个回来，比如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\devspace\gradle-6.3</span><br></pre></td></tr></table></figure><p>配置系统环境变量</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251020171400704.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251020171447622.png" alt="image.png"></p><p>测试验证</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle -v </span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Gradle 6.3</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build time:   2020-03-24 19:52:07 UTC</span><br><span class="line">Revision:     bacd40b727b0130eeac8855ae3f9fd9a0b207c60</span><br><span class="line"></span><br><span class="line">Kotlin:       1.3.70</span><br><span class="line">Groovy:       2.5.10</span><br><span class="line">Ant:          Apache Ant(TM) version 1.10.7 compiled on September 1 2019</span><br><span class="line">JVM:          1.8.0_202 (Oracle Corporation 25.202-b08)</span><br><span class="line">OS:           Windows 10 10.0 amd64</span><br></pre></td></tr></table></figure><h2 id="配置镜像仓库"><a href="#配置镜像仓库" class="headerlink" title="配置镜像仓库"></a>配置镜像仓库</h2><p>Gradle默认从国际站点下载，在国内会比较慢，可以配置腾讯的镜像源。<br>在gradle-6.3\init.d下创建init.gradle文件，然后输入如下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        // 阿里云镜像</span><br><span class="line">        maven &#123; url &#x27;https://maven.aliyun.com/repository/public/&#x27; &#125;</span><br><span class="line">        maven &#123; url &#x27;https://maven.aliyun.com/repository/google/&#x27; &#125;</span><br><span class="line">        maven &#123; url &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27; &#125;</span><br><span class="line">        </span><br><span class="line">        // 华为云镜像</span><br><span class="line">        maven &#123; url &#x27;https://mirrors.huaweicloud.com/repository/maven/&#x27; &#125;</span><br><span class="line">        </span><br><span class="line">        // 备用Maven中央仓库</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    buildscript &#123;</span><br><span class="line">        repositories &#123;</span><br><span class="line">            maven &#123; url &#x27;https://maven.aliyun.com/repository/public/&#x27; &#125;</span><br><span class="line">            maven &#123; url &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="验证有消息"><a href="#验证有消息" class="headerlink" title="验证有消息"></a>验证有消息</h2><p>创建一个Java项目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir gradle-test</span><br><span class="line">cd gradle-test</span><br><span class="line">gradle init --type java-application</span><br></pre></td></tr></table></figure><p>然后编译它</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle build</span><br></pre></td></tr></table></figure><p>基于国内源会非常快。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>62 CentOS 上搭建WeBase</title>
      <link href="/2025/10/20/62-CentOS-%E4%B8%8A%E6%90%AD%E5%BB%BAWeBase/"/>
      <url>/2025/10/20/62-CentOS-%E4%B8%8A%E6%90%AD%E5%BB%BAWeBase/</url>
      
        <content type="html"><![CDATA[<blockquote><p>WeBASE（WeBank Blockchain Application Software Extension） 是在区块链应用和FISCO-BCOS节点之间搭建的一套通用组件。围绕交易、合约、密钥管理，数据，可视化管理来设计各个模块，开发者可以根据业务所需，选择子系统进行部署。WeBASE屏蔽了区块链底层的复杂度，降低开发者的门槛，大幅提高区块链应用的开发效率，包含节点前置、节点管理、交易链路，数据导出，Web管理平台等子系统。</p></blockquote><p>参考原文：<a href="https://webasedoc.readthedocs.io/zh-cn/latest/docs/WeBASE-Install/visual_deploy.html">可视化部署 — WeBASE v1.5.5 文档</a></p><p>本文介绍WeBase的可视化部署。可视化部署是指通过 WeBASE 管理平台（WeBASE-Web + WeBASE-Node-Manager），在 <strong>多台</strong> 主机上快速部署 <strong>FISCO-BCOS 底层节点和 WeBASE-Front 前置</strong> 以及 对底层节点的扩容操作。</p><p>可视化部署，需要先部署依赖服务，包括管理平台（WeBASE-Web）、节点管理子系统（WeBASE-Node-Manager）、签名服务（WeBASE-Sign）。</p><p>然后通过 WeBASE 管理平台（WeBASE-Web）的界面在填入的主机中部署节点（FISCO-BCOS 2.5.0+，暂未支持FISCO-BCOS 3.0系列）和节点前置子系统（WeBASE-Front 1.4.0+）。</p><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="主机防火墙需要开放以下端口。"><a href="#主机防火墙需要开放以下端口。" class="headerlink" title="主机防火墙需要开放以下端口。"></a>主机防火墙需要开放以下端口。</h3><table><thead><tr><th>端口</th><th>描述</th></tr></thead><tbody><tr><td>22</td><td>默认SSH登录端口</td></tr><tr><td>5000</td><td>WeBASE-Web 节点管理平台的访问端口</td></tr><tr><td>输入如下命令</td><td></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=22/tcp --permanent</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=5000/tcp --permanent</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=5002/tcp --permanent</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload</span><br></pre></td></tr></table></figure><h3 id="更新CentOS-源"><a href="#更新CentOS-源" class="headerlink" title="更新CentOS 源"></a>更新CentOS 源</h3><p>备份原来的源文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure><p>下载阿里云的镜像源配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><ul><li>清理旧缓存并生成新缓存：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum clean all</span><br><span class="line"><span class="built_in">sudo</span> yum makecache</span><br></pre></td></tr></table></figure><h2 id="系统依赖"><a href="#系统依赖" class="headerlink" title="系统依赖"></a>系统依赖</h2><p>配置系统依赖分成<strong>宿主机</strong>（Node-Manager所在主机）与<strong>节点主机</strong>（节点所在主机）两种：</p><ul><li>宿主机：安装WeBASE-Node-Manager的主机，配置Ansible、配置Ansible免密登录节点机</li><li>节点主机：用于安装节点的主机，配置docker及docker用户组、配置Ansible用户的sudo权限、安装FISCO BOCS节点依赖</li></ul><p><strong>注：宿主机也需要安装节点时，则需要同时配置。</strong></p><h3 id="配置Ansible"><a href="#配置Ansible" class="headerlink" title="配置Ansible"></a>配置Ansible</h3><p>Ansible配置包括以下三步：</p><ul><li>宿主机安装Ansible<ul><li><strong>仅在宿主机安装节点</strong>时，则仅需安装Ansible，无需完成下面两步host与免密配置</li></ul></li><li>配置Ansible host列表</li><li>配置Ansible免密登录到节点主机</li></ul><h4 id="安装Ansible"><a href="#安装Ansible" class="headerlink" title="安装Ansible"></a>安装Ansible</h4><p><strong>注</strong>：Ansible只需要安装在宿主机上，节点主机无需安装Ansible，只需配置宿主机到节点主机的免密登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install ansible –y</span><br></pre></td></tr></table></figure><p>安装完之后，验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible --version</span><br></pre></td></tr></table></figure><h4 id="配置Ansible-host-key-checking"><a href="#配置Ansible-host-key-checking" class="headerlink" title="配置Ansible host_key_checking"></a>配置Ansible host_key_checking</h4><p>配置Ansible的Host key checking，将自动确认连接到远程主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ansible/ansible.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到host_key_checking选项</span></span><br><span class="line">···</span><br><span class="line">host_key_checking = False</span><br></pre></td></tr></table></figure><h4 id="免密登录配置"><a href="#免密登录配置" class="headerlink" title="免密登录配置"></a>免密登录配置</h4><p>在节点管理台进行可视化部署时，节点管理（WeBASE-Node-Manager）服务会为每个节点生成相应的配置文件，然后通过Ansible的免密登录远程操作，在远程的节点主机中执行系统命令来操作节点。</p><p>下面介绍配置免密登录的各个步骤</p><ol><li>配置 WeBASE-Node-Manager 主机到其它节点主机的 SSH 免密登录；</li><li>配置Ansible的hosts列表并配置免密登录私钥路径</li><li>注意免密登录的账号sudo权限，否则会造成Docker服务启动、检测端口占用失败；</li><li>如果免密账号为非 root 账号，保证账号有 sudo <strong>免密</strong> 权限，即使用 sudo 执行命令时，不需要输入密码；</li></ol><p><strong>免密登录配置方法</strong></p><blockquote><p>[!important]<br>如果 WeBASE-Node-Manager 所在主机已经生成过秘钥对，建议使用命令 ssh-keygen -t rsa -m PEM 重新生成；</p></blockquote><p>登录 WeBASE-Node-Manager 所在主机：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ssh root@[IP]</span></span><br><span class="line">ssh root@192.168.201.133</span><br></pre></td></tr></table></figure><p>检查 <code>~/.ssh/</code> 目录是否已经存在 <code>id_rsa</code> 私钥文件和对应的 <code>id_rsa.pub</code> 公钥文件。如果存在，备份现有私钥对</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> ~/.ssh/id_rsa ~/.ssh/id_rsa.bak</span><br><span class="line"><span class="built_in">mv</span> ~/.ssh/id_rsa.pub ~/.ssh/id_rsa.pub.bak</span><br></pre></td></tr></table></figure><p>如果没有文件会出现下面的找不到文件的提示，属于正常情况</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No such file or directory</span><br></pre></td></tr></table></figure><p>执行命令 <code>ssh-keygen -t rsa -m PEM</code>，然后直接两次回车即可生成（提示输入密码时，直接回车）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -m PEM</span><br></pre></td></tr></table></figure><p>输出下面的信息说明创建证书成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:vZU9eYKCJIFeApkg1gnmjmz3XTvzLRYX2/a9BRaHIZc root@localhost.localdomain</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|o=++...     . o. |</span><br><span class="line">|= ooo ..     oEo |</span><br><span class="line">| . . o. .     o .|</span><br><span class="line">|+   .  o o   = + |</span><br><span class="line">|.+ .    S.o + @ .|</span><br><span class="line">|. . . . . .= + B |</span><br><span class="line">|     . . +. o . +|</span><br><span class="line">|          +o.   +|</span><br><span class="line">|          .... ..|</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将公钥文件上传到需要免密登录的主机（替换<code> [IP]</code> 为节点主机的 IP 地址），然后输入远程主机的登录密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@[IP]</span><br></pre></td></tr></table></figure><p>假设节点安装的4台主机IP如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.201.129</span><br><span class="line">192.168.201.130</span><br><span class="line">192.168.201.131</span><br><span class="line">192.168.201.132</span><br></pre></td></tr></table></figure><p>则启动相应的节点主机并执行下面的命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@192.168.201.129</span><br><span class="line"></span><br><span class="line">ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@192.168.201.130</span><br><span class="line"></span><br><span class="line">ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@192.168.201.131</span><br><span class="line"></span><br><span class="line">ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@192.168.201.132</span><br></pre></td></tr></table></figure><p>运行命令后会提示输入root用户的密码，如果看到下面的提示说明证书上传成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh -o &#x27;StrictHostKeyChecking=no&#x27; &#x27;root@192.168.201.129&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>检查从部署 WeBASE-Node-Manager 服务的主机是否能成功免密登录部署节点的主机（替换<code> [IP]</code> 为主机的 IP 地址）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh -o StrictHostKeyChecking=no root@[IP]</span></span><br><span class="line">ssh -o StrictHostKeyChecking=no root@192.168.201.129</span><br><span class="line"></span><br><span class="line">ssh -o StrictHostKeyChecking=no root@192.168.201.130</span><br><span class="line"></span><br><span class="line">ssh -o StrictHostKeyChecking=no root@192.168.201.131</span><br><span class="line"></span><br><span class="line">ssh -o StrictHostKeyChecking=no root@192.168.201.132</span><br></pre></td></tr></table></figure><p>如果出现类似下面的信息说明可以成功登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Last login: Wed Oct 15 23:47:59 2025</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><em>切记妥善保管免密登录的私钥，否则当前主机与ssh免密登录的主机均会被控制</em></p><p>此处配置宿主机免密登录到节点主机完成后，记住宿主机中<code>id_rsa</code>私钥的路径，下一步进行Ansible中hosts的免密配置。</p><p><strong>配置Ansible Hosts与免密登录</strong></p><p>在<code>/etc/ansible/hosts</code>文件中添加IP组<code>webase</code>，并配置节点主机的IP、免密登录账号和私钥路径、SSH端口。</p><blockquote><p>[!note]<br><strong>注</strong>：若后续需要添加新的主机，需要将新主机的IP添加到此处</p></blockquote><p>添加以下内容：此处假设节点机IP为192.168.201.133，免密登录账户为root，且<code>id_rsa</code>免密私钥的路径为<code>/root/.ssh/id_rsa</code>，ssh端口使用22端口，添加名为<code>webase</code>的IP组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先登录到NodeManger主机也就是我们的宿主机</span></span><br><span class="line">ssh -o StrictHostKeyChecking=no root@192.168.201.133</span><br><span class="line"><span class="comment">## 然后添加节点的面膜登录配置</span></span><br><span class="line">vi /etc/ansible/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[webase]</span><br><span class="line">192.168.201.129 ansible_ssh_private_key_file=/root/.ssh/id_rsa  ansible_ssh_user=root  ansible_ssh_port=22</span><br><span class="line">192.168.201.130 ansible_ssh_private_key_file=/root/.ssh/id_rsa  ansible_ssh_user=root  ansible_ssh_port=22</span><br><span class="line">192.168.201.131 ansible_ssh_private_key_file=/root/.ssh/id_rsa  ansible_ssh_user=root  ansible_ssh_port=22</span><br><span class="line">192.168.201.132 ansible_ssh_private_key_file=/root/.ssh/id_rsa  ansible_ssh_user=root  ansible_ssh_port=22</span><br></pre></td></tr></table></figure><h4 id="测试Ansible"><a href="#测试Ansible" class="headerlink" title="测试Ansible"></a>测试Ansible</h4><p>执行Ansible的<code>--list-hosts</code>命令查看是否已添加成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ansible webase --list-hosts</span><br><span class="line">  hosts (4):</span><br><span class="line">    192.168.201.129</span><br><span class="line">    192.168.201.130</span><br><span class="line">    192.168.201.131</span><br><span class="line">    192.168.201.132</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行Ansible的<code>ping</code>命令，检测添加到hosts中各个节点主机IP能否被访问，免密配置是否已生效</p><ul><li>若出现<code>IP | SUCCESS</code>的则代表该IP可连通</li><li>如果出现<code>FAILED</code>代表该IP无法连接，需要根据上文的免密登录配置进行<code>ssh -o StrictHostKeyChecking=no root@[IP]</code>检测</li></ul><p>对ansible中的webase ip组进行ping检测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webase -m ping</span><br></pre></td></tr></table></figure><p>输出结果类似下面这样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">92.168.201.131 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.201.130 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.201.129 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置Docker"><a href="#配置Docker" class="headerlink" title="配置Docker"></a>配置Docker</h3><p>配置Docker需要<strong>在每个安装节点的主机上都要执行</strong>，否则将导致节点远程安装失败。包括以下几个步骤</p><ul><li>安装Docker并启动Docker</li><li>配置Docker用户组</li></ul><h4 id="替换阿里源"><a href="#替换阿里源" class="headerlink" title="替换阿里源"></a>替换阿里源</h4><p>docker安装之前先替换centos的源为阿里源</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>登录每一个主机安装docker</p><h4 id="安装依赖工具"><a href="#安装依赖工具" class="headerlink" title="安装依赖工具"></a>安装依赖工具</h4><p>安装 <em>yum-utils</em> 工具，用于管理软件包和配置仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure><h4 id="添加-Docker-官方仓库"><a href="#添加-Docker-官方仓库" class="headerlink" title="添加 Docker 官方仓库"></a>添加 Docker 官方仓库</h4><p>运行以下命令添加 Docker 的官方仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h4 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h4><p>使用以下命令安装 Docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p>首先查看 Docker 服务是否处于运行状态：</p><p>bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status docker</span><br></pre></td></tr></table></figure><ul><li>若输出中包含 <code>inactive (dead)</code>，说明 Docker 服务未启动；</li><li>若包含 <code>active (running)</code>，则可能是守护进程配置异常（后续步骤处理）。</li></ul><p>如果服务未启动，执行以下命令启动服务，并配置开机自动启动（避免下次重启后仍需手动启动）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 Docker 服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 Docker 开机自启（可选但推荐）</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h4 id="配置docker用户组"><a href="#配置docker用户组" class="headerlink" title="配置docker用户组"></a>配置docker用户组</h4><p>检测<code>docker ps</code>命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>若<code>docker ps</code>命令报错Permission Denied则需要配置docker用户组：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 创建docker用户组</span><br><span class="line">sudo groupadd docker</span><br><span class="line"># 将当前用户添加到docker用户组</span><br><span class="line">sudo usermod -aG docker $USER</span><br><span class="line"># 重启docker服务</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"># 切换或者退出当前账户，重新登入</span><br><span class="line">exit</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>重新登入后，执行<code>docker ps</code>如有输出，未报错Permission Denied则代表配置成功。</p><h2 id="一键部署依赖安装"><a href="#一键部署依赖安装" class="headerlink" title="一键部署依赖安装"></a>一键部署依赖安装</h2><p>一键部署需要安装以下依赖环境</p><table><thead><tr><th>环境</th><th>版本</th></tr></thead><tbody><tr><td>Java</td><td>Oracle JDK 8 至 14</td></tr><tr><td>MySQL</td><td>MySQL-5.6及以上</td></tr><tr><td>Python</td><td>Python3.6及以上</td></tr><tr><td>PyMySQL</td><td></td></tr></tbody></table><h3 id="Java安装"><a href="#Java安装" class="headerlink" title="Java安装"></a>Java安装</h3><p>基于CentOS的安装，系统默认带有OpenJDK1.8，执行下面命令查看jdk版本</p><blockquote><p>[!caution]<br><strong>CentOS下OpenJDK无法正常工作，需要安装OracleJDK<a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">下载链接</a>。</strong></p></blockquote><p>从Oracle官网(<a href="https://www.oracle.com/java/technologies/downloads/#java8)%E9%80%89%E6%8B%A9Java">https://www.oracle.com/java/technologies/downloads/#java8)选择Java</a> 8或以上的版本下载，例如下载jdk-8u461-linux-x64.tar.gz</p><p>然后可以创建一个文件夹保存下载的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /software</span><br></pre></td></tr></table></figure><p>解压jdk</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u461-linux-x64.tar.gz </span><br></pre></td></tr></table></figure><p>修改解压后的文件夹，便于查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> jdk1.8.0_461 jdk-8u461</span><br></pre></td></tr></table></figure><p>配置Java环境，编辑&#x2F;etc&#x2F;profile文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开以后将下面三句输入到文件里面并保存退出</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/software/jdk-8u461  <span class="comment">#这是一个文件目录，非文件</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生效profile</span></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询Java版本，出现的版本是自己下载的版本，则安装成功。</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><h3 id="MySQL-安装"><a href="#MySQL-安装" class="headerlink" title="MySQL 安装"></a>MySQL 安装</h3><p>此处以<strong>CentOS 7(x86_64)<strong>安装</strong>MariaDB 10.6</strong>为例。_MariaDB_数据库是 MySQL 的一个分支，主要由开源社区在维护，采用 GPL 授权许可。_MariaDB_完全兼容 MySQL，包括API和命令行。MariaDB 10.2版本对应Mysql 5.7。其他安装方式请参考<a href="https://dev.mysql.com/downloads/mysql/">MySQL官网</a>。</p><ul><li>CentOS 7 默认MariaDB为5.5版本，安装10.6版本需要按下文进行10.6版本的配置。</li><li>若使用CentOS 8则直接使用<code>sudo yum install -y mariadb*</code>即可安装MariaDB 10.3，并跳到下文的 <em>启停</em> 章节即可。</li></ul><p>使用<code>vi</code>或<code>vim</code>创建新文件<code>/etc/yum.repos.d/mariadb.repo</code>，并写入下文的文件内容（参考<a href="http://mirrors.ustc.edu.cn/help/mariadb.html">MariaDB中科大镜像源修改</a>进行配置）</p><ul><li>创建repo文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vi /etc/yum.repos.d/mariadb.repo</span><br></pre></td></tr></table></figure><ul><li>文件内容，此处使用的是中科大镜像源</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MariaDB 10.6 CentOS repository list - created 2021-07-12 07:37 UTC</span></span><br><span class="line"><span class="comment"># http://downloads.mariadb.org/mariadb/repositories/</span></span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = https://mirrors.ustc.edu.cn/mariadb/yum/10.6/centos7-amd64</span><br><span class="line">gpgkey=https://mirrors.ustc.edu.cn/mariadb/yum/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br></pre></td></tr></table></figure><ul><li>更新yum源缓存数据</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache all</span><br></pre></td></tr></table></figure><ul><li>安装<code>MariaDB 10.2</code></li><li>如果已存在使用<code>sudo yum install -y mariadb*</code>命令安装的MariaDB，其版本默认为5.5版本，对应Mysql版本为5.5。新版本MariaDB无法兼容升级，需要先<strong>卸载旧版本</strong>的MariaDB，卸载前需要<strong>备份</strong>数据库内容，卸载命令可参考<code>yum remove mariadb</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y mariadb-server</span><br></pre></td></tr></table></figure><p>启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start mariadb.service</span><br></pre></td></tr></table></figure><p>停止数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop  mariadb.service</span><br></pre></td></tr></table></figure><p>设置开机启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable mariadb.service</span><br></pre></td></tr></table></figure><p>初始化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">执行以下命令：</span><br><span class="line">sudo mariadb-secure-installation</span><br><span class="line">以下根据提示输入：</span><br><span class="line">Enter current password for root (enter for none):&lt;–初次运行直接回车</span><br><span class="line">Set root password? [Y/n] &lt;– 是否设置root用户密码，输入y并回车或直接回车</span><br><span class="line">New password: &lt;– 设置root用户的密码</span><br><span class="line">Re-enter new password: &lt;– 再输入一次你设置的密码</span><br><span class="line">Remove anonymous users? [Y/n] &lt;– 是否删除匿名用户，回车</span><br><span class="line">Disallow root login remotely? [Y/n] &lt;–是否禁止root远程登录，回车</span><br><span class="line">Remove test database and access to it? [Y/n] &lt;– 是否删除test数据库，回车</span><br><span class="line">Reload privilege tables now? [Y/n] &lt;– 是否重新加载权限表，回车</span><br></pre></td></tr></table></figure><ul><li>授权访问用户</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p -h localhost -P 3306</span><br></pre></td></tr></table></figure><ul><li>授权root用户远程访问</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27; WITH GRANT OPTION;</span><br><span class="line">mysql &gt; flush PRIVILEGES;</span><br></pre></td></tr></table></figure><p>这样就设置了远程root用户，密码是123456</p><ul><li>创建test用户并授权本地访问</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; GRANT ALL PRIVILEGES ON *.* TO &#x27;test&#x27;@localhost IDENTIFIED BY &#x27;123456&#x27; WITH GRANT OPTION;</span><br><span class="line">mysql &gt; flush PRIVILEGES;</span><br></pre></td></tr></table></figure><ul><li>登录数据库</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -utest -p123456 -h localhost -P 3306</span><br></pre></td></tr></table></figure><ul><li>创建数据库</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; create database webasenodemanager;</span><br></pre></td></tr></table></figure><h3 id="安装Python-3-x"><a href="#安装Python-3-x" class="headerlink" title="安装Python 3.x"></a>安装Python 3.x</h3><p>python版本要求使用python3.x, 推荐使用python3.6及以上版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y python36</span><br><span class="line">sudo yum install -y python36-pip</span><br></pre></td></tr></table></figure><h3 id="安装PyMySQL"><a href="#安装PyMySQL" class="headerlink" title="安装PyMySQL"></a>安装PyMySQL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install PyMySQL</span><br></pre></td></tr></table></figure><h3 id="检查服务器网络策略"><a href="#检查服务器网络策略" class="headerlink" title="检查服务器网络策略"></a>检查服务器网络策略</h3><p>网络策略检查：</p><ul><li><strong>开放WeBASE管理平台端口</strong>：检查webase-web管理平台页面的端口<code>webPort</code>(默认为5000)在服务器的网络安全组中是否设置为<strong>开放</strong>。如，云服务厂商如腾讯云，查看安全组设置，为webase-web开放5000端口。<strong>若端口未开放，将导致浏览器无法访问WeBASE服务页面</strong></li><li><strong>开放节点前置端口</strong>：如果希望通过浏览器直接访问webase-front节点前置的页面，则需要开放节点前置端口<code>frontPort</code>（默认5002）；由于节点前置直连节点，<strong>不建议对公网开放节点前置端口</strong>，建议按需开放</li></ul><h2 id="拉取部署脚本"><a href="#拉取部署脚本" class="headerlink" title="拉取部署脚本"></a>拉取部署脚本</h2><p>获取部署安装包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/WeBankBlockchain/WeBASELargeFiles/releases/download/v1.5.5/webase-deploy.zip</span><br></pre></td></tr></table></figure><p>解压安装包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip webase-deploy.zip</span><br></pre></td></tr></table></figure><p>进入目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd webase-deploy</span><br></pre></td></tr></table></figure><h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>mysql数据库需提前安装，已安装直接配置即可。<br>修改配置文件（<code>vi common.properties</code>）；</p><p>一键部署支持使用已有链或者搭建新链。通过参数”if.exist.fisco”配置是否使用已有链，以下配置二选一即可：</p><ul><li>当配置”yes”时，需配置已有链的路径<code>fisco.dir</code>。路径下要存在sdk目录，sdk目录中包含ca.crt, sdk.crt, sdk.key及gm目录，gm目录中包含国密SSL所需证书，包含gmca.crt、gmsdk.crt、gmsdk.key、gmensdk.crt和gmensdk.key</li><li>当配置”no”时，需配置节点fisco版本和节点安装个数，搭建的新链默认两个群组</li></ul><p>服务端口不能小于1024</p><p>部署时，修改 <code>common.properties</code> 配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WeBASE子系统的最新版本(v1.1.0或以上版本)</span></span><br><span class="line"><span class="attr">webase.web.version</span>=<span class="string">v1.5.5</span></span><br><span class="line"><span class="attr">webase.mgr.version</span>=<span class="string">v1.5.5</span></span><br><span class="line"><span class="attr">webase.sign.version</span>=<span class="string">v1.5.5</span></span><br><span class="line"><span class="attr">webase.front.version</span>=<span class="string">v1.5.5</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">## 使用Docker启用Mysql服务，则需要配置以下值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 1: enable mysql in docker</span></span><br><span class="line"><span class="comment"># 0: mysql run in host, required fill in the configuration of webase-node-mgr and webase-sign</span></span><br><span class="line"><span class="attr">docker.mysql</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># if [docker.mysql=1], mysql run in host (only works in [installDockerAll])</span></span><br><span class="line"><span class="comment"># run mysql 5.6 by docker</span></span><br><span class="line"><span class="attr">docker.mysql.port</span>=<span class="string">23306</span></span><br><span class="line"><span class="comment"># default user [root]</span></span><br><span class="line"><span class="attr">docker.mysql.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">## 不使用Docker启动Mysql，则需要配置以下值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 节点管理子系统mysql数据库配置</span></span><br><span class="line"><span class="attr">mysql.ip</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">mysql.port</span>=<span class="string">3306</span></span><br><span class="line"><span class="attr">mysql.user</span>=<span class="string">dbUsername</span></span><br><span class="line"><span class="attr">mysql.password</span>=<span class="string">dbPassword</span></span><br><span class="line"><span class="attr">mysql.database</span>=<span class="string">webasenodemanager</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 签名服务子系统mysql数据库配置</span></span><br><span class="line"><span class="attr">sign.mysql.ip</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">sign.mysql.port</span>=<span class="string">3306</span></span><br><span class="line"><span class="attr">sign.mysql.user</span>=<span class="string">dbUsername</span></span><br><span class="line"><span class="attr">sign.mysql.password</span>=<span class="string">dbPassword</span></span><br><span class="line"><span class="attr">sign.mysql.database</span>=<span class="string">webasesign</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 节点前置子系统h2数据库名和所属机构</span></span><br><span class="line"><span class="attr">front.h2.name</span>=<span class="string">webasefront</span></span><br><span class="line"><span class="attr">front.org</span>=<span class="string">fisco</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># WeBASE管理平台服务端口</span></span><br><span class="line"><span class="attr">web.port</span>=<span class="string">5000</span></span><br><span class="line"><span class="comment"># 启用移动端管理平台 (0: disable, 1: enable)</span></span><br><span class="line"><span class="attr">web.h5.enable</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 节点管理子系统服务端口</span></span><br><span class="line"><span class="attr">mgr.port</span>=<span class="string">5001</span></span><br><span class="line"><span class="comment"># 节点前置子系统端口</span></span><br><span class="line"><span class="attr">front.port</span>=<span class="string">5002</span></span><br><span class="line"><span class="comment"># 签名服务子系统端口</span></span><br><span class="line"><span class="attr">sign.port</span>=<span class="string">5004</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 节点监听Ip</span></span><br><span class="line"><span class="attr">node.listenIp</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="comment"># 节点p2p端口</span></span><br><span class="line"><span class="attr">node.p2pPort</span>=<span class="string">30300</span></span><br><span class="line"><span class="comment"># 节点链上链下端口</span></span><br><span class="line"><span class="attr">node.channelPort</span>=<span class="string">20200</span></span><br><span class="line"><span class="comment"># 节点rpc端口</span></span><br><span class="line"><span class="attr">node.rpcPort</span>=<span class="string">8545</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 加密类型 (0: ECDSA算法, 1: 国密算法)</span></span><br><span class="line"><span class="attr">encrypt.type</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># SSL连接加密类型 (0: ECDSA SSL, 1: 国密SSL)</span></span><br><span class="line"><span class="comment"># 只有国密链才能使用国密SSL</span></span><br><span class="line"><span class="attr">encrypt.sslType</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 是否使用已有的链（yes/no）</span></span><br><span class="line"><span class="attr">if.exist.fisco</span>=<span class="string">no</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 使用已有链时需配置</span></span><br><span class="line"><span class="comment"># 已有链的路径，start_all.sh脚本所在路径</span></span><br><span class="line"><span class="comment"># 路径下要存在sdk目录（sdk目录中包含了SSL所需的证书，即ca.crt、sdk.crt、sdk.key和gm目录（包含国密SSL证书，gmca.crt、gmsdk.crt、gmsdk.key、gmensdk.crt和gmensdk.key）</span></span><br><span class="line"><span class="attr">fisco.dir</span>=<span class="string">/data/app/nodes/127.0.0.1</span></span><br><span class="line"><span class="comment"># 前置所连接节点，在127.0.0.1目录中的节点中的一个</span></span><br><span class="line"><span class="comment"># 节点路径下要存在conf文件夹，conf里存放节点证书（ca.crt、node.crt和node.key）</span></span><br><span class="line"><span class="attr">node.dir</span>=<span class="string">node0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 搭建新链时需配置</span></span><br><span class="line"><span class="comment"># FISCO-BCOS版本</span></span><br><span class="line"><span class="attr">fisco.version</span>=<span class="string">v2.11.0</span></span><br><span class="line"><span class="comment"># 搭建节点个数（默认两个）</span></span><br><span class="line"><span class="attr">node.counts</span>=<span class="string">nodeCounts</span></span><br></pre></td></tr></table></figure><p>上述配置文件中记得将以下两项改成mysql数据库的用户名和密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sign.mysql.user=dbUsername</span><br><span class="line">sign.mysql.password=dbPassword</span><br></pre></td></tr></table></figure><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul><li>执行installAll命令，部署服务将自动部署FISCO BCOS节点，并部署 WeBASE 中间件服务，包括签名服务（sign）、节点前置（front）、节点管理服务（node-mgr）、节点管理前端（web）</li></ul><p><strong>备注：</strong></p><ul><li>部署脚本会拉取相关安装包进行部署，需保持网络畅通</li><li>首次部署需要下载编译包和初始化数据库，重复部署时可以根据提示不重复操作</li><li>部署过程中出现报错时，可根据错误提示进行操作，或根据本文档中的<a href="https://webasedoc.readthedocs.io/zh-cn/latest/docs/WeBASE/install.html#q&a">常见问题</a>进行排查</li><li><strong>不要用sudo执行脚本</strong>，例如<code>sudo python3 deploy.py installAll</code>（sudo会导致无法获取当前用户的环境变量如JAVA_HOME）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署并启动所有服务</span></span><br><span class="line">python3 deploy.py installAll</span><br></pre></td></tr></table></figure><p>部署完成后可以看到<code>deploy has completed</code>的日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ python3 deploy.py installWeBASE</span><br><span class="line">...</span><br><span class="line">============================================================</span><br><span class="line">              _    _     ______  ___  _____ _____ </span><br><span class="line">             | |  | |    | ___ \/ _ \/  ___|  ___|</span><br><span class="line">             | |  | | ___| |_/ / /_\ \ `--.| |__  </span><br><span class="line">             | |/\| |/ _ | ___ |  _  |`--. |  __| </span><br><span class="line">             \ /\ |  __| |_/ | | | /\__/ | |___ </span><br><span class="line">              \/  \/ \___\____/\_| |_\____/\____/  </span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">============================================================</span><br><span class="line">==============      deploy has completed     ==============</span><br><span class="line">============================================================</span><br><span class="line">==============    webase-web version  v1.5.0        ========</span><br><span class="line">==============    webase-node-mgr version  v1.5.0   ========</span><br><span class="line">==============    webase-sign version  v1.5.0       ========</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure><ul><li>服务部署后，需要对各服务进行启停操作，可以使用以下命令：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 可视化部署</span><br><span class="line">部署并启动可视化部署的所有服务  python3 deploy.py installWeBASE</span><br><span class="line">停止可视化部署的所有服务  python3 deploy.py stopWeBASE</span><br><span class="line">启动可视化部署的所有服务  python3 deploy.py startWeBASE</span><br><span class="line"># 各子服务启停</span><br><span class="line">启动WeBASE-Node-Manager: python3 deploy.py startManager</span><br><span class="line">停止WeBASE-Node-Manager: python3 deploy.py stopManager</span><br><span class="line">启动WeBASE-Web:          python3 deploy.py startWeb</span><br><span class="line">停止WeBASE-Web:          python3 deploy.py stopWeb</span><br><span class="line">启动WeBASE-Sign:        python3 deploy.py startSign</span><br><span class="line">停止WeBASE-Sign:        python3 deploy.py stopSign</span><br></pre></td></tr></table></figure><h2 id="可视化部署节点"><a href="#可视化部署节点" class="headerlink" title="可视化部署节点"></a>可视化部署节点</h2><p>在部署完依赖服务后，使用浏览器，访问节点管理平台页面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 默认端口 5000</span><br><span class="line">http://&#123;deployIP&#125;:&#123;webPort&#125;</span><br><span class="line"># 我的测试环境是下面的地址</span><br><span class="line">http://192.168.201.133:500</span><br></pre></td></tr></table></figure><p>然后用默认的用户名和密码登录 admin&#x2F;Abcd1234，第一次要求修改为自己的密码。</p><p>注意：这里有一个bug。当创建私钥的时候会抛出异常。这是因为后天数据库tb_user表中缺少private_key字段。目前官方还没有解决这个问题，但是GitHub中提到这是因为签名服务和节点管理服务共用了一个数据库导致的。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于新闻：《北大成功研制出新型芯片，算力可超顶级GPU1000倍》的解读</title>
      <link href="/2025/10/16/63%20%E5%85%B3%E4%BA%8E%E6%96%B0%E9%97%BB%EF%BC%9A%E3%80%8A%E5%8C%97%E5%A4%A7%E6%88%90%E5%8A%9F%E7%A0%94%E5%88%B6%E5%87%BA%E6%96%B0%E5%9E%8B%E8%8A%AF%E7%89%87%EF%BC%8C%E7%AE%97%E5%8A%9B%E5%8F%AF%E8%B6%85%E9%A1%B6%E7%BA%A7GPU1000%E5%80%8D%E3%80%8B%E7%9A%84%E8%A7%A3%E8%AF%BB/"/>
      <url>/2025/10/16/63%20%E5%85%B3%E4%BA%8E%E6%96%B0%E9%97%BB%EF%BC%9A%E3%80%8A%E5%8C%97%E5%A4%A7%E6%88%90%E5%8A%9F%E7%A0%94%E5%88%B6%E5%87%BA%E6%96%B0%E5%9E%8B%E8%8A%AF%E7%89%87%EF%BC%8C%E7%AE%97%E5%8A%9B%E5%8F%AF%E8%B6%85%E9%A1%B6%E7%BA%A7GPU1000%E5%80%8D%E3%80%8B%E7%9A%84%E8%A7%A3%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<p>刚看到这个新闻的时候以为是假的，因为这个结果太震撼了。但是抱着小心求证的理念，让AI帮我查询了论文并做了总结。结论是论文是真的，论文论述的内容也是真的，但是新闻标题有点夸张。以下是Gork的解读，留存。</p><p>论文的原文上传到了Github： <a href="https://github.com/bsneric/note-gen-image-sync/blob/main/Precise_and_scalable_analogue_matrix_equation_solv.pdf">Precise_and_scalable_analogue_matrix_equation_solv.pdf </a></p><h3 id="论文原文概述"><a href="#论文原文概述" class="headerlink" title="论文原文概述"></a>论文原文概述</h3><p>该论文的原文发表在《Nature Electronics》期刊上，标题为《Precise and scalable analogue matrix equation solving using resistive random-access memory chips》。原文可通过Nature官网（<a href="https://www.nature.com/articles/s41928-025-01477-0%EF%BC%89%E8%AE%BF%E9%97%AE%EF%BC%8C%E4%BD%86%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E8%AE%A2%E9%98%85%E6%88%96%E6%9C%BA%E6%9E%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E3%80%82">https://www.nature.com/articles/s41928-025-01477-0）访问，但可能需要订阅或机构访问权限。</a> 此外，ResearchGate上提供了一个免费的PDF版本（<a href="https://www.researchgate.net/publication/396448715_Precise_and_scalable_analogue_matrix_equation_solving_using_resistive_random-access_memory_chips%EF%BC%89%EF%BC%8C%E5%8C%85%E5%90%AB%E5%AE%8C%E6%95%B4%E6%96%87%E6%9C%AC%EF%BC%8C%E5%8C%85%E6%8B%AC%E6%91%98%E8%A6%81%E3%80%81%E5%BC%95%E8%A8%80%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E7%BB%93%E6%9E%9C%E3%80%81%E8%AE%A8%E8%AE%BA%E5%92%8C%E7%BB%93%E8%AE%BA%E3%80%82">https://www.researchgate.net/publication/396448715_Precise_and_scalable_analogue_matrix_equation_solving_using_resistive_random-access_memory_chips），包含完整文本，包括摘要、引言、方法、结果、讨论和结论。</a> 论文于2025年10月13日在线发布，作者包括Pushen Zuo、Qishen Wang等，主要来自北京大学人工智能研究院和集成电路学院。</p><p>论文全文约10页（不含补充材料），包括多个图表（如电路示意图、实验结果图）和补充笔记（Supplementary Notes 1–4）、补充图表（Supplementary Figs. 1–20）。由于原文较长，我无法完整复制，但以下是基于原文的详细解读，包括关键部分的摘要提取、核心内容分析、技术创新、实验结果和整体意义。我会结构化呈现，便于理解。</p><h3 id="1-摘要（Abstract）解读"><a href="#1-摘要（Abstract）解读" class="headerlink" title="1. 摘要（Abstract）解读"></a>1. 摘要（Abstract）解读</h3><p>原文摘要强调了模拟计算的精度瓶颈问题，并介绍了他们的解决方案：一种高精度、可扩展的模拟矩阵方程求解器，使用迭代算法结合低精度矩阵求逆（LP-INV）和高精度矩阵-向量乘法（HP-MVM）。两者均使用3位阻变随机存取存储器（RRAM）芯片实现。通过结合块矩阵算法，他们实验解决了16×16实值矩阵的求逆问题，达到了24位定点精度（相当于32位浮点精度，FP32）。在应用于大规模多输入多输出（MIMO）系统的信号检测时，仅需3次迭代即可达到与FP32数字处理器相当的性能。基准测试显示，该方法在相同精度下，吞吐量可比最先进数字处理器高1000倍，能效高100倍。</p><p><strong>解读</strong>：摘要突出了模拟计算的优势——低复杂度、高效率，但解决了长期难题：精度低和可扩展性差。这项工作标志着从数字主导向模拟计算的转变，尤其适合数据密集型应用如AI和信号处理。创新在于全模拟迭代，避免了数字转换的开销。</p><h3 id="2-引言（Introduction）解读"><a href="#2-引言（Introduction）解读" class="headerlink" title="2. 引言（Introduction）解读"></a>2. 引言（Introduction）解读</h3><p>引言部分介绍了矩阵方程求解（A x &#x3D; b）在信号处理、科学计算和神经网络训练中的核心作用（图1a）。传统数字方法计算复杂度高（O(N³)），受限于冯·诺伊曼架构的内存瓶颈。模拟矩阵计算（AMC）使用RRAM阵列作为物理矩阵，能一步完成矩阵-向量乘法（MVM，图1b）或闭环反馈求逆（INV，图1c），但面临精度低和可扩展性问题。现有混合模拟-数字方法（如图1d）虽改善精度，但牺牲了模拟计算的低复杂度优势。</p><p>作者提出了一种全模拟高精度方案：结合LP-INV和HP-MVM的迭代，使用商用40nm CMOS工艺制造的1T1R RRAM芯片（每个单元8个电导水平）。他们验证了BlockAMC方法，用于解决中规模（16×16）矩阵方程。</p><p><strong>解读</strong>：引言清晰定位问题——模拟计算的“阿喀琉斯之踵”是精度和规模。作者的贡献是首次实现高精度（24位）模拟INV，而非依赖数字辅助。这为边缘计算和AI硬件提供了新范式，潜在减少能耗和延迟。</p><h3 id="3-方法（Methods）解读"><a href="#3-方法（Methods）解读" class="headerlink" title="3. 方法（Methods）解读"></a>3. 方法（Methods）解读</h3><p>方法部分详细描述了芯片制造、编程和实验设置。</p><ul><li><p><strong>芯片制造</strong>：使用商用40nm CMOS平台制造TaOₓ基RRAM芯片，包括1Mb阵列（用于HP-MVM）和8×8阵列（用于LP-INV）。每个单元采用1T1R结构（一个晶体管一个电阻器），通过写-验证方法编程到8个电导状态（0.5–35 μS，图2c），成功率100%。</p></li><li><p><strong>HP-INV方案</strong>（图2a）：一种迭代精炼算法，全模拟实现。矩阵A转换为定点数并位切片（bit-slicing）：A &#x3D; ∑ 2^{km} A_k（k&#x3D;0到n-1，m&#x3D;3）。最重要切片A_0用于LP-INV电路（闭环反馈，使用OPA），所有切片用于HP-MVM（开放阵列）。迭代过程：计算增量Δx^{(k)} &#x3D; A_0^{-1} r^{(k)}，更新x，计算残差r^{(k+1)} &#x3D; r^{(k)} - A Δx^{(k+1)}（使用HP-MVM）。使用DAC&#x2F;ADC（4位分辨率）处理输入&#x2F;输出，微控制器处理向量加减和移位加法。伪代码见补充笔记1。</p></li><li><p><strong>扩展到实值和复值矩阵</strong>：对于实值，使用差分编码（正&#x2F;负阵列对）；对于复值，使用4个阵列表示实&#x2F;虚部（图3a）。块矩阵方法（BlockAMC）用于大规模：将大矩阵分成块，使用多个小阵列求解（图4a）。</p></li><li><p><strong>实验设置</strong>：LP-INV板包括RRAM阵列、OPA、开关、MUX、DAC&#x2F;ADC；HP-MVM使用集成1Mb芯片。编程使用写-验证算法，确保精度。</p></li></ul><p><strong>解读</strong>：方法创新在于位切片和全模拟迭代，简化编程（只需3位&#x2F;设备），避免了高位编程的开销。闭环反馈使INV一步完成，结合位切片实现高精度MVM。这是首次在商用芯片上实现可靠的多级RRAM用于INV，解决了模拟计算的噪声和非线性问题。补充图3–6显示了I-V特性、编程速度、保留和耐久性，证明芯片稳定。</p><h3 id="4-结果（Results）解读"><a href="#4-结果（Results）解读" class="headerlink" title="4. 结果（Results）解读"></a>4. 结果（Results）解读</h3><p>结果部分展示了实验验证。</p><ul><li><p><strong>HP-INV示例</strong>（图2d–f）：对4×4 12位正矩阵求解，3次迭代后残差降到10^{-3}，平均相对误差从LP-INV的10^{-1}精炼到高精度。</p></li><li><p><strong>实值矩阵扩展</strong>（图3b–d）：使用差分阵列解决4×4实值矩阵，3次迭代达到12位精度。统计100个随机矩阵，平均迭代2.9次，相对误差~10^{-4}。</p></li><li><p><strong>复值矩阵扩展</strong>（图3e–g）：使用4阵列解决4×4复矩阵，平均迭代3.2次，误差~10^{-4}。应用于大规模MIMO信号检测（图5），在16×16矩阵上，3次迭代BER接近FP32，优于传统模拟方法。</p></li><li><p><strong>可扩展性</strong>（图4）：使用BlockAMC解决16×16矩阵，24位精度。阵列级联减少了反馈线复杂度。</p></li></ul><p><strong>解读</strong>：结果证明了方案的有效性：迭代次数少（2–3次），精度高（24位），适用于实&#x2F;复矩阵。MIMO应用显示实际价值——在噪声环境下，性能媲美数字GPU，但能效更高。统计数据（100矩阵）显示鲁棒性，误差主要来自阵列非理想性（如寄生电阻），但迭代精炼有效补偿。</p><h3 id="5-讨论与结论（Discussion-and-Conclusions）解读"><a href="#5-讨论与结论（Discussion-and-Conclusions）解读" class="headerlink" title="5. 讨论与结论（Discussion and Conclusions）解读"></a>5. 讨论与结论（Discussion and Conclusions）解读</h3><p>讨论部分基准测试：瞬态响应<del>1μs（图6a），比数字快。吞吐量</del>1000倍，能效~100倍于A100 GPU（图6b–d）。局限包括阵列规模（当前8×8），未来可扩展到更大。</p><p>结论重申：这是模拟计算的重大突破，解决了百年精度难题，适用于AI、通信和科学计算。未来可集成更多位级和更大阵列。</p><p><strong>解读</strong>：讨论强调性能优势：模拟的并行性和低功耗使它在边缘设备中潜力巨大。相比数字，节省能量100倍，适合可持续计算。局限是硬件规模，但作者建议通过块方法扩展。整体意义：推动模拟芯片商用化，中国在该领域领先。</p><h3 id="总体创新与意义"><a href="#总体创新与意义" class="headerlink" title="总体创新与意义"></a>总体创新与意义</h3><ul><li><strong>关键创新</strong>：全模拟HP-INV算法（LP-INV + HP-MVM迭代），位切片实现高精度，BlockAMC解决规模问题。首次使用商用RRAM芯片实现高精度模拟INV。</li><li><strong>技术细节</strong>：基于物理定律（欧姆&#x2F;基尔霍夫定律）求解，避免逐元素运算；动态校准补偿非理想性。</li><li><strong>实验结果</strong>：精度达24位，迭代少，应用于MIMO检测性能优异。</li><li><strong>意义</strong>：在AI和信号处理中，可比GPU快1000倍、低能耗100倍，推动“模拟复兴”。但商用需进一步验证稳定性。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 思考 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> 芯片 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FISCO BCOS 控制台的操作</title>
      <link href="/2025/10/16/61-FISCO-BCOS-%E6%8E%A7%E5%88%B6%E5%8F%B0/"/>
      <url>/2025/10/16/61-FISCO-BCOS-%E6%8E%A7%E5%88%B6%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -#LO https://gitee.com/FISCO-BCOS/console/raw/master-2.0/tools/download_console.sh &amp;&amp; bash download_console.sh</span><br></pre></td></tr></table></figure><p>此时会从github上下载控制台程序。成功下载会显示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">[INFO] Downloading console 2.10.0 from https://github.com/FISCO-BCOS/console/releases/download/v2.10.0/console.tar.gz</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">[INFO] Download console successfully</span><br><span class="line">[INFO] unzip console successfully</span><br></pre></td></tr></table></figure><h2 id="配置控制台-拷贝SDK证书"><a href="#配置控制台-拷贝SDK证书" class="headerlink" title="配置控制台: 拷贝SDK证书"></a><strong>配置控制台: 拷贝SDK证书</strong></h2><p>将已经安装的区块链的节点下的sdk证书拷贝到控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/fisco/192.168.201.129/sdk/* ~/fisco/console/conf</span><br></pre></td></tr></table></figure><h2 id="配置控制台：配置文件更新"><a href="#配置控制台：配置文件更新" class="headerlink" title="配置控制台：配置文件更新"></a>配置控制台：配置文件更新</h2><p>将例子配置文件拷贝为正式的配置文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -n ~/fisco/console/conf/config-example.toml ~/fisco/console/conf/config.toml</span><br></pre></td></tr></table></figure><p>这个config.toml是控制台的配置文件，我们要想管理节点关键是修改下面这行</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[network]</span></span><br><span class="line"><span class="attr">peers</span>=[<span class="string">&quot;127.0.0.1:20200&quot;</span>, <span class="string">&quot;127.0.0.1:20201&quot;</span>]    <span class="comment"># The peer list to connect</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是控制台要连接的节点。如果我们的网络中已经有的节点如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">192.168.201.129:20200</span><br><span class="line">192.168.201.129:20201</span><br><span class="line">192.168.201.130:20200</span><br><span class="line">192.168.201.131:20200</span><br><span class="line">192.168.201.132:20200</span><br></pre></td></tr></table></figure><p>那么可以通过下面的命令批量修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/peers=\[&quot;127.0.0.1:20200&quot;, &quot;127.0.0.1:20201&quot;\]/peers=[&quot;192.168.201.129:20200&quot;, &quot;192.168.201.129:20201&quot;, &quot;192.168.201.130:20200&quot;, &quot;192.168.201.131:20200&quot;,&quot;192.168.201.132:20200&quot;]/g&#x27;</span> ~/fisco/console/conf/config.toml</span><br></pre></td></tr></table></figure><h2 id="启动控制台"><a href="#启动控制台" class="headerlink" title="启动控制台"></a>启动控制台</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash ~/fisco/console/start.sh</span><br></pre></td></tr></table></figure><p>输出结果如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[fisco@localhost console]$ bash ~/fisco/console/start.sh</span><br><span class="line">=============================================================================================</span><br><span class="line">Welcome to FISCO BCOS console(2.10.0)!</span><br><span class="line">Type &#x27;help&#x27; or &#x27;h&#x27; for help. Type &#x27;quit&#x27; or &#x27;q&#x27; to quit console.</span><br><span class="line"> ________ ______  ______   ______   ______       _______   ______   ______   ______  </span><br><span class="line">|        |      \/      \ /      \ /      \     |       \ /      \ /      \ /      \ </span><br><span class="line">| $$$$$$$$\$$$$$|  $$$$$$|  $$$$$$|  $$$$$$\    | $$$$$$$|  $$$$$$|  $$$$$$|  $$$$$$\</span><br><span class="line">| $$__     | $$ | $$___\$| $$   \$| $$  | $$    | $$__/ $| $$   \$| $$  | $| $$___\$$</span><br><span class="line">| $$  \    | $$  \$$    \| $$     | $$  | $$    | $$    $| $$     | $$  | $$\$$    \ </span><br><span class="line">| $$$$$    | $$  _\$$$$$$| $$   __| $$  | $$    | $$$$$$$| $$   __| $$  | $$_\$$$$$$\</span><br><span class="line">| $$      _| $$_|  \__| $| $$__/  | $$__/ $$    | $$__/ $| $$__/  | $$__/ $|  \__| $$</span><br><span class="line">| $$     |   $$ \\$$    $$\$$    $$\$$    $$    | $$    $$\$$    $$\$$    $$\$$    $$</span><br><span class="line"> \$$      \$$$$$$ \$$$$$$  \$$$$$$  \$$$$$$      \$$$$$$$  \$$$$$$  \$$$$$$  \$$$$$$</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br><span class="line">[group:1]&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="console中支持的命令"><a href="#console中支持的命令" class="headerlink" title="console中支持的命令"></a>console中支持的命令</h2><table><thead><tr><th>命令</th><th>中文解释</th></tr></thead><tbody><tr><td>help([-h, -help, –h, –H, –help, -H, h])</td><td>提供帮助信息</td></tr><tr><td>addObserver</td><td>添加一个观察节点</td></tr><tr><td>addSealer</td><td>添加一个共识节点（Sealer 节点）</td></tr><tr><td>call</td><td>通过函数和参数调用合约</td></tr><tr><td>callByCNS</td><td>通过 CNS（合约名称服务），使用函数和参数调用合约</td></tr><tr><td>create</td><td>通过 SQL 语句创建数据表</td></tr><tr><td>delete</td><td>通过 SQL 语句删除记录</td></tr><tr><td>deploy</td><td>在区块链上部署合约</td></tr><tr><td>deployByCNS</td><td>通过 CNS（合约名称服务）在区块链上部署合约</td></tr><tr><td>desc</td><td>查看数据表的结构信息</td></tr><tr><td>quit([quit, q, exit])</td><td>退出控制台</td></tr><tr><td>freezeAccount</td><td>冻结账户</td></tr><tr><td>freezeContract</td><td>冻结合约</td></tr><tr><td>generateGroup</td><td>为指定节点创建一个群组</td></tr><tr><td>generateGroupFromFile</td><td>根据指定文件的配置创建群组</td></tr><tr><td>getAccountStatus</td><td>获取账户的状态</td></tr><tr><td>getAvailableConnections</td><td>获取 SDK（软件开发工具包）已连接节点的连接信息</td></tr><tr><td>getBatchReceiptsByBlockHashAndRange</td><td>根据区块哈希和交易范围，批量获取交易回执</td></tr><tr><td>getBatchReceiptsByBlockNumberAndRange</td><td>根据区块号和交易范围，批量获取交易回执</td></tr><tr><td>getBlockByHash</td><td>通过区块哈希查询区块信息</td></tr><tr><td>getBlockByNumber</td><td>通过区块号查询区块信息</td></tr><tr><td>getBlockHashByNumber</td><td>通过区块号查询区块哈希</td></tr><tr><td>getBlockHeaderByHash</td><td>通过区块哈希查询区块头信息</td></tr><tr><td>getBlockHeaderByNumber</td><td>通过区块号查询区块头信息</td></tr><tr><td>getBlockNumber</td><td>查询最新区块的区块号</td></tr><tr><td>getCode</td><td>查询指定地址下的合约代码</td></tr><tr><td>getConsensusStatus</td><td>查询共识状态</td></tr><tr><td>getContractStatus</td><td>获取合约的状态</td></tr><tr><td>getCryptoType</td><td>获取当前使用的加密算法类型</td></tr><tr><td>getCurrentAccount</td><td>获取当前账户的信息</td></tr><tr><td>getDeployLog</td><td>查询合约部署的日志</td></tr><tr><td>getGroupConnections</td><td>获取 SDK 已连接的该群组节点信息</td></tr><tr><td>getGroupList</td><td>查询群组列表</td></tr><tr><td>getGroupPeers</td><td>查询该群组中共识节点（Sealer）和观察节点（Observer）的 NodeID 列表</td></tr><tr><td>getNodeIDList</td><td>查询所有已连接节点的 NodeID 列表</td></tr><tr><td>getNodeInfo</td><td>查询指定节点的详细信息</td></tr><tr><td>getNodeVersion</td><td>查询当前节点的版本</td></tr><tr><td>getObserverList</td><td>查询观察节点（Observer）的 NodeID 列表</td></tr><tr><td>getPbftView</td><td>查询节点的 PBFT 共识视图（仅 PBFT 共识算法适用）</td></tr><tr><td>getPeers</td><td>查询当前客户端已连接的节点列表</td></tr><tr><td>getPendingTransactions</td><td>查询待确认的交易（未上链交易）</td></tr><tr><td>getPendingTxSize</td><td>查询待确认交易的数量</td></tr><tr><td>getSealerList</td><td>查询共识节点（Sealer）的 NodeID 列表</td></tr><tr><td>getSyncStatus</td><td>查询节点的数据同步状态</td></tr><tr><td>getSystemConfigByKey</td><td>通过配置键（Key）查询系统配置值</td></tr><tr><td>getTotalTransactionCount</td><td>查询区块链的总交易数量</td></tr><tr><td>getTransactionByBlockHashAndIndex</td><td>通过区块哈希和交易在区块中的索引位置，查询交易信息</td></tr><tr><td>getTransactionByBlockNumberAndIndex</td><td>通过区块号和交易在区块中的索引位置，查询交易信息</td></tr><tr><td>getTransactionByHash</td><td>通过交易哈希查询交易信息</td></tr><tr><td>getTransactionByHashWithProof</td><td>通过交易哈希查询交易信息及对应的交易证明</td></tr><tr><td>getTransactionReceipt</td><td>通过交易哈希查询交易回执</td></tr><tr><td>getTransactionReceiptByHashWithProof</td><td>通过交易哈希查询交易回执及对应的交易回执证明</td></tr><tr><td>grantCNSManager</td><td>为指定地址授予 CNS（合约名称服务）管理权限</td></tr><tr><td>grantCommitteeMember</td><td>将指定账户设为委员会成员</td></tr><tr><td>grantContractStatusManager</td><td>为指定用户授予合约状态管理权限（如冻结&#x2F;解冻合约）</td></tr><tr><td>grantContractWritePermission</td><td>为指定账户授予合约写入权限</td></tr><tr><td>grantDeployAndCreateManager</td><td>为指定地址授予合约部署和数据表创建权限</td></tr><tr><td>grantNodeManager</td><td>为指定地址授予节点配置管理权限（如添加&#x2F;删除节点）</td></tr><tr><td>grantOperator</td><td>将指定账户设为操作员（拥有部分管理权限）</td></tr><tr><td>grantSysConfigManager</td><td>为指定地址授予系统配置管理权限</td></tr><tr><td>grantUserTableManager</td><td>为指定地址授予指定数据表的管理权限</td></tr><tr><td>insert</td><td>通过 SQL 语句插入记录</td></tr><tr><td>listAbi</td><td>列出合约的函数和事件信息（解析合约 ABI）</td></tr><tr><td>listAccount</td><td>列出当前已保存的账户列表</td></tr><tr><td>listCNSManager</td><td>查询拥有 CNS（合约名称服务）管理权限的地址信息</td></tr><tr><td>listCommitteeMembers</td><td>列出所有委员会成员</td></tr><tr><td>listContractStatusManager</td><td>列出拥有合约状态管理权限的用户信息</td></tr><tr><td>listContractWritePermission</td><td>查询拥有指定合约写入权限的账户列表</td></tr><tr><td>listDeployAndCreateManager</td><td>查询拥有合约部署和数据表创建权限的地址信息</td></tr><tr><td>listDeployContractAddress</td><td>列出指定合约已部署的所有地址</td></tr><tr><td>listNodeManager</td><td>查询拥有节点配置管理权限的地址信息</td></tr><tr><td>listOperators</td><td>列出所有操作员</td></tr><tr><td>listSysConfigManager</td><td>查询拥有系统配置管理权限的地址信息</td></tr><tr><td>listUserTableManager</td><td>查询拥有指定数据表管理权限的地址信息</td></tr><tr><td>loadAccount</td><td>加载账户（用于交易签名）</td></tr><tr><td>newAccount</td><td>创建一个新账户</td></tr><tr><td>queryCNS</td><td>通过合约名称和合约版本查询 CNS（合约名称服务）信息</td></tr><tr><td>queryCommitteeMemberWeight</td><td>查询委员会成员的权重</td></tr><tr><td>queryGroupStatus</td><td>查询指定节点上指定群组的状态</td></tr><tr><td>queryThreshold</td><td>查询操作权限的阈值（如修改配置需满足的投票阈值）</td></tr><tr><td>queryVotesOfMember</td><td>查询某个委员会成员的得票数</td></tr><tr><td>queryVotesOfThreshold</td><td>查询修改权限阈值操作的得票数</td></tr><tr><td>recoverGroup</td><td>恢复指定节点上的指定群组（如群组异常后恢复）</td></tr><tr><td>registerCNS</td><td>为指定合约注册 CNS（合约名称服务）信息</td></tr><tr><td>removeGroup</td><td>删除指定节点上的指定群组</td></tr><tr><td>removeNode</td><td>移除一个节点（从集群&#x2F;群组中删除）</td></tr><tr><td>revokeCNSManager</td><td>撤销指定地址的 CNS（合约名称服务）管理权限</td></tr><tr><td>revokeCommitteeMember</td><td>将指定账户从委员会成员中移除</td></tr><tr><td>revokeContractStatusManager</td><td>撤销指定用户的合约状态管理权限</td></tr><tr><td>revokeContractWritePermission</td><td>撤销指定账户的合约写入权限</td></tr><tr><td>revokeDeployAndCreateManager</td><td>撤销指定地址的合约部署和数据表创建权限</td></tr><tr><td>revokeNodeManager</td><td>撤销指定地址的节点配置管理权限</td></tr><tr><td>revokeOperator</td><td>将指定账户从操作员中移除</td></tr><tr><td>revokeSysConfigManager</td><td>撤销指定地址的系统配置管理权限</td></tr><tr><td>revokeUserTableManager</td><td>撤销指定地址对指定数据表的管理权限</td></tr><tr><td>switch([s])</td><td>切换到指定 ID 的群组（如从群组 1 切换到群组 2）</td></tr><tr><td>select</td><td>通过 SQL 语句查询记录</td></tr><tr><td>setSystemConfigByKey</td><td>通过配置键（Key）设置系统配置值</td></tr><tr><td>startGroup</td><td>启动指定节点上的指定群组</td></tr><tr><td>stopGroup</td><td>停止指定节点上的指定群组</td></tr><tr><td>unfreezeAccount</td><td>解冻账户</td></tr><tr><td>unfreezeContract</td><td>解冻合约</td></tr><tr><td>update</td><td>通过 SQL 语句更新记录</td></tr><tr><td>updateCommitteeMemberWeight</td><td>更新委员会成员的权重</td></tr><tr><td>updateThreshold</td><td>更新操作权限的阈值</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建FISCO BCOS多主机网络</title>
      <link href="/2025/10/16/60-%E6%90%AD%E5%BB%BAFISCO-BCOS%E5%A4%9A%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2025/10/16/60-%E6%90%AD%E5%BB%BAFISCO-BCOS%E5%A4%9A%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a>安装虚拟机</h3><p>通过VMWorkStation 安装四台CentOS7主机，IP地址分别是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.232.128</span><br><span class="line">192.168.232.129</span><br><span class="line">192.168.232.130</span><br><span class="line">192.168.232.131</span><br></pre></td></tr></table></figure><p>记住每个主机的管理员用户和密码。</p><h3 id="将虚拟机的IP设置为固定IP"><a href="#将虚拟机的IP设置为固定IP" class="headerlink" title="将虚拟机的IP设置为固定IP"></a>将虚拟机的IP设置为固定IP</h3><p>首先，查找虚拟机的默认网关。在<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130446323.png" alt="image.png"></p><p>然后在找到VMnet8的Nat设置<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130547373.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130610406.png" alt="image.png"><br>这里的192.168.201.2就是默认网关。<br>接下来，在Windows中查找VMWare的虚拟网卡，VMnet8那个。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130726372.png" alt="image.png"></p><p>接下来，点击【属性】<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130806378.png" alt="image.png"><br>找到IPv4，再设置【属性】，填写网关和网址如下，注意：这里的网关就是前面找到的那个192.168.201.2，网址可以自己设置<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016130920632.png" alt="image.png"></p><p>最后，设置CentOS 的固定IP</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br></pre></td></tr></table></figure><p>补充静态IP地址信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IPV6_PRIVACY=no</span><br><span class="line">IPADDR0=192.168.201.129</span><br><span class="line">GATEWAY0=192.168.201.2</span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line">DNS2=8.8.4.4</span><br></pre></td></tr></table></figure><h3 id="检查端口是否被占用"><a href="#检查端口是否被占用" class="headerlink" title="检查端口是否被占用"></a>检查端口是否被占用</h3><p>确保每台机器的 <code>30300</code>, <code>20200</code>, <code>8545</code> 端口没有被占用。使用下面的命令查找端口是否被占用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tuln | egrep <span class="string">&#x27;30300|20200|8545&#x27;</span></span><br></pre></td></tr></table></figure><p>如果输出为空，那么说明端口没有被占用。</p><h3 id="检查端口是否有网络访问权限"><a href="#检查端口是否有网络访问权限" class="headerlink" title="检查端口是否有网络访问权限"></a>检查端口是否有网络访问权限</h3><p>确保每台机器开通了 <code>30300</code>, <code>20200</code> 和 <code>22</code> 端口的网络访问权限。</p><ol><li>首先检查防火墙是否开启</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status firewalld</span><br></pre></td></tr></table></figure><ol start="2"><li>如果没有开启，通过下面的命令开启防火墙</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start firewalld</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> firewalld</span><br></pre></td></tr></table></figure><ol start="2"><li>然后将上述三个端口开放</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放 22 端口（SSH默认端口）</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=22/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放 20200 端口</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=20200/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放 30300 端口</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --add-port=30300/tcp --permanent</span><br></pre></td></tr></table></figure><h2 id="联盟链的搭建"><a href="#联盟链的搭建" class="headerlink" title="联盟链的搭建"></a>联盟链的搭建</h2><h3 id="生成区块链节点配置"><a href="#生成区块链节点配置" class="headerlink" title="生成区块链节点配置"></a>生成区块链节点配置</h3><p>我们在第一台主机（192.168.232.128）上，<strong>创建操作路径，下载开发部署工具build_chain</strong>，执行下面的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建操作路径~/fisco</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/fisco &amp;&amp; <span class="built_in">cd</span> ~/fisco</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载开发部署工具build_chain</span></span><br><span class="line">curl -#LO https://gitee.com/FISCO-BCOS/FISCO-BCOS/raw/master-2.0/tools/build_chain.sh &amp;&amp; <span class="built_in">chmod</span> u+x build_chain.sh</span><br></pre></td></tr></table></figure><p>然后生成网络配置文件，执行下面的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里所有区块链节点均属于agencyA，并仅启动了群组1</span></span><br><span class="line"><span class="comment"># (注: 下面的ip信息需要根据真实的机器IP填写)</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; ipconf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.201.129 agencyA 1</span></span><br><span class="line"><span class="string">192.168.201.130 agencyA 1</span></span><br><span class="line"><span class="string">192.168.201.131 agencyA 1</span></span><br><span class="line"><span class="string">192.168.201.132 agencyA 1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>然后通过上面的build_chain脚本命令生成区块链节点配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash build_chain.sh -f ipconf -p 30300,20200,8545</span><br></pre></td></tr></table></figure><p>命令执行后，会从github上下载节点文件。命令执行成功会输出<code>All completed</code>。如果执行出错，请检查<code>nodes/build.log</code>文件中的错误信息。</p><p>成功执行命令后，会输出类似下面这样的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Downloading fisco-bcos binary from https://github.com/FISCO-BCOS/FISCO-BCOS/releases/download/v2.11.1/fisco-bcos.tar.gz ...</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==============================================================</span><br><span class="line">Generating CA key...</span><br><span class="line">==============================================================</span><br><span class="line">Generating keys and certificates ...</span><br><span class="line">Processing IP=192.168.232.128 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.129 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.130 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.131 Total=1 Agency=agencyA Groups=1</span><br><span class="line">==============================================================</span><br><span class="line">Generating configuration files ...</span><br><span class="line">Processing IP=192.168.232.128 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.129 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.130 Total=1 Agency=agencyA Groups=1</span><br><span class="line">Processing IP=192.168.232.131 Total=1 Agency=agencyA Groups=1</span><br><span class="line">==============================================================</span><br><span class="line">Group:1 has 4 nodes</span><br><span class="line">==============================================================</span><br><span class="line">[INFO] IP List File    : ipconf</span><br><span class="line">[INFO] Start Port      : 30300 20200 8545</span><br><span class="line">[INFO] Server IP       : 192.168.232.128 192.168.232.129 192.168.232.130 192.168.232.131</span><br><span class="line">[INFO] Output Dir      : /home/eric/fisco/nodes</span><br><span class="line">[INFO] CA Path         : /home/eric/fisco/nodes/cert/</span><br><span class="line">[INFO] RSA channel     : <span class="literal">true</span></span><br><span class="line">==============================================================</span><br><span class="line">[INFO] Execute the download_console.sh script <span class="keyword">in</span> directory named by IP to get FISCO-BCOS console.</span><br><span class="line">e.g.  bash /home/eric/fisco/nodes/192.168.232.128/download_console.sh -f</span><br><span class="line">==============================================================</span><br><span class="line">[INFO] All completed. Files <span class="keyword">in</span> /home/eric/fisco/nodes</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们可以看到在fisco目录下生成了nodes文件夹，并在其中有4个以ip地址命名的文件夹。可以安装tree命令查看。</p><p>先更新一下CentOS的源。<br>备份原来的源文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure><p>下载阿里云的镜像源配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><ul><li>清理旧缓存并生成新缓存：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum clean all</span><br><span class="line"><span class="built_in">sudo</span> yum makecache</span><br></pre></td></tr></table></figure><p>然后安装tree命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y tree</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过tree命令查看nodes文件夹结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree nodes/192.168.232.128</span><br></pre></td></tr></table></figure><p>输出结果如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">nodes/192.168.232.128</span><br><span class="line">├── download_bin.sh</span><br><span class="line">├── download_console.sh</span><br><span class="line">├── fisco-bcos</span><br><span class="line">├── node0</span><br><span class="line">│   ├── conf</span><br><span class="line">│   │   ├── ca.crt</span><br><span class="line">│   │   ├── channel_cert</span><br><span class="line">│   │   │   ├── ca.crt</span><br><span class="line">│   │   │   ├── cert.cnf</span><br><span class="line">│   │   │   ├── node.crt</span><br><span class="line">│   │   │   └── node.key</span><br><span class="line">│   │   ├── group.1.genesis</span><br><span class="line">│   │   ├── group.1.ini</span><br><span class="line">│   │   ├── node.crt</span><br><span class="line">│   │   ├── node.key</span><br><span class="line">│   │   └── node.nodeid</span><br><span class="line">│   ├── config.ini</span><br><span class="line">│   ├── scripts</span><br><span class="line">│   │   ├── load_new_groups.sh</span><br><span class="line">│   │   ├── monitor.sh</span><br><span class="line">│   │   ├── reload_sdk_allowlist.sh</span><br><span class="line">│   │   └── reload_whitelist.sh</span><br><span class="line">│   ├── start.sh</span><br><span class="line">│   └── stop.sh</span><br><span class="line">├── sdk</span><br><span class="line">│   ├── ca.crt</span><br><span class="line">│   ├── cert.cnf</span><br><span class="line">│   ├── sdk.crt</span><br><span class="line">│   └── sdk.key</span><br><span class="line">├── start_all.sh</span><br><span class="line">└── stop_all.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到，其中包括了node0和sdk文件夹，以及启动节点和停止节点的命令。<br>至此，成功生成了多机4节点配置，每台机器的区块链节点配置均位于<code>nodes</code>文件夹下，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> nodes/</span><br></pre></td></tr></table></figure><p>结果如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.232.128  192.168.232.129  192.168.232.130  192.168.232.131  cert  cert.cnf</span><br></pre></td></tr></table></figure><h3 id="拷贝区块链节点配置"><a href="#拷贝区块链节点配置" class="headerlink" title="拷贝区块链节点配置"></a>拷贝区块链节点配置</h3><p>首先为每个节点创建一个fisco用户，并赋予其超级用户权限<br>切换到超级用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></figure><p>添加fisco用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd fisco</span><br></pre></td></tr></table></figure><p>设置密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd fisco</span><br></pre></td></tr></table></figure><p>将fisco用户加入到超级用户组wheel中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG wheel fisco</span><br></pre></td></tr></table></figure><p>生成区块链节点配置后，需要将每个节点配置拷贝到对应机器上，可通过<code>scp</code>命令执行拷贝，具体如下：<br>注意，下面的命令在192.168.201.129这个主机上执行，因为我们之前初始化下载的节点是在这里。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为每台机器创建操作目录~/fisco</span></span><br><span class="line"><span class="comment"># (注: 这里使用fisco用户进行操作; 实际操作时，可使用自己的账户进行类似操作, IP也需要替换成自己的机器IP)</span></span><br><span class="line">ssh fisco@192.168.201.129 <span class="string">&quot;mkdir -p ~/fisco&quot;</span></span><br><span class="line">ssh fisco@192.168.201.130 <span class="string">&quot;mkdir -p ~/fisco&quot;</span></span><br><span class="line">ssh fisco@192.168.201.131 <span class="string">&quot;mkdir -p ~/fisco&quot;</span></span><br><span class="line">ssh fisco@192.168.201.132 <span class="string">&quot;mkdir -p ~/fisco&quot;</span></span><br></pre></td></tr></table></figure><p>执行上面的命令后，是通过fisco账户连接到主机上，然后在其用户主目录<code>~</code>目录下创建了fisco文件夹。</p><p>现在切换到第一次下载并创建了nodes命令的主机上，在这里是192.168.201.129 下 (&#x2F;root&#x2F;fisco)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fisco</span><br></pre></td></tr></table></figure><p>确保目录下有刚才生成的nodes目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build_chain.sh  ipconf  nodes</span><br></pre></td></tr></table></figure><p>然后通过scp命令，将nodes下节点配置文件到不同的主机上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拷贝节点配置</span></span><br><span class="line"><span class="comment"># 拷贝节点配置到192.168.201.129的~/fisco路径</span></span><br><span class="line">scp -r nodes/192.168.201.129/ fisco@192.168.201.129:~/fisco/192.168.201.129</span><br><span class="line"><span class="comment"># 拷贝节点配置到196.168.0.2的~/fisco路径</span></span><br><span class="line">scp -r nodes/192.168.201.130/ fisco@192.168.201.130:~/fisco/192.168.201.130</span><br><span class="line"><span class="comment"># 拷贝节点配置到196.168.0.3的~/fisco路径</span></span><br><span class="line">scp -r nodes/192.168.201.131/ fisco@192.168.201.131:~/fisco/192.168.201.131</span><br><span class="line"><span class="comment"># 拷贝节点配置到196.168.0.4的~/fisco路径</span></span><br><span class="line">scp -r nodes/192.168.201.132/ fisco@192.168.201.132:~/fisco/192.168.201.132</span><br></pre></td></tr></table></figure><h3 id="启动各主机上的节点"><a href="#启动各主机上的节点" class="headerlink" title="启动各主机上的节点"></a>启动各主机上的节点</h3><p>区块链节点配置拷贝成功后，需要启动所有节点，可通过某台机器发起<code>ssh</code>操作远程启动区块链节点，也可登录上所有物理机后，在对应的物理机上启动区块链节点。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (注: 这里使用fisco用户进行操作; 实际操作时，可使用自己的账户进行类似操作, IP也需要替换成自己的机器IP)</span></span><br><span class="line"><span class="comment"># 启动192.168.201.129机器上部署的区块链节点</span></span><br><span class="line">$ ssh fisco@192.168.201.129 <span class="string">&quot;bash ~/fisco/192.168.201.129/start_all.sh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh fisco@192.168.201.130 <span class="string">&quot;bash ~/fisco/192.168.201.130/start_all.sh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh fisco@192.168.201.131 <span class="string">&quot;bash ~/fisco/192.168.201.131/start_all.sh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh fisco@192.168.201.132 <span class="string">&quot;bash ~/fisco/192.168.201.132/start_all.sh&quot;</span></span><br></pre></td></tr></table></figure><h3 id="检查主机上的节点运行状态"><a href="#检查主机上的节点运行状态" class="headerlink" title="检查主机上的节点运行状态"></a>检查主机上的节点运行状态</h3><p>登录任何一台主机，使用fisco账户，然后输入下面的命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f ~/fisco/*/node0/log/* |grep -i connected</span><br></pre></td></tr></table></figure><p>正常情况下应该不停的输出下面的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">info|2025-10-15 23:38:03.477351|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2025-10-15 23:38:13.485545|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2025-10-15 23:38:23.498435|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2025-10-15 23:38:33.501871|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2025-10-15 23:38:43.503722|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="检查共识是否整"><a href="#检查共识是否整" class="headerlink" title="检查共识是否整"></a>检查共识是否整</h3><p>登录任何一台主机，使用fisco账户，然后输入下面的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f ~/fisco/*/node0/log/* |grep -i +++</span><br></pre></td></tr></table></figure><p>正常情况下应该不停的输出下面的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info|2025-10-15 23:40:36.186639|PBFTSeal-1-0x00007fc9c4c75700|[g:1][CONSENSUS][SEALER]++++++++++++++++ Generating seal on,blkNum=1,tx=0,nodeIdx=2,<span class="built_in">hash</span>=11dd8692...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，基于4个主机的fisco bcos网络就搭建完毕了。</p><h2 id="群组中新增节点"><a href="#群组中新增节点" class="headerlink" title="群组中新增节点"></a>群组中新增节点</h2><p>本节以为上一小节生成的群组1新增一个共识节点为例操作。</p><h4 id="为新节点生成私钥证书"><a href="#为新节点生成私钥证书" class="headerlink" title="为新节点生成私钥证书"></a>为新节点生成私钥证书</h4><p>接下来的操作，都在上一节生成的<code>nodes/192.168.201.129</code>目录下进行</p><p>获取生成节点证书的工具</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> curl -#LO https://gitee.com/FISCO-BCOS/FISCO-BCOS/raw/master-2.0/tools/gen_node_cert.sh</span><br></pre></td></tr></table></figure><p>生成新的节点证书</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># -c指定机构证书及私钥所在路径</span><br><span class="line"># -o输出到指定文件夹，其中newNode/conf中会存在机构agencyA新签发的证书和私钥</span><br><span class="line">bash gen_node_cert.sh -c ../cert/agencyA -o newNode</span><br></pre></td></tr></table></figure><p>这里的agencyA是我们开始创建网络是指定的机构名称，它位于cert&#x2F;agencyA目录。<br>newNode是新的节点名称，可以根据自己的需要修改。<br>执行完上面的命令后，会生成一个新的newNode文件夹<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016151741533.png" alt="image.png"></p><p>查看这个文件夹下的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 192.168.201.129]# tree newNode/</span><br><span class="line">newNode/</span><br><span class="line">└── conf</span><br><span class="line">    ├── agency.crt</span><br><span class="line">    ├── ca.crt</span><br><span class="line">    ├── channel_cert</span><br><span class="line">    │   ├── ca.crt</span><br><span class="line">    │   ├── node.crt</span><br><span class="line">    │   └── node.key</span><br><span class="line">    ├── node.crt</span><br><span class="line">    ├── node.key</span><br><span class="line">    ├── node.nodeid</span><br><span class="line">    ├── node.param</span><br><span class="line">    ├── node.private</span><br><span class="line">    └── node.pubkey</span><br><span class="line"></span><br><span class="line">2 directories, 11 files</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h4><p>拷贝群组1中节点node0配置文件与工具脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> node0/config.ini newNode/config.ini</span><br><span class="line"><span class="built_in">cp</span> node0/conf/group.1.genesis newNode/conf/group.1.genesis</span><br><span class="line"><span class="built_in">cp</span> node0/conf/group.1.ini newNode/conf/group.1.ini</span><br><span class="line"><span class="built_in">cp</span> node0/*.sh newNode/</span><br><span class="line"><span class="built_in">cp</span> -r node0/scripts newNode/</span><br></pre></td></tr></table></figure><p>更新<code>newNode/config.ini</code>中监听的IP和端口，对于<code>[rpc]</code>模块，修改<code>listen_ip</code>、<code>channel_listen_port</code>和<code>jsonrpc_listen_port</code>；对于<code>[p2p]</code>模块，修改<code>listen_port</code>。</p><p>将新节点的P2P配置中的IP和Port加入原有节点的config.ini中的<code>[p2p]</code>字段。假设新节点IP:Port为192.168.201.128:30304则，修改后的<code>[P2P]</code>配置为</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20251016154255023.png" alt="image.png"></p><blockquote><p>[!warning]<br>注意这里要修改<br>channel_listen_port&#x3D;20201 （原来node0节点的端口是20200，这里新增的需要不一样）<br>jsonrpc_listen_port&#x3D;8546（原来node0节点的端口是8545，这里新增的需要不一样）<br>listen_port&#x3D;30304（原来已有的4个节点分别是30300 30301 30302 30303，新增这个要不一样<br>node.4&#x3D;192.168.201.129:30304（这里把新增的节点加上）</p></blockquote><p>然后通过下面的命令将newNode复制到到fisco账户下的节点中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r newNode/  fisco@192.168.201.129:~/fisco/192.168.201.129/newNode </span><br></pre></td></tr></table></figure><h3 id="启动节点"><a href="#启动节点" class="headerlink" title="启动节点"></a>启动节点</h3><p>切换到fisco账户并启动新的节点</p><p>启动新节点，执行<code>newNode/start.sh</code></p><h3 id="检查节点连接装"><a href="#检查节点连接装" class="headerlink" title="检查节点连接装"></a>检查节点连接装</h3><p>再次运行下面的命令检查节点装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f ~/fisco/*/node0/log/* |grep -i connected</span><br></pre></td></tr></table></figure><p>可以发现新的节点已经加入了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">info|2025-10-16 00:48:06.668461|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=4</span><br><span class="line">info|2025-10-16 00:48:16.680214|io_service-0x00007fc9e64b8700|[P2P][Service] heartBeat,connected count=4</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="将节点加入到群组"><a href="#将节点加入到群组" class="headerlink" title="将节点加入到群组"></a>将节点加入到群组</h3><p>通过下面的命令找到新增节点的节点id</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/fisco/192.168.201.129/newNode/conf/node.nodeid </span><br></pre></td></tr></table></figure><p>输出结果如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">97139b1883595c4019ce4e9a5a84781941a9e8abd96bd7619e9325a7aa66128ca21d367e44b305defa79303756c218eb346cb5b018dfed2e104a5674cc2ac090</span><br></pre></td></tr></table></figure><p>启动fisco bcos控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash ~/fisco/console/start.sh</span><br></pre></td></tr></table></figure><p>首先公共addObserver 将节点加入为一个观察节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[group:1]&gt; addObserver 97139b1883595c4019ce4e9a5a84781941a9e8abd96bd7619e9325a7aa66128ca21d367e44b305defa79303756c218eb346cb5b018dfed2e104a5674cc2ac090</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后通过addSealer将其加入为共识节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[group:1]&gt; addSealer 97139b1883595c4019ce4e9a5a84781941a9e8abd96bd7619e9325a7aa66128ca21d367e44b305defa79303756c218eb</span><br><span class="line">346cb5b018dfed2e104a5674cc2ac090</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改Fisco Bcos的节点配置，实现外网访问</title>
      <link href="/2025/10/15/59-%E4%BF%AE%E6%94%B9Fisco-Bcos%E7%9A%84%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE/"/>
      <url>/2025/10/15/59-%E4%BF%AE%E6%94%B9Fisco-Bcos%E7%9A%84%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<p>按照Fisco Bcos单机部署的模式，其默认是监听在<code>127.0.0.1</code> 的本地回环的。因此，如果我们的应用想要通过主机的IP+端口号的方式访问rpc服务是不行的。<br>所以，我们需要通过修改节点的配置文件来实现。找到节点的配置文件，其通常位于<code>127.0.0.1\nodes\</code> 目录下根据我们的选择部署的节点从0开始，node0 node1 node2 node3 等。</p><p>分别打开子目录下的config.ini文件，将 chanell_listen_ip和 jsonrpc_listen_ip 的值改为 0.0.0.0</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">chanell_listen_ip</span>=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">jsonrpc_listen_ip</span>=<span class="number">0.0</span>.<span class="number">0.0</span></span><br></pre></td></tr></table></figure><p>然后重启节点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash nodes/127.0.0.1/stop_all.sh</span><br><span class="line">bash nodes/127.0.0.1/start_all.sh</span><br></pre></td></tr></table></figure><p>如果在Windows主机上开发应用，可以用下面的powershell命令检查 rcp和p2p端口是否已经开启</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Test-NetConnection <span class="number">192</span>.<span class="number">168</span>.<span class="number">201</span>.<span class="number">128</span> -Port <span class="number">8545</span></span><br><span class="line">Test-NetConnection <span class="number">192</span>.<span class="number">168</span>.<span class="number">201</span>.<span class="number">128</span> -Port <span class="number">20200</span></span><br><span class="line">Test-NetConnection <span class="number">192</span>.<span class="number">168</span>.<span class="number">201</span>.<span class="number">128</span> -Port <span class="number">30300</span></span><br></pre></td></tr></table></figure><p><code>Test-NetConnection</code> 是powershell用于测试远程主机和端口是否可联通的命令<br>如果看到类似下面的结果说明可以联通</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ComputerName     : 192.168.201.128</span><br><span class="line">RemoteAddress    : 192.168.201.128</span><br><span class="line">RemotePort       : 8545</span><br><span class="line">InterfaceAlias   : VMware Network Adapter VMnet8</span><br><span class="line">SourceAddress    : 192.168.201.1</span><br><span class="line">TcpTestSucceeded : True</span><br></pre></td></tr></table></figure><p>主要是 <code>TcpTestSucceeded : True</code> 说明联通了，如果是False说明连接失败。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Fisco-Bcos的管理端WeBase-Front</title>
      <link href="/2025/10/10/58-%E6%90%AD%E5%BB%BAFisco-Bcos%E7%9A%84%E7%AE%A1%E7%90%86%E7%AB%AFWeBase-Front/"/>
      <url>/2025/10/10/58-%E6%90%AD%E5%BB%BAFisco-Bcos%E7%9A%84%E7%AE%A1%E7%90%86%E7%AB%AFWeBase-Front/</url>
      
        <content type="html"><![CDATA[<p>在区块链应用开发阶段建议用户使用快速入门搭建。在快速入门搭建模式，开发者只需要搭建节点和节点前置服务(WeBASE-Front)，就可通过WeBASE-Front的合约编辑器进行合约的编辑，编译，部署，调试。</p><p>本文假定已经在本机上安装了FiscoBcos的联盟链节点。</p><h2 id="节点前置服务搭建"><a href="#节点前置服务搭建" class="headerlink" title="节点前置服务搭建"></a>节点前置服务搭建</h2><p><strong>前提条件</strong></p><table><thead><tr><th>依赖软件</th><th>支持版本</th></tr></thead><tbody><tr><td>Java</td><td><a href="https://webasedoc.readthedocs.io/zh-cn/latest/docs/WeBASE-Front/appendix.html#java">Oracle JDK 8 至JDK 14</a></td></tr></tbody></table><h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/WeBankBlockchain/WeBASELargeFiles/releases/download/v1.5.5/webase-front.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">网络访问失败，则可以尝试直接git <span class="built_in">clone</span> WeBASE-Front的仓库，构建方法可参考节点前置部署文档</span></span><br><span class="line">git clone https://github.com/WeBankBlockchain/WeBASE-Front.git</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若因网络问题导致长时间下载失败，可尝试以下命令</span></span><br><span class="line">git clone https://gitee.com/WeBank/WeBASE-Front.git</span><br></pre></td></tr></table></figure><h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip webase-front.zip</span><br><span class="line">cd webase-front</span><br></pre></td></tr></table></figure><h3 id="拷贝sdk证书文件（build-chain的时候生成的）"><a href="#拷贝sdk证书文件（build-chain的时候生成的）" class="headerlink" title="拷贝sdk证书文件（build_chain的时候生成的）"></a>拷贝sdk证书文件（build_chain的时候生成的）</h3><p>将节点所在目录<code>nodes/$&#123;ip&#125;/sdk</code>下的所有文件拷贝到当前<code>conf</code>目录，供SDK与节点建立连接时使用（SDK会自动判断是否为国密，且是否使用国密SSL）</p><ul><li>链的<code>sdk</code>目录包含了<code>ca.crt, sdk.crt, sdk.key</code>和<code>gm</code>文件夹，<code>gm</code>文件夹包含了国密SSL所需的证书</li><li>拷贝命令可使用<code>cp -r nodes/$&#123;ip&#125;/sdk/* ./conf/</code></li><li>注，只有在建链时手动指定了<code>-G</code>(大写)时节点才会使用国密SSL</li></ul><h3 id="服务启停"><a href="#服务启停" class="headerlink" title="服务启停"></a>服务启停</h3><p>服务启停命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动：</span></span><br><span class="line"> bash start.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止：</span> </span><br><span class="line">bash stop.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查：</span> </span><br><span class="line">bash status.sh</span><br></pre></td></tr></table></figure><p>启动成功将出现如下日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Application() - main run success...</span><br></pre></td></tr></table></figure><h2 id="状态检查"><a href="#状态检查" class="headerlink" title="状态检查"></a>状态检查</h2><p>成功部署后，可以根据以下步骤<strong>确认各个子服务是否启动成功</strong></p><h3 id="1-检查各子系统进程"><a href="#1-检查各子系统进程" class="headerlink" title="1. 检查各子系统进程"></a>1. 检查各子系统进程</h3><p>通过<code>ps</code>命令，检查节点与节点前置的进程是否存在</p><ul><li>包含：节点进程<code>nodeXX</code>，节点前置进程<code>webase.front</code></li></ul><p>检查节点进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep node</span><br></pre></td></tr></table></figure><p>输出如下，此处部署了两个节点node0, node1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root     29977     1  1 17:24 pts/2    00:02:20 /root/fisco/webase/webase-deploy/nodes/127.0.0.1/node1/../fisco-bcos -c config.ini</span><br><span class="line">root     29979     1  1 17:24 pts/2    00:02:23 /root/fisco/webase/webase-deploy/nodes/127.0.0.1/node0/../fisco-bcos -c config.ini</span><br></pre></td></tr></table></figure><p>检查节点前置webase-front的进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep webase.front</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root     31805     1  0 17:24 pts/2    00:01:30 /usr/local/jdk/bin/java -Djdk.tls.namedGroups=secp256k1 ... conf/:apps/*:lib/* com.webank.webase.front.Application</span><br></pre></td></tr></table></figure><h3 id="检查进程端口"><a href="#检查进程端口" class="headerlink" title="检查进程端口"></a>检查进程端口</h3><p>通过<code>netstat</code>命令，检查节点与节点前置的端口监听情况</p><p>检查方法如下，若无输出，则代表进程端口监听异常，需要到<code>webase-front/log</code>中查看日志的错误信息，并根据错误提示或根据<a href="https://webasedoc.readthedocs.io/zh-cn/latest/docs/WeBASE-Front/appendix.html">WeBASE-Front常见问题</a>进行错误排查</p><p>检查节点channel端口(默认为20200)是否已监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -anlp | grep 20200</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:20200           0.0.0.0:*               LISTEN      29069/fisco-bcos</span><br></pre></td></tr></table></figure><p>检查webase-front端口(默认为5002)是否已监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -anlp | grep 5002</span><br></pre></td></tr></table></figure><h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p>访问<code> http://&#123;deployIP&#125;:&#123;frontPort&#125;/WeBASE-Front</code>，示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:5002/WeBASE-Front</span><br></pre></td></tr></table></figure><h2 id="开启局域网访问"><a href="#开启局域网访问" class="headerlink" title="开启局域网访问"></a>开启局域网访问</h2><p>修改 web-front&#x2F;conf&#x2F;application.yml</p><p>将sdk下面的ip改成：0.0.0.0 (默认是127.0.0.1)，这样就可以通过物理IP访问服务了。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sdk:</span></span><br><span class="line">  <span class="attr">corePoolSize:</span> <span class="number">50</span></span><br><span class="line">  <span class="attr">maxPoolSize:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">queueCapacity:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">ip:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">channelPort:</span> <span class="number">20200</span></span><br><span class="line">  <span class="attr">certPath:</span> <span class="string">conf</span>  <span class="comment"># cert path of relative or absolute</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后重启服务，关闭CentOS的防火墙或者开放5002端口，之后就可以在另一台计算机上通过IP和端口号访问服务了。</p><p>CentOS 默认防火墙会阻止外部访问，需要开放 5002 端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时开放5002端口（立即生效，重启后失效）</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --add-port=5002/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久开放5002端口（需要重启防火墙）</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --add-port=5002/tcp --permanent</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart firewalld</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco-bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 下安装Fisco Bcos</title>
      <link href="/2025/10/10/57-CentOS-%E4%B8%8B%E5%AE%89%E8%A3%85Fisco-Bcos/"/>
      <url>/2025/10/10/57-CentOS-%E4%B8%8B%E5%AE%89%E8%A3%85Fisco-Bcos/</url>
      
        <content type="html"><![CDATA[<h2 id="1-搭建单群组FISCO-BCOS联盟链"><a href="#1-搭建单群组FISCO-BCOS联盟链" class="headerlink" title="1. 搭建单群组FISCO BCOS联盟链"></a>1. 搭建单群组FISCO BCOS联盟链</h2><h3 id="第一步-安装依赖"><a href="#第一步-安装依赖" class="headerlink" title="第一步. 安装依赖"></a>第一步. 安装依赖</h3><p><code>开发部署工具 build_chain.sh</code>脚本依赖于<code>openssl, curl</code>，根据您使用的操作系统，使用以下命令安装依赖。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure><h3 id="第二步-创建操作目录-下载安装脚本"><a href="#第二步-创建操作目录-下载安装脚本" class="headerlink" title="第二步. 创建操作目录, 下载安装脚本"></a>第二步. 创建操作目录, 下载安装脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建操作目录</span></span></span><br><span class="line">cd ~ &amp;&amp; mkdir -p fisco &amp;&amp; cd fisco</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 下载脚本</span></span></span><br><span class="line">curl -#LO https://github.com/FISCO-BCOS/FISCO-BCOS/releases/download/v2.11.0/build_chain.sh &amp;&amp; chmod u+x build_chain.sh</span><br></pre></td></tr></table></figure><blockquote><p>[!note]<br>如果因为网络问题导致长时间无法下载build_chain.sh脚本，请尝试 curl -#LO <a href="https://gitee.com/FISCO-BCOS/FISCO-BCOS/releases/download/v2.11.0/build_chain.sh">https://gitee.com/FISCO-BCOS/FISCO-BCOS/releases/download/v2.11.0/build_chain.sh</a> &amp;&amp; chmod u+x build_chain.sh</p></blockquote><h3 id="第三步-搭建单群组4节点联盟链"><a href="#第三步-搭建单群组4节点联盟链" class="headerlink" title="第三步. 搭建单群组4节点联盟链"></a>第三步. 搭建单群组4节点联盟链</h3><p>在fisco目录下执行下面的指令，生成一条单群组4节点的FISCO链。 请确保机器的<code>30300~30303，20200~20203，8545~8548</code>端口没有被占用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash build_chain.sh -l 127.0.0.1:4 -p 30300,20200,8545</span><br></pre></td></tr></table></figure><p>命令执行成功会输出<code>All completed</code>。如果执行出错，请检查<code>nodes/build.log</code>文件中的错误信息。</p><h3 id="第四步-启动FISCO-BCOS链"><a href="#第四步-启动FISCO-BCOS链" class="headerlink" title="第四步. 启动FISCO BCOS链"></a>第四步. 启动FISCO BCOS链<a href="https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/installation.html#id5" title="永久链接至标题"></a></h3><ul><li>启动所有节点</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash nodes/127.0.0.1/start_all.sh</span><br></pre></td></tr></table></figure><p>启动成功会输出类似下面内容的响应。否则请使用<code>netstat -an | grep tcp</code>检查机器的<code>30300~30303，20200~20203，8545~8548</code>端口是否被占用。</p><h3 id="第五步-检查进程"><a href="#第五步-检查进程" class="headerlink" title="第五步. 检查进程"></a>第五步. 检查进程<a href="https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/installation.html#id6" title="永久链接至标题"></a></h3><ul><li>检查进程是否启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -v grep | grep fisco-bcos</span><br></pre></td></tr></table></figure><p>正常情况会有类似下面的输出； 如果进程数不为4，则进程没有启动（一般是端口被占用导致的）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fisco       5453     1  1 17:11 pts/0    00:00:02 /home/ubuntu/fisco/nodes/127.0.0.1/node0/../fisco-bcos -c config.ini</span><br><span class="line">fisco       5459     1  1 17:11 pts/0    00:00:02 /home/ubuntu/fisco/nodes/127.0.0.1/node1/../fisco-bcos -c config.ini</span><br><span class="line">fisco       5464     1  1 17:11 pts/0    00:00:02 /home/ubuntu/fisco/nodes/127.0.0.1/node2/../fisco-bcos -c config.ini</span><br><span class="line">fisco       5476     1  1 17:11 pts/0    00:00:02 /home/ubuntu/fisco/nodes/127.0.0.1/node3/../fisco-bcos -c config.ini</span><br></pre></td></tr></table></figure><h3 id="第六步-检查日志输出"><a href="#第六步-检查日志输出" class="headerlink" title="第六步. 检查日志输出"></a>第六步. 检查日志输出<a href="https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/installation.html#id7" title="永久链接至标题"></a></h3><ul><li>如下，查看节点node0链接的节点数</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f nodes/127.0.0.1/node0/log/log*  |</span><br></pre></td></tr></table></figure><p>正常情况会不停地输出连接信息，从输出可以看出node0与另外3个节点有连接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">info|2019-01-21 17:30:58.316769| [P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2019-01-21 17:31:08.316922| [P2P][Service] heartBeat,connected count=3</span><br><span class="line">info|2019-01-21 17:31:18.317105| [P2P][Service] heartBeat,connected count=3</span><br></pre></td></tr></table></figure><ul><li>执行下面指令，检查是否在共识</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f nodes/127.0.0.1/node0/log/log*  | grep +++</span><br></pre></td></tr></table></figure><p>正常情况会不停输出带有<code>++++Generating seal</code>的日志，即表示共识正常。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info|2020-12-22 17:24:43.729402|[g:1][CONSENSUS][SEALER]++++++++++++++++ Generating seal on,blkNum=1,tx=0,nodeIdx=1,hash=2e133146...</span><br><span class="line">info|2020-12-22 17:24:47.740603|[g:1][CONSENSUS][SEALER]++++++++++++++++ Generating seal on,blkNum=1,tx=0,nodeIdx=1,hash=eb199760...</span><br></pre></td></tr></table></figure><h2 id="2-配置及使用控制台"><a href="#2-配置及使用控制台" class="headerlink" title="2. 配置及使用控制台"></a>2. 配置及使用控制台</h2><p>在控制台链接FISCO BCOS节点，实现<strong>查询区块链状态、部署调用合约</strong>等功能，能够快速获取到所需要的信息。</p><h3 id="第一步-准备依赖"><a href="#第一步-准备依赖" class="headerlink" title="第一步. 准备依赖"></a>第一步. 准备依赖<a href="https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/installation.html#id9" title="永久链接至标题"></a></h3><ul><li>安装java （推荐使用java 14）.</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y java java-devel</span><br></pre></td></tr></table></figure><ul><li>获取控制台并回到fisco目录</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/fisco &amp;&amp; curl -LO https://github.com/FISCO-BCOS/console/releases/download/v2.9.2/download_console.sh &amp;&amp; bash download_console.sh</span><br></pre></td></tr></table></figure><blockquote><p>[!note]<br>如果因为网络问题导致长时间无法下载，请尝试 cd ~&#x2F;fisco &amp;&amp; curl -#LO <a href="https://gitee.com/FISCO-BCOS/console/raw/master-2.0/tools/download_console.sh">https://gitee.com/FISCO-BCOS/console/raw/master-2.0/tools/download_console.sh</a> &amp;&amp; bash download_console.sh</p></blockquote><ul><li>拷贝控制台配置文件</li></ul><p>若节点未采用默认端口，请将文件中的20200替换成节点对应的channel端口。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最新版本控制台使用如下命令拷贝配置文件</span></span><br><span class="line">cp -n console/conf/config-example.toml console/conf/config.toml</span><br></pre></td></tr></table></figure><ul><li>配置控制台证书</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r nodes/127.0.0.1/sdk/* console/conf/</span><br></pre></td></tr></table></figure><h3 id="第二步-启动并使用控制台"><a href="#第二步-启动并使用控制台" class="headerlink" title="第二步. 启动并使用控制台"></a>第二步. 启动并使用控制台<a href="https://fisco-bcos-documentation.readthedocs.io/zh-cn/latest/docs/installation.html#id10" title="永久链接至标题"></a></h3><ul><li>启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/fisco/console &amp;&amp; bash start.sh</span><br></pre></td></tr></table></figure><p>输出下述信息表明启动成功 否则请检查conf&#x2F;config.toml中节点端口配置是否正确</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">=============================================================================================</span><br><span class="line">Welcome to FISCO BCOS console(2.6.0)！</span><br><span class="line">Type &#x27;help&#x27; or &#x27;h&#x27; for help. Type &#x27;quit&#x27; or &#x27;q&#x27; to quit console.</span><br><span class="line"> ________  ______   ______    ______    ______         _______    ______    ______    ______</span><br><span class="line">|        \|      \ /      \ /      \ /      \ |       \ /      \ /      \ /      \</span><br><span class="line">| $$$$$$$$ \$$$$$$|  $$$$$$\|  $$$$$$\|  $$$$$$\ | $$$$$$$\|  $$$$$$\|  $$$$$$\|  $$$$$$\</span><br><span class="line">| $$__      | $$  | $$___\$$| $$   \$$| $$  | $$      | $$__/ $$| $$   \$$| $$  | $$| $$___\$$</span><br><span class="line">| $$  \ | $$   \$$    \ | $$      | $$  | $$      | $$    $$| $$      | $$  | $$ \$$    \</span><br><span class="line">| $$$$$     | $$   _\$$$$$$\| $$   __ | $$  | $$      | $$$$$$$\| $$   __ | $$  | $$ _\$$$$$$\</span><br><span class="line">| $$       _| $$_ |  \__| $$| $$__/  \| $$__/ $$      | $$__/ $$| $$__/  \| $$__/ $$|  \__| $$</span><br><span class="line">| $$      |   $$ \ \$$    $$ \$$    $$ \$$    $$      | $$    $$ \$$    $$ \$$    $$ \$$    $$</span><br><span class="line"> \$$       \$$$$$$  \$$$$$$   \$$$$$$   \$$$$$$        \$$$$$$$   \$$$$$$   \$$$$$$   \$$$$$$</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br></pre></td></tr></table></figure><ul><li>用控制台获取信息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取客户端版本</span></span><br><span class="line">[group:1]&gt; getNodeVersion</span><br><span class="line">ClientVersion&#123;</span><br><span class="line">    version=&#x27;2.6.0&#x27;,</span><br><span class="line">    supportedVersion=&#x27;2.6.0&#x27;,</span><br><span class="line">    chainId=&#x27;1&#x27;,</span><br><span class="line">    buildTime=&#x27;20200819 15:47:59&#x27;,</span><br><span class="line">    buildType=&#x27;Darwin/appleclang/RelWithDebInfo&#x27;,</span><br><span class="line">    gitBranch=&#x27;HEAD&#x27;,</span><br><span class="line">    gitCommitHash=&#x27;e4a5ef2ef64d1943fccc4ebc61467a91779fb1c0&#x27;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取节点信息</span></span><br><span class="line">[group:1]&gt; getPeers</span><br><span class="line">[</span><br><span class="line">    PeerInfo&#123;</span><br><span class="line">        nodeID=&#x27;c1bd77e188cd0783256ee06838020f24a697f9af785438403d3620967a4a3612e3abc4bbe986d1e9dddf62d4236bff0b7d19a935a3cd44889f681409d5bf8692&#x27;,</span><br><span class="line">        ipAndPort=&#x27;127.0.0.1:30302&#x27;,</span><br><span class="line">        agency=&#x27;agency&#x27;,</span><br><span class="line">        topic=[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        node=&#x27;node2&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    PeerInfo&#123;</span><br><span class="line">        nodeID=&#x27;7f27f5d67f104eacf689790f09313e4343e7887a1a7b79c31cd151be33c7c8dd57c895a66086c3c8e0b54d2fa493407e0d9646b2bd9fc29a94fd3663a5332e6a&#x27;,</span><br><span class="line">        ipAndPort=&#x27;127.0.0.1:57266&#x27;,</span><br><span class="line">        agency=&#x27;agency&#x27;,</span><br><span class="line">        topic=[</span><br><span class="line">            _block_notify_1</span><br><span class="line">        ],</span><br><span class="line">        node=&#x27;node1&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    PeerInfo&#123;</span><br><span class="line">        nodeID=&#x27;862f26d9681ed4c12681bf81a50d0b8c66dd5b6ee7b0b42a4af12bb37b1ad2442f7dcfe8dac4e737ce9fa46aa94d904e8c474659eabf575d6715995553245be5&#x27;,</span><br><span class="line">        ipAndPort=&#x27;127.0.0.1:30303&#x27;,</span><br><span class="line">        agency=&#x27;agency&#x27;,</span><br><span class="line">        topic=[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        node=&#x27;node3&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[group:1]&gt;</span><br></pre></td></tr></table></figure><h2 id="3-部署及调用HelloWorld合约"><a href="#3-部署及调用HelloWorld合约" class="headerlink" title="3. 部署及调用HelloWorld合约"></a>3. 部署及调用HelloWorld合约</h2><h3 id="第一步-编写HelloWorld合约"><a href="#第一步-编写HelloWorld合约" class="headerlink" title="第一步. 编写HelloWorld合约"></a>第一步. 编写HelloWorld合约</h3><p>HelloWorld合约提供两个接口，分别是<code>get()</code>和<code>set()</code>，用于获取&#x2F;设置合约变量<code>name</code>。合约内容如下:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">    string name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">HelloWorld</span>(<span class="params"></span>) &#123;</span><br><span class="line">        name = <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>)constant <span class="title function_">returns</span>(<span class="params">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">string n</span>) &#123;</span><br><span class="line">        name = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="第二步-部署HelloWorld合约"><a href="#第二步-部署HelloWorld合约" class="headerlink" title="第二步. 部署HelloWorld合约"></a>第二步. 部署HelloWorld合约</h3><p>为了方便用户快速体验，HelloWorld合约已经内置于控制台中，位于控制台目录下<code>contracts/solidity/HelloWorld.sol</code>，参考下面命令部署即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在控制台输入以下指令 部署成功则返回合约地址</span></span><br><span class="line">[group:1]&gt; deploy HelloWorld</span><br><span class="line">transaction hash: 0xd0305411e36d2ca9c1a4df93e761c820f0a464367b8feb9e3fa40b0f68eb23fa</span><br><span class="line">contract address:0xb3c223fc0bf6646959f254ac4e4a7e355b50a344</span><br></pre></td></tr></table></figure><h3 id="第三步-调用HelloWorld合约"><a href="#第三步-调用HelloWorld合约" class="headerlink" title="第三步. 调用HelloWorld合约"></a>第三步. 调用HelloWorld合约</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前块高</span></span><br><span class="line">[group:1]&gt; getBlockNumber</span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调用get接口获取name变量 此处的合约地址是deploy指令返回的地址</span></span><br><span class="line">[group:1]&gt; call HelloWorld 0xb3c223fc0bf6646959f254ac4e4a7e355b50a344 get</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Return code: 0</span><br><span class="line">description: transaction executed successfully</span><br><span class="line">Return message: Success</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Return values:</span><br><span class="line">[</span><br><span class="line">    &quot;Hello,World!&quot;</span><br><span class="line">]</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前块高，块高不变，因为get接口不更改账本状态</span></span><br><span class="line">[group:1]&gt; getBlockNumber</span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调用<span class="built_in">set</span>设置name</span></span><br><span class="line">[group:1]&gt; call HelloWorld 0xb3c223fc0bf6646959f254ac4e4a7e355b50a344 set &quot;Hello, FISCO BCOS&quot;</span><br><span class="line">transaction hash: 0x7e742c44091e0d6e4e1df666d957d123116622ab90b718699ce50f54ed791f6e</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">transaction status: 0x0</span><br><span class="line">description: transaction executed successfully</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Output</span><br><span class="line">Receipt message: Success</span><br><span class="line">Return message: Success</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Event logs</span><br><span class="line">Event: &#123;&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次查看当前块高，块高增加表示已出块，账本状态已更改</span></span><br><span class="line">[group:1]&gt; getBlockNumber</span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调用get接口获取name变量，检查设置是否生效</span></span><br><span class="line">[group:1]&gt; call HelloWorld 0xb3c223fc0bf6646959f254ac4e4a7e355b50a344 get</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Return code: 0</span><br><span class="line">description: transaction executed successfully</span><br><span class="line">Return message: Success</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Return values:</span><br><span class="line">[</span><br><span class="line">    &quot;Hello,FISCO BCOS&quot;</span><br><span class="line">]</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出控制台</span></span><br><span class="line">[group:1]&gt; quit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> fisco-bcos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 下安装Docker</title>
      <link href="/2025/10/10/56-CentOS-%E4%B8%8B%E5%AE%89%E8%A3%85Docker/"/>
      <url>/2025/10/10/56-CentOS-%E4%B8%8B%E5%AE%89%E8%A3%85Docker/</url>
      
        <content type="html"><![CDATA[<p>由于Docker官方服务的变更，原有的一键安装Docker的命令无法执行。下面是CentOS 7中手动安装的过程。</p><h2 id="1-卸载旧版本-Docker"><a href="#1-卸载旧版本-Docker" class="headerlink" title="1. 卸载旧版本 Docker"></a>1. 卸载旧版本 Docker</h2><p>如果系统中已安装旧版本的 Docker，请先卸载：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">               docker-client \</span><br><span class="line">               docker-client-latest \</span><br><span class="line">               docker-common \</span><br><span class="line">               docker-latest \</span><br><span class="line">               docker-latest-logrotate \</span><br><span class="line">               docker-logrotate \</span><br><span class="line">               docker-engine</span><br></pre></td></tr></table></figure><h2 id="2-安装依赖工具"><a href="#2-安装依赖工具" class="headerlink" title="2. 安装依赖工具"></a>2. 安装依赖工具</h2><p>安装 <em>yum-utils</em> 工具，用于管理软件包和配置仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure><h2 id="3-添加-Docker-官方仓库"><a href="#3-添加-Docker-官方仓库" class="headerlink" title="3. 添加 Docker 官方仓库"></a>3. 添加 Docker 官方仓库</h2><p>运行以下命令添加 Docker 的官方仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h2 id="4-安装-Docker"><a href="#4-安装-Docker" class="headerlink" title="4. 安装 Docker"></a>4. 安装 Docker</h2><p>使用以下命令安装 Docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><h2 id="5-启动并验证-Docker"><a href="#5-启动并验证-Docker" class="headerlink" title="5. 启动并验证 Docker"></a>5. 启动并验证 Docker</h2><ul><li>启动 Docker 服务：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><ul><li>验证是否成功运行：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure><h2 id="6-设置开机自启"><a href="#6-设置开机自启" class="headerlink" title="6. 设置开机自启"></a>6. 设置开机自启</h2><p>让 Docker 在系统启动时自动运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure><h2 id="7-测试安装"><a href="#7-测试安装" class="headerlink" title="7. 测试安装"></a>7. 测试安装</h2><p>运行以下命令测试 Docker 是否正常工作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure><p>如果看到 “Hello from Docker!” 的欢迎信息，说明安装成功。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>女儿数学考试成绩不理想</title>
      <link href="/2025/09/30/55-%E5%A5%B3%E5%84%BF%E6%95%B0%E5%AD%A6%E8%80%83%E8%AF%95%E6%88%90%E7%BB%A9%E4%B8%8D%E7%90%86%E6%83%B3/"/>
      <url>/2025/09/30/55-%E5%A5%B3%E5%84%BF%E6%95%B0%E5%AD%A6%E8%80%83%E8%AF%95%E6%88%90%E7%BB%A9%E4%B8%8D%E7%90%86%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿，你好：</p><p>昨晚，你忽然对我说：“爸爸，我有一个秘密你想不想听？”<br>我说，好啊。<br>于是你跟我说了昨天的数学考试成绩，只有63分。<br>我能看出来你内心是不开心的，但是你还是装作平静的跟我说，班里最高的也就80多分，很多人还不及格，你因为做完检查了卷子才没有不及格。<br>我安慰你，考的不好没关系，学习并不能代表什么。还跟你说，如果想提高成绩，那我们就想办法。<br>女儿，我想让你知道，有事爸爸会帮她想办法。<br>于是，我们定下来每天学习数学25分钟的目标。从今天开始。</p><p>我打算今天看一下你们现在上的数学课内容，然后咱们一起商量着看哪部分需要提高。数学这个东西，根据我的经验，多做题是一个看起来很笨，但是很有效的方法。而且，我们只要每天花25分钟，我相信下个学期你的数学成绩就会排在全班的前列。因为你是个聪明的孩子，数学这个东西是可以通过练习提高的，应付考试是没问题的。</p><p>早上你妈妈跟我说，班里的数学成绩都下来了，问我是否知道。还说要不要给你找个补习班补一补。我觉得咱们看看再说，如果爸爸和你一起复习的效果不好，我们再找一个补习老师，别着急，也别灰心，没问题的。</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Word插件开发快速入门</title>
      <link href="/2025/09/29/54-Word%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2025/09/29/54-Word%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>Word插件开发之前一直是基于VBS这样的脚本语言，这种方式有一个问题是其基于“Windows宏”，那么在非Windows的系统上就不是有好。最新的Office-Add-In支持基于Nodejs进行插件的开发。</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>Nodejs</li><li>npm</li></ul><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g yo generator-office</span><br></pre></td></tr></table></figure><h2 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo office</span><br></pre></td></tr></table></figure><p>然后选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Choose a project type: Office Add-in Task Pane project</span><br></pre></td></tr></table></figure><p>接下来选择开发语言，这里我们选择TypeScript</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeScript</span><br></pre></td></tr></table></figure><p>接下根据提示给项目命名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">What do you want to name your add-in? (My Office Add-in)</span><br></pre></td></tr></table></figure><p>然后选择Word</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">? Which Office client application would you like to support?</span><br><span class="line">  Excel</span><br><span class="line">  Onenote</span><br><span class="line">  Outlook</span><br><span class="line">  Powerpoint</span><br><span class="line">  Project</span><br><span class="line">&gt; Word</span><br></pre></td></tr></table></figure><p>回车后，yo框架会创建工程架构并通过npm安装必要的nodejs依赖。最后会输出下面的信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">230 packages are looking for funding</span><br><span class="line">  run `npm fund` for details</span><br><span class="line">-----------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">      Congratulations! Your add-in has been created! Your next steps:</span><br><span class="line"></span><br><span class="line">      1. Go the directory where your project was created:</span><br><span class="line"></span><br><span class="line">         cd C:\Users\xxx\你的项目路径</span><br><span class="line"></span><br><span class="line">      2. Start the local web server and sideload the add-in:</span><br><span class="line"></span><br><span class="line">         npm start</span><br><span class="line"></span><br><span class="line">      3. Open the project in VS Code:</span><br><span class="line"></span><br><span class="line">         code .</span><br><span class="line"></span><br><span class="line">         For more information, visit http://code.visualstudio.com.</span><br><span class="line"></span><br><span class="line">      Please visit https://learn.microsoft.com/office/dev/add-ins for more information about Office Add-ins.</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="运行工程"><a href="#运行工程" class="headerlink" title="运行工程"></a>运行工程</h2><p>按照上面的提示，首选需要启动本地的调试服务。因为我们的Nodejs代码实际上是嵌入到Word中的一个HTML页面，其中包含了Nodejs写的功能逻辑。因此这个本地的服务相当于一个Nodejs的运行容器。</p><p>执行下面的命令启动服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><blockquote><p>[!caution]<br>注意，一定要用管理员模式打开Powershell</p></blockquote><p>然后控制台会提示是否运行本地服务执行Edge的 WebView。由此可见Word插件开发是基于浏览器的WebView的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Debugging is being started...</span><br><span class="line">App type: desktop</span><br><span class="line">? Allow localhost loopback for Microsoft Edge WebView? (Y/n)</span><br></pre></td></tr></table></figure><p>Word插件的开发需要Office 插件的证书，因此运行项目的时候可能会出现未知异常，这很可能是证书失效了。解决的办法是用管理员身份打开Powershell，然后再执行上面的命令。此时会弹出下面的提示，选择“是”。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250929141203108.png" alt="image.png"></p><p>然后系统会再给你颁发一个新的证书，弹出如下的对话框，选择“是”</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250929141305729.png" alt="image.png"></p><p>接着系统会打开Word，并出现下面的提示，点“确定”即可。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250929141355963.png" alt="image.png"></p><p>这时我们会发现系统的右边出现下面的界面，这是yo为我们生成的骨架程序，我们基于这个工程进行修改即可。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250929141518703.png" alt="image.png"></p><h2 id="自定义面板"><a href="#自定义面板" class="headerlink" title="自定义面板"></a>自定义面板</h2><p>示例工程给出了Word插件的骨架。我们的项目中将开发一个Word插件来检查当前文档中的错别字。暂时给它取个名字叫“文镜”，那么我们来按照这个需求修改一下插件的名称和一些定制的界面内容。</p><h3 id="修改插件名称"><a href="#修改插件名称" class="headerlink" title="修改插件名称"></a>修改插件名称</h3><p>默认的插件名称是示例工程提供的，我们在这里要改成“文镜”两个字，默认的菜单分子是”Commands Group” 我们要改成“文镜校对”几个字。修改的方法是打开项目根目录下的manifest.xml文件，然后找到<code>bt:ShortStrings</code> 和 <code>bt:LongStrings</code> 这两个元素，然后找到对应的位置修改如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bt:ShortStrings</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bt:String</span> <span class="attr">id</span>=<span class="string">&quot;GetStarted.Title&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;开始使用文镜校对&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bt:String</span> <span class="attr">id</span>=<span class="string">&quot;CommandsGroup.Label&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;文镜修改&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bt:String</span> <span class="attr">id</span>=<span class="string">&quot;TaskpaneButton.Label&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;文镜&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bt:ShortStrings</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bt:LongStrings</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bt:String</span> <span class="attr">id</span>=<span class="string">&quot;GetStarted.Description&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;点击这里开始进行文字校对.&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bt:String</span> <span class="attr">id</span>=<span class="string">&quot;TaskpaneButton.Tooltip&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;点击这里开始校对&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bt:LongStrings</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="修改面板的名称"><a href="#修改面板的名称" class="headerlink" title="修改面板的名称"></a>修改面板的名称</h3><p>当插件启动的时候，面板的名称是默认的工程名，我们需要修改成应用的名称，方法还是找到manifest.xml 进行修改，找到 <code>DisplayName</code> 元素进行修改如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">DisplayName</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;文镜&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="修改应用图标"><a href="#修改应用图标" class="headerlink" title="修改应用图标"></a>修改应用图标</h3><p>默认图标是一个<code>Logo</code> 文字图标，我们在这里要换成自己的。图标文件在项目根目录的assets文件夹下面，我们需要创建下面几个尺寸的图片文件</p><table><thead><tr><th>文件名</th><th>尺寸</th></tr></thead><tbody><tr><td>icon-16.png</td><td><code>16*16</code></td></tr><tr><td>icon-32.png</td><td><code>32*32</code></td></tr><tr><td>icon-64.png</td><td><code>64*64</code></td></tr><tr><td>icon-80.png</td><td><code>80*80</code></td></tr><tr><td>icon-128.png</td><td><code>128*128</code></td></tr><tr><td>logo-filed.png</td><td><code>300*300</code></td></tr></tbody></table><p>可以自己设计也可以到iconfont上购买。<br>这些图标位置的定义也是在manifest.xml中，找到<code>bt:Image</code> 元素即可看到</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bt:Images</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bt:Image</span> <span class="attr">id</span>=<span class="string">&quot;Icon.16x16&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;https://localhost:3000/assets/icon-16.png&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bt:Image</span> <span class="attr">id</span>=<span class="string">&quot;Icon.32x32&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;https://localhost:3000/assets/icon-32.png&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bt:Image</span> <span class="attr">id</span>=<span class="string">&quot;Icon.80x80&quot;</span> <span class="attr">DefaultValue</span>=<span class="string">&quot;https://localhost:3000/assets/icon-80.png&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bt:Images</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="第一个程序功能"><a href="#第一个程序功能" class="headerlink" title="第一个程序功能"></a>第一个程序功能</h2><p>我们使用TypeScript开发插件，其实主要功能就是利用Office封装的Nodejs的SDK来操作Word中的对象。在上面的示例工程中，当我们点击面板上的【Run】时，会在Word文档中插入“Hello World” 这样的文本。</p><p>yo工程的所有源代码都在src命令下，上述的页面面板就是在src\taskpane这个文件夹下面。其中有一个taskpane.html。其中就是普通的HTML。可见word插件是通过内置的WebView将HTML渲染出来。我们现在先不该界面元素。来看看点击按钮后是怎么在Word中插入文字的。</p><p>找到taskpane.ts文件，下面的<code>Office.onReady</code> 这个函数是在文档加载时执行的操作：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Office</span>.<span class="title function_">onReady</span>(<span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (info.<span class="property">host</span> === <span class="title class_">Office</span>.<span class="property">HostType</span>.<span class="property">Word</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sideload-msg&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app-body&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;flex&quot;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;run&quot;</span>).<span class="property">onclick</span> = run;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>从代码中我们可以看到：</p><ol><li>if 判定Word的插件服务是否已经启动了</li><li>如果已经启动，那么下面的三行代码分别是：<ol><li>给<code>sideload-msg</code> 元素设置样式</li><li>给<code>app-body</code> 元素设置样式</li><li>给<code>run</code> 元素的onclick事件绑定函数<code>run</code></li></ol></li></ol><p>接下来我们看<code>run</code> 函数的功能是什么</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Word</span>.<span class="title function_">run</span>(<span class="title function_">async</span> (context) =&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Insert your Word code here</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// insert a paragraph at the end of the document.</span></span><br><span class="line">    <span class="keyword">const</span> paragraph = context.<span class="property">document</span>.<span class="property">body</span>.<span class="title function_">insertParagraph</span>(<span class="string">&quot;Hello World&quot;</span>, <span class="title class_">Word</span>.<span class="property">InsertLocation</span>.<span class="property">end</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// change the paragraph color to blue.</span></span><br><span class="line">    paragraph.<span class="property">font</span>.<span class="property">color</span> = <span class="string">&quot;blue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> context.<span class="title function_">sync</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li><code>context.document.body.insertParagraph</code> 这个是Office插件SDK提供的函数，它的功能就是在文档中插入一段文本。后面的<code>Word.InsertLocation.end</code> 参数意思是在当前文档最后的位置插入。</li><li><code>paragraph.font.color = &quot;blue&quot;;</code> 是设置刚才我们插入文字的颜色。</li><li><code>await context.sync();</code> 是把把修改<code>同步</code>到当前文档中。</li></ul><p>我们来试着修改一下，把刚才的”Hello Word”改成中文“你好，世界！”</p><p>再次点击【Run】，看效果如下</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250929150032015.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Office </tag>
            
            <tag> 插件开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Firecrawl抓取网页内容并输出为Markdown文件</title>
      <link href="/2025/09/28/53-%E4%BD%BF%E7%94%A8Firecrawl%E6%8A%93%E5%8F%96%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%E5%B9%B6%E8%BE%93%E5%87%BA%E4%B8%BAMarkdown%E6%96%87%E4%BB%B6/"/>
      <url>/2025/09/28/53-%E4%BD%BF%E7%94%A8Firecrawl%E6%8A%93%E5%8F%96%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%E5%B9%B6%E8%BE%93%E5%87%BA%E4%B8%BAMarkdown%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>我们要训练大模型离不开为其提供语料，在实际的工作中，对于自然语言类知识，最好的方式是提供Markdown格式的内容。<br>现在的互联网上有大量的内容可以供我们拿来使用，但是还需要将其格式转换为Markdown格式。<a href="https://www.firecrawl.dev/">Firecrawl</a> 是一个方便的工具，可以快速的根据提供的网页地址甚至是一个网站链接将内容抓取出来，并且可以输出为Markdown、HTML、Json等多种格式。<br>Firecrawl是开源的，我们可以本地化部署这个服务来使用。不过它也提供了在线的SaaS服务。下面这个例子展示了如何通过调用它的SaaS服务来抓取知乎上的一篇文章。</p><p>首先，我们需要注册一个Firecrawl的账号。 进入下面这个网址：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.firecrawl.dev/</span><br></pre></td></tr></table></figure><p>注册一个账号，就可以使用了。Firecrawl提供500个积分的免费额度。这500个积分可以用于抓取500个页面，对于我们的例子讲解足够了，它也提供了收费服务，可以通过这里查看价格 <a href="https://www.firecrawl.dev/pricing">Firecrawl - The Web Data API for AI</a>。</p><p>注册账号之后，Firecrawl会提供给我们一个API Key，我们在执行代码时需要用到它。</p><p>我们用Python来写这个例子（Firecrawl也提供了NodeJs的SDK，以及Http API）。</p><p>首先安装Python依赖：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install firecrawl-py</span><br></pre></td></tr></table></figure><p>下面是例子代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> firecrawl <span class="keyword">import</span> Firecrawl </span><br><span class="line"></span><br><span class="line">api_key=<span class="string">&quot;写入你的Firecrawl API Key&quot;</span></span><br><span class="line">firecrawl=Firecrawl(api_key=api_key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抓取一个网页</span></span><br><span class="line">scrap_result=firecrawl.scrape(<span class="string">&quot;https://zhuanlan.zhihu.com/p/1954937234307388150&quot;</span></span><br><span class="line">,formats=[<span class="string">&quot;markdown&quot;</span>])</span><br><span class="line"><span class="comment"># 获取页面的标题</span></span><br><span class="line">title=scrap_result.metadata.title</span><br><span class="line"><span class="comment"># 用标题来命名markdown文件并写入本地磁盘</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;<span class="subst">&#123;title&#125;</span>.md&quot;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(scrap_result.markdown)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行上面代码后，会在当前目录生成一个.md的Markdown文件，包含了从提供的网址抓取到的网页内容并转换成了markdown格式。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> Firecrawl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用智谱CogTTS将文本转换为语音</title>
      <link href="/2025/09/26/52-%E4%BD%BF%E7%94%A8%E6%99%BA%E8%B0%B1CogTTS%E5%B0%86%E6%96%87%E6%9C%AC%E8%BD%AC%E6%8D%A2%E4%B8%BA%E8%AF%AD%E9%9F%B3/"/>
      <url>/2025/09/26/52-%E4%BD%BF%E7%94%A8%E6%99%BA%E8%B0%B1CogTTS%E5%B0%86%E6%96%87%E6%9C%AC%E8%BD%AC%E6%8D%A2%E4%B8%BA%E8%AF%AD%E9%9F%B3/</url>
      
        <content type="html"><![CDATA[<p>文本转语音这类技术已经有很多了，自从大模型出现后在转换速度和转换后的还原度上有了很大的突破。今天这个示例是基于智谱AI的CogTTS来实现的文本转语音的例子。</p><p>在这个例子中，我们的需求如下：</p><ul><li>在一个名为speech.txt文本中保存了要转换的语音</li><li>通过CogTTS将speech.txt中的文本转换为语音</li><li>将转换后的语音保存到.&#x2F;audo&#x2F;speech.wav文件中</li></ul><p>要完成这些工作，我们首先需要安装依赖。在这之前我们在当前目录下创建一个Python的虚拟环境</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m venv .venv</span><br><span class="line">./venv/Scripts/activate</span><br></pre></td></tr></table></figure><p>然后安装依赖</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install zai-sdk</span><br></pre></td></tr></table></figure><p>示例代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> zai <span class="comment"># 导入CogTTS</span></span><br><span class="line"><span class="keyword">from</span> zai <span class="keyword">import</span> ZhipuAiClient <span class="comment"># 导入智谱AI的客户端</span></span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path <span class="comment"># 用于查找和创建文件目录</span></span><br><span class="line"></span><br><span class="line">client=ZhipuAiClient(api_key=<span class="string">&quot;这里输入你的智谱AI的ApiKey&quot;</span>)</span><br><span class="line"><span class="comment"># 创建audio目录（如果不存在）</span></span><br><span class="line">audio_dir = Path(<span class="string">&quot;audio&quot;</span>)</span><br><span class="line">audio_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">speech_file_path = audio_dir / <span class="string">&quot;speech.wav&quot;</span></span><br><span class="line"></span><br><span class="line">content=<span class="string">&quot;&quot;</span> <span class="comment"># 用于保存从文本中读出的内容</span></span><br><span class="line">spech_text_file_path=Path(<span class="string">&quot;speech.txt&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(spech_text_file_path,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content=f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response=client.audio.speech(</span><br><span class="line">    model=<span class="string">&quot;cogtts&quot;</span>, <span class="comment"># 制定使用的模型为cogtts 这是固定的</span></span><br><span class="line">    <span class="built_in">input</span>=content, <span class="comment"># 设置要让模型读取的文本内容</span></span><br><span class="line">    voice=<span class="string">&quot;douji&quot;</span>, <span class="comment"># 这里可以设置语音的音色，根据官方文档可以有多个音色</span></span><br><span class="line">    response_format=<span class="string">&quot;wav&quot;</span>, <span class="comment"># 返回的文件格式，支持 wav和pcm</span></span><br><span class="line">    speed=<span class="number">1.0</span>, <span class="comment"># 语速，默认1.0，取值范围[0.5, 2]</span></span><br><span class="line">    volume=<span class="number">1.0</span> <span class="comment"># 音量，默认1.0，取值范围(0, 10]</span></span><br><span class="line">)</span><br><span class="line">response.stream_to_file(speech_file_path)</span><br></pre></td></tr></table></figure><p>CogTTS支持的音色</p><ul><li>tongtong: 彤彤，默认音色</li><li>chuichui: 锤锤</li><li>xiaochen: 小陈</li><li>jam: 动动动物圈jam音色</li><li>kazi: 动动动物圈kazi音色</li><li>douji: 动动动物圈douji音色</li><li>luodo: 动动动物圈luodo音色</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CogTTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows10 最长路径字符限制导致Python依赖安装异常的解决办法</title>
      <link href="/2025/09/26/51-Windows10-%E6%9C%80%E9%95%BF%E8%B7%AF%E5%BE%84%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6%E5%AF%BC%E8%87%B4Python%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85%E5%BC%82%E5%B8%B8%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2025/09/26/51-Windows10-%E6%9C%80%E9%95%BF%E8%B7%AF%E5%BE%84%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6%E5%AF%BC%E8%87%B4Python%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85%E5%BC%82%E5%B8%B8%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>今天在开发程序，在安装Python的一个依赖时出现了下面的异常：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ERROR: <span class="title">Could</span> <span class="title">not</span> <span class="title">install</span> <span class="title">packages</span> <span class="title">due</span> <span class="title">to</span> <span class="title">an</span> <span class="title">OSError</span>: [<span class="title">Errno</span> 2] <span class="title">No</span> <span class="title">such</span> <span class="title">file</span> <span class="title">or</span> <span class="title">directory</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">HINT</span>: <span class="title">This</span> <span class="title">error</span> <span class="title">might</span> <span class="title">have</span> <span class="title">occurred</span> <span class="title">since</span> <span class="title">this</span> <span class="title">system</span> <span class="title">does</span> <span class="title">not</span> <span class="title">have</span> <span class="title">Windows</span> <span class="title">Long</span> <span class="title">Path</span> <span class="title">support</span> <span class="title">enabled</span>. <span class="title">You</span> <span class="title">can</span> <span class="title">find</span> <span class="title">information</span> <span class="title">on</span> <span class="title">how</span> <span class="title">to</span> <span class="title">enable</span> <span class="title">this</span> <span class="title">at</span> <span class="title">https</span>://<span class="title">pip.pypa.io</span>/<span class="title">warnings</span>/<span class="title">enable</span>-<span class="title">long</span>-<span class="title">paths</span></span></span><br></pre></td></tr></table></figure><p>从提示中可以看出，这是由于Windows最长路径限制造成的。因为我写的这个程序的目录特别长，而Window10默认对路径的最长限制是260个字符。</p><p>修改的方式我们只要参考这里即可：<a href="https://learn.microsoft.com/en-us/windows/win32/fileio/maximum-file-path-limitation?tabs=registry#enable-long-paths-in-windows-10-version-1607-and-later">Maximum Path Length Limitation - Win32 apps | Microsoft Learn</a></p><p>文章一开头就告诉我们：</p><blockquote><p>In the Windows API (with some exceptions discussed in the following paragraphs), the maximum length for a path is <strong>MAX_PATH</strong>, which is defined as 260 characters. A local path is structured in the following order: drive letter, colon, backslash, name components separated by backslashes, and a terminating null character. For example, the maximum path on drive D is “D:_some 256-character path string_<code>&lt;NUL&gt;</code>“ where “<code>&lt;NUL&gt;</code>“ represents the invisible terminating null character for the current system codepage. (The characters <code>&lt; &gt;</code> are used here for visual clarity and cannot be part of a valid path string.)</p></blockquote><p>翻译过来就是</p><blockquote><p>[!note]<br>在Windows API中（下文段落会讨论一些例外情况），路径的最大长度为MAX_PATH，其定义为260个字符。本地路径的结构顺序如下：驱动器号、冒号、反斜杠、由反斜杠分隔的名称组件，以及一个终止空字符。例如，D盘上的最大路径为“D:\some 256-character path string<code>&lt;NUL&gt;</code>”，其中“<code>&lt;NUL&gt;</code>”代表当前系统代码页中不可见的终止空字符。（此处使用<code>&lt; &gt;</code>是为了视觉上的清晰，它们不能成为有效路径字符串的一部分。）</p></blockquote><p>解决的办法文中也告诉我们了，只要用Windows管理员权限打开Powershell，然后输入下面的命令即可</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem&quot;</span> <span class="literal">-Name</span> <span class="string">&quot;LongPathsEnabled&quot;</span> <span class="literal">-Value</span> <span class="number">1</span> <span class="literal">-PropertyType</span> DWORD <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式22 -- 解释器模式</title>
      <link href="/2025/09/26/50-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F22-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/50-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F22-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>解释器模式是一种<strong>行为型设计模式</strong>，其核心思想是定义一种语言的 “语法规则”，并构建一个 “解释器” 来解释这种语言中的 “句子”（即符合语法规则的表达式）。该模式通过将复杂的语法拆解为多个简单的 “语法单元”（终结符 &#x2F; 非终结符），用对象表示每个语法单元的解释逻辑，最终递归或迭代地解析整个表达式。</p></blockquote><p>解释器模式的本质是 <strong>“用对象表示语法，用解释器执行语法”</strong>，适用于需要处理自定义语言、表达式解析或规则验证的场景（如数学表达式计算、配置文件语法解析、正则表达式引擎等）。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926111415670.png" alt="image.png"><br>下面我将用 Java 代码实现解释器模式，以简单整数运算表达式解析为例，支持变量、数字以及加法和乘法运算。</p><ol><li><p><strong>AbstractExpression（抽象表达式）</strong>：</p><ul><li>定义了所有表达式的统一接口，声明了 interpret () 方法</li><li>是所有终结符和非终结符表达式的父类</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractExpression</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>终结符表达式</strong>：</p><ul><li>NumberExpression：处理数字常量，解释时直接返回其值</li><li>VariableExpression：处理变量，解释时从上下文获取变量值</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数字表达式（终结符）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NumberExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> number;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumberExpression</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="comment">// 数字直接返回其值，不依赖上下文</span></span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量表达式（终结符）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VariableExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String variableName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VariableExpression</span><span class="params">(String variableName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.variableName = variableName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="comment">// 从上下文中获取变量值</span></span><br><span class="line">        <span class="keyword">return</span> context.getVariable(variableName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>非终结符表达式</strong>：</p><ul><li>AddExpression：处理加法运算，包含左右两个子表达式</li><li>MultiplyExpression：处理乘法运算，包含左右两个子表达式</li><li>非终结符表达式通过递归调用子表达式的 interpret () 方法实现计算</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加法表达式（非终结符）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression leftExpr;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression rightExpr;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddExpression</span><span class="params">(AbstractExpression leftExpr, AbstractExpression rightExpr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftExpr = leftExpr;</span><br><span class="line">        <span class="built_in">this</span>.rightExpr = rightExpr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="comment">// 先解释左表达式，再解释右表达式，最后相加</span></span><br><span class="line">        <span class="keyword">return</span> leftExpr.interpret(context) + rightExpr.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 乘法表达式（非终结符）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplyExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression leftExpr;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression rightExpr;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiplyExpression</span><span class="params">(AbstractExpression leftExpr, AbstractExpression rightExpr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftExpr = leftExpr;</span><br><span class="line">        <span class="built_in">this</span>.rightExpr = rightExpr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="comment">// 先解释左表达式，再解释右表达式，最后相乘</span></span><br><span class="line">        <span class="keyword">return</span> leftExpr.interpret(context) * rightExpr.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>Context（上下文）</strong>：</p><ul><li>存储变量名和对应的值，供变量表达式查询使用</li><li>提供 putVariable () 和 getVariable () 方法管理变量</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上下文类</span></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="comment">// 存储变量名到值的映射</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; variableMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置变量值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putVariable</span><span class="params">(String varName, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        variableMap.put(varName, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取变量值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVariable</span><span class="params">(String varName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> variableMap.getOrDefault(varName, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>Client（客户端）</strong>：</p><ul><li>负责构建抽象语法树（AST），将表达式拆分为各个表达式节点</li><li>设置上下文变量值并触发解释过程</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建上下文并设置变量值</span></span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        context.putVariable(<span class="string">&quot;a&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        context.putVariable(<span class="string">&quot;b&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建语法树：解析表达式 a + 2 * b</span></span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">expression</span> <span class="operator">=</span> buildExpression();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解释表达式并输出结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> expression.interpret(context);</span><br><span class="line">        System.out.println(<span class="string">&quot;表达式 a + 2 * b 的计算结果: &quot;</span> + result);  <span class="comment">// 预期结果: 3 + 2*4 = 11</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构建表达式的抽象语法树</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AbstractExpression <span class="title function_">buildExpression</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 构建变量a</span></span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">varA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VariableExpression</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建数字2</span></span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建变量b</span></span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">varB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VariableExpression</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建 2 * b 表达式</span></span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">multiplyExpr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplyExpression</span>(num2, varB);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建 a + (2 * b) 表达式</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AddExpression</span>(varA, multiplyExpr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述代码的执行流程如下：</p><ol><li>客户端创建上下文对象并设置变量值</li><li>客户端构建抽象语法树，将复杂表达式分解为多个简单表达式的组合</li><li>调用根表达式的 interpret () 方法开始解释过程</li><li>解释过程通过递归方式进行：<ul><li>非终结符表达式先解释其包含的子表达式</li><li>再根据自身语义（加法或乘法）处理子表达式的结果</li></ul></li><li>最终返回整个表达式的解释结果</li></ol><p>这种设计模式的优势在于：</p><ul><li>可以轻松扩展新的语法规则（如添加减法、除法）</li><li>每个表达式的解释逻辑被封装在独立的类中，职责明确</li><li>适合处理简单的自定义语言或表达式解析场景</li><li>语法树的结构清晰地反映了表达式的语法结构</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式21 -- 命令模式</title>
      <link href="/2025/09/26/49-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F21-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/49-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F21-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>命令模式是一种<strong>行为型设计模式</strong>，其核心思想是将 “请求” 封装成一个独立的 “命令对象”，该对象包含执行请求所需的所有信息（如请求的接收者、执行参数等），从而实现 “请求的发送者” 与 “请求的接收者” 解耦 —— 发送者无需知道接收者的具体实现，只需调用命令对象的执行方法即可。</p><p>该模式的本质是  <strong>“封装请求为对象”</strong> ，通过命令对象作为中间载体，支持请求的存储、排队、撤销（Undo）、重做（Redo）等高级功能，同时让发送者和接收者完全独立。</p><p>UML结构如下</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926110435445.png" alt="image.png"></p><p>命令模式的典型应用场景如下：</p><ol><li><p><strong>需要解耦请求发送者与接收者</strong>：</p><ul><li>GUI 界面操作：如按钮（调用者）、菜单（调用者）触发 “打开窗口”“保存文件”（命令），窗口 &#x2F; 文件处理器（接收者）执行实际操作，按钮无需知道窗口如何打开。</li><li>遥控器控制：如电视遥控器（调用者）的 “开机”“换台” 按钮（命令），电视（接收者）执行对应操作，遥控器无需知道电视的内部电路逻辑。</li></ul></li><li><p><strong>需要支持命令的撤销 &#x2F; 重做</strong>：</p><ul><li>文本编辑器：如 “输入文字”“删除文字” 命令，可通过 <code>undo()</code> 撤销上一步操作，通过 <code>redo()</code> 重做已撤销的操作。</li><li>绘图软件：如 “画直线”“画圆形” 命令，支持撤销最近绘制的图形。</li></ul></li><li><p><strong>需要批量处理或排队执行命令</strong>：</p><ul><li>任务调度系统：如定时任务（命令）被加入任务队列（调用者维护的命令列表），到时间后批量执行所有任务。</li><li>数据库事务：如一组 SQL 操作（命令）被封装成事务，要么全部执行（<code>execute()</code>），要么全部回滚（<code>undo()</code>）。</li></ul></li></ol><p>下面我将用 Java 代码实现命令模式，以文件操作（打开和关闭文件）为例，展示命令模式的具体应用。</p><ol><li><p><strong>Command（抽象命令接口）</strong>：</p><ul><li>定义了命令的统一接口，包含执行命令的<code>execute()</code>方法和撤销命令的<code>undo()</code>方法</li><li>是所有具体命令的抽象父类</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象命令接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销命令</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>具体命令类（OpenFileCommand 和 CloseFileCommand）</strong>：</p><ul><li>实现了 Command 接口，持有对命令接收者（FileReceiver）的引用</li><li>在<code>execute()</code>方法中调用接收者的相应方法来完成实际操作</li><li>在<code>undo()</code>方法中调用接收者的撤销方法来恢复到操作前的状态</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体命令：打开文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenFileCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="comment">// 持有命令接收者引用</span></span><br><span class="line">    <span class="keyword">private</span> FileReceiver fileReceiver;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器注入接收者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OpenFileCommand</span><span class="params">(FileReceiver fileReceiver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileReceiver = fileReceiver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行命令：调用接收者的打开文件方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        fileReceiver.openFile();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销命令：调用接收者的撤销打开方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        fileReceiver.undoOpenFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体命令：关闭文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CloseFileCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="comment">// 持有命令接收者引用</span></span><br><span class="line">    <span class="keyword">private</span> FileReceiver fileReceiver;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器注入接收者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CloseFileCommand</span><span class="params">(FileReceiver fileReceiver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileReceiver = fileReceiver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行命令：调用接收者的关闭文件方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        fileReceiver.closeFile();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销命令：调用接收者的撤销关闭方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        fileReceiver.undoCloseFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>FileReceiver（命令接收者）</strong>：</p><ul><li>是实际执行命令的对象，包含打开文件、关闭文件及对应的撤销方法</li><li>维护文件的状态（是否打开），用于支持撤销操作</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令接收者：文件处理器（实际执行文件操作）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="comment">// 记录文件当前状态，用于撤销操作</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isOpen;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileReceiver</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">        <span class="built_in">this</span>.isOpen = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实际业务方法：打开文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isOpen) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;打开文件：&quot;</span> + fileName);</span><br><span class="line">            isOpen = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件 &quot;</span> + fileName + <span class="string">&quot; 已经处于打开状态&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实际业务方法：关闭文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;关闭文件：&quot;</span> + fileName);</span><br><span class="line">            isOpen = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件 &quot;</span> + fileName + <span class="string">&quot; 已经处于关闭状态&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销打开：对应关闭文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoOpenFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;撤销打开文件：&quot;</span> + fileName);</span><br><span class="line">            closeFile();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销关闭：对应打开文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoCloseFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isOpen) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;撤销关闭文件：&quot;</span> + fileName);</span><br><span class="line">            openFile();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>ButtonInvoker（命令调用者）</strong>：</p><ul><li>持有命令对象的引用，提供<code>setCommand()</code>方法设置要执行的命令</li><li>通过<code>click()</code>方法触发命令的执行，通过<code>clickUndo()</code>方法触发命令的撤销</li><li>不直接与接收者交互，完全依赖命令对象完成操作</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令调用者：操作按钮（触发命令执行）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ButtonInvoker</span> &#123;</span><br><span class="line">    <span class="comment">// 持有当前命令引用</span></span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置要执行的命令</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 触发命令：点击按钮时执行命令</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">click</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>) &#123;</span><br><span class="line">            command.execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 触发撤销：点击撤销按钮时执行undo</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clickUndo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>) &#123;</span><br><span class="line">            command.undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><strong>Client（客户端）</strong>：</p><ul><li>负责创建接收者、具体命令和调用者对象</li><li>将接收者注入具体命令，将具体命令注入调用者，完成命令模式的组装</li><li>触发命令的执行和撤销，测试整个模式的工作流程</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：测试命令模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建命令接收者：文件处理器</span></span><br><span class="line">        <span class="type">FileReceiver</span> <span class="variable">fileReceiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReceiver</span>(<span class="string">&quot;example.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 创建具体命令，并绑定接收者</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">openCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenFileCommand</span>(fileReceiver);</span><br><span class="line">        <span class="type">Command</span> <span class="variable">closeCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CloseFileCommand</span>(fileReceiver);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 创建命令调用者：按钮</span></span><br><span class="line">        <span class="type">ButtonInvoker</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ButtonInvoker</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 测试打开文件命令</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=== 测试打开文件 ===&quot;</span>);</span><br><span class="line">        button.setCommand(openCommand);</span><br><span class="line">        button.click();      <span class="comment">// 执行打开命令</span></span><br><span class="line">        button.clickUndo();  <span class="comment">// 撤销打开命令</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 测试关闭文件命令</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 测试关闭文件 ===&quot;</span>);</span><br><span class="line">        button.setCommand(closeCommand);</span><br><span class="line">        button.click();      <span class="comment">// 先打开文件（通过撤销关闭实现）</span></span><br><span class="line">        button.click();      <span class="comment">// 执行关闭命令</span></span><br><span class="line">        button.clickUndo();  <span class="comment">// 撤销关闭命令</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述代码执行流程如下：</p><ol><li>客户端创建接收者对象，它知道如何执行具体的业务操作</li><li>客户端创建具体命令对象，并将接收者对象注入到命令中</li><li>客户端将具体命令对象设置到调用者中</li><li>当调用者触发命令（如按钮被点击）时，调用者调用命令的<code>execute()</code>方法</li><li>命令的<code>execute()</code>方法调用接收者的相应方法，完成实际操作</li><li>若需要撤销操作，调用者调用命令的<code>undo()</code>方法，命令会调用接收者的撤销方法</li></ol><p>这种设计模式的优势在于：</p><ul><li>实现了请求发送者（调用者）和接收者之间的解耦</li><li>支持命令的撤销和重做操作</li><li>可以很容易地添加新的命令，符合开闭原则</li><li>便于实现命令的排队执行、日志记录等高级功能</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式20 -- 访问者模式</title>
      <link href="/2025/09/26/48-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F20-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/48-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F20-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>访问者模式是一种<strong>行为型设计模式</strong>，其核心思想是：将 “数据结构” 与 “数据操作” 解耦，定义一个 “访问者” 对象，封装对数据结构中元素的操作逻辑；数据结构中的元素提供 “接受访问者” 的接口，允许访问者在不修改元素类的前提下，灵活扩展对元素的操作。</p><p>该模式的本质是 <strong>“分离算法与数据结构”</strong>—— 当需要对同一批元素执行多种不同操作（如统计、打印、过滤）时，无需在元素类中添加大量操作方法，只需新增对应的访问者类，符合 “开闭原则”。</p><p>访问者模式的UML如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926105553901.png" alt="image.png"></p><p>访问者模式的典型应用场景是：</p><ol><li><strong>数据结构稳定，但操作频繁变化</strong>：<ul><li>库存系统：商品类型（电子产品、服装）稳定，但需频繁新增操作（统计库存、打印价格、计算折扣）；</li><li>文档解析：文档元素（标题、段落、图片）稳定，但需新增操作（字数统计、格式检查、内容导出）。</li></ul></li><li><strong>需要对同一批元素执行多种不相关操作</strong>：<ul><li>报表系统：对 “订单”“用户”“商品” 元素，需同时执行 “数据统计”“报表生成”“异常检测” 三种操作，每种操作对应一个访问者。</li></ul></li><li><strong>操作需要累计状态</strong>：<ul><li>财务系统：遍历 “收入”“支出” 元素，通过访问者累计总利润、统计各类支出占比。</li></ul></li></ol><p>下面将用Java代码实现访问者模式，以<strong>商品库存系统</strong>为场景：定义“电子产品”和“服装”两种商品元素，通过“库存统计访问者”（统计总数量、总价值）和“价格打印访问者”（打印商品详情）实现不同操作，最终通过“库存管理类”（对象结构）统一管理商品并触发访问者操作。</p><h3 id="1-抽象访问者（Visitor）"><a href="#1-抽象访问者（Visitor）" class="headerlink" title="1. 抽象访问者（Visitor）"></a>1. 抽象访问者（Visitor）</h3><p>定义访问所有商品元素的接口，为每种具体商品声明对应的访问方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象访问者：定义访问商品的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="comment">// 访问电子产品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">visitElectronic</span><span class="params">(Electronic electronic)</span>;</span><br><span class="line">    <span class="comment">// 访问服装</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">visitClothing</span><span class="params">(Clothing clothing)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-具体访问者（Concrete-Visitor）"><a href="#2-具体访问者（Concrete-Visitor）" class="headerlink" title="2. 具体访问者（Concrete Visitor）"></a>2. 具体访问者（Concrete Visitor）</h3><p>实现抽象访问者接口，封装对商品的具体操作逻辑：</p><h4 id="（1）库存统计访问者（StockCountVisitor）"><a href="#（1）库存统计访问者（StockCountVisitor）" class="headerlink" title="（1）库存统计访问者（StockCountVisitor）"></a>（1）库存统计访问者（StockCountVisitor）</h4><p>统计所有商品的总数量和总价值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体访问者1：库存统计（统计总数量、总价值）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StockCountVisitor</span> <span class="keyword">extends</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">totalQuantity</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 总数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">totalValue</span> <span class="operator">=</span> <span class="number">0.0</span>; <span class="comment">// 总价值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计电子产品</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitElectronic</span><span class="params">(Electronic electronic)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">quantity</span> <span class="operator">=</span> electronic.getQuantity();</span><br><span class="line">        <span class="type">double</span> <span class="variable">value</span> <span class="operator">=</span> electronic.getPrice() * quantity;</span><br><span class="line">        totalQuantity += quantity;</span><br><span class="line">        totalValue += value;</span><br><span class="line">        System.out.println(<span class="string">&quot;[统计] 电子产品《&quot;</span> + electronic.getName() + <span class="string">&quot;》：&quot;</span> + quantity + <span class="string">&quot;件，价值&quot;</span> + value + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计服装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitClothing</span><span class="params">(Clothing clothing)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">quantity</span> <span class="operator">=</span> clothing.getQuantity();</span><br><span class="line">        <span class="type">double</span> <span class="variable">value</span> <span class="operator">=</span> clothing.getPrice() * quantity;</span><br><span class="line">        totalQuantity += quantity;</span><br><span class="line">        totalValue += value;</span><br><span class="line">        System.out.println(<span class="string">&quot;[统计] 服装《&quot;</span> + clothing.getName() + <span class="string">&quot;》：&quot;</span> + quantity + <span class="string">&quot;件，价值&quot;</span> + value + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取统计结果</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showTotal</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=== 库存统计结果 ===&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;总商品数量：&quot;</span> + totalQuantity + <span class="string">&quot;件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;总商品价值：&quot;</span> + totalValue + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="（2）价格打印访问者（PricePrintVisitor）"><a href="#（2）价格打印访问者（PricePrintVisitor）" class="headerlink" title="（2）价格打印访问者（PricePrintVisitor）"></a>（2）价格打印访问者（PricePrintVisitor）</h4><p>打印所有商品的名称和单价：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体访问者2：价格打印（打印商品名称和单价）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PricePrintVisitor</span> <span class="keyword">extends</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="comment">// 打印电子产品价格</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitElectronic</span><span class="params">(Electronic electronic)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[价格] 电子产品《&quot;</span> + electronic.getName() + <span class="string">&quot;》：单价&quot;</span> + electronic.getPrice() + <span class="string">&quot;元/件&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印服装价格</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitClothing</span><span class="params">(Clothing clothing)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[价格] 服装《&quot;</span> + clothing.getName() + <span class="string">&quot;》：单价&quot;</span> + clothing.getPrice() + <span class="string">&quot;元/件&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-抽象元素（Element）"><a href="#3-抽象元素（Element）" class="headerlink" title="3. 抽象元素（Element）"></a>3. 抽象元素（Element）</h3><p>定义商品接受访问者的接口，声明<code>accept</code>方法（核心：让元素主动接受访问者）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象元素：定义商品接受访问者的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Element</span> &#123;</span><br><span class="line">    <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="comment">// 商品单价</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="comment">// 商品数量</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> quantity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Element</span><span class="params">(String name, <span class="type">double</span> price, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">        <span class="built_in">this</span>.quantity = quantity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 核心方法：接受访问者（让访问者访问自己）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter方法（供访问者获取商品属性）</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getQuantity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> quantity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-具体元素（Concrete-Element）"><a href="#4-具体元素（Concrete-Element）" class="headerlink" title="4. 具体元素（Concrete Element）"></a>4. 具体元素（Concrete Element）</h3><p>实现抽象元素接口，在<code>accept</code>方法中显式调用访问者对应的访问方法：</p><h4 id="（1）电子产品（Electronic）"><a href="#（1）电子产品（Electronic）" class="headerlink" title="（1）电子产品（Electronic）"></a>（1）电子产品（Electronic）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体元素1：电子产品</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Electronic</span> <span class="keyword">extends</span> <span class="title class_">Element</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Electronic</span><span class="params">(String name, <span class="type">double</span> price, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, price, quantity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接受访问者：调用访问者的“访问电子产品”方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visitElectronic(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="（2）服装（Clothing）"><a href="#（2）服装（Clothing）" class="headerlink" title="（2）服装（Clothing）"></a>（2）服装（Clothing）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体元素2：服装</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clothing</span> <span class="keyword">extends</span> <span class="title class_">Element</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Clothing</span><span class="params">(String name, <span class="type">double</span> price, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, price, quantity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接受访问者：调用访问者的“访问服装”方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visitClothing(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-对象结构（Object-Structure）"><a href="#5-对象结构（Object-Structure）" class="headerlink" title="5. 对象结构（Object Structure）"></a>5. 对象结构（Object Structure）</h3><p>维护商品集合，提供遍历商品的接口，供访问者批量访问所有元素：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象结构：库存管理（维护商品集合，触发访问者操作）</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Inventory</span> &#123;</span><br><span class="line">    <span class="comment">// 存储所有商品元素</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Element&gt; elements = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加商品到库存</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addElement</span><span class="params">(Element element)</span> &#123;</span><br><span class="line">        elements.add(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接受访问者：遍历所有商品，让每个商品接受访问者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">acceptVisitor</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">            element.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-客户端（Client）"><a href="#6-客户端（Client）" class="headerlink" title="6. 客户端（Client）"></a>6. 客户端（Client）</h3><p>创建库存、商品和访问者，触发访问操作，验证访问者模式的工作流程：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：测试访问者模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建对象结构（库存）</span></span><br><span class="line">        <span class="type">Inventory</span> <span class="variable">inventory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventory</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 添加具体元素（商品）</span></span><br><span class="line">        inventory.addElement(<span class="keyword">new</span> <span class="title class_">Electronic</span>(<span class="string">&quot;智能手机&quot;</span>, <span class="number">3999.0</span>, <span class="number">50</span>));</span><br><span class="line">        inventory.addElement(<span class="keyword">new</span> <span class="title class_">Electronic</span>(<span class="string">&quot;笔记本电脑&quot;</span>, <span class="number">5999.0</span>, <span class="number">30</span>));</span><br><span class="line">        inventory.addElement(<span class="keyword">new</span> <span class="title class_">Clothing</span>(<span class="string">&quot;纯棉衬衫&quot;</span>, <span class="number">199.0</span>, <span class="number">100</span>));</span><br><span class="line">        inventory.addElement(<span class="keyword">new</span> <span class="title class_">Clothing</span>(<span class="string">&quot;休闲裤子&quot;</span>, <span class="number">249.0</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 创建具体访问者1：库存统计</span></span><br><span class="line">        System.out.println(<span class="string">&quot;===== 执行库存统计操作 =====&quot;</span>);</span><br><span class="line">        <span class="type">StockCountVisitor</span> <span class="variable">countVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StockCountVisitor</span>();</span><br><span class="line">        inventory.acceptVisitor(countVisitor);</span><br><span class="line">        countVisitor.showTotal(); <span class="comment">// 显示统计结果</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 创建具体访问者2：价格打印</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n===== 执行价格打印操作 =====&quot;</span>);</span><br><span class="line">        <span class="type">PricePrintVisitor</span> <span class="variable">printVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PricePrintVisitor</span>();</span><br><span class="line">        inventory.acceptVisitor(printVisitor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码运行结果"><a href="#代码运行结果" class="headerlink" title="代码运行结果"></a>代码运行结果</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">===== 执行库存统计操作 =====</span><br><span class="line">[统计] 电子产品《智能手机》：50件，价值199950.0元</span><br><span class="line">[统计] 电子产品《笔记本电脑》：30件，价值179970.0元</span><br><span class="line">[统计] 服装《纯棉衬衫》：100件，价值19900.0元</span><br><span class="line">[统计] 服装《休闲裤子》：80件，价值19920.0元</span><br><span class="line">=== 库存统计结果 ===</span><br><span class="line">总商品数量：260件</span><br><span class="line">总商品价值：419740.0元</span><br><span class="line"></span><br><span class="line">===== 执行价格打印操作 =====</span><br><span class="line">[价格] 电子产品《智能手机》：单价3999.0元/件</span><br><span class="line">[价格] 电子产品《笔记本电脑》：单价5999.0元/件</span><br><span class="line">[价格] 服装《纯棉衬衫》：单价199.0元/件</span><br><span class="line">[价格] 服装《休闲裤子》：单价249.0元/件</span><br></pre></td></tr></table></figure><h3 id="访问者模式核心逻辑解析"><a href="#访问者模式核心逻辑解析" class="headerlink" title="访问者模式核心逻辑解析"></a>访问者模式核心逻辑解析</h3><ol><li><strong>解耦操作与结构</strong>：商品元素（<code>Electronic</code>&#x2F;<code>Clothing</code>）仅维护自身属性，统计、打印等操作封装在访问者中，新增操作（如“折扣计算”）只需新增<code>DiscountVisitor</code>，无需修改商品类。</li><li><strong>双重分派机制</strong>：通过“元素的<code>accept</code>方法 + 访问者的<code>visit</code>方法”实现——先根据元素类型调用对应<code>accept</code>，再根据访问者类型调用对应<code>visit</code>，确保操作与元素精准匹配。</li><li><strong>对象结构统一调度</strong>：<code>Inventory</code>作为对象结构，批量管理商品并触发访问者，客户端只需与<code>Inventory</code>和访问者交互，无需关注单个商品的遍历逻辑。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式19 -- 状态模式</title>
      <link href="/2025/09/26/47-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F19-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/47-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F19-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>状态模式是一种<strong>行为型设计模式</strong>，其核心思想是：当一个对象的<strong>内部状态改变时，它的行为也会随之改变，就像对象的 “类” 发生了变化一样</strong>。该模式通过将对象不同状态对应的行为封装到独立的 “状态类” 中，让对象在不同状态下切换时，只需切换对应的状态对象，而非通过大量<code>if-else</code>或<code>switch</code>判断状态。</p><p>状态模式的本质是 <strong>“将状态与行为绑定，并用状态对象管理状态切换”</strong> —— 对象本身不直接维护状态和实现状态对应的行为，而是委托给当前的 “状态对象”，从而简化状态管理逻辑，提高代码可维护性和扩展性。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926104144420.png" alt="image.png"></p><p>状态模式的典型应用场景如下：</p><ol><li><strong>对象状态较多且状态切换频繁</strong>：<ul><li>订单系统：待支付→已支付→已发货→已完成→已取消（多状态流转）；</li><li>电梯系统：停止→上升→下降→开门→关门（不同状态下行为不同，如 “上升中” 不可开门）。</li></ul></li><li><strong>对象行为随状态变化而变化</strong>：<ul><li>播放器：播放中（可暂停 &#x2F; 停止）→暂停中（可播放 &#x2F; 停止）→停止中（可播放）；</li><li>网络连接：连接中（可发送数据 &#x2F; 断开）→断开中（可重连）→重连中（可取消重连）。</li></ul></li><li><strong>避免大量条件判断</strong>：<ul><li>传统代码：<code>if (state == 待支付) &#123; 执行支付逻辑 &#125; else if (state == 已支付) &#123; 执行发货逻辑 &#125;</code>；</li><li>状态模式：将每个 <code>if</code> 分支的逻辑封装到独立状态类，环境类直接委托给当前状态。</li></ul></li></ol><p>下面我将用 Java 代码实现状态模式，以订单状态流转为例，展示不同状态下订单行为的变化。</p><p>首先，我们根据业务场景将状态分为支付、运输和确认收货三个状态，然后把他们封装到一个状态类中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="comment">// 支付行为</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(Order order)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发货行为</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">(Order order)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确认收货行为</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后，我们定义具体的状态类，他们都继承这个State抽象类，但是只能执行自己的状态操作。定义如下：</p><ul><li>PendingPaymentState（待支付状态）：只能执行支付操作，支付后切换到已支付状态</li><li>PaidState（已支付状态）：只能执行发货操作，发货后切换到已发货状态</li><li>ShippedState（已发货状态）：只能执行确认收货操作，确认后切换到已完成状态</li><li>CompletedState（已完成状态）：不能执行任何操作</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体状态类：待支付状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PendingPaymentState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 支付成功&quot;</span>);</span><br><span class="line">        <span class="comment">// 支付后切换到已支付状态</span></span><br><span class="line">        order.setState(<span class="keyword">new</span> <span class="title class_">PaidState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 尚未支付，不能发货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 尚未支付，不能确认收货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体状态类：已支付状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaidState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已经支付，不能重复支付&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已发货&quot;</span>);</span><br><span class="line">        <span class="comment">// 发货后切换到已发货状态</span></span><br><span class="line">        order.setState(<span class="keyword">new</span> <span class="title class_">ShippedState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 尚未发货，不能确认收货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体状态类：已发货状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShippedState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已经支付并发货，不能再次支付&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已经发货，不能重复发货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已确认收货&quot;</span>);</span><br><span class="line">        <span class="comment">// 确认收货后切换到已完成状态</span></span><br><span class="line">        order.setState(<span class="keyword">new</span> <span class="title class_">CompletedState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体状态类：已完成状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletedState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已完成，无需支付&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已完成，无需发货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;错误：订单 &quot;</span> + order.getOrderId() + <span class="string">&quot; 已完成，不能重复确认收货&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>定义好这些状态后，我们的订单对象中就可以维护这个订单的当前状态、提供状态切换的方法，但具体的状态切换后执行的动作，延迟到具体的状态类中执行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 环境类：订单类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> State currentState;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String orderId;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Order</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">        <span class="comment">// 初始状态为待支付</span></span><br><span class="line">        <span class="built_in">this</span>.currentState = <span class="keyword">new</span> <span class="title class_">PendingPaymentState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentState = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 支付行为，委托给当前状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123;</span><br><span class="line">        currentState.pay(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发货行为，委托给当前状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ship</span><span class="params">()</span> &#123;</span><br><span class="line">        currentState.ship(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确认收货行为，委托给当前状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmReceipt</span><span class="params">()</span> &#123;</span><br><span class="line">        currentState.confirmReceipt(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后，我们看客户端调用代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建订单（初始状态为待支付）</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="string">&quot;ORD-123456&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行一系列操作，观察状态变化</span></span><br><span class="line">        order.pay();         <span class="comment">// 支付 -&gt; 状态变为已支付</span></span><br><span class="line">        order.ship();        <span class="comment">// 发货 -&gt; 状态变为已发货</span></span><br><span class="line">        order.confirmReceipt(); <span class="comment">// 确认收货 -&gt; 状态变为已完成</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试在已完成状态执行操作</span></span><br><span class="line">        order.pay();         <span class="comment">// 应该提示错误</span></span><br><span class="line">        order.ship();        <span class="comment">// 应该提示错误</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面的代码中：</p><ol><li>订单创建时初始化状态为待支付状态</li><li>当调用订单的某个行为方法（如 pay ()）时：<ul><li>订单将请求委托给当前状态对象</li><li>状态对象执行该状态下的具体逻辑</li><li>如果操作有效，状态对象会通过订单的 setState () 方法切换到新状态</li></ul></li><li>状态切换后，订单的后续行为将由新的状态对象处理</li></ol><p>这种设计模式的优势在于：</p><ul><li>避免了大量的 if-else 条件判断，代码结构更清晰</li><li>每个状态的行为被封装在独立的类中，职责单一</li><li>新增状态只需添加新的状态类，符合开闭原则</li><li>状态切换逻辑集中在状态类中，便于维护和扩展</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式18 -- 观察者模式</title>
      <link href="/2025/09/26/46-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F18-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/46-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F18-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>观察者模式是一种<strong>行为型设计模式</strong>，其核心思想是定义 “一对多” 的依赖关系：当一个对象（称为 “主题 &#x2F; 被观察者”）的状态发生变化时，所有依赖于它的对象（称为 “观察者”）会自动收到通知并进行更新。</p></blockquote><p>该模式的本质是 <strong>“解耦主题与观察者”</strong> —— 主题无需知道具体有哪些观察者，只需维护一个观察者列表；观察者也无需了解主题的内部逻辑，只需在收到通知时执行自身的更新逻辑，符合 “开闭原则”。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926102907101.png" alt="image.png"></p><p>下面我将用 Java 代码实现观察者模式，以气象站系统为例，展示当气象数据变化时，多个显示器如何自动更新显示内容。</p><p>首先，我们要定义一个抽象主题接口，它的作用是注册、移除和通知观察者。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="comment">// 注册观察者</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移除观察者</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通知所有观察者</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>具体的主题，也就是被观察者要实现Subject接口。它会维护气象数据和观察者列表。当数据更新时，会通知所有的注册者。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题：气象数据中心</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherData</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> temperature; <span class="comment">// 温度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> humidity;    <span class="comment">// 湿度</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers; <span class="comment">// 观察者列表</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeatherData</span><span class="params">()</span> &#123;</span><br><span class="line">        observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 通知所有观察者</span></span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新气象数据并通知观察者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWeatherData</span><span class="params">(<span class="type">double</span> temperature, <span class="type">double</span> humidity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="comment">// 数据更新后通知所有观察者</span></span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供getter方法，供观察者获取最新数据（拉模式）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTemperature</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> temperature;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getHumidity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> humidity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还需要定义观察者的抽象接口，所有的具体观察者都要继承它，这个接口定义了更新丰富，也就是当被观察者对象发送变化时通过这个来通知观察者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象观察者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="comment">// 当主题状态变化时，调用此方法更新</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>有了接口抽象，接下来定义具体的观察者，这里我们定义了温度和湿度的观察者，当气候发送变化时他们会收到通知并获取气候数据来显示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体观察者：湿度显示器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HumidityDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> WeatherData weatherData; <span class="comment">// 持有主题引用，用于获取数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器：注册到主题</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HumidityDisplay</span><span class="params">(WeatherData weatherData)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 从主题拉取最新湿度数据</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">humidity</span> <span class="operator">=</span> weatherData.getHumidity();</span><br><span class="line">        display(humidity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示湿度信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">double</span> humidity)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;湿度显示器: 当前湿度为 &quot;</span> + humidity + <span class="string">&quot; %&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体观察者：温度显示器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemperatureDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> WeatherData weatherData; <span class="comment">// 持有主题引用，用于获取数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器：注册到主题</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TemperatureDisplay</span><span class="params">(WeatherData weatherData)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 从主题拉取最新温度数据</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">temperature</span> <span class="operator">=</span> weatherData.getTemperature();</span><br><span class="line">        display(temperature);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示温度信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">double</span> temperature)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;温度显示器: 当前温度为 &quot;</span> + temperature + <span class="string">&quot; °C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后通过客户端代码来演示它</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建主题（被观察者）：气象数据中心</span></span><br><span class="line">        <span class="type">WeatherData</span> <span class="variable">weatherData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherData</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建观察者：温度显示器和湿度显示器</span></span><br><span class="line">        <span class="comment">// 观察者在创建时会自动注册到主题</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TemperatureDisplay</span>(weatherData);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HumidityDisplay</span>(weatherData);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟气象数据更新</span></span><br><span class="line">        System.out.println(<span class="string">&quot;--- 第一次更新气象数据 ---&quot;</span>);</span><br><span class="line">        weatherData.setWeatherData(<span class="number">25.5</span>, <span class="number">60.0</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- 第二次更新气象数据 ---&quot;</span>);</span><br><span class="line">        weatherData.setWeatherData(<span class="number">26.3</span>, <span class="number">58.5</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- 第三次更新气象数据 ---&quot;</span>);</span><br><span class="line">        weatherData.setWeatherData(<span class="number">24.8</span>, <span class="number">62.3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>从上面的代码可以看出：</p><ol><li>客户端创建具体主题（WeatherData）实例</li><li>创建具体观察者（TemperatureDisplay、HumidityDisplay）时，观察者会自动注册到主题</li><li>当主题的状态（气象数据）发生变化时：<ul><li>调用主题的 setWeatherData () 方法更新数据</li><li>主题内部调用 notifyObservers () 方法通知所有观察者</li><li>每个观察者的 update () 方法被调用</li><li>观察者从主题拉取最新数据并更新显示</li></ul></li></ol><p>这种设计模式的优势在于：</p><ul><li>主题和观察者之间实现了解耦，彼此不需要知道对方的具体实现</li><li>可以方便地添加新的观察者，无需修改主题代码</li><li>当主题状态变化时，所有相关观察者会自动收到通知并更新</li><li>符合开闭原则，系统扩展性好</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式17 -- 中介者模式</title>
      <link href="/2025/09/26/45-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F17-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/45-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F17-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>中介者模式是一种<strong>行为型设计模式</strong>，其核心思想是通过一个 “中介者” 对象，封装多个对象（称为 “同事对象”）之间的交互关系，使同事对象无需直接相互引用，仅通过中介者传递信息，从而降低对象间的耦合度，简化系统结构。</p></blockquote><p>该模式的本质是 <strong>“集中控制交互”</strong> —— 将原本分散在多个同事对象之间的复杂交互逻辑，转移到中介者中统一管理，让同事对象专注于自身的核心功能，而非与其他对象的通信细节。</p><p>中介者模式的UML如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926101608207.png" alt="image.png"></p><p>中介者模式的典型应用场景如下：</p><ol><li><strong>对象间存在复杂交互</strong>：<ul><li>聊天室 &#x2F; 群聊系统：用户（同事）发送消息时，无需直接发给每个成员，通过聊天室（中介者）统一转发；</li><li>图形界面（GUI）组件交互：如 “按钮点击后触发文本框清空、列表刷新”，通过窗口（中介者）协调按钮、文本框、列表的交互。</li></ul></li><li><strong>系统存在 “多对多” 依赖</strong>：<ul><li>订单处理系统：订单（同事）、库存（同事）、支付（同事）、物流（同事）的交互，通过 “订单中介者” 协调（如支付成功后，中介者通知库存扣减、物流创建）；</li><li>智能家居系统：灯光（同事）、空调（同事）、窗帘（同事）通过 “中控系统（中介者）” 联动（如 “离家模式” 触发所有设备关闭）。</li></ul></li><li><strong>需要集中控制交互规则</strong>：<ul><li>游戏中的 “战斗管理器”：玩家（同事）、怪物（同事）、道具（同事）的交互，通过战斗管理器（中介者）计算伤害、判定胜负。</li></ul></li></ol><p>下面我将用 Java 代码实现中介者模式，以聊天室系统为例，展示中介者如何协调多个用户之间的交互。</p><p>首先，我们定义一个抽象的中介者对象Mediator，它定义了注册同事和转发消息的接口，是中介者和同事之间交互的契约。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象中介者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="comment">// 注册同事对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Colleague colleague)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转发消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">relay</span><span class="params">(Colleague colleague, String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在我们的例子中聊天室是一个具体的中介者，它实现了聊天室的功能，维护着所有用户的列表并负责将消息转发给其他所有用户。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者：聊天室</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRoomMediator</span> <span class="keyword">extends</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="comment">// 维护所有注册的用户</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Colleague&gt; colleagues = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Colleague colleague)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果用户未注册，则添加到列表</span></span><br><span class="line">        <span class="keyword">if</span> (!colleagues.contains(colleague)) &#123;</span><br><span class="line">            colleagues.add(colleague);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">relay</span><span class="params">(Colleague colleague, String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 向除发送者外的所有用户转发消息</span></span><br><span class="line">        <span class="keyword">for</span> (Colleague c : colleagues) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!c.equals(colleague)) &#123;</span><br><span class="line">                c.receive(colleague.getName(), message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们这个例子中，消息是在不同的用户（同事）之间转发的，因此我们定义一个抽象的同事类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象同事类：用户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Mediator mediator;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法，传入中介者和用户名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Colleague</span><span class="params">(Mediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 接收消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String senderName, String message)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户名</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上面这个类中，定义了用户的基本行为，包括发送和接收消息，并持有一个中介者的引用。</p><p>在具体的用户类中，我们实现具体行为，发送消息时通过中介者转发，接收消息时显示接收到的内容。这里重要的一点是消息似乎通过中介者转发的而不是用户直接发送。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体同事类：用户实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Mediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(mediator, name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;发送消息: &quot;</span> + message);</span><br><span class="line">        <span class="comment">// 通过中介者转发消息</span></span><br><span class="line">        mediator.relay(<span class="built_in">this</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String senderName, String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;收到来自&quot;</span> + senderName + <span class="string">&quot;的消息: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后我们通过客户端代码来演示这个模式的使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建中介者：聊天室</span></span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">chatRoom</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatRoomMediator</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建同事：用户</span></span><br><span class="line">        <span class="type">Colleague</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(chatRoom, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        <span class="type">Colleague</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(chatRoom, <span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        <span class="type">Colleague</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(chatRoom, <span class="string">&quot;王五&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册用户到聊天室</span></span><br><span class="line">        chatRoom.register(user1);</span><br><span class="line">        chatRoom.register(user2);</span><br><span class="line">        chatRoom.register(user3);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发送消息测试</span></span><br><span class="line">        user1.send(<span class="string">&quot;大家好，我是张三！&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----&quot;</span>);</span><br><span class="line">        user2.send(<span class="string">&quot;欢迎张三加入聊天室！&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----&quot;</span>);</span><br><span class="line">        user3.send(<span class="string">&quot;你们好啊！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们可以看到：</p><ol><li>客户端创建中介者实例（聊天室）</li><li>创建同事对象（用户），并在构造时传入中介者引用</li><li>将所有同事注册到中介者中</li><li>当一个同事发送消息时：<ul><li>调用自身的 send () 方法</li><li>send () 方法通过中介者的 relay () 方法转发消息</li><li>中介者将消息分发给其他所有同事</li><li>其他同事通过 receive () 方法处理消息</li></ul></li></ol><p>这种设计使得用户之间无需直接相互引用，所有交互都通过中介者完成，降低了系统的耦合度，便于后续扩展新的功能。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式16 -- 责任链模式</title>
      <link href="/2025/09/26/44-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F16-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/44-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F16-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>责任链模式是一种<strong>行为型设计模式</strong>，其核心思想是将多个 “处理器”（负责处理特定请求的对象）串联成一条 “链”，当请求产生时，请求会沿着这条链依次传递，直到某个处理器能够处理该请求并返回结果，或请求到达链的末端仍未被处理（可选择默认处理或忽略）。</p></blockquote><p>该模式的本质是<strong>解耦 “请求的发送者” 和 “请求的处理者”</strong>—— 发送者无需知道哪个处理器会处理请求，只需将请求传递给链的第一个节点即可；同时，处理器也无需知道链的整体结构，只需关注自身负责的请求类型，以及无法处理时将请求传递给下一个节点。</p><p>责任链模式的UML如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926100137429.png" alt="image.png"></p><p>责任链模式通常包含以下 3 个核心角色，各角色职责明确，共同构成请求处理的链式结构：</p><table><thead><tr><th>角色名称（英文）</th><th>核心职责</th><th>典型实现</th></tr></thead><tbody><tr><td><strong>抽象处理器（Handler）</strong></td><td>定义处理请求的接口，声明一个 “下一个处理器” 的引用，提供设置下一个节点的方法</td><td>声明 <code>handleRequest(request)</code>（处理请求的核心方法）、<code>setNextHandler(handler)</code>（设置下一个处理器）</td></tr><tr><td><strong>具体处理器（Concrete Handler）</strong></td><td>实现抽象处理器接口，判断自身是否能处理当前请求：<br><br>1. 能处理则直接处理并返回结果；<br><br>2. 不能处理则调用 “下一个处理器” 的 <code>handleRequest</code> 方法传递请求</td><td>重写 <code>handleRequest</code> 方法，添加请求类型判断逻辑（如 “金额是否在自身处理范围内”“请求类型是否匹配”）</td></tr><tr><td><strong>请求者（Client）</strong></td><td>创建请求对象，将请求传递给责任链的<strong>第一个处理器</strong>，无需关注后续处理流程</td><td>实例化具体处理器并构建链式结构，调用链首处理器的 <code>handleRequest</code> 方法发送请求</td></tr></tbody></table><p>我们用一个费用审批流程为例，通过Java代码说明责任链模式。</p><p>首先定义一个责任链的结构抽象，这里是Handler抽象类，它包含一个执行nexHandler的引用和处理请求的方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象处理器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="comment">// 下一个处理器</span></span><br><span class="line">    <span class="keyword">protected</span> Handler nextHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置下一个处理器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextHandler</span><span class="params">(Handler nextHandler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextHandler = nextHandler;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理请求的抽象方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">handleRequest</span><span class="params">(Request request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后我们封装具体的请求信息，其中包括了请求金额和事由</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求类（封装审批请求信息）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">    <span class="comment">// 审批金额</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> amount;</span><br><span class="line">    <span class="comment">// 审批事由</span></span><br><span class="line">    <span class="keyword">private</span> String reason;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Request</span><span class="params">(<span class="type">double</span> amount, String reason)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">        <span class="built_in">this</span>.reason = reason;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getReason</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reason;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在我们的场景中，我们定义了三个处理审批请求的具体类</p><ul><li>TeamLeaderHandler：处理 1000 元及以下的审批</li><li>ManagerHandler：处理 1001-5000 元的审批</li><li>DirectorHandler：处理 5000 元以上的审批</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组长处理器（处理1000元以下的审批）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TeamLeaderHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果金额小于等于1000元，组长可以审批</span></span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &lt;= <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;组长审批通过：&quot;</span> + request.getReason() + <span class="string">&quot;，金额：&quot;</span> + request.getAmount() + <span class="string">&quot;元&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 否则传递给下一个处理器</span></span><br><span class="line">            <span class="keyword">if</span> (nextHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> nextHandler.handleRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;审批流程结束，无人处理该请求&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 经理处理器（处理1001-5000元的审批）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果金额在1001-5000元之间，经理可以审批</span></span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &gt; <span class="number">1000</span> &amp;&amp; request.getAmount() &lt;= <span class="number">5000</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;经理审批通过：&quot;</span> + request.getReason() + <span class="string">&quot;，金额：&quot;</span> + request.getAmount() + <span class="string">&quot;元&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 否则传递给下一个处理器</span></span><br><span class="line">            <span class="keyword">if</span> (nextHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> nextHandler.handleRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;审批流程结束，无人处理该请求&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 总监处理器（处理5001元以上的审批）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectorHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果金额大于5000元，总监可以审批</span></span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &gt; <span class="number">5000</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;总监审批通过：&quot;</span> + request.getReason() + <span class="string">&quot;，金额：&quot;</span> + request.getAmount() + <span class="string">&quot;元&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 否则传递给下一个处理器</span></span><br><span class="line">            <span class="keyword">if</span> (nextHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> nextHandler.handleRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;审批流程结束，无人处理该请求&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>客户端的调用示例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="comment">// 创建责任链</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Handler <span class="title function_">createChain</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建各个处理器</span></span><br><span class="line">        <span class="type">Handler</span> <span class="variable">teamLeader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeamLeaderHandler</span>();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerHandler</span>();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DirectorHandler</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建责任链：组长 -&gt; 经理 -&gt; 总监</span></span><br><span class="line">        teamLeader.setNextHandler(manager);</span><br><span class="line">        manager.setNextHandler(director);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 返回链头</span></span><br><span class="line">        <span class="keyword">return</span> teamLeader;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建责任链</span></span><br><span class="line">        <span class="type">Handler</span> <span class="variable">chain</span> <span class="operator">=</span> createChain();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建不同的请求</span></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="number">800</span>, <span class="string">&quot;购买办公用品&quot;</span>);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="number">3000</span>, <span class="string">&quot;团队建设活动&quot;</span>);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="number">8000</span>, <span class="string">&quot;购买新设备&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理请求</span></span><br><span class="line">        System.out.println(chain.handleRequest(request1));</span><br><span class="line">        System.out.println(chain.handleRequest(request2));</span><br><span class="line">        System.out.println(chain.handleRequest(request3));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>责任链的处理流程如下：</p><ol><li>客户端创建责任链，设置处理器之间的先后关系</li><li>客户端创建请求对象，并将其提交给责任链的第一个处理器</li><li>请求在责任链中传递：<ul><li>如果当前处理器可以处理请求，则直接处理并返回结果</li><li>如果当前处理器不能处理请求，则将请求传递给下一个处理器</li><li>直到请求被处理或到达链的末端</li></ul></li></ol><p>这种设计模式的优势在于：</p><ul><li>降低了请求发送者和接收者之间的耦合</li><li>可以灵活地增加或修改处理逻辑</li><li>符合开闭原则，便于扩展新的处理器</li><li>避免了多重条件判断的复杂代码结构</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式15 -- 迭代器模式</title>
      <link href="/2025/09/26/43-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F15-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/26/43-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F15-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>迭代器模式（Iterator Pattern）是一种行为型设计模式，它的核心是<strong>提供一种统一的方式遍历聚合对象（如集合、列表）中的元素，同时隐藏聚合对象的内部结构</strong>。通过引入 “迭代器” 角色，将 “遍历逻辑” 与 “聚合对象” 解耦，让聚合对象无需暴露内部实现即可支持遍历。</p></blockquote><p>简单来说，迭代器模式就像 “快递员取件”—— 快递员（迭代器）按固定流程（<code>hasNext()</code>判断是否有件、<code>next()</code>取件）从快递柜（聚合对象）取件，无需知道快递柜内部的分层、分区结构，只需按统一接口操作。</p><p>迭代器模式的UML如下:</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250926093543486.png"></p><p>下面我将用 Java 代码实现迭代器模式，展示其核心结构和工作原理。这个示例将创建一个简单的集合类和对应的迭代器，实现对元素的遍历。</p><ol><li><strong>Iterator 接口</strong>：定义了迭代器的基本操作，<code>hasNext()</code>用于判断是否还有下一个元素，<code>next()</code>用于获取下一个元素。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象迭代器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    Object <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>Aggregate 接口</strong>：定义了聚合对象的基本操作，包括创建迭代器的<code>createIterator()</code>方法，以及添加元素、获取大小等方法。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象聚合接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Aggregate</span> &#123;</span><br><span class="line">    Iterator <span class="title function_">createIterator</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object element)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">    Object <span class="title function_">getElement</span><span class="params">(<span class="type">int</span> index)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>ConcreteIterator 类</strong>：实现了 Iterator 接口，负责具体的遍历逻辑。它持有一个对具体聚合对象的引用，并维护当前遍历的索引位置。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ConcreteAggregate aggregate;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> currentIndex;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteIterator</span><span class="params">(ConcreteAggregate aggregate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.aggregate = aggregate;</span><br><span class="line">        <span class="built_in">this</span>.currentIndex = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentIndex &lt; aggregate.getSize();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasNext()) &#123;</span><br><span class="line">            <span class="keyword">return</span> aggregate.getElement(currentIndex++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li><strong>ConcreteAggregate 类</strong>：实现了 Aggregate 接口，是具体的聚合对象。它内部使用 ArrayList 存储元素，并实现了创建迭代器的方法。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体聚合</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteAggregate</span> <span class="keyword">implements</span> <span class="title class_">Aggregate</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; elements;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteAggregate</span><span class="params">()</span> &#123;</span><br><span class="line">        elements = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">createIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteIterator</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object element)</span> &#123;</span><br><span class="line">        elements.add(element);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> elements.size();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getElement</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> elements.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li><strong>Client 类</strong>：演示了如何使用迭代器模式。客户端只需通过聚合对象获取迭代器，然后使用迭代器进行遍历，无需了解聚合对象的内部结构。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建聚合对象并添加元素</span></span><br><span class="line">        <span class="type">Aggregate</span> <span class="variable">aggregate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteAggregate</span>();</span><br><span class="line">        aggregate.add(<span class="string">&quot;元素1&quot;</span>);</span><br><span class="line">        aggregate.add(<span class="string">&quot;元素2&quot;</span>);</span><br><span class="line">        aggregate.add(<span class="string">&quot;元素3&quot;</span>);</span><br><span class="line">        aggregate.add(<span class="string">&quot;元素4&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取迭代器并遍历</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> aggregate.createIterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">element</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;遍历元素: &quot;</span> + element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面的代码中</p><ol><li>客户端创建聚合对象并添加元素</li><li>客户端通过聚合对象的<code>createIterator()</code>方法获取迭代器</li><li>客户端使用迭代器的<code>hasNext()</code>和<code>next()</code>方法遍历聚合中的元素</li><li>迭代器负责跟踪当前遍历位置，并从聚合中获取相应元素</li></ol><p>迭代器模式的优势如下：</p><ol><li><strong>避免迭代器失效</strong>：若在遍历过程中修改聚合对象（如添加 &#x2F; 删除元素），可能导致迭代器 “失效”（如索引错乱），需在迭代器中处理（如快速失败机制，Java 的 <code>ConcurrentModificationException</code>）。</li><li><strong>简化设计</strong>：若聚合对象结构简单（如固定大小的数组），且无需多种遍历方式，可直接在聚合类中实现遍历逻辑，避免过度设计。</li><li><strong>语言原生支持</strong>：多数高级语言（Java、C#、Python）已内置迭代器模式（如 Java 的 <code>Iterator</code> 接口、Python 的 <code>__iter__</code> 和 <code>__next__</code> 方法），实际开发中优先使用原生迭代器，无需重复造轮子。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式14 -- 备忘录模式</title>
      <link href="/2025/09/25/42-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F14-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/42-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F14-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>备忘录模式（Memento Pattern）是一种行为型设计模式，它的核心作用是<strong>在不破坏对象封装性的前提下，捕获并存储对象的内部状态</strong>，以便后续需要时能将对象恢复到之前的状态。</p></blockquote><p>简单来说，备忘录模式就像 “游戏存档”—— 游戏过程中可以随时存档（存储当前状态），遇到失败时可以读档（恢复到之前的状态），且存档过程不会暴露游戏内部的复杂数据结构。</p><p>备忘录模式的UML如下</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925153051866.png" alt="image.png"><br>如上图，备忘录模式包含三个核心角色，职责严格分离：</p><ol><li><strong>发起人（Originator）</strong><ul><li>核心对象，拥有内部状态（如游戏角色的血量、装备）。</li><li>提供<code>createMemento()</code>方法：创建备忘录，将当前内部状态存入备忘录。</li><li>提供<code>restoreFromMemento()</code>方法：从备忘录中读取状态，恢复自身到之前的状态。</li><li><strong>关键</strong>：备忘录的创建和恢复逻辑由发起人控制，确保状态封装性。</li></ul></li><li><strong>备忘录（Memento）</strong><ul><li>仅负责存储发起人状态，不包含任何业务逻辑。</li><li>状态变量通常为私有，仅通过有限接口（如<code>getState()</code>）暴露，且仅允许发起人或负责人访问（通过访问权限控制，如 Java 中的包访问权限）。</li><li><strong>关键</strong>：防止外部对象随意修改或查看状态，保护发起人封装性。</li></ul></li><li><strong>负责人（Caretaker）</strong><ul><li>充当备忘录的 “仓库”，负责存储和管理多个备忘录（如按时间顺序存储多个存档）。</li><li>不关心备忘录的内容，也不参与状态的创建或恢复，仅提供 “保存” 和 “获取” 的管理能力。</li><li><strong>关键</strong>：隔离发起人（状态创建者）和备忘录（状态存储），降低耦合。</li></ul></li></ol><p>这个模式的核心价值在于：</p><ul><li><strong>保护封装性</strong>：发起人状态仅通过备忘录间接暴露，外部无法直接访问或修改。</li><li><strong>状态回溯</strong>：支持对象状态的多次存档和恢复（如多步撤销操作）。</li><li><strong>职责分离</strong>：将 “状态创建”（Originator）、“状态存储”（Memento）、“状态管理”（Caretaker）拆分，符合单一职责原则。</li></ul><p>备忘录模式的常见应用场景包括：</p><ul><li>文本编辑器的撤销 &#x2F; 重做功能（存储每次编辑后的文档状态）。</li><li>游戏存档 &#x2F; 读档（存储角色、地图、进度等状态）。</li><li>事务回滚（数据库存储事务执行前的状态，失败时恢复）。</li><li>配置中心的版本管理（存储配置的历史版本，支持回滚）。</li></ul><p>下面以 “文本编辑器的撤销功能” 为例，用代码实现备忘录模式。这个场景中，我们需要保存文本的历史状态，以便用户随时撤销到之前的编辑状态。</p><p>首先我们创建这个文本编辑器的备忘录对象，它用于存储文本编辑器的内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 备忘录类：存储文本编辑器的状态</span></span><br><span class="line"><span class="comment">// 注意：构造方法和状态获取方法设为包级私有，仅允许同包的Originator访问</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextMemento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String content;  <span class="comment">// 保存的文本内容</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> cursorPosition;  <span class="comment">// 保存的光标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 包级私有构造：仅TextEditor可创建</span></span><br><span class="line">    TextMemento(String content, <span class="type">int</span> cursorPosition) &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">        <span class="built_in">this</span>.cursorPosition = cursorPosition;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 包级私有方法：仅TextEditor可读取状态</span></span><br><span class="line">    String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 包级私有方法：仅TextEditor可读取状态</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getCursorPosition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cursorPosition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着我们创建一个文本编辑器对象，它记录每次的键盘录入和光标位置并存到备忘录对象中，并且提供了从某个备忘录恢复的方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 发起人：文本编辑器（创建和恢复备忘录）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;  <span class="comment">// 当前文本内容</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">cursorPosition</span> <span class="operator">=</span> <span class="number">0</span>;  <span class="comment">// 当前光标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编辑文本</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">type</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        content = content.substring(<span class="number">0</span>, cursorPosition) + text + content.substring(cursorPosition);</span><br><span class="line">        cursorPosition += text.length();</span><br><span class="line">        System.out.println(<span class="string">&quot;编辑后：&quot;</span> + content + <span class="string">&quot;（光标在&quot;</span> + cursorPosition + <span class="string">&quot;位置）&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移动光标</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveCursor</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt;= content.length()) &#123;</span><br><span class="line">            cursorPosition = position;</span><br><span class="line">            System.out.println(<span class="string">&quot;光标移动到：&quot;</span> + cursorPosition);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录（保存当前状态）</span></span><br><span class="line">    <span class="keyword">public</span> TextMemento <span class="title function_">createMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;创建存档...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextMemento</span>(content, cursorPosition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreFromMemento</span><span class="params">(TextMemento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = memento.getContent();</span><br><span class="line">        <span class="built_in">this</span>.cursorPosition = memento.getCursorPosition();</span><br><span class="line">        System.out.println(<span class="string">&quot;撤销后：&quot;</span> + content + <span class="string">&quot;（光标在&quot;</span> + cursorPosition + <span class="string">&quot;位置）&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第三步，我们创建一个管理备忘录的对象，它将每次的备忘录副本保存到一个列表对象中，并提供从列表中取出某个备忘录副本的功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 负责人：管理备忘录（存档历史）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;TextMemento&gt; history = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存备忘录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveMemento</span><span class="params">(TextMemento memento)</span> &#123;</span><br><span class="line">        history.add(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取上一个备忘录（用于撤销）</span></span><br><span class="line">    <span class="keyword">public</span> TextMemento <span class="title function_">getPreviousMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (history.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 移除并返回最后一个存档（模拟单次撤销）</span></span><br><span class="line">        <span class="keyword">return</span> history.remove(history.size() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后我们演示客户端使用备忘录模式的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：使用文本编辑器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextEditorClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文本编辑器和负责人</span></span><br><span class="line">        <span class="type">TextEditor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextEditor</span>();</span><br><span class="line">        <span class="type">Caretaker</span> <span class="variable">caretaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Caretaker</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一次编辑</span></span><br><span class="line">        caretaker.saveMemento(editor.createMemento());  <span class="comment">// 保存初始状态</span></span><br><span class="line">        editor.type(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二次编辑</span></span><br><span class="line">        caretaker.saveMemento(editor.createMemento());  <span class="comment">// 保存当前状态</span></span><br><span class="line">        editor.type(<span class="string">&quot;World&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移动光标</span></span><br><span class="line">        editor.moveCursor(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三次编辑</span></span><br><span class="line">        caretaker.saveMemento(editor.createMemento());  <span class="comment">// 保存当前状态</span></span><br><span class="line">        editor.type(<span class="string">&quot;Java &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行撤销</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n执行第一次撤销：&quot;</span>);</span><br><span class="line">        <span class="type">TextMemento</span> <span class="variable">prev1</span> <span class="operator">=</span> caretaker.getPreviousMemento();</span><br><span class="line">        <span class="keyword">if</span> (prev1 != <span class="literal">null</span>) &#123;</span><br><span class="line">            editor.restoreFromMemento(prev1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再次撤销</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n执行第二次撤销：&quot;</span>);</span><br><span class="line">        <span class="type">TextMemento</span> <span class="variable">prev2</span> <span class="operator">=</span> caretaker.getPreviousMemento();</span><br><span class="line">        <span class="keyword">if</span> (prev2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            editor.restoreFromMemento(prev2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式13 -- 策略模式</title>
      <link href="/2025/09/25/41-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F13-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/41-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F13-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>策略模式（Strategy Pattern）是一种<strong>行为型设计模式</strong>，它定义了一系列算法，将每个算法封装起来并使它们可以相互替换。策略模式让算法的变化独立于使用算法的客户端，从而实现灵活的算法切换。</p></blockquote><p>简单来说，策略模式就像 “出行方式选择”—— 去同一个目的地可以选择步行、骑车、开车等不同策略，这些策略（算法）可根据情况随时切换，而不影响出行的目标。</p><p>策略模式的UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925151941754.png" alt="image.png"></p><p>上图中：</p><ul><li><strong>策略接口（Strategy）</strong>：定义所有具体策略必须实现的方法（如<code>execute()</code>），统一算法的调用方式。</li><li><strong>具体策略（ConcreteStrategyA&#x2F;B&#x2F;C）</strong>：实现策略接口，包含具体的算法逻辑（如不同的排序算法、支付方式）。</li><li><strong>环境类（Context）</strong>：持有一个策略对象的引用，提供<code>setStrategy()</code>方法动态切换策略，通过<code>doOperation()</code>方法调用当前策略的算法。</li></ul><p>策略模式的核心价值是<strong>算法的封装与切换</strong>，它将算法的定义与使用分离，使得：</p><ol><li>可以在不修改客户端的情况下新增算法（符合开闭原则）</li><li>可以在运行时动态切换算法</li><li>避免使用多重条件判断（if-else&#x2F;switch）</li></ol><p>常见应用场景：支付方式选择（微信、支付宝、银行卡）、排序算法切换、折扣计算策略等。</p><p>下面以 “电商平台的折扣计算” 为例，展示策略模式的实现。不同用户（普通用户、会员、VIP）有不同的折扣策略，且折扣规则可能随时调整，使用策略模式可以灵活切换和扩展这些折扣算法。</p><p>首先，定义一个统一的折扣策略抽象接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略接口：定义折扣计算的统一方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="comment">// 计算折扣后价格</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> originalPrice)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后定义针对不同用户的折扣策略</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体策略1：普通用户（无折扣）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NormalUserDiscount</span> <span class="keyword">implements</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;普通用户：无折扣&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体策略2：会员用户（9折）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemberDiscount</span> <span class="keyword">implements</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">discountedPrice</span> <span class="operator">=</span> originalPrice * <span class="number">0.9</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;会员用户：9折，折后价：&quot;</span> + discountedPrice);</span><br><span class="line">        <span class="keyword">return</span> discountedPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体策略3：VIP用户（8折+满100减20）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VipDiscount</span> <span class="keyword">implements</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">tempPrice</span> <span class="operator">=</span> originalPrice * <span class="number">0.8</span>;</span><br><span class="line">        <span class="comment">// 满100再减20</span></span><br><span class="line">        <span class="keyword">if</span> (tempPrice &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">            tempPrice -= <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;VIP用户：8折+满100减20，折后价：&quot;</span> + tempPrice);</span><br><span class="line">        <span class="keyword">return</span> tempPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第三步，定义一个使用策略的上下文，它持有策略对象，能够根据不同策略计算折扣</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 环境类：订单上下文（使用折扣策略）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderContext</span> &#123;</span><br><span class="line">    <span class="comment">// 持有当前折扣策略</span></span><br><span class="line">    <span class="keyword">private</span> DiscountStrategy discountStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造时指定初始策略</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderContext</span><span class="params">(DiscountStrategy discountStrategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.discountStrategy = discountStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态切换策略</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDiscountStrategy</span><span class="params">(DiscountStrategy discountStrategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.discountStrategy = discountStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算最终价格（委托给当前策略）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateFinalPrice</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> discountStrategy.calculate(originalPrice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的代码演示了客户端调用折扣策略的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：模拟订单结算</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">goodsPrice</span> <span class="operator">=</span> <span class="number">150.0</span>; <span class="comment">// 商品原价</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 普通用户下单</span></span><br><span class="line">        <span class="type">OrderContext</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderContext</span>(<span class="keyword">new</span> <span class="title class_">NormalUserDiscount</span>());</span><br><span class="line">        order.calculateFinalPrice(goodsPrice);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 切换为会员用户</span></span><br><span class="line">        order.setDiscountStrategy(<span class="keyword">new</span> <span class="title class_">MemberDiscount</span>());</span><br><span class="line">        order.calculateFinalPrice(goodsPrice);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 切换为VIP用户</span></span><br><span class="line">        order.setDiscountStrategy(<span class="keyword">new</span> <span class="title class_">VipDiscount</span>());</span><br><span class="line">        order.calculateFinalPrice(goodsPrice);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 新增策略：节日促销（7折）无需修改原有代码</span></span><br><span class="line">        order.setDiscountStrategy(<span class="keyword">new</span> <span class="title class_">HolidayDiscount</span>());</span><br><span class="line">        order.calculateFinalPrice(goodsPrice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有了策略模式，那么我们就可以根据需求增加不同的策略，比如针对某个促销定义一个新的策略，我们只需要增加一个策略对象即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增策略：节日促销（7折）- 体现扩展性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HolidayDiscount</span> <span class="keyword">implements</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">discountedPrice</span> <span class="operator">=</span> originalPrice * <span class="number">0.7</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;节日促销：7折，折后价：&quot;</span> + discountedPrice);</span><br><span class="line">        <span class="keyword">return</span> discountedPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用策略模式的优势如下：</p><ul><li><strong>消除条件判断</strong>：避免使用<code>if-else</code>或<code>switch</code>判断用户类型来选择折扣（传统方式会导致代码臃肿且难维护）。</li><li><strong>动态切换</strong>：支持运行时根据情况切换策略（如用户升级为 VIP 后立即应用 VIP 折扣）。</li><li><strong>易于扩展</strong>：比如上面的代码中，新增折扣策略只需实现<code>DiscountStrategy</code>接口，无需修改现有代码（符合开闭原则）。</li><li><strong>算法复用</strong>：不同订单可以共享同一个策略实例（如所有会员都使用<code>MemberDiscount</code>）。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式12 -- 模版模式</title>
      <link href="/2025/09/25/40-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F12-%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/40-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F12-%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>模板模式（Template Pattern）是一种行为型设计模式，它定义了一个操作的骨架流程，将某些步骤延迟到子类中实现。核心思想是<strong>固定算法结构，灵活定制具体步骤</strong>，使得子类可以在不改变算法整体结构的情况下，重写某些特定步骤。</p><p>简单来说，模板模式就像 “食谱”—— 食谱规定了做菜的步骤（如准备食材→翻炒→调味→出锅），但具体用什么食材、放多少调料可以由使用者（子类）自行决定。</p><p>模版模式的UML表示如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925145055562.png" alt="image.png"></p><p>在上图中：</p><ul><li><strong>抽象模板类（AbstractClass）</strong>：<ul><li>定义<code>templateMethod()</code>：作为算法骨架，按固定顺序调用各个步骤方法。</li><li>声明抽象方法（<code>primitiveOperation1()</code>、<code>primitiveOperation2()</code>）：这些步骤由子类实现，是算法中可变的部分。</li><li>提供具体方法（<code>concreteOperation()</code>）：算法中固定不变的步骤，父类直接实现。</li><li>可选钩子方法（<code>hook()</code>）：默认空实现或基础实现，子类可根据需要重写，用于控制算法流程。</li></ul></li><li><strong>具体子类（ConcreteClassA&#x2F;B）</strong>：实现父类的抽象方法，定制算法中的可变步骤，也可选择重写钩子方法。</li><li><strong>客户端</strong>：通过抽象模板类调用<code>templateMethod()</code>，无需关心具体子类，实现对不同算法变体的统一调用。</li></ul><p>模板模式的核心价值是<strong>封装不变部分，扩展可变部分</strong>，常用于框架设计（如 Spring 的<code>JdbcTemplate</code>、Servlet 的<code>doGet/doPost</code>），让框架控制流程，用户只需填充具体业务逻辑。</p><p>下面以 “饮品制作流程” 为例，展示模板模式的具体实现。制作咖啡和茶的流程有相似的骨架（煮水→冲泡→倒入杯子→添加调料），但具体步骤的实现不同，适合用模板模式统一流程并差异化实现细节。</p><p>首先，我们定义一个抽象的模版类，它定义了饮品制作的流程骨架：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象模板类：定义饮品制作的骨架流程</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BeverageMaker</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板方法：固定算法步骤，用final修饰防止子类修改流程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">makeBeverage</span><span class="params">()</span> &#123;</span><br><span class="line">        boilWater();       <span class="comment">// 步骤1：煮水（固定步骤）</span></span><br><span class="line">        brew();            <span class="comment">// 步骤2：冲泡（子类实现）</span></span><br><span class="line">        pourInCup();       <span class="comment">// 步骤3：倒入杯子（固定步骤）</span></span><br><span class="line">        <span class="keyword">if</span> (needCondiments()) &#123;  <span class="comment">// 钩子方法：判断是否需要添加调料</span></span><br><span class="line">            addCondiments(); <span class="comment">// 步骤4：添加调料（子类实现）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象方法：冲泡（咖啡和茶的实现不同）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象方法：添加调料（咖啡和茶的调料不同）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 具体方法：煮水（所有饮品都需要，固定实现）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">boilWater</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;煮水至100℃&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 具体方法：倒入杯子（所有饮品都需要，固定实现）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pourInCup</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;将饮品倒入杯子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 钩子方法：默认需要添加调料，子类可重写改变行为</span></span><br><span class="line"><span class="comment">     * 用于控制算法流程的可选步骤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 默认需要添加调料</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>制作饮品的抽象步骤是相同的，但是具体执行是有差异的。比如泡茶和泡咖啡的每一个步骤要做的事情是不一样的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体子类：咖啡制作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeMaker</span> <span class="keyword">extends</span> <span class="title class_">BeverageMaker</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用沸水冲泡咖啡粉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加牛奶和糖&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可选：重写钩子方法（例如某些咖啡不加调料）</span></span><br><span class="line">    <span class="comment">// @Override</span></span><br><span class="line">    <span class="comment">// protected boolean needCondiments() &#123;</span></span><br><span class="line">    <span class="comment">//     return false;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体子类：茶制作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TeaMaker</span> <span class="keyword">extends</span> <span class="title class_">BeverageMaker</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用沸水浸泡茶叶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加柠檬&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写钩子方法：茶可以选择不加调料</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 实际场景中可以根据用户输入决定，这里简化为固定返回false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端调用代码示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：使用模板模式制作饮品</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeverageShop</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 制作咖啡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=== 制作咖啡 ===&quot;</span>);</span><br><span class="line">        <span class="type">BeverageMaker</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CoffeeMaker</span>();</span><br><span class="line">        coffee.makeBeverage();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 制作茶</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 制作茶 ===&quot;</span>);</span><br><span class="line">        <span class="type">BeverageMaker</span> <span class="variable">tea</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeaMaker</span>();</span><br><span class="line">        tea.makeBeverage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用模板方法的优势在于：</p><ul><li><strong>代码复用</strong>：父类封装了公共步骤（如煮水、倒杯子），避免子类重复实现。</li><li><strong>流程控制</strong>：父类固定算法结构，确保所有子类遵循统一的流程规范（如必须先煮水再冲泡）。</li><li><strong>灵活扩展</strong>：子类通过重写抽象方法和钩子方法，可在不改变流程的前提下定制具体行为。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式11 -- 桥接模式</title>
      <link href="/2025/09/25/39-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F11-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/39-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F11-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>桥接模式（Bridge Pattern）是一种<strong>结构型设计模式</strong>，它的核心是将抽象部分与实现部分分离，使它们可以独立变化。通过引入一个 “桥接” 接口，将两个维度的变化解耦，避免因多维度扩展导致的类爆炸问题。</p></blockquote><p>简单来说，桥接模式就像 “遥控器与电器” 的关系 —— 遥控器（抽象部分）和电器（实现部分）可以独立变化：遥控器可以是红外、蓝牙等类型，电器可以是电视、空调等类型，通过桥接（遥控信号）关联，彼此不直接依赖。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925143210382.png" alt="image.png"></p><p>在上图中：</p><ul><li><strong>抽象部分（Abstraction）</strong>：定义抽象接口，包含一个对实现部分的引用，声明业务方法。</li><li><strong>扩展抽象部分（RefinedAbstraction）</strong>：继承抽象部分，对抽象接口进行扩展和完善。</li><li><strong>实现部分接口（Implementor）</strong>：定义实现部分的接口，与抽象部分的接口对应，但侧重点不同（抽象侧重业务，实现侧重具体操作）。</li><li><strong>具体实现（ConcreteImplementorA&#x2F;B）</strong>：实现实现部分接口，提供具体的功能实现。</li><li><strong>桥接关系</strong>：抽象部分通过持有实现部分的引用，将抽象的业务方法委托给实现部分的具体方法，形成 “桥接”。</li></ul><p>桥接模式的核心价值是<strong>解耦多维度变化</strong>，当系统存在两个独立变化的维度（如 “形状与颜色”、”操作系统与软件”）时，使用桥接模式可以避免为每个组合创建单独的类，减少类的数量并提高扩展性。</p><p>桥接模式特别适合处理存在两个独立变化维度的场景。<br>下面以 “消息通知系统” 为例说明其工作原理：消息有不同的类型（如普通消息、紧急消息），同时需要通过不同渠道发送（如短信、邮件、APP 推送）。这两个维度可以独立变化，使用桥接模式能避免类爆炸（如<code>SmsNormalMessage</code>、<code>EmailUrgentMessage</code>等大量组合类）。</p><p>首先我们定义一个消息发送接口，它只有一个send方法负责发送消息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现部分接口：定义消息发送渠道的接口（第二个变化维度）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MessageSender</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>; <span class="comment">// 发送消息的具体实现</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后针对不同的消息发送方式，比如短信和Email定义具体的发送消息类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现1：短信发送</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmsSender</span> <span class="keyword">implements</span> <span class="title class_">MessageSender</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【短信】发送消息：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现2：邮件发送</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailSender</span> <span class="keyword">implements</span> <span class="title class_">MessageSender</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【邮件】发送消息：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送消息的方式不同，我们用上面的代码进行了抽象解耦。同时，消息本身的类型也是不同的。那么我们在对消息进行抽象和实现的解耦。</p><p>首先定义消息抽象，我们让每个消息都要有一个消息发送者对象，并且有一个消息通知的方法让子类继承实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象部分：消息类型的抽象（第一个变化维度）</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="comment">// 桥接：持有发送渠道的引用（连接两个维度）</span></span><br><span class="line">    <span class="keyword">protected</span> MessageSender sender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造函数注入发送渠道</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(MessageSender sender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sender = sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象方法：发送消息（业务逻辑）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String content)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们实现具体的消息类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展抽象1：普通消息</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NormalMessage</span> <span class="keyword">extends</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NormalMessage</span><span class="params">(MessageSender sender)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 普通消息直接发送</span></span><br><span class="line">        sender.send(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展抽象2：紧急消息</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UrgentMessage</span> <span class="keyword">extends</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UrgentMessage</span><span class="params">(MessageSender sender)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 紧急消息添加特殊处理（如重复发送）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">urgentContent</span> <span class="operator">=</span> <span class="string">&quot;[紧急] &quot;</span> + content;</span><br><span class="line">        sender.send(urgentContent);</span><br><span class="line">        sender.send(<span class="string">&quot;再次提醒：&quot;</span> + urgentContent); <span class="comment">// 紧急消息重复发送</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，在客户端调用时的演示如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：使用桥接模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建两个发送渠道（实现部分）</span></span><br><span class="line">        <span class="type">MessageSender</span> <span class="variable">smsSender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsSender</span>();</span><br><span class="line">        <span class="type">MessageSender</span> <span class="variable">emailSender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmailSender</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建不同消息类型，并通过构造函数关联发送渠道（桥接）</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">normalSms</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NormalMessage</span>(smsSender);</span><br><span class="line">        <span class="type">Message</span> <span class="variable">urgentEmail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrgentMessage</span>(emailSender);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送消息（客户端无需关心具体组合）</span></span><br><span class="line">        normalSms.notify(<span class="string">&quot;您有一条新消息&quot;</span>);</span><br><span class="line">        urgentEmail.notify(<span class="string">&quot;系统将在10分钟后维护&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上述的例子中我们可以看出，如果不用桥接模式，为了支持 2 种消息类型 ×2 种发送渠道，需要创建 4 个组合类（<code>NormalSmsMessage</code>、<code>NormalEmailMessage</code>、<code>UrgentSmsMessage</code>、<code>UrgentEmailMessage</code>）。当维度扩展到 3 种消息类型 ×3 种渠道时，需 9 个类，形成 “类爆炸”。</p><p>桥接模式通过分离维度，只需<code>3+3=6</code>个类，且新增维度时无需修改原有代码（符合开闭原则）。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式10 -- 组合模式</title>
      <link href="/2025/09/25/38-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F10-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/38-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F10-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>组合模式（Composite Pattern）是一种<strong>结构型设计模式</strong>，它允许将对象组合成树形结构，并用统一的方式处理单个对象和对象组合。这种模式让客户端可以忽略单个对象和组合对象的差异，从而对它们进行一致操作。</p></blockquote><p>简单来说，组合模式就像 “文件系统”—— 文件和文件夹可以被统一对待，文件夹中可以包含文件或其他文件夹，形成树形结构，用户可以对任意节点（文件或文件夹）执行复制、删除等操作。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925141822856.png"></p><p>在上图中：</p><ul><li><strong>抽象组件（Component）</strong>：定义了叶子节点和组合节点的共同方法，包括业务方法（<code>operation()</code>）和管理子节点的方法（<code>add()</code>、<code>remove()</code>、<code>getChild()</code>）。</li><li><strong>叶子节点（Leaf）</strong>：没有子节点，实现<code>operation()</code>方法，但通常不实现子节点管理方法（或抛出异常）。</li><li><strong>组合节点（Composite）</strong>：包含子节点集合，实现<code>operation()</code>方法（通常会递归调用子节点的<code>operation()</code>），并实现子节点管理方法。</li><li><strong>客户端（Client）</strong>：通过抽象组件接口与对象交互，无需判断操作的是叶子还是组合，实现对整个树形结构的统一处理。</li></ul><p>下面以 “公司组织结构管理” 为例，通过代码示例说明组合模式的工作原理。在企业中，组织结构呈现树形结构（总部包含部门，部门包含子部门或员工），组合模式可以统一处理 “部门”（组合节点）和 “员工”（叶子节点）。</p><p>我们首先定义一个抽线的表示公司内部门或者员工的对象，这个对象有展示自己display的方法，增加子对象和移除子对象的add和remove方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件：表示组织中的所有元素（部门或员工）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">OrganizationComponent</span> &#123;</span><br><span class="line">    <span class="comment">// 显示组织信息</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">int</span> depth)</span>;  <span class="comment">// depth用于控制缩进，展示层级关系</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新增子组件（部门可以添加，员工不能添加）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移除子组件</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后实现一个叶子节点对象，它可以具体代表一个公司中的员工</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 叶子节点：员工（没有子节点）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">OrganizationComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String position;  <span class="comment">// 职位</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, String position)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.position = position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示员工信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印缩进，展示层级</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">indent</span> <span class="operator">=</span> <span class="string">&quot;-&quot;</span>.repeat(depth);</span><br><span class="line">        System.out.println(indent + <span class="string">&quot;员工：&quot;</span> + name + <span class="string">&quot;（&quot;</span> + position + <span class="string">&quot;）&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 员工不能添加子组件，抛出异常</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;员工不能添加子组件&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 员工没有子组件可移除</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;员工没有子组件可移除&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后再定义一个部门对象，它可以是一个公司的部门也可以是部门下的一个小组</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组合节点：部门（可以包含子部门或员工）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span> <span class="keyword">implements</span> <span class="title class_">OrganizationComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;  <span class="comment">// 部门名称</span></span><br><span class="line">    <span class="comment">// 存储子组件（可以是部门或员工）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrganizationComponent&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Department</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示部门信息，并递归显示所有子组件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">int</span> depth)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">indent</span> <span class="operator">=</span> <span class="string">&quot;-&quot;</span>.repeat(depth);</span><br><span class="line">        System.out.println(indent + <span class="string">&quot;部门：&quot;</span> + name);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 递归显示所有子组件（深度+1，增加缩进）</span></span><br><span class="line">        <span class="keyword">for</span> (OrganizationComponent child : children) &#123;</span><br><span class="line">            child.display(depth + <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加子组件（部门或员工）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        children.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除子组件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        children.remove(component);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在我们在客户端中，就可以通过这个组合模式的方式构建出整个公司的架构：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：构建并展示公司组织结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompanyStructure</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 构建总部（顶级组合节点）</span></span><br><span class="line">        <span class="type">OrganizationComponent</span> <span class="variable">headquarters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;总公司&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 构建技术部（子组合节点）</span></span><br><span class="line">        <span class="type">OrganizationComponent</span> <span class="variable">techDept</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;技术部&quot;</span>);</span><br><span class="line">        techDept.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;高级工程师&quot;</span>));</span><br><span class="line">        techDept.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;李四&quot;</span>, <span class="string">&quot;产品经理&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 构建技术部下属的前端团队（子组合节点）</span></span><br><span class="line">        <span class="type">OrganizationComponent</span> <span class="variable">frontendTeam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;前端团队&quot;</span>);</span><br><span class="line">        frontendTeam.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>, <span class="string">&quot;前端开发&quot;</span>));</span><br><span class="line">        techDept.add(frontendTeam);  <span class="comment">// 前端团队加入技术部</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 构建市场部（子组合节点）</span></span><br><span class="line">        <span class="type">OrganizationComponent</span> <span class="variable">marketDept</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;市场部&quot;</span>);</span><br><span class="line">        marketDept.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;赵六&quot;</span>, <span class="string">&quot;市场专员&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 将所有部门加入总部</span></span><br><span class="line">        headquarters.add(techDept);</span><br><span class="line">        headquarters.add(marketDept);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. 统一展示整个组织结构（无需区分部门和员工）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;公司组织结构：&quot;</span>);</span><br><span class="line">        headquarters.display(<span class="number">1</span>);  <span class="comment">// 从深度1开始展示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面的例子中我们可以看出，应用了组合模式后有诸多优势：</p><ul><li><strong>统一处理</strong>：客户端用相同代码处理单个对象（员工）和组合对象（部门），简化代码逻辑。</li><li><strong>树形结构灵活扩展</strong>：可以随时新增部门或员工，或调整层级关系（如将前端团队从技术部移到产品部），无需修改客户端代码。</li><li><strong>递归操作便捷</strong>：通过组合节点的递归调用，轻松实现对整个树形结构的遍历（如统计总人数、部门数量等）。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式9 -- 享元模式</title>
      <link href="/2025/09/25/37-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F9-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/37-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F9-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>享元模式（Flyweight Pattern）是一种<strong>结构型设计模式</strong>，它通过共享已存在的对象来减少内存占用和对象创建开销，特别适合处理大量相似对象的场景。</p></blockquote><p>核心思想是：将对象的属性分为<strong>内部状态</strong>（可共享，不随环境变化）和<strong>外部状态</strong>（不可共享，随环境变化），通过共享内部状态相同的对象，来减少系统中对象的数量。</p><p>享元模式的UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925120009697.png" alt="image.png"><br>从图中可以看出</p><ul><li><strong>享元工厂（FlyweightFactory）</strong>：维护一个享元池（通常是哈希表），负责创建享元对象或复用已存在的对象。</li><li><strong>抽象享元（Flyweight）</strong>：定义享元对象的接口，声明接收外部状态的方法。</li><li><strong>具体享元（ConcreteFlyweight）</strong>：实现抽象享元接口，存储可共享的内部状态，方法参数接收外部状态。</li><li><strong>非享元（UnsharedConcreteFlyweight）</strong>：不参与共享，通常包含不能共享的外部状态（可选角色）。</li><li><strong>客户端（Client）</strong>：需要使用享元时，向工厂请求并提供外部状态，不直接创建享元对象。</li></ul><p>我们来举一个例子。假设我们要实现一个数据库连接池。针对不同的数据库，其连接地址、用户名、密码等这些是变动的。但是，每个数据库连接都会有<code>execute</code> 执行SQL的方法和<code>close</code>关闭连接的方法，这两个方法是不变的。那么，我们来用享元模式实现它。<br>首先，将不变的部分封装成一个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象享元：数据库连接接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DBConnection</span> &#123;</span><br><span class="line">    <span class="comment">// 执行SQL（外部状态：SQL语句）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String sql)</span>;</span><br><span class="line">    <span class="comment">// 释放连接（回归连接池）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">release</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后将变动的部分封装在另一个部分，但是变动的部分会继承不变部分的功能。比如我们要实现一个MySQL的连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体享元：数据库连接实现（内部状态为连接配置）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLConnection</span> <span class="keyword">implements</span> <span class="title class_">DBConnection</span> &#123;</span><br><span class="line">    <span class="comment">// 内部状态：连接配置（可共享）</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// 外部状态标记：是否被占用（随使用变化）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> inUse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MySQLConnection</span><span class="params">(String url, String username, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.inUse = <span class="literal">false</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;创建新连接：&quot;</span> + url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String sql)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!inUse) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;连接未被占用，无法执行SQL&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;连接[%s]执行SQL：%s%n&quot;</span>, url, sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inUse = <span class="literal">false</span>;</span><br><span class="line">        System.out.printf(<span class="string">&quot;连接[%s]已释放，回归连接池%n&quot;</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 标记连接为“被占用”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInUse</span><span class="params">(<span class="type">boolean</span> inUse)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inUse = inUse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInUse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> inUse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MySQLConnection是一个数据库连接，因此它继承了DBConnection接口，即需要实现execute和close方法。同时，mysql的连接url 、username、password等这些变动的部分在MySQLConnection中维护。</p><p>接下来，我们创建一个数据库连接池，它扮演了享元工厂的角色用于创建数据库连接并维护一个包含多条连接的连接池</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 享元工厂：数据库连接池</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionPool</span> &#123;</span><br><span class="line">    <span class="comment">// 享元池：存储可复用的连接</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MySQLConnection&gt; connections = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 连接配置（内部状态模板）</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// 最大连接数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConnectionPool</span><span class="params">(String url, String username, String password, <span class="type">int</span> maxSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.maxSize = maxSize;</span><br><span class="line">        <span class="comment">// 初始化最小连接数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Math.min(<span class="number">3</span>, maxSize); i++) &#123;</span><br><span class="line">            connections.add(<span class="keyword">new</span> <span class="title class_">MySQLConnection</span>(url, username, password));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取连接（核心：复用空闲连接）</span></span><br><span class="line">    <span class="keyword">public</span> DBConnection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 优先复用空闲连接</span></span><br><span class="line">        <span class="keyword">for</span> (MySQLConnection conn : connections) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!conn.isInUse()) &#123;</span><br><span class="line">                conn.setInUse(<span class="literal">true</span>);</span><br><span class="line">                System.out.printf(<span class="string">&quot;复用连接：%s%n&quot;</span>, url);</span><br><span class="line">                <span class="keyword">return</span> conn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 若未达最大连接数，创建新连接</span></span><br><span class="line">        <span class="keyword">if</span> (connections.size() &lt; maxSize) &#123;</span><br><span class="line">            <span class="type">MySQLConnection</span> <span class="variable">newConn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MySQLConnection</span>(url, username, password);</span><br><span class="line">            newConn.setInUse(<span class="literal">true</span>);</span><br><span class="line">            connections.add(newConn);</span><br><span class="line">            <span class="keyword">return</span> newConn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 连接耗尽，等待（实际中会有超时机制）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;连接池已满，等待空闲连接...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getConnection(); <span class="comment">// 递归重试</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，在客户端调用时可以通过连接池对象创建数据库连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：模拟多线程使用连接池</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnectionPoolDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建连接池（享元工厂）</span></span><br><span class="line">        <span class="type">ConnectionPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionPool</span>(</span><br><span class="line">            <span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>,</span><br><span class="line">            <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">            <span class="number">5</span> <span class="comment">// 最大连接数5</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟10个线程并发获取连接</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">DBConnection</span> <span class="variable">conn</span> <span class="operator">=</span> pool.getConnection();</span><br><span class="line">                <span class="comment">// 执行SQL（外部状态）</span></span><br><span class="line">                conn.execute(<span class="string">&quot;SELECT * FROM users LIMIT 1&quot;</span>);</span><br><span class="line">                <span class="comment">// 释放连接（回归池）</span></span><br><span class="line">                conn.release();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里应用享元模式的价值在于：</p><ul><li><strong>性能优化</strong>：避免频繁创建数据库连接（一次创建成本约 10-100ms），复用连接可提升系统吞吐量 10 倍以上。</li><li><strong>资源控制</strong>：通过最大连接数限制，防止数据库被连接耗尽。</li><li><strong>稳定性</strong>：连接池统一管理连接的创建、释放和异常处理，减少连接泄露风险。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式8 -- 装饰模式</title>
      <link href="/2025/09/25/36-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F8-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/36-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F8-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>装饰模式（Decorator Pattern）是一种<strong>结构型设计模式</strong>，它允许在不改变原有对象结构的情况下，动态地给对象添加新功能。装饰模式通过创建 “装饰器” 类来包裹原始对象，从而在保持接口一致性的同时，实现功能的扩展。</p></blockquote><p>打个比方，装饰模式就像 “手机壳”—— 手机本身的功能不变，但加上不同的手机壳（装饰器）可以获得防摔、美观、无线充电等额外功能，且可以自由组合多个装饰器。</p><p>装饰模式的UML类图如下：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925113410837.png" alt="image.png"></p><p>从上面的类图中我们可以看出，在装饰模式中：</p><ol><li>Component：是一个抽象组件，它定义了被装饰对象的公共接口。也就是说，客户端能访问的被装饰组件的通用的方法。</li><li>Concretecomponent：是实际上的被装饰对象，它实现了Component接口，也意味着每个实际的被装饰对象必须实现抽象的公共接口中的方法，也就是通用功能必须具备。</li><li>Decorator：装饰器的抽象类，在这里它要持有某个被装饰的对象的抽象，然后通过后面的具体装饰器继承它来实现被装饰组件功能的叠加。</li><li>ConcreteDecorator：具体的装饰器，它通过继承Decorator来给被装饰组件增加额外的功能。</li></ol><p>我们还是通过一个具体的例子来理解它。比如，我们喝的咖啡有各种口味的，其实都是在基础的咖啡液中增加奶、糖、巧克力等配料来形成不同的口味，当然价格也会不一样。我们可以抽象出一个咖啡产品都有“什么口味和多少钱一杯”这两个信息。<br>那么，首先我们来创建咖啡这个被装饰组件的抽象接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件：咖啡</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>; <span class="comment">// 获取描述</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span>; <span class="comment">// 获取价格</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么，最基本的开发可能是浓缩咖啡，我们来实现它：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体组件：基础咖啡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Espresso</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;浓缩咖啡&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">25.0</span>; <span class="comment">// 基础价格</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，加入不同的配料就有了不同口味和价格的咖啡，因此我们可以”装饰“这个咖啡了。<br>先来创建一个抽象的<code>咖啡装饰器</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Coffee coffee; <span class="comment">// 被装饰的咖啡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CoffeeDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.coffee = coffee;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getDescription();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getCost();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个装饰器继承了<code>Coffee</code>类，也就是说，无论是怎么装饰，它本身都是一杯咖啡。<br>接下来我们创建<code>牛奶咖啡</code>的装饰器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MilkDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getDescription() + <span class="string">&quot; + 牛奶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getCost() + <span class="number">5.0</span>; <span class="comment">// 牛奶价格</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从代码中我们不难看出，牛奶咖啡首先必须是一种咖啡，所以我们在构造的时候要把coffee参数传入进来，这部分是不变的。然后，牛奶咖啡的描述和价格是其特有的，这部分是变动的，我们在装饰器里完成这部分变动的内容。<br>以此类推，我们继续实现<code>加糖</code>和<code>加巧克力</code> 的装饰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体装饰器：糖</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SugarDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SugarDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getDescription() + <span class="string">&quot; + 糖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getCost() + <span class="number">2.0</span>; <span class="comment">// 糖价格</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体装饰器：巧克力</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChocolateDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChocolateDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getDescription() + <span class="string">&quot; + 巧克力&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getCost() + <span class="number">8.0</span>; <span class="comment">// 巧克力价格</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在关于这个咖啡的装饰器我们已经做好了，客户来点咖啡的时候，就可以根据要求加不同的配料来。在实际的软件开发中，也就是给一个组件增加不同的功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：咖啡店订单</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CoffeeShop</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 点一杯基础浓缩咖啡</span></span><br><span class="line">        <span class="type">Coffee</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Espresso</span>();</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot;，价格：&quot;</span> + coffee.getCost() + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 加牛奶</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">MilkDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot;，价格：&quot;</span> + coffee.getCost() + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 再加巧克力</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">ChocolateDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot;，价格：&quot;</span> + coffee.getCost() + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 再加点糖</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">SugarDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot;，价格：&quot;</span> + coffee.getCost() + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从例子中我们可以看出，装饰器的优势在于：</p><ul><li><strong>动态扩展</strong>：可以在运行时为对象添加功能，如示例中动态组合各种配料</li><li><strong>灵活组合</strong>：装饰器可以任意组合，实现多种功能组合（如牛奶 + 糖、巧克力 + 牛奶等）</li><li><strong>避免类爆炸</strong>：相比为每种组合创建单独的类（如加牛奶的咖啡、加牛奶和糖的咖啡），装饰模式大大减少了类的数量。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式7 -- 外观模式</title>
      <link href="/2025/09/25/35-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F7-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/35-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F7-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>外观模式（Facade Pattern）是一种<strong>结构型设计模式</strong>，它为复杂子系统提供一个统一的简化接口，客户端通过这个接口与子系统交互，而无需直接操作子系统中的多个组件。</p></blockquote><p>简单来说，外观模式就像 “前台服务员”—— 当你去餐厅吃饭时，不需要直接和厨房、吧台、保洁等多个部门打交道，只需告诉前台服务员你的需求，由他协调协调内部各部门完成工作。</p><p>其UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925111509437.png" alt="image.png"></p><p>从类图中我们不难看出，外观模式中：</p><ul><li>一个Facade外观：封装了ABC三个子系统，它负责与客户端直接通信</li><li>子系统ABC：是实现了具体功能的系统，他们之间彼此没有依赖</li></ul><p>外观模式的核心价值是<strong>降低复杂度</strong>和<strong>解耦</strong>，通过引入外观类隔离客户端与子系统，让客户端更易用，同时保护子系统内部细节不被暴露。常见应用场景包括：框架的 API 封装（如 Spring 的<code>JdbcTemplate</code>简化 JDBC 操作）、复杂工具类的统一接口（如日志门面 SLF4J）等。</p><p>我们通过一个例子来说明。假设我们有一个电商系统，其中的订单支付后的处理场景包括了“库存扣减、订单状态更新、物流创建和短信通知”。他们分别由不同的子系统完成。那么这个流程可以通过外观模式实现，把其他几个子系统的处理封装到一个Facade中，从而降低了对其他子系统的耦合，也提高了安全性。</p><p>首先，假设我们有以下几个子系统的代码：</p><ol><li>库存子系统，负责扣减库存</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InventorySystem</span> &#123;</span><br><span class="line">    <span class="comment">// 扣减库存（模拟复杂逻辑：校验库存、锁定库存、更新数据库）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(String productId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[库存系统] 校验商品[&quot;</span> + productId + <span class="string">&quot;]库存...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[库存系统] 扣减库存：商品ID=&quot;</span> + productId + <span class="string">&quot;，数量=&quot;</span> + quantity);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 模拟扣减成功</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>订单子系统中的方法完成了订单状态的更改</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OrderSystem</span> &#123;</span><br><span class="line">    <span class="comment">// 更新订单为“已支付”状态（模拟复杂逻辑：状态流转校验、记录操作日志）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(String orderId, String status)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[订单系统] 校验订单[&quot;</span> + orderId + <span class="string">&quot;]当前状态...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[订单系统] 订单状态更新为：&quot;</span> + status + <span class="string">&quot;（订单ID=&quot;</span> + orderId + <span class="string">&quot;）&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>物流子系统中的方法负责创建物流单</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LogisticsSystem</span> &#123;</span><br><span class="line">    <span class="comment">// 创建物流单（模拟复杂逻辑：匹配快递公司、生成物流单号、推送物流信息）</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createLogisticsOrder</span><span class="params">(String orderId, String recipientAddress)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[物流系统] 为订单[&quot;</span> + orderId + <span class="string">&quot;]匹配快递公司...&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">logisticsNo</span> <span class="operator">=</span> <span class="string">&quot;SF1234567890&quot;</span>; <span class="comment">// 模拟生成的物流单号</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[物流系统] 生成物流单：单号=&quot;</span> + logisticsNo + <span class="string">&quot;，收货地址=&quot;</span> + recipientAddress);</span><br><span class="line">        <span class="keyword">return</span> logisticsNo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>通知子系统负责发出短信通知客户</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationSystem</span> &#123;</span><br><span class="line">    <span class="comment">// 发送支付成功短信（模拟复杂逻辑：模板渲染、调用短信网关、记录发送日志）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendPaymentSuccessSms</span><span class="params">(String phone, String orderId, String logisticsNo)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;【电商平台】您的订单（&quot;</span> + orderId + <span class="string">&quot;）已支付成功，物流单号：&quot;</span> + logisticsNo + <span class="string">&quot;，请注意查收！&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;[通知系统] 向手机号[&quot;</span> + phone + <span class="string">&quot;]发送短信：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在我们来创建一个Facade类，来封装上述四个子系统的方法，让它在订单支付后完成一系列操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentPostProcessFacade</span> &#123;</span><br><span class="line">    <span class="comment">// 持有各子系统的引用（子系统可通过依赖注入实现，此处简化为直接初始化）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InventorySystem inventorySystem;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderSystem orderSystem;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LogisticsSystem logisticsSystem;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotificationSystem notificationSystem;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化所有子系统（实际项目中可通过Spring等框架自动注入）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentPostProcessFacade</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inventorySystem = <span class="keyword">new</span> <span class="title class_">InventorySystem</span>();</span><br><span class="line">        <span class="built_in">this</span>.orderSystem = <span class="keyword">new</span> <span class="title class_">OrderSystem</span>();</span><br><span class="line">        <span class="built_in">this</span>.logisticsSystem = <span class="keyword">new</span> <span class="title class_">LogisticsSystem</span>();</span><br><span class="line">        <span class="built_in">this</span>.notificationSystem = <span class="keyword">new</span> <span class="title class_">NotificationSystem</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对外提供的简化接口：支付成功后统一处理流程</span></span><br><span class="line"><span class="comment">     * 客户端只需调用这一个方法，无需关心内部子系统如何交互</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processAfterPayment</span><span class="params">(String orderId, String productId, <span class="type">int</span> quantity, </span></span><br><span class="line"><span class="params">                                   String recipientAddress, String userPhone)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 扣减库存（子系统1）</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">stockReduced</span> <span class="operator">=</span> inventorySystem.reduceStock(productId, quantity);</span><br><span class="line">            <span class="keyword">if</span> (!stockReduced) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;库存不足，支付后处理失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 更新订单状态为“已支付”（子系统2）</span></span><br><span class="line">            orderSystem.updateOrderStatus(orderId, <span class="string">&quot;PAID&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 创建物流单（子系统3）</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">logisticsNo</span> <span class="operator">=</span> logisticsSystem.createLogisticsOrder(orderId, recipientAddress);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 发送支付成功短信（子系统4）</span></span><br><span class="line">            notificationSystem.sendPaymentSuccessSms(userPhone, orderId, logisticsNo);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;\n[支付后处理完成] 订单[&quot;</span> + orderId + <span class="string">&quot;]所有后续操作执行成功！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;[支付后处理失败] 原因：&quot;</span> + e.getMessage());</span><br><span class="line">            <span class="comment">// 实际项目中会触发异常处理（如回滚库存、标记订单异常）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，在客户端调用时，只需调用Facade类中的一个方法即可完成上述步骤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EcommerceClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 模拟支付成功后接收到的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> <span class="string">&quot;ORDER_20240925_001&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">productId</span> <span class="operator">=</span> <span class="string">&quot;PROD_10086&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">quantity</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">recipientAddress</span> <span class="operator">=</span> <span class="string">&quot;北京市朝阳区XX街道&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userPhone</span> <span class="operator">=</span> <span class="string">&quot;13800138000&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用外观类接口（仅需一行代码，无需操作4个子系统）</span></span><br><span class="line">        <span class="type">PaymentPostProcessFacade</span> <span class="variable">facade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentPostProcessFacade</span>();</span><br><span class="line">        facade.processAfterPayment(orderId, productId, quantity, recipientAddress, userPhone);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面的例子中我们可以看出Facade模式的优势：</p><ol><li><strong>简化调用</strong>：客户端只需调用<code>processAfterPayment</code>一个方法，无需逐一调用 4 个子系统的接口，降低了代码复杂度。</li><li><strong>隔离变化</strong>：若子系统逻辑修改（如库存系统增加 “库存预警” 步骤），只需修改外观类，客户端代码无需变动，符合 “开闭原则”。</li><li><strong>统一流程</strong>：外观类封装了子系统的调用顺序（如必须先扣库存，再更新订单状态），避免客户端因调用顺序错误导致业务异常。</li><li><strong>降低耦合</strong>：客户端与子系统完全解耦，未来替换子系统（如将短信通知换成 APP 推送），客户端无需感知。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式6 -- 适配器模式</title>
      <link href="/2025/09/25/34-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/25/34-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>适配器模式（Adapter Pattern）的定义是：它一种<strong>结构型设计模式</strong>，它的核心作用是<strong>将一个类的接口转换成客户端期望的另一个接口</strong>，使得原本因接口不兼容而无法一起工作的类能够协同工作。</p></blockquote><p>用一个现实生活中的例子来比喻，我们家里的插座是三项的，但是我们的插头是两项的，这时候可以用一个转换插座把三项的转换成两项的。又比如，我们家里的电源都是220V的，那我要给手机充电就需要一个充电头将220V转换成手机可以适应的电流。</p><p>适配器模式主要的应用场景有以下几个方面：</p><ul><li>解决接口不兼容的问题：比如当一个已有的类接口，由于参数数量或者参数类型等与需求不匹配而无法使用，那么我们可以通过适配器模式在不改变已有类的情况下满足接口需求。</li><li>复用现有功能：比如我们要用一个第三方的API接口或者一个遗留系统的功能代码，可以通过适配器模式实现对现有功能的复用。</li></ul><p>下面是适配器模式的UML类图表示</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250925101459873.png" alt="image.png"><br>这个UML类图中提供了两种适配器模式的实现方案：对象适配器(ObjectAdapter)和类适配器(ClassAdapter)。对象适配器通过组合的方式，也就是在类内部持有被适配的对象（Adaptee）来实现，这种方式更灵活。而类适配器模式，是通过继承被适配对象（Adaptee）来实现的，这种一般需要编程语言的支持，通常面向对象编程语言都可以支持。</p><p>我们举一个工程中常见的例子。比如我们的系统中有一个日志工具，现在要继承第三方的日志库，但是我们发现现有日志工具的方法参数等和第三方日志库的不匹配，这时候可以通过适配器模式来解决接口不兼容的问题。</p><p>假设我们有下面这样一个第三方日志库的类，注意我们无法修改它</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第三方日志库（适配者）</span></span><br><span class="line"><span class="comment">// 注意：这个类是我们无法修改的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThirdPartyLogger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logMessage</span><span class="params">(String level, String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[&quot;</span> + level + <span class="string">&quot;] &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logException</span><span class="params">(String message, Throwable throwable)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;[ERROR] &quot;</span> + message);</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>首先我们创建一个日志接口，它充当目标接口，用于和客户端代码交互。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 系统定义的日志接口（目标接口）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">info</span><span class="params">(String message)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">error</span><span class="params">(String message, Throwable throwable)</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>这个接口中我们定义了<code>info</code> 和<code>error</code>两个方法。</p><p>然后我们创建一个适配器类来实现这个接口并让它持有<code>ThirdPartyLogger</code>对象，这样就可以把它的功能进行适配</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日志适配器（将第三方日志库适配到系统日志接口）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggerAdapter</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ThirdPartyLogger thirdPartyLogger;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造函数注入第三方日志实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggerAdapter</span><span class="params">(ThirdPartyLogger thirdPartyLogger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.thirdPartyLogger = thirdPartyLogger;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 适配info级别日志</span></span><br><span class="line">        thirdPartyLogger.logMessage(<span class="string">&quot;INFO&quot;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">error</span><span class="params">(String message, Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="comment">// 适配error级别日志</span></span><br><span class="line">        thirdPartyLogger.logException(message, throwable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>如代码所示，我们把第三方日志库的<code>logMessage</code>和<code>logException</code> 方法适配成了我们自己要用的<code>info</code>和<code>error</code> 这两个方法。<br>下面演示客户端的调用过程：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建第三方日志实例</span></span><br><span class="line">        <span class="type">ThirdPartyLogger</span> <span class="variable">thirdPartyLogger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThirdPartyLogger</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建适配器</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggerAdapter</span>(thirdPartyLogger);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 客户端使用系统定义的接口，无需关心具体实现</span></span><br><span class="line">        logger.info(<span class="string">&quot;系统启动成功&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;发生数学运算异常&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>适配器模式的优势在于其在不修改现有代码的情况下实现了接口的兼容，这样可以让客户端使用统一的接口，能更好的提升代码的复用性并降低了系统间的耦合度。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式5 -- 代理模式</title>
      <link href="/2025/09/24/33-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F5-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/24/33-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F5-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>代理模式是一种结构型设计模式，它通过引入“代理对象”来控制原始对象的访问。这个代理对象与我们要访问的原始对象实现相同的接口，然后客户端就可以通过代理对象访问原始对象。那么我们就可以实现在不修改原始对象电的情况下增加额外的功能。比如，实现权限控制、日志记录或者延迟加载等。<br>下面是一个代理模式的UML类图：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924164156118.png" alt="image.png"><br>在上面的类图中：</p><ul><li>Subject：是一个抽象主题，它定义了我们真实要访问的主题和代理对象的公共接口，客户端直接和这个接口交互。</li><li>RealSubject: 它是客户端实际上要操作的对象，它也实现了Subject接口。</li><li>Proxy：是代理对象，它实现了Subject的接口，内部持有RealSubjet的引用，它负责控制对真实主体对象的访问，并且还可以增加额外的操作</li><li>Client：是客户端，它只和Subject接口交互，无需知道真实主体的存在。</li></ul><blockquote><p>代理模式的关键是代理对象与真实对象实现相同的接口，从而实现对真实对象的透明访问，同时可以在访问过程中增加额外功能。</p></blockquote><p>举一个具体的例子。比如在分布式系统中，客户端需要调用远程服务器上的服务（如微服务接口），直接调用会涉及网络通信、序列化 &#x2F; 反序列化等复杂逻辑。使用代理模式可以将这些细节封装在代理对象中，让客户端像调用本地方法一样使用远程服务。</p><p>下面的代码模拟了一个电商系统中，客户端需要调用远程库存服务查询商品库存，代理对象负责处理网络通信细节：</p><p>首先创建一个代表主题的库存服务接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题：库存服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getStock</span><span class="params">(String productId)</span>;       <span class="comment">// 查询库存</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(String productId, <span class="type">int</span> quantity)</span>; <span class="comment">// 扣减库存</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>然后创建一个代理丢下实现这个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理类：远程服务代理（客户端）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteInventoryProxy</span> <span class="keyword">implements</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="comment">// 代理对象封装远程调用的细节</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStock</span><span class="params">(String productId)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 开始远程调用：查询库存，商品ID=&quot;</span> + productId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 处理网络通信（模拟）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 建立网络连接，发送请求...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 调用远程服务（实际中通过网络调用，这里简化为直接调用）</span></span><br><span class="line">        <span class="type">InventoryService</span> <span class="variable">remoteService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteInventoryServiceImpl</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">stock</span> <span class="operator">=</span> remoteService.getStock(productId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 处理响应（模拟）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 接收响应，关闭连接&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(String productId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 开始远程调用：扣减库存，商品ID=&quot;</span> + productId + <span class="string">&quot;，数量=&quot;</span> + quantity);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 封装网络调用细节</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 建立网络连接，发送请求...&quot;</span>);</span><br><span class="line">        <span class="type">InventoryService</span> <span class="variable">remoteService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteInventoryServiceImpl</span>();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> remoteService.reduceStock(productId, quantity);</span><br><span class="line">        System.out.println(<span class="string">&quot;[代理] 接收响应，关闭连接&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>真实的库存服务对象也实现这个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实主题：远程库存服务的实际实现（运行在服务器端）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteInventoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStock</span><span class="params">(String productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 实际的库存查询逻辑（如查询数据库）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[服务器] 查询商品 &quot;</span> + productId + <span class="string">&quot; 的库存&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">150</span>; <span class="comment">// 模拟库存数据</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(String productId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="comment">// 实际的库存扣减逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[服务器] 扣减商品 &quot;</span> + productId + <span class="string">&quot; 的库存：&quot;</span> + quantity);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 模拟扣减成功</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>下面的代码演示了客户端调用的方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码：调用库存服务（通过代理）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 客户端通过代理访问远程服务，无需关心网络细节</span></span><br><span class="line">        <span class="type">InventoryService</span> <span class="variable">inventoryService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteInventoryProxy</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 查询商品库存</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">stock</span> <span class="operator">=</span> inventoryService.getStock(<span class="string">&quot;product_123&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;商品库存：&quot;</span> + stock); <span class="comment">// 输出：商品库存：150</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 扣减库存</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> inventoryService.reduceStock(<span class="string">&quot;product_123&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;扣减库存是否成功：&quot;</span> + success); <span class="comment">// 输出：扣减库存是否成功：true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>代理模式的优势如下：</p><ul><li><strong>透明访问</strong>：客户端无需知道原始对象的存在，代理对象对客户端透明。</li><li><strong>功能增强</strong>：在不修改原始对象的情况下，通过代理添加日志、缓存、权限校验等功能。</li><li><strong>资源优化</strong>：例如使用 “虚拟代理” 延迟加载大对象，只有在真正需要时才初始化。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式 4 -- 生成器模式</title>
      <link href="/2025/09/24/32-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-4-%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/24/32-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-4-%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>我们在工厂实践中会遇到一种场景，那就是要构造的对象很复杂，可能包含多个组成部分，但是由这些不同的组成部分形成的对象最终的表现形式可能是不同的。此时我们就可以用到生成器模式。</p><blockquote><p>生成器模式的定义是：<strong>将复杂对象的构建过程与表示分离，使得同样的构建过程可以创建不同的表示。</strong></p></blockquote><p>其核心要解决的问题就是：<strong>当一个对象包含多个组成部分，且构建过程复杂（如需要分步骤构建、存在多种配置组合）时，将构建逻辑从对象本身剥离，由专门的 “生成器” 负责，从而简化对象创建、提高灵活性。</strong></p><p>其UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924153510809.png" alt="image.png"></p><p>在上面这个图中：</p><ul><li>Product：也就是产品，它代表了要被最终创建出来的那个复杂对象。</li><li>Builder: 是抽象生成器，它定义了构造出这个Product各个部分的接口，以及获取这个最终Product的方法。</li><li>ConcreteBuilder1和ConcreteBuilder2是具体的生成器：它们都实现了Builder这个抽象接口，它们负责产品Product的具体构造并保存了构件好的Product。</li><li>最后的Director：它用来接受Builder对象，然后按照固定的流程调用Builder里的方法来控制构建的过程。</li></ul><p>这样说起来还是有点抽象，我们举一个具体的例子。比如我们的开发的系统要输出报表，一个报表其内容可能是相同的，保护了报表的标题、报表内容、页眉页脚等，构建一个报表需要多个步骤，但是最终可能要输出的格式包括了Html和PDF等多种形式，因为输出的格式不同其设置的一些属性也是不同的，此时就可以使用生成器模式。<br>下面是具体的示例代码：</p><p>首先要创建具体的产品Product，在这里就是报表，定义创建一个报表要包含的属性和一个展示报表的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Report</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String footer;</span><br><span class="line">    <span class="keyword">private</span> String format; <span class="comment">// 格式：HTML/PDF等</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFooter</span><span class="params">(String footer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.footer = footer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFormat</span><span class="params">(String format)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.format = format;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 展示报告内容</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===== &quot;</span> + format + <span class="string">&quot; 报告 =====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;标题: &quot;</span> + title);</span><br><span class="line">        System.out.println(<span class="string">&quot;内容: &quot;</span> + content);</span><br><span class="line">        System.out.println(<span class="string">&quot;页脚: &quot;</span> + footer);</span><br><span class="line">        System.out.println(<span class="string">&quot;======================&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后我们定义一个报表的生成器，它定义了如何创建一个报表Product以及如何展示这个报表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReportBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setFooter</span><span class="params">(String footer)</span>;</span><br><span class="line">    Report <span class="title function_">getResult</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来分别定义Html和PDF格式报表的生成器，它们负责实现具体的报表格式的定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体生成器：HTML报表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HtmlReportBuilder</span> <span class="keyword">implements</span> <span class="title class_">ReportBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Report report;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HtmlReportBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.report = <span class="keyword">new</span> <span class="title class_">Report</span>();</span><br><span class="line">        <span class="built_in">this</span>.report.setFormat(<span class="string">&quot;HTML&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// HTML格式的标题处理</span></span><br><span class="line">        report.setTitle(<span class="string">&quot;&lt;h1&gt;&quot;</span> + title + <span class="string">&quot;&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// HTML格式的内容处理</span></span><br><span class="line">        report.setContent(<span class="string">&quot;&lt;p&gt;&quot;</span> + content + <span class="string">&quot;&lt;/p&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFooter</span><span class="params">(String footer)</span> &#123;</span><br><span class="line">        <span class="comment">// HTML格式的页脚处理</span></span><br><span class="line">        report.setFooter(<span class="string">&quot;&lt;footer&gt;&quot;</span> + footer + <span class="string">&quot;&lt;/footer&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Report <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> report;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体生成器：PDF报表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PdfReportBuilder</span> <span class="keyword">implements</span> <span class="title class_">ReportBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Report report;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PdfReportBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.report = <span class="keyword">new</span> <span class="title class_">Report</span>();</span><br><span class="line">        <span class="built_in">this</span>.report.setFormat(<span class="string">&quot;PDF&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// PDF格式的标题处理（模拟）</span></span><br><span class="line">        report.setTitle(<span class="string">&quot;[PDF标题] &quot;</span> + title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// PDF格式的内容处理（模拟）</span></span><br><span class="line">        report.setContent(<span class="string">&quot;[PDF内容] &quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFooter</span><span class="params">(String footer)</span> &#123;</span><br><span class="line">        <span class="comment">// PDF格式的页脚处理（模拟）</span></span><br><span class="line">        report.setFooter(<span class="string">&quot;[PDF页脚] &quot;</span> + footer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Report <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> report;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后定义一个Director，它<code>指挥</code> 不同的生成器来生成报表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指挥者：控制报表构建流程</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportDirector</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ReportBuilder builder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReportDirector</span><span class="params">(ReportBuilder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建月度报告的固定流程</span></span><br><span class="line">    <span class="keyword">public</span> Report <span class="title function_">buildMonthlyReport</span><span class="params">(String month, String content)</span> &#123;</span><br><span class="line">        builder.setTitle(month + <span class="string">&quot;销售报告&quot;</span>);</span><br><span class="line">        builder.setContent(content);</span><br><span class="line">        builder.setFooter(<span class="string">&quot;生成日期: &quot;</span> + java.time.LocalDate.now() + <span class="string">&quot; | 机密文档&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.getResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以添加其他构建方法，如季度报告、年度报告等</span></span><br><span class="line">    <span class="keyword">public</span> Report <span class="title function_">buildQuarterlyReport</span><span class="params">(String quarter, String content)</span> &#123;</span><br><span class="line">        builder.setTitle(quarter + <span class="string">&quot;季度总结报告&quot;</span>);</span><br><span class="line">        builder.setContent(content);</span><br><span class="line">        builder.setFooter(<span class="string">&quot;生成日期: &quot;</span> + java.time.LocalDate.now() + <span class="string">&quot; | 内部使用&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.getResult();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>客户端生成不同报表的方式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportGeneratorDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 生成HTML格式的月度报告</span></span><br><span class="line">        <span class="type">ReportBuilder</span> <span class="variable">htmlBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HtmlReportBuilder</span>();</span><br><span class="line">        <span class="type">ReportDirector</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReportDirector</span>(htmlBuilder);</span><br><span class="line">        <span class="type">Report</span> <span class="variable">htmlReport</span> <span class="operator">=</span> director.buildMonthlyReport(<span class="string">&quot;2024年9月&quot;</span>, <span class="string">&quot;本月销售额增长15%，达成季度目标&quot;</span>);</span><br><span class="line">        htmlReport.display();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成PDF格式的月度报告（仅更换生成器）</span></span><br><span class="line">        <span class="type">ReportBuilder</span> <span class="variable">pdfBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PdfReportBuilder</span>();</span><br><span class="line">        director = <span class="keyword">new</span> <span class="title class_">ReportDirector</span>(pdfBuilder);</span><br><span class="line">        <span class="type">Report</span> <span class="variable">pdfReport</span> <span class="operator">=</span> director.buildMonthlyReport(<span class="string">&quot;2024年9月&quot;</span>, <span class="string">&quot;本月销售额增长15%，达成季度目标&quot;</span>);</span><br><span class="line">        pdfReport.display();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成PDF格式的季度报告</span></span><br><span class="line">        <span class="type">Report</span> <span class="variable">quarterlyReport</span> <span class="operator">=</span> director.buildQuarterlyReport(<span class="string">&quot;2024年Q3&quot;</span>, <span class="string">&quot;三季度总销售额同比增长12%&quot;</span>);</span><br><span class="line">        quarterlyReport.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>需要注意的是生成器模式和抽象工厂模式的不同，生成器模式更强调“如何构建”，它专注于分布构建单个复杂对象。而抽象工厂的核心是“创建什么”，它专注于创建出一套相互关联的产品。</p><p>简单说：生成器模式像 “定制蛋糕”（分步添加配料，控制每一步），抽象工厂模式像 “购买餐具套装”（一次性获取配套的碗、盘、勺）。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式3 -- 原型模式</title>
      <link href="/2025/09/24/31-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F3-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/24/31-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F3-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>面向对象的编程中，创建一个对象是要开销资源的，比如java中通过new关键字来创建对象。但是有的时候，我们要创建大量的对象而这些对象的大部分属性都是相同只有部分属性会有变化。此时还使用new来创建对象，其开销的资源就比较大了，而且效率不高。于是我们就可以用到原型模式。</p><p>原型模式的定义是：通过编程语言（比如Java或C++）等提供的对象克隆（复制）方法来创建对象，而不是通过new关键字来创建对象。这种模式需要先有一个相当于<code>对象模板</code>的类，然后通过克隆的方式快速生成和原型具有相同或者相似属性的新对象。</p><p>原型模式的UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924150400271.png" alt="image.png"></p><p>在这个模式中，其核心结构：</p><ul><li>首先定义一个克隆方法的接口，所有具体的原型都实现这个接口</li><li>然后创建一个具体的原型类，实现这个接口并提供一个<code>clone</code>方法，让它能够复制自身</li><li>最后，在调用的时候通过原型对象的<code>clone</code>方法来创建新对象。</li></ul><p>举一个具体的例子，比如我们的系统中要提供一个邮件订阅的功能，当我们向订阅者发送邮件的时候，邮件内容基本是相同的，每一封邮件的区别可能只是收件人地址或者称呼有区别，那么我们就可以通过原型模式来快速创建邮件对象。<br>下面是实例代码，在这个例子中我们假设给两类用户发邮件，一类用来通知订单发货、一类用来通知用户的积分情况。</p><p>首先创建一个邮件对象接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> protyotype;</span><br><span class="line"><span class="comment">// 邮件原型接口（抽象原型）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Email</span> <span class="keyword">extends</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    Email <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setRecipient</span><span class="params">(String recipient)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">send</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>然后在具体的通知邮件对象中实现克隆方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> protyotype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationEmail</span> <span class="keyword">implements</span> <span class="title class_">Email</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="string">&quot;[系统通知] &quot;</span>; <span class="comment">// 固定主题前缀</span></span><br><span class="line">    <span class="keyword">private</span> String recipient; <span class="comment">// 收件人（克隆后修改）</span></span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">// 内容（克隆后修改）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">footer</span> <span class="operator">=</span> <span class="string">&quot;\n\n---\n系统自动发送，请勿回复&quot;</span>; <span class="comment">// 固定签名</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Email <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (NotificationEmail) <span class="built_in">super</span>.clone(); <span class="comment">// 浅克隆</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;克隆失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRecipient</span><span class="params">(String recipient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.recipient = recipient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送邮件至：&quot;</span> + recipient);</span><br><span class="line">        System.out.println(<span class="string">&quot;主题：&quot;</span> + subject);</span><br><span class="line">        System.out.println(<span class="string">&quot;内容：&quot;</span> + content + footer);</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后在客户端中调用，使用<code>clone</code>方法来创建对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> protyotype;</span><br><span class="line"><span class="comment">// 客户端：批量发送邮件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建原型模板（只需初始化一次）</span></span><br><span class="line">        <span class="type">Email</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotificationEmail</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 克隆模板生成新邮件，并修改差异部分</span></span><br><span class="line">        <span class="type">Email</span> <span class="variable">email1</span> <span class="operator">=</span> template.clone();</span><br><span class="line">        email1.setRecipient(<span class="string">&quot;user1@example.com&quot;</span>);</span><br><span class="line">        email1.setContent(<span class="string">&quot;您的订单已发货，物流单号：12345&quot;</span>);</span><br><span class="line">        email1.send();</span><br><span class="line">        </span><br><span class="line">        <span class="type">Email</span> <span class="variable">email2</span> <span class="operator">=</span> template.clone();</span><br><span class="line">        email2.setRecipient(<span class="string">&quot;user2@example.com&quot;</span>);</span><br><span class="line">        email2.setContent(<span class="string">&quot;您的会员积分已到账，当前积分：500&quot;</span>);</span><br><span class="line">        email2.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>总之，原型模式在应对批量创建相似属性对象时具有优势，而且灵活性更高，其使用编程语言内置的克隆方法也更加节省资源开销，在一些诸如邮件通知、消息推送或者报表生成等场景中较为常用。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式2 -- 工厂模式</title>
      <link href="/2025/09/24/30-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/24/30-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>工厂模式是为了把对象的内容耦合进行解耦，变成一种更好的数据耦合的方式，最终的目的是还是为了解耦。<br>工厂模式的定义是：<strong>定义一个用于创建对象的接口，然后让子类决定实例化哪一个类。这样的目的是让一个类的实例化延迟到子类中完成</strong>。</p><p>工厂模式的UML类图如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924141657136.png" alt="image.png"></p><p>举一个实际中应用的例子，比如我们的程序中需要一个日志工具，记录日志的方式有很多种，可能初期的时候我们可能只是在控制台打印日志，后续系统正式上线后，我们使用文件的方式。根据系统的规划后续随着分析日志的需求，我们可能会增加基于Redis或者MangoDB方式将日志保存到数据库中。我们还希望可以通过配置的方式切换日志工具。这是就需要用到工厂方法。</p><p>为了实现对象的延迟实例化，我们首先需要定义一个接口，它是具体要创建实例的抽象，比如创建一个日志对象的接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个接口中我们定义了<code>log</code>方法，这是所有日志对象都要实现的方法。假设我们现在要提供一个控制台打印的日志对象，那么可以这样实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ConsoleLogger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在，我们要再实现一个向文件写入日志的对象<code>FileLogger</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟将日志写入文件的代码</span></span><br><span class="line">       System.out.println(<span class="string">&quot;FileLogger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以及一个向Redis写入日志的对象 <code>RedisLogger</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟将日志写入Redis</span></span><br><span class="line">       System.out.println(<span class="string">&quot;RedisLogger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>刚才我们说过，要将对象的创建延迟到子类中，那么就需要一个创建对象的工厂方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggerFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (type.equals(<span class="string">&quot;console&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConsoleLogger</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;file&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileLogger</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;redis&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RedisLogger</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上面的代码所示，我们根据<code>type</code>参数来判定要创建的日志工具是什么类型的，这样就降低了使用日志工具的类的耦合性。下面是一个具体调用工厂方法的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;console&quot;</span>);</span><br><span class="line">        logger.log(<span class="string">&quot;这是一条日志消息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这种方式是工厂模式中的简单工厂，我们只是通过参数判定来决定创建哪个类。如果再进一步可以实现一个抽象工厂，它是进一步将工厂对象抽象为一个接口，然后不同的<code>产品对象</code>由不同的<code>工厂对象</code>来创建，这种方式避免了在需要新增产品时修改工厂对象中创建方法，更加灵活，但是相对而言实现方式较复杂，但是灵活性更高。<br>下面是抽象工厂的UML类图<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924144321250.png" alt="image.png"><br>具体抽象工厂的示例代码这里就不提供了。总结一下，工厂方法这个设计模式，更符合面向对象中的“符合开闭原则、单一职责原则”的设计原则。并且很好的实现了对象创建的解耦。比如上面的抽象工厂中，如果要增加一种产品，只要继承<code>Factory</code> 和<code>Product</code> 这两个接口就可以实现，无需对现有代码进行更改。但是它在一定程度上增加了复杂性，因为每增加一个具体的产品就要增加一组类，代理维护成本高了，如果是具体产品的种类不多或者变化不频繁使用抽象工厂方法会稍显复杂，一般用简单工厂方法即可。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式 1--单例模式</title>
      <link href="/2025/09/24/29-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2025/09/24/29-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>介绍设计模式的文章其实很多了，今天开始我打算把23个设计模式用自己的方式重新梳理一遍。以下是最简单也是比较常用的单例模式。</p></blockquote><p>单例模式的定义是：<strong>确保一个类，只有一个实例，并提供一个访问它的全局访问点。</strong></p><p>我们来用一个UML图示表示它，如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250924115318082.png" alt="image.png"></p><p>这个单例模式在我们日常的编程中应用还是比较多的。比如，我们在做各类基于数据库的这种信息系统时，要不停的访问数据库存取数据，意味着要频繁的建立数据库连接，但是数据库的连接资源是有限的，通常我们会创建一个连接池来进行管理。这个时候就需要通过单例模式来统一管理连接的创建、分配和回收。此外，像程序中的日志操作，也通常是需要通过单例模式来确保单一实例来操作日志文件，避免出现多实例同时写入造成的冲突。</p><p>单例模式的实现也比较简单，下面是一个Java示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">businessMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Singleton 业务方法被调用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码中我们通过<code>getInstance</code>方法来获得Singleton这个类的实例，并且把它声明为<code>static</code>这样就可以直接通过类静态方法调用。因为这里我们判定了instantce是否已经存在，如果存在就直接返回，如果不存在才会创建，因此实例永远是单一的，不会被重复创建。</p><p>下面是一个调用代码的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        instance.businessMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReLU_函数的定义和作用</title>
      <link href="/2025/09/23/28-ReLU-%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%9C%E7%94%A8/"/>
      <url>/2025/09/23/28-ReLU-%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%9C%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ReLU（Rectified Linear Unit，修正线性单元）是深度学习中常用的一种激活函数。它的定义非常简单：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923092935447.png" alt="image.png"></p><p>也就是说，ReLU 函数会将输入中的负值全部置为0，而正值保持不变。</p><p>ReLU 函数的图像如下：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923092011433.png" alt="ReLU函数"></p><p>ReLU 函数的优点包括：</p><ol><li><strong>计算简单</strong>：ReLU 函数的计算非常简单，只需要比较输入值和0的大小。</li><li><strong>梯度消失问题</strong>：相比于 sigmoid 和 tanh 激活函数，ReLU 函数在正区间的梯度恒为1，能够有效缓解梯度消失问题。</li><li><strong>稀疏激活</strong>：ReLU 函数会将一部分神经元的输出置为0，从而引入了稀疏性，有助于模型的泛化能力。</li></ol><p>在 PyTorch 中，可以使用 <code>torch.nn.ReLU</code> 或 <code>torch.relu</code> 来应用 ReLU 激活函数。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 nn.ReLU</span></span><br><span class="line">relu = nn.ReLU()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设输入张量 x</span></span><br><span class="line">x = torch.tensor([-<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用 ReLU 激活函数</span></span><br><span class="line">y = relu(x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;输入张量 x:&quot;</span>, x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;输出张量 y:&quot;</span>, y)</span><br></pre></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入张量 x: tensor([-1., 0., 1., 2.]) </span><br><span class="line">输出张量 y: tensor([0., 0., 1., 2.])</span><br></pre></td></tr></table></figure><p>在这个例子中，输入张量 <code>x</code> 中的负值被置为0，正值保持不变。</p><p>使用 ReLU 的好处是它的梯度要么是 1（对于正值），要么是 0（对于负值）——不再有梯度消失！</p><p>这种模式导致网络更快的收敛。 然而，这种行为也可能导致所谓的“神经元死亡”； 也就是说，输入始终为负的神经元，因此激活值始终为零。 更糟糕的是，负输入的梯度也为零，这意味着权重不会更新。 就像神经元被卡住了一样。</p><p>ReLU 的激活值显然不是以零为中心。 它会比双曲正切更糟糕吗？ 当然不是，否则它不会成为从业者中如此流行的激活函数。 尽管 ReLU 的输出不以零为中心，但其梯度相对较大，能够比其他两个激活函数获得更好更快的结果。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习中几种激活函数介绍</title>
      <link href="/2025/09/23/27-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%87%A0%E7%A7%8D%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/"/>
      <url>/2025/09/23/27-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%87%A0%E7%A7%8D%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>激活函数的发展经历了Sigmoid→Tanh→ReLU→Leaky ReLU等多种不同类型的激活函数及其改进结构，还有一个特殊的激活函数Softmax，它只会被用在网络中的最后一层，用来进行最后的分类和归一化。</p><h2 id="Sigmoid激活函数"><a href="#Sigmoid激活函数" class="headerlink" title="Sigmoid激活函数"></a>Sigmoid激活函数</h2><p>Sigmoid函数常被用作神经网络的阈值函数，因为它在信息科学中具备单增以及反函数单增等性质，它可以将变量映射至0～1，其公式如下：</p><p>$$<br>f(x)&#x3D;\frac {1}{1+e^{-x}}<br>$$</p><p>Sigmoid是几十年来应用最多的激活函数之一，它的应用范围比较广泛，值域在0～1，因此可以将其输出作为预测二值型变量取值为1的概率，有很好的概率解释性，Sigmoid激活函数在其大部分定义域内都饱和，仅仅当输入接近0时才会对输入强烈敏感。它能够控制数值的幅度，并且在深层网络中可以保持数据幅度不会出现大的变化。下面是这个函数的图像</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923090055408.png" alt="sigmod.png"></p><p>Sigmoid函数具有明显的优势。首先，Sigmoid函数限定了神经元的输出范围在0～1，在一些问题中，这种形式的输出可以被看作概率取值。其次，当神经网络的损失函数取交叉熵时，S函数可用于输入数据的归一化操作，且交叉熵与Sigmoid函数的配合能够有效改善算法迭代速度慢的问题。</p><h2 id="Tanh激活函数"><a href="#Tanh激活函数" class="headerlink" title="Tanh激活函数"></a>Tanh激活函数</h2><p>Tanh是双曲函数中的一个，Tanh()为双曲正切。在数学中，双曲正切Tanh是由基本双曲函数双曲正弦和双曲余弦推导而来的，其公式如下：</p><p>$$<br>tanh(x)&#x3D;\frac {sinh(x)}{cosh(x)}&#x3D;\frac{e^{x}-e^{-x}}{e^{x}+e^{-x}}<br>$$</p><p><strong>分类任务中，Tanh激活函数正逐渐取代Sigmoid激活函数成为神经网络的激活函数。</strong> 根据图像可以看出，他关于原点对称，解决了Sigmoid函数中输出值都为正数的问题，而其他属性基本都与Sigmoid函数相同，具有连续性和可微性。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923090312884.png" alt="tanh.png"></p><p>Tanh函数关于原点对称，是一个0均值的函数，这是它较之Sigmod函数有所改进的地方。Sigmoid函数的输出具有偏移现象，即输出均为大于0的实值。而Tanh的输出则均匀地分布在y轴两侧。<strong>生物神经元的激活具有稀疏性，而Tanh函数的输出结果更趋于0，从而使人工神经网络更接近生物自然状态</strong>。</p><h2 id="ReLU激活函数"><a href="#ReLU激活函数" class="headerlink" title="ReLU激活函数"></a>ReLU激活函数</h2><p>2001年，线性分段激活函数ReLU（Rectified Linear Unit）首次被提出，伴随深度神经网络的产生而兴起，其公式如下：</p><p>$$<br>f(x)&#x3D;max(0,x)<br>$$</p><p>ReLU函数的一个直观的特点就是形式简单，抑制所有小于0的输入，仅保留净激活大于0的部分。因此，当x＜0时，函数的导数为0，即ReLU在x轴右侧饱和。但与Sigmoid函数和Tanh函数同时存在左右两个饱和区的情况相比，ReLU陷入单侧饱和的概率已经大大降低。另外，ReLU也是非0均值的激活函数，但是其本身具有的稀疏激活性在一定程度上可以抵消非0均值输出带来的影响。</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923090457974.png" alt="ReLu.png"></p><p>ReLU函数近年来应用较为广泛，相对于Sigmoid和Tanh，它解决了两个函数存在的致命缺陷，即梯度弥散问题：根据图像不难看出，函数在正无穷处的梯度是一个常量，而不是像前两个函数一样为0，并且由于函数组成简单，运算速度比包含指数函数的Sigmoid以及Tanh要快很多。</p><h2 id="Leakey-ReLU激活函数"><a href="#Leakey-ReLU激活函数" class="headerlink" title="Leakey ReLU激活函数"></a>Leakey ReLU激活函数</h2><p>当ReLU的输入值为负的时候，输出始终为0，其一阶导数也始终为0，这样会导致神经元不能更新参数，也就是神经元不学习了，这种现象叫作“神经元坏死”。<br>为了解决ReLU函数这个缺点，在ReLU函数的负半区间引入一个泄漏（Leaky）值，所以称为Leaky ReLU函数，其公式如下：</p><p>$$<br>f(x)&#x3D;max(0.01x.x)<br>$$</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250923090616573.png" alt="leakrelu.png"></p><p>带泄漏修正线性单元（Leaky ReLU）函数是经典（以及广泛使用的）的ReLU激活函数的变体，该函数输出对负值输入有很小的坡度。由于导数总是不为零，这能减少静默神经元的出现，允许基于梯度的学习（虽然会很慢），解决了ReLU函数进入负区间后，导致神经元不学习的问题。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何面对产品管理涉及的利益冲突</title>
      <link href="/2025/09/22/26-%E5%A6%82%E4%BD%95%E9%9D%A2%E5%AF%B9%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%E6%B6%89%E5%8F%8A%E7%9A%84%E5%88%A9%E7%9B%8A%E5%86%B2%E7%AA%81/"/>
      <url>/2025/09/22/26-%E5%A6%82%E4%BD%95%E9%9D%A2%E5%AF%B9%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%E6%B6%89%E5%8F%8A%E7%9A%84%E5%88%A9%E7%9B%8A%E5%86%B2%E7%AA%81/</url>
      
        <content type="html"><![CDATA[<p>马克思有一句名言：</p><blockquote><p>“资本家害怕没有利润或利润太少,就像自然界害怕真空一样。一旦有适当的利润,资本就胆大起来。如果有10%的利润,它就保证到处被使用;有20%的利润,它就活跃起来;有50%的利润,它就铤而走险;为了100%的利润,它就敢践踏一切人间法律;有300%的利润,它就敢犯任何罪行,甚至冒绞死的危险。” </p></blockquote><p>由此可见，利益面前人们的贪婪。</p><h3 id="产品管理是一种改革"><a href="#产品管理是一种改革" class="headerlink" title="产品管理是一种改革"></a>产品管理是一种改革</h3><p>在公司实施产品管理本质上是一种改革，而改革的本质就是对现有利益的重现分配，那么实施产品管理改革的团队，势必会成为其他部门的众矢之的。我国在进行制度和经济的改革，国家一直在说，不仅要把改革的这块蛋糕做大，更要做好，其含义就是要处理好改革所带来的利益重新分配。其实，古往今来，无论国内外，失败的改革最终都是因为利益关系没有协调好。</p><p>而解决这个问题的常见办法有两种：妥协和打压。</p><p>如果一味地妥协，势必带来反对者肆无忌惮的索取，最后把改革的成果拱手想让。实际上这种妥协是很多产品经理都采用的办法，其本质无非是通过多付出一些自己的利益来换取反对者的支持。这绝对是无效的做法，历史上有太多这样惨痛的教训了。</p><p>这里我举一个例子吧。我认识的一个人，原来是做技术的，技术能力非常强，人也很好。转行做产品管理后，因为还是带着以前研发部的技术思维，把产品管理做成了研发管理的跟班，自己希望实施的一些产品管理措施到了研发部那里就卡住了，由于他总是妥协最后导致产品团队被并入到研发部，成了研发部负责做原型设计和写文档的人。</p><p>另一种是不停的打压。这是一种典型的想要一劳永逸的想法，改革者希望通过打压反对者的利益来减少改革的阻力。但是，人的天性是利己的，天然会想要保护自己的利益，打压能解决短期矛盾，但是长期下去会积攒更多的障碍，最终处处树敌，直到有一天形成一道无法逾越的障碍而一败涂地。</p><p>这里也举一个例子，同样是我认识的一个人，同样是做技术出身。但是，由于平常对于任何其他部门的支撑需求都采取反弹的策略，对内也采用高压策略，最好导致其他部门的投诉居高不下，自己内部的人员也纷纷提出离职，最后产品管理战略也实施不下去。</p><h3 id="产品管理中如何平衡利益"><a href="#产品管理中如何平衡利益" class="headerlink" title="产品管理中如何平衡利益"></a>产品管理中如何平衡利益</h3><p>那么，一味的妥协和不停的打压都行不通，我们到底应该怎么做？具体到产品管理上，我认为应该视情况而定，在不涉及原则（不伤筋动骨、不触碰底线）的地方可以适当妥协，以便争取支持。但是，这里要有一定的技巧，不能很容易的妥协，这样可以让反对者从心理上认为自己换取了很大的利益，有点像是买卖东西的讨价还价。而对于重要的策略和计划，要不折不扣的执行下去。因此，这里也将解决这种利益冲突的方法总结为两条：<strong>不折不扣、不偏不倚</strong>。</p><p><strong>不折不扣原则，就是要实事求是，一切以事实为依据，这也是下一个原则不偏不倚原则的基础。</strong> 对于实施的产品战略，那么涉及其他部门和个人的利益，会产生矛盾。这时候，要保持实事求是的原则，问问自己，对方提出的问题是不是真问题，是不是事实，如果是真问题，是事实，那么就接收。如果是没有根据的、完全主观的、甚至是歪曲事实而产生的矛盾，那就要各种手段、调用各种资源，坚决的打回去。按照既定的计划执行，不能有一点折扣，不能妥协。</p><p><strong>不偏不倚，是建立在不折不扣，实事求是的原则上的。</strong> 在具体的产品管理实施上，不能参杂个人感情，奖罚分明。有错误，就总结经验，该罚的就罚；做得好，也总结经验，该奖励的就奖励。</p><p>这个有时候就像打仗一样，如果战略错了，或者战略是对的，但是执行不到位，最后是要出人命的。就如同马斯克的卫星发射，出了问题，火箭就爆炸了。当然，我们做产品管理的，最终如果失败了，到不一定会有那么的损失。但是，做事上要养成这种良好的习惯。</p><p>产品部门和其他部门的利益之争，说到底是人的欲望的体现 。部门和人一样，都有表现欲和支配欲。有了功劳大家都向争，出了问题都会踢皮球，这就是表现欲。谁对公司的业务过程起核心作用，业务部门说是自己的客户机会，研发部门说是自己的技术出色，于是利益纷争就出现了。</p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>写下上面这篇文章，是因为昨晚遇到的一件小事。一个规模很大的公司，两个部门出现了矛盾，原因是共同服务一个重要客户，AB 两个部门既想要戴红花，由害怕担责任。我认为，这既有公司高层绩效考核制度不合理的部分，也是产品管理和业务线条常见的一种矛盾。希望 A 部门能做到不折不扣、不偏不倚，即使是中间用些小手段，也要为公司产品的长期利益考虑为好。</p>]]></content>
      
      
      <categories>
          
          <category> 管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 产品 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从黄仁勋身上看中层管理</title>
      <link href="/2025/09/22/25-%E4%BB%8E%E9%BB%84%E4%BB%81%E5%8B%8B%E8%BA%AB%E4%B8%8A%E7%9C%8B%E4%B8%AD%E5%B1%82%E7%AE%A1%E7%90%86/"/>
      <url>/2025/09/22/25-%E4%BB%8E%E9%BB%84%E4%BB%81%E5%8B%8B%E8%BA%AB%E4%B8%8A%E7%9C%8B%E4%B8%AD%E5%B1%82%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>黄仁勋，英伟达（NVIDIA）的创始人兼首席执行官，他应该是当前这个AI时代绝对的热点人物。2022年英伟达的全球员工是18975人，到2023年员工数达到了22473人。那么，作为这么大一个公司的CEO，他管理的直接下属，或者说直接向他汇报的人有多少呢？答案是50人。</p><p>2023年11月30日，黄仁勋接受了CNBC采访时，主持人问他：“听说你直接管理的人是40人？” 黄仁勋说：“不，50人”。主持人很好奇：“你可以管理这么多人吗？” 他的意思是这会很忙碌，应该越少人越好。</p><p>黄仁勋说，“CEO 的直接下属越多，公司的层级就越少。这样可以保持信息的流动性，”他还补充说这使得英伟达公司的表现更好。因为，首先这些高管应该都是领域内的顶尖人才，所以他可以放心地把事情交给他们做，他只要在业务关键的地方给出决策和建议，这些人也可以识别什么是需要他决策的。而他管理这么多直接下属的好处，还在于可以让公司更扁平化，这样信息传输的效率也就更高。</p><p>对比黄仁勋，我想说一个我身边的例子。我认识的一个公司高管，部门大概几百人吧，你知道向他汇报的有多少人吗？不超过10个，但是你知道他直接安排工作任务的多少人吗？答案几乎是部门人员的半数，因为很多事情他都是直接跨级安排。这造成的后果就是，很多人同时被安排好几件事，有自己团队领导安排的，也有这位高管安排的。为什么会这样做？因为他觉得这样效率更高，或者按照他的话说：“有些人很笨，安排的事情推不下去”。喔理解的潜台词就是，“我很聪明，他们做的事情我都不放心，只有我亲自安排的最可靠。” 后果是，整个部门都在疲于奔命，很多项目都出了问题。</p><p>原因在哪里？我分析有几个方面。首先，客观地讲我这位朋友的员工，尤其是中层干部，能力都不够，很多都是只有2～3年工作经验的人。我曾经问他为什么不招聘一些资深的人，答案是招不到。我很奇怪，按说人才市场是不缺人啊。其次，高管直接跨过中层安排工作，其实是对中层的不信任，反过来也验证了中层干部能力不足的情况。第三，我觉得就是管理风格了，管理者不愿意放手、不敢放手、不能放手实际上管理者本身的问题也很大。</p><p>上面这两个例子，我总结了几点我的想法：</p><ol><li><strong>一定要不惜成本找最合适的人</strong>：作为一个高管或者公司负责人，一定要找最合适的人。不能计较成本，不要觉得可以自己有能力把一个月薪20k的人，培养成一个年薪百万的中层。因为，一是这个过程的风险很大，有人本身学习能力的原因，二是也有很大的时间成本和试错成本，最后可能（肯定）会付出更高的代价。如果说创业初期没有那么多钱请高手，那么老板或者高管就给自己找一个助理，然后每件事都要花足够的心思，否则找一个不上不下的人，只会耽误事、浪费钱。</li><li><strong>要避免多层级汇报</strong>：就像黄仁勋的管理一样，让组织结构扁平化，加速信息的流动，提供公司运转的效率。</li><li><strong>用人不疑，疑人勿用</strong>：一旦选择了合适的人才，就放手让他去做，平时只要让对方做好汇报，及时识别风险即可。</li><li><strong>一旦出错，立即换人</strong>：经济学上有个说法叫“沉默成本”，意思是已经花出去的成本，对于沉默成本，在做出决策的时候是无需考虑的。对于人员的选用，不可能每次都选得那么合适，那么如初发现自己选人不对，就要立刻换人，不能因为已经让“他做了一段时间，现在换人前面的工作都浪费了”这种思想左右，因为那些都是沉默成本。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 黄仁勋 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>做事一定要有清晰的目标，坚持到底</title>
      <link href="/2025/09/19/24-%E5%81%9A%E4%BA%8B%E4%B8%80%E5%AE%9A%E8%A6%81%E6%9C%89%E6%B8%85%E6%99%B0%E7%9A%84%E7%9B%AE%E6%A0%87%EF%BC%8C%E5%9D%9A%E6%8C%81%E5%88%B0%E5%BA%95/"/>
      <url>/2025/09/19/24-%E5%81%9A%E4%BA%8B%E4%B8%80%E5%AE%9A%E8%A6%81%E6%9C%89%E6%B8%85%E6%99%B0%E7%9A%84%E7%9B%AE%E6%A0%87%EF%BC%8C%E5%9D%9A%E6%8C%81%E5%88%B0%E5%BA%95/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿，你好：</p><p>今天爸爸要跟你说说做事设立目标的事情。我这里说的做“事”，指的是那些相对正式一点的、或者说需要长期努力完成的事情。比如考试成绩、减肥效果、学习一个技能等等。</p><p>我们在做这类事情的时候往往要花大量的精力和时间，而精力和时间对于我们来说是最宝贵的，尤其是时间，过去了就没有了。</p><p>所以，在做一件事情的时候，一定要问自己几个问题：</p><ol><li>我做这件事是为什么？（要有明确的目的）</li><li>这件事做好了或者说做完了的标准是什么？（目标要清晰可衡量）</li></ol><p>如果上面两个问题回答后，你觉得目的明确（值得做）并且做事的结果也想清楚了（目标清晰可衡量），那么接下来的就是一鼓作气把他做完。</p><p>当然，完成这类事情（比如减肥、提供学习成绩）都是比较“辛苦”的一件事，所以要有一定的方法。爸爸觉得有以下几点你可以参考。</p><p>**首先，是要让你的目标“可触摸”，就是说一定要非常清晰。**比如，减肥。我说我要减肥10斤，这是一个目标，但是不够清晰。我们应该设置的目标是：我要在3个月内减肥10斤。这个目标才是清晰的。但是，有了清晰的目标后还不够，要对目标进行分解，比如可以把“3个月瘦10斤”，进一步分解为：每周瘦0.8斤 的一个小目标，然后为了实现小目标，可以把它分解为具体的行动，比如：每天跳绳500个+晚餐少吃或者不吃。</p><p>**其次，要给自己的目标加上“意义”。**我们都希望做完一件事有一些好处。所以，可以想想要完成的目标对自己有什么好处。比如，告诉自己减肥的好处：</p><ol><li>可以穿漂亮衣服</li><li>体育测试可以拿到好成绩</li><li>拍照更好看</li></ol><p>有了这些“意义”或者说“好处”，可以让我们更好地坚持下去。</p><p>**第三，用“小胜利”替代“大胜利”。**有时候我们要实现的目标需要花很长的时间，而且目标可能有点大。这时候要给自己一些“即时反馈”或者“即时奖励”。比如，最近你在减肥，我不知道你的大目标是什么，但是有一点你做得很好，那就是每天晚上称体重后看看自己瘦了多少，哪怕只有几十克，也是自己减肥效果的“小胜利”。</p><p><strong>第四，累了就歇一歇，接着再来</strong>。有时候一个大目标需要付出长期的努力，当初我们定的计划可能由于疲劳等原因，暂时不能坚持，那么没关系，让自己偶尔松懈一下也没关系。比如，我们想要提高数学成绩，于是定了一个计划，每天学习1小时。但是某一段时间实在是觉得这个事情很枯燥，那就中断一下，改成学习半小时，或者某个周末就不学了，休息一下。过了这个倦怠期之后，我们打起精神继续就好了。千万不要有：“一次松懈就等于全盘失败”的想法。其实这个就跟跑步一下，跑累了就歇一歇，然后举行跑。我们的目标是跑完400米或者2000米，中间歇一歇没关系的。</p><p>女儿，你妈妈昨天带你参加义工活动，说是有很多人参加，她看到大部分人都是在糊弄事，但是只有你认真地完成了要求的事情。我知道这种义工活动，对于你来说有点无聊，但是你既然参加了就实实在在地认真完成了，爸爸真为你感到骄傲。你践行了：认真做事，有始有终的好品格。</p><p>我亲爱的女儿，你非常优秀，希望你能永远快乐开心。</p><p>2025年7月8日 于望京南 公司办公室</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>用“小行动”替代“大幻想”</title>
      <link href="/2025/09/19/23-%E7%94%A8%E5%B0%8F%E8%A1%8C%E5%8A%A8%E6%9B%BF%E4%BB%A3%E5%A4%A7%E5%B9%BB%E6%83%B3/"/>
      <url>/2025/09/19/23-%E7%94%A8%E5%B0%8F%E8%A1%8C%E5%8A%A8%E6%9B%BF%E4%BB%A3%E5%A4%A7%E5%B9%BB%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿，你好：</p><p>你有没有遇到过这样的事。某个人说：“我只是没努力，如果我努力了就一定能XXX。”“我只是没参加，如果我参加了一定能赢。”等等，类似说这样的话的人，或者抱有这样想法的人，最后他们说的那些事，都没有做成。这种情况很普遍，在心理学上讲是一种“自我保护防御机制”。它的核心逻辑是：通过强调“未付出努力”来维护“自己能力足够强”的积极自我认知，本质上是为了避免“可能失败”或者“能力不足”而损害自尊心。</p><p>比如有人期末挂科，却说 “我只是没复习，真复习了肯定能过”；看到同学考研上岸，随口说 “我要是考，清北都没问题，就是不想考”。其实背后的逻辑在于，用 “没付出努力” 掩盖 “可能基础差、学习能力不足” 或 “害怕考不上丢面子” 的现实。因为从未真正投入复习或备考，“我能行” 的假设永远不会被戳破，从而维持 “我智商在线，只是不屑于努力” 的自我认知。又比如，看到别人健身练出好身材，说 “我只是没时间，真练起来，马甲线一个月就能练出来”；朋友减肥成功，却说 “我要是少吃点，一周就能瘦 10 斤，只是不想委屈自己”。其实背后的逻辑是，高估 “短期努力” 的效果，低估 “长期坚持” 的难度。比如忽略健身需要科学方法（动作标准、饮食搭配），减肥需要打破身体代谢惯性（不是 “少吃” 就能简单实现），用 “我能轻松做到” 的幻想，掩盖 “害怕付出汗水、无法坚持” 的惰性。</p><p>人天生有维护“自我良好形象”的需求。所以，当我们面对“未达成的目标”或者“不敢尝试”的情况时，就会用“我只是没有努力”和“我要是做了肯定行”来掩盖担心失败和自己能力不足。</p><p>其实，人的能力是有边界的，并不是什么事情都可以做成。失败也不可怕，爸爸以前给你也写过，我们之所以努力是为了增加事情成功的概率。所以，与其担心失败，还不如先把事情做起来。</p><p>爸爸想给你的一个建议是：用“小行动”替代“大幻想”。通过具体、可落地的微小行为，打破 “我要是做了就一定行” 的空想循环，用真实的体验和反馈替代虚无的自我安慰，最终建立基于现实的自信。这种方式的关键在于：不追求 “一步到位”，而是聚焦 “立刻能做的小事”，让行动本身成为检验能力、暴露问题、积累经验的载体 —— 哪怕结果不完美，也能让人更清醒地认识自己，避免陷入 “自我欺骗” 的陷阱。</p><p>比如，假设你要考雅思。也许你的“大幻想”是“我要是认真学，雅思肯定能得高分，只是不想考。”那我们不如用“小行动”来代替：不纠结 “要不要考雅思”，而是花 1 小时做一套模拟真题（比如英语阅读），不查词典、不看答案，限时完成后对照解析打分。最后的效果是：可能会发现 “原来长难句根本读不懂”“选项陷阱完全没识别”，这会击碎 “我随便考考就能上” 的幻想，但也能明确 “需要从语法补起”“要练解题技巧” 等具体方向。后续若真决定考雅思，就能从实际短板出发备考；若放弃，也会明白 “不是不想考，而是确实需要付出大量努力”，避免用 “不屑考” 自我美化。</p><p>总之，我们应该让 “行动” 成为镜子，照见真实的自己 —— 无论是优点还是不足。空想的 “我能行” 像泡沫，一触即破；而小行动积累的 “我做到了” 像砖石，能真正搭建起自信的地基。哪怕小行动的结果不完美，至少让人远离 “眼高手低” 的陷阱，活得更清醒、更踏实。</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>选择没有绝对的答案，最后都是价值的衡量</title>
      <link href="/2025/09/19/22-%E9%80%89%E6%8B%A9%E6%B2%A1%E6%9C%89%E7%BB%9D%E5%AF%B9%E7%9A%84%E7%AD%94%E6%A1%88%EF%BC%8C%E6%9C%80%E5%90%8E%E9%83%BD%E6%98%AF%E4%BB%B7%E5%80%BC%E7%9A%84%E8%A1%A1%E9%87%8F/"/>
      <url>/2025/09/19/22-%E9%80%89%E6%8B%A9%E6%B2%A1%E6%9C%89%E7%BB%9D%E5%AF%B9%E7%9A%84%E7%AD%94%E6%A1%88%EF%BC%8C%E6%9C%80%E5%90%8E%E9%83%BD%E6%98%AF%E4%BB%B7%E5%80%BC%E7%9A%84%E8%A1%A1%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<p>女儿，你好：</p><p>今天是2025年6月14日，周六，外面下着雨。</p><p>今天上午你去上美术课，我接你回来的时候问了你一个问题：“假如给你一个亿或者是考上清华大学，你选择哪个？” 。你毫不犹豫地选择了一个亿，你说这种情况下当然是选一个亿了，考上清华也不一定能挣到一个亿，而且如果有一个亿可以做很多事，也可以继续考清华啊，但是如果只是选择上清华，再赚到一个亿就没那么容易了。我觉得你的选择是对的。</p><p>我之所以问你这个问题，是因为我看到了一个抖音上的短视频，在视频里一个老师问排成队的学生，清华和一个亿他们选择哪个？结果几乎所有学生都选择上清华。我觉得有可能是人们一直受到中国某种思想所谓的“万般皆下品，唯有读书高”。其实这种想法是错误的，都有的选择应该从价值的角度来衡量，简单说就是：这事值不值？</p><p>我给你说一个真实的故事。中国有一个著名的作家叫梁晓声。他成名后有一次一个人来找他，说有一个富豪想找他写个自传，他一打听是山西的一个煤老板，很可能就是靠着某种机会赚了大钱。梁晓声一想，自己好歹是一个知名作家，怎么可以给这种“暴发户”做“枪手”呢？于是拒绝了。可是有一天那人又找上门来，说愿意出很多钱。梁晓声觉得自己也不差钱，于是还是拒绝了。此时那个人做了一件事：他不断地从自己随身携带的皮箱中拿钱出来。起初是5万（注意这个故事是90年代，5万其实很多）。梁晓声继续拒绝并表现出藐视对方，但接下来的事情就有意思了。来人只要听到梁晓声拒绝，就再次加码。于是，当加到某个数字的时候，梁晓声沉默了，他有点想要接这个活儿。</p><p>上面作家梁晓声的这个故事是他有一次接受电视采访自己说的，我相信真实性还是挺高的。我们回过头来再看看开始那个选择清华还是一个亿的故事。如果这时候问题换成：“假如给你一百万或者是考上清华大学，你选择哪个？” 我想这时候应该毫不犹豫地选择考上清华，因为此时对比的事物发生变化，从一个亿变成了一百万。</p><p>所以，现在问题变得清晰了。大部分选择没有绝对的答案，最后都是价值的衡量。梁晓声开始不接受给人代笔，到后来接受（虽然他没明说），是因为对方给了很多钱，诱惑力足够大。选择一个亿而不是考上清华，是因为一个亿的价值更大；反之选择清华而不选择一百万的原因是此时考上清华的相对价值更大。</p><p>所以，我们在作出一些关键选择的时候，要理性地衡量不同选择的代价，最后选择那个相对而言回报最大的。</p><p>今天就啰唆到这里吧。</p><p>爱你的爸爸。</p><p>2025年6月14日 于宝盛里家中</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 选择 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>拾穗集:写给我的乖乖刘一诺</title>
      <link href="/2025/09/19/21-%E6%8B%BE%E7%A9%97%E9%9B%86-%E5%86%99%E7%BB%99%E6%88%91%E7%9A%84%E4%B9%96%E4%B9%96%E5%88%98%E4%B8%80%E8%AF%BA/"/>
      <url>/2025/09/19/21-%E6%8B%BE%E7%A9%97%E9%9B%86-%E5%86%99%E7%BB%99%E6%88%91%E7%9A%84%E4%B9%96%E4%B9%96%E5%88%98%E4%B8%80%E8%AF%BA/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿，你好：</p><p>今天是2025年6月11日。今天你跟我说要写一本小说，问我怎么样，我觉得挺好啊。说到写书，我也想给你写一本书。写什么呢？我觉得，应该是包括我们平常生活中的一些趣事、爸爸看过的一些觉得挺好的书，还有我偶尔觉得一些有用的人生感悟。</p><p>我总觉得，也许多年以后把它给你看，或者我自己翻看，会是一件很有趣的事情。</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 女儿 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>成功是一种概率，我们提升自己是为了增加这种概率</title>
      <link href="/2025/09/19/20-%E6%88%90%E5%8A%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E6%A6%82%E7%8E%87%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A2%9E%E5%8A%A0%E8%BF%99%E7%A7%8D%E6%A6%82%E7%8E%87/"/>
      <url>/2025/09/19/20-%E6%88%90%E5%8A%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E6%A6%82%E7%8E%87%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A2%9E%E5%8A%A0%E8%BF%99%E7%A7%8D%E6%A6%82%E7%8E%87/</url>
      
        <content type="html"><![CDATA[<p>亲爱的女儿，你好：</p><p>今天我想跟你说一下“努力”这回事。你可能经常听老师或者爸妈跟你说：“你要努力学习，将来就一定能考一个好成绩，上好的中学、高中、大学”等等。但是，是不是努力就一定能达到这样的目标呢？其实不一定。</p><p>按理说，为了鼓励你，爸爸应该跟你说，只要努力就一定能成功。但是，这个世界是复杂的，其实没有必然的“只要…就一定…”这样的事情。你一定看到过有的同学可能平时成绩很好，学习也很努力，但是某次考试的成绩就是不好。爸爸身边也有这样的例子，某个人平时工作很认真，但是就是没有得到升职加薪，或者某个人明明没抽烟喝酒但还是生了不好的病。</p><p>那是不是，其实我们不需要努力学习，也不需要锻炼身体，更不需要戒掉不好的习惯呢？其实不是。其实，如果我们把好的学习成绩、好的工作职位、好的身体等等当作是某种“成功”，那么这种成功其实是没有必然性的。比如，某个同学的考试成绩，可能是因为正好考了一个他没有复习的知识，也可能当时他看错了答案，把C选成了D；某个人没有得到升职加薪，可能是因为他做那个工作中，有一个人无意中做了一件错事，责任虽然不在他但是影响了他；也可能那个生病的人，本身身上就有某个得病的基因，让他得了那个病，又或者，某个人虽然抽烟喝酒，但是他碰巧没有病。</p><p>你发现了吗？我上面说的事情，其中有很多“碰巧”，这个在科学里有个与之对应的名词，叫做“概率”。其实成功也好，失败也罢，其实都是某种概率，就像我们扔硬币，可能是正面也可能是反面。当然，扔硬币这个事情的概率是50%，也就是每一面出现的概率都是50%，这种叫做“独立随机事件”，就是说每一次扔硬币的结果和上一次没有什么关系，每做一次这个事情产生的结果都是随机的。</p><p>但是，上面我给你举的那些例子以及我们工作、生活、学习等中的大部分事情不是这样的“独立随机事件”，而是可以根据我们对事情施加的影响而对结果的概率产生影响。比如学习这件事，如果我们平常努力一点，尽量多地把各种知识点都学明白了，那么遇到“复习盲区”的概率就会变小，那么考出好成绩的概率就会增加。又比如身体健康这件事，如果我们平时保持好的生活习惯，健康的饮食和规律的运动和休息，就会增加健康的概率。工作也是一样，如果我们在做事情的时候尽量充分地准备，并且预先对多种可能出现的风险进行预防，那么我们工作出错的概率就会变小，成功的概率也会增加。</p><p>所以，你看，其实成功或者失败都是一种概率。我们之所以应该“努力”，就是为了增加“成功”的概率，减少“失败”的概率，最终是否能成功也许就是靠一点点“运气”。<br>对了，你觉得“运气”这个词，其实是不是就是“概率”的意思呢？</p><p>爱你的爸爸</p><p>2025年6月17日 于北京家中。</p>]]></content>
      
      
      <categories>
          
          <category> 拾穗集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 成功 </tag>
            
            <tag> 概率 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>产品化要先解决项目管理的问题</title>
      <link href="/2025/09/16/19-%E4%BA%A7%E5%93%81%E5%8C%96%E8%A6%81%E5%85%88%E8%A7%A3%E5%86%B3%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2025/09/16/19-%E4%BA%A7%E5%93%81%E5%8C%96%E8%A6%81%E5%85%88%E8%A7%A3%E5%86%B3%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>最近处理一个产品管理的事情，作为顾问我大概用三周时间大致梳理了一下现在的情况。原打算是做一个软件系统的产品化，但是经过梳理之后我发现问题可能比想象中要复杂的多。</p><p>先说一下现状吧。现在团队大部分的业务是基于一个多年的大客户的多个项目，人员大概有将近 100人，项目也很多。但是经常发现各个项目组都加班开发，人员严重不足，这造成了客户大量的投诉。我通过参与的一两个项目的需求评审发现几个问题：</p><p>需求来源于产品经理与对客户的调研，这种调研通常是几次谈话后的总结。<br>需求的评审是通过召开会议，产品经理按照事先画好的原型，跟研发人员讨论需求。<br>研发人员通常同时在多个项目上，最少有 2 个项目在身。<br>然后是研发人手不足，包括 UI、测试、实施等人手都不足。<br>最后需要产品经理跟部门的最高领导要人。<br>从上面的简单现状描述，其实反映了几个问题：</p><ol><li>缺少项目立项流程：一个项目是否要做，缺少立项流程。在立项时不仅仅是有人就可以做，还要有其他的资源安排。因此要高层决策，因为这涉及到跨部门和跨团队的资源协调。</li><li>缺少需求评审流程：现在的评审只有原型，没有用户角色划分、用例流程、需求文档，最后这些需求都在产品经理的脑子里，如果研发人员有不清楚的地方，要么向产品经理再次确认，要么就想当然的开发了。最后是否符合用户的需求完全靠运气。因此，需求内部评审完之后，要有一个客户的需求确认。</li><li>缺少项目过程监督：没有定期的项目过程汇报，需求评审会开了之后，就开始协调开发人员，然后就开干了，最后大家之盯着 deadline 交付，中间的过程没有人监督，只看结果不重视过程。又由于之前没有立项和需求确认流程，最后客户的投诉大概率是避免不了的。</li></ol><p>基于上面的情况，我认为要做以下的改进：</p><ol><li>成立产品项目管理委员会：由部门主管、产品总监、研发总监和项目经理参加。负责项目的立项审批，定期的项目过程监控。</li><li>明确项目管理制度：对于客户定制项目，每个项目都有明确的项目经理，采用项目经理负责制。这里还有两种方式，如果是强矩阵模式，那么由项目经理对人员进行考核；如果是弱矩阵模式，则由资源部门的经理对人员考核，资源部门与项目经理签订项目外包合同，定期向项目经理汇报。</li><li>明确项目分类，不同项目类型处理方式不同：要有产研项目、实施项目的区分。产研项目是公司的产品平台项目，有明确的产品基线，按照产品基线进行开发，由产品经理负责；实施项目是基于产品化平台进行客户定制，由项目经理负责。</li><li>任命产品总监和研发总监：产品总监负责管理产品团队，研发总监负责管理技术团队。后续的所有产研项目的人员安排由这两个人负责。</li><li>建立例会制度：PMO 有定期的例会，对所有的产研项目和实施项目的过程进行监控。单独的产研项目，成立专门的内部事业部，每周定期开会，反馈情况。要监控的内容包括但不限于：计划执行情况、项目风险情况、项目成本核算、客户回款情况等。</li></ol><p>产品化绝对不是一些文档和套路，一定是按照产品化的管理来做的，简单说，先改变管理方式，再根据管理方式的改变变更具体的动作。</p>]]></content>
      
      
      <categories>
          
          <category> 管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 产品 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>读书笔记《如何写出一篇好文章》</title>
      <link href="/2025/09/12/18-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8A%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E7%AF%87%E5%A5%BD%E6%96%87%E7%AB%A0%E3%80%8B/"/>
      <url>/2025/09/12/18-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8A%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E7%AF%87%E5%A5%BD%E6%96%87%E7%AB%A0%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250912114355573.png" alt="image.png"></p><p>这本书的作者是日本作家 – <strong>山口拓朗</strong>。 我大概花了3天时间读完。怎么说呢，这本书有一些日本写这类“快消品书”的通病，那就是：本身要讲的内容其实很好，因此会起一个很吸引研究的书名，然后把文章分成很多个章节，每个章节只讲一小点。由于真正要说的内容太少，因此书中会夹杂大量作者的举例。</p><p>这种书的写法到也不是完全不可取，对于喜欢step-by-step的读者，其实蛮友好的，但是如果经常阅读的人可能会觉得啰嗦。</p><p>既然读完一本书，不妨把一些有用的东西记下来。比如作者说的一些写作方法还是比较实用的。</p><p>作者强调了写作之前就要确定自己书的读者是谁。这一点很重要，虽然我们大多数人不写书，但是会经常写一些文章，最容易犯错的就是不知道自己写给谁看，或则说有的时候是读者的范围太宽泛了。我们写文章时一定要聚焦，回答自己一个问题：这篇文章（或这本书）到底是给谁看的？<br>然后就是写作的时候，把自己当做一个教师，想象读者就在面前，把自己想要说的话写出来。<br>当然本书的作者还提到了一些训练写作的技巧，比如：</p><ul><li>把平常自己观察到的事情记录下来，积累素材</li><li>给自己的写作规定一个最后截止日期，这样能逼着自己尽快写出东西来。</li><li>保持写作的习惯，比如每天写。</li><li>写作的文章要主题明确，一定要有鲜明的观点，然后找出多个论据来支撑自己的观点。</li><li>千万不要废话连篇，读者的耐心是有限的。</li><li>写作是尽量少用抽象的词，要具体化，要具体描写。这让我想起了高尔基的《在人间》，刻画人物细节非常棒。</li><li>然后是要有5W3H的原则来写作：<ul><li>When</li><li>What</li><li>Who</li><li>Where</li><li>Why</li><li>How</li><li>How many</li><li>How much</li></ul></li><li>“逻辑”与“情感”密不可分，所以，不能偏重于某一方，而要平衡两者的比重，才能写出打动人的文章来。</li><li>要学会讲故事，人们都爱挺故事，不爱听大道理。</li><li>说话要斩钉截铁，不要磨磨唧唧。</li><li>理解别人，这个世界上有不同的价值观，写的文章如果对谁都不利，那么何必写？</li></ul><p>这个基本上就是阅读这篇文章的一些感想，记录下来。</p>]]></content>
      
      
      <categories>
          
          <category> 读书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 写作 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么你想做的事情没做成？</title>
      <link href="/2025/09/11/17-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E6%83%B3%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85%E6%B2%A1%E5%81%9A%E6%88%90%EF%BC%9F/"/>
      <url>/2025/09/11/17-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E6%83%B3%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85%E6%B2%A1%E5%81%9A%E6%88%90%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>我一直思考一个问题：为什么很多人，包括我自己，有各种各样的想法，尤其想逃离现在朝九晚五的生活，但是最后一直朝九晚五到退休？然后我看到了这个知乎上的文章。这里节选两部分。第一部分是：为什么不应该上班；第二部分是：如何才能成事。</p></blockquote><h2 id="为什么不应该上班"><a href="#为什么不应该上班" class="headerlink" title="为什么不应该上班"></a>为什么不应该上班</h2><p>有人说，人就该上班。<br>操，凭什么说人就该上班？你是没办法才上班，你是走投无路了才上班的。<br>不管你是考公还是考编，还是去工厂里面打螺丝，你都是没办法，你才去的。你稍微有些办法，你会去上班吗，你这个鸡贼。<br>任何人上班都是因为穷，除非那些从政的，他们想做一番轰轰烈烈的事业。<br>工作其实也就两个岗位，第一个是当官的，第二个是经商的，其它的就不用想了，基本上没什么用，在社会中是非常没有存在感的一个群体。<br>所以说如果你正常的话，你就不会去考虑上班，上班都是没办法的事，一眼望到头的生活你愿意过吗，你肯定不愿意过。<br>如果你一辈子不上班的话，你也能够找到不上班的路子，也能发家致富的路子。<br>比如你不愿意去上班，人家说那你帮我去招工吧，你成立了一个劳务公司。<br>人家说你不愿意去上班，那你跟我一起搞拆迁吧。<br>总之就是你不上班，就有不上班的路子，你上班，就有上班的路子。<br>不上班的路子更广，因为这个群体人比较少，你稍微优秀一点，你就能够脱颖而出。你上班，面对的竞争对手都很牛，千军万马过独木桥，你要想鹤立鸡群，是非常难的事儿。<br>所以说你正常的话，你就不应该去上班。为啥你去上班了？你有车贷，你有房贷，你没有被动收入，不上班不行。<br>现在你没有车贷，没有房贷，你还会去上班吗？上个鸡脖，饿死都不上班。宁愿拾破烂都不去上班，宁愿当鸭子都不愿意去上班，甚至说宁愿当小姐都不愿意去上班。只要你不上班，你总能找到自己的出路。<br>上班永远只是权宜之计，一入侯门深似海，上班一年，掉到一个一米的坑里。上面两年，掉到一个两米的坑里。上班超过20年，直接掉进无底深渊。你说你想跳出来，可能吗？不可能的。所以说上班的时间越久，你就越不正常。别管读再多书，他都会变得非常胆小非常傻。<br>人，只有不上班了，他才会恢复元气。你刚开始不上班是不是有恐惧感？任何人刚开始都有这种恐惧感，当你克服了这种恐惧感，你才能够立起来。<br>记住一句话，不是走投无路，不是快要饿死了，就不要去上班。就算上班，也是白天跟老板干，晚上复制老板，为以后能自己单干做准备。而不是说我要跟老板学一辈子。</p><h2 id="如何才能成事"><a href="#如何才能成事" class="headerlink" title="如何才能成事"></a>如何才能成事</h2><blockquote><p>冯唐写过一本书《成事》，但是我觉得弯弯绕绕的还没有下面这段文字说的透彻。</p></blockquote><p><strong>很多人都想立起来，为什么最后没立起来？</strong><br>很简单，他没把心放在一个地方，只要咱把心放在一个地方，咱100%能立起来。<br>怎样才能把心放在一个地方？看身边的人超越了咱10倍100倍没有。<br>我们镇有个人，他邻居在上海卖保健品，每年能赚1000多万，每年回家都是开路虎来。他的邻居原本是在大学食堂打工，也不打工了，一转身去广州卖保健品了，6年多都没回家。如果他的邻居不成功，他会辞职吗？不会。<br>人只会被身边的人影响，外面的人成功了，我们没感觉，身边的人成功了，我们才有感觉。<br>父亲的同事退休了，天天做直播，卖字画，日收入2000 +，对父亲的刺激还是蛮大的。<br>父亲说，他的字画还没我好呢，买他字画的人懂个屁啊，父亲也买了直播架，开始做直播。<br>咱讲这个到底想说明个啥？你身边的人在某种程度上决定了你的命运。你身边有个人跟你住在一起，他每天都能赚10000，你能睡得着？你肯定睡不着。<br>一个人之所以进步，是他习惯性把地狱当天堂，把大灾难当做零食吃。育小之辈他喜欢逃避痛苦，不知道所有的智慧都是痛苦送给我们的。你拒绝了痛苦光临，也就拒绝了智慧敲门。<br>有个人，他的爸爸妈妈在时，每天只有300多的收入，他的爸爸妈妈不在了，没人给他兜底了，他每天的收入变成了3000多。赚钱的核心秘密是什么？没人帮兜底了，除了自己变得越来越厉害，别无选择。<br>为什么咱老立不起来，咱遇到困难了，老有别的路走。当一个人只有一条路时才能被封神。<br>有个和尚，他没钱，但去了很多地方，人家问他秘诀是啥？他说，有个要饭的碗，一直往人多的地方走。<br>要是这个和尚比较富有，或许他就走不远了。因为走时他想带着车啊，房啊，团队啊啥的往前走。<br>往前走，是一个不断舍的过程，不是一个做加法的过程，但你放眼看去，身边的人都在做加法。<br>人的能力在某种程度上也是被逼的，我从来不信什么顺其自然，把该做的事儿做了，剩下就看老天的安排这一类的话。<br>一个人竭尽全力都未必能成功，凭什么你随便玩玩你成功了？所有的成功都是被重大灾难蹂躏的结果。</p>]]></content>
      
      
      <categories>
          
          <category> 思考 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 知乎 </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>项目管理中总时差与自由时差的解析</title>
      <link href="/2025/09/09/16-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%B8%AD%E6%80%BB%E6%97%B6%E5%B7%AE%E4%B8%8E%E8%87%AA%E7%94%B1%E6%97%B6%E5%B7%AE%E7%9A%84%E8%A7%A3%E6%9E%90/"/>
      <url>/2025/09/09/16-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%B8%AD%E6%80%BB%E6%97%B6%E5%B7%AE%E4%B8%8E%E8%87%AA%E7%94%B1%E6%97%B6%E5%B7%AE%E7%9A%84%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>在项目管理中，做资源计划是必有的功课，其中“总时差”和“自由时差”是两个关键的概念，它们用来判断任务的灵活度。下面通过一个例子来说明它们的概念和用法。</p><p>假设，我们用一个“产品发布会筹备项目”，我把它分成了A～F的6个字任务，它们的依赖关系如下：</p><table><thead><tr><th>任务</th><th>前置任务</th><th>持续时长（天）</th><th>说明</th></tr></thead><tbody><tr><td>A</td><td>无</td><td>2</td><td>确定发布会主题</td></tr><tr><td>B</td><td>A</td><td>3</td><td>制定流程方案</td></tr><tr><td>C</td><td>A</td><td>4</td><td>联系场地与供应商</td></tr><tr><td>D</td><td>B</td><td>5</td><td>设计宣传物料</td></tr><tr><td>E</td><td>C</td><td>2</td><td>确认场地与供应商合同</td></tr><tr><td>F</td><td>D、E</td><td>3</td><td>最终彩排与准备</td></tr></tbody></table><p>画成箭线图就是下面这个样子：</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250909092516215.png" alt="image.png"></p><p>我们知道，项目的关键路径是任务链条中时间最长的那个，在这里是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A→B→D→F（总时长 = 2+3+5+3=13 天，为项目最短工期）</span><br></pre></td></tr></table></figure><p>而非关键路径是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非关键路径：A→C→E→F（总时长 = 2+4+2+3=11 天）</span><br></pre></td></tr></table></figure><p>项目中的总时差计算公式如下：</p><p>$$<br>总时差&#x3D;任务最晚开始时间 - 任务最早开始时间 &#x3D; 最晚完成时间 - 最早完成时间<br>$$</p><p>项目的自由时差计算公式如下：</p><p>$$<br>自由时差&#x3D;紧后任务的最早开始时间 - 本任务的最早完成时间 </p><p>$$</p><p>我们知道，关键路径上的任务的自由时差和总时差都是0，存在这两类时差的都是在非关键路径上，这里就是C和E这两个任务。</p><p>那么，根据上面的例子和计算公式，我们可以得到下面C、E两个任务的总时差和自由时差。</p><p>C最晚的完成时间是什么呢？就是E任务的最晚开始时间，也就是F任务的开始时间减去E任务本身的时间，结果是8。</p><p>$$<br>C的最晚开始时间&#x3D;F任务的开始时间-E任务本身的时间&#x3D; 10-2&#x3D;8<br>$$</p><p>C任务的最早完成时间是什么呢？就是A任务完成后，马上开始C，那么就是A任务时间（2），加上C任务的时长（4），结果是6</p><p>$$<br>C任务的最早开始时间&#x3D;A任务的时间 + C任务的时间 &#x3D; 2+4&#x3D;6<br>$$</p><p>因此，C任务的总时差：</p><p>$$<br> C任务的总时差&#x3D;C任务最晚开始时间 - C任务最早开始时间 &#x3D; 8-6&#x3D;2<br>$$</p><p>一个任务有总时差代表这个任务可以推迟执行的时间或者任务本身可以延长的时间，在这里：C 可推迟 2 天开始（从第 2 天推迟到第 4 天开始），<strong>不会影响项目总工期 13 天</strong>。  但是，这里C本身的工期如果延长2天，那么就会导致关键路径变化（有两条了）。原因是“自由时差”的限制。</p><p>因为C的自由时差是：</p><p>$$<br>C的自由时差&#x3D;C的紧后任务的最早开始时间 - C的最早完成时间&#x3D; E的最早开始时间- C的最早完成时间&#x3D;6-6&#x3D;0<br>$$</p><p>如果自由时差为0，那么C就不能延长自己的最晚完成时间。</p><p>最后，总结一下。C任务的总时差是 2 天。这意味着 C 最多只能延误 2 天，超过则会打破 “项目总工期 13 天” 的限制，关键路径发生变化了，说明项目会整体延期。C的自由时差为0，意味着 C 任务哪怕只延误 1 天，都会直接导致紧后任务 E 无法按原计划，就是说 E 也会推迟开始。</p><p>所以，作为项目经理，我们要记住2点：</p><ol><li>如果一个任务上有总时差，意味着我们在这个任务上有一些冗余的时间可以调配。这个总时差的消耗不会影响项目工期</li><li>如果一个任务上有自由时差，意味着个这个任务的可以推迟的时间，就是说，只要推迟的时间在自由时差之内就不会影响后面任务的执行。如果自由时差为0，说明这个任务如果推迟了，就会有连锁反应，造成后面的任务也推迟。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 项目管理 </tag>
            
            <tag> 总时差 </tag>
            
            <tag> 自由时差 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库关系代数中的有损分解与无损分解：概念、区别及示例</title>
      <link href="/2025/09/05/15-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E4%B8%AD%E7%9A%84%E6%9C%89%E6%8D%9F%E5%88%86%E8%A7%A3%E4%B8%8E%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E5%8C%BA%E5%88%AB%E5%8F%8A%E7%A4%BA%E4%BE%8B/"/>
      <url>/2025/09/05/15-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E4%B8%AD%E7%9A%84%E6%9C%89%E6%8D%9F%E5%88%86%E8%A7%A3%E4%B8%8E%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E5%8C%BA%E5%88%AB%E5%8F%8A%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<p>在数据库设计中，当我们对一个关系模式进行分解时，有损分解和无损分解是两个重要的概念，它们对于保持数据的完整性和一致性起着关键作用。</p><h2 id="有损分解"><a href="#有损分解" class="headerlink" title="有损分解"></a>有损分解</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>有损分解指的是在将一个关系模式 (R) 分解为多个关系模式 (R1, R2, \cdots, Rn) 的过程中，通过对这些分解后的关系进行自然连接（这是关系代数中一种常用的连接操作，它基于两个关系中相同属性名的属性值相等进行连接），无法还原出原始关系 (R) 的所有信息。也就是说，分解后会丢失部分数据信息，这种分解会损害数据的完整性。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设有一个关系模式 <code>StudentCourse</code>，包含属性 <code>学号(SID)</code>、<code>学生姓名(SName)</code>、<code>课程号(CID)</code> 和 <code>课程名称(CName)</code>，即 <code>StudentCourse(SID, SName, CID, CName)</code>。假设存在数据如下：</p><table><thead><tr><th>SID</th><th>SName</th><th>CID</th><th>CName</th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>C001</td><td>数学</td></tr><tr><td>1</td><td>张三</td><td>C002</td><td>语文</td></tr><tr><td>2</td><td>李四</td><td>C001</td><td>数学</td></tr></tbody></table><p>现在将其分解为两个关系模式：</p><ul><li><code>Student(SID, SName)</code></li><li><code>Course(CID, CName)</code></li></ul><p>分解后的 <code>Student</code> 关系：</p><table><thead><tr><th>SID</th><th>SName</th></tr></thead><tbody><tr><td>1</td><td>张三</td></tr><tr><td>2</td><td>李四</td></tr></tbody></table><p>分解后的 <code>Course</code> 关系：</p><table><thead><tr><th>CID</th><th>CName</th></tr></thead><tbody><tr><td>C001</td><td>数学</td></tr><tr><td>C002</td><td>语文</td></tr></tbody></table><p>当我们对 <code>Student</code> 和 <code>Course</code> 进行自然连接时，会得到：</p><table><thead><tr><th>SID</th><th>SName</th><th>CID</th><th>CName</th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>C001</td><td>数学</td></tr><tr><td>1</td><td>张三</td><td>C002</td><td>语文</td></tr><tr><td>2</td><td>李四</td><td>C001</td><td>数学</td></tr><tr><td>2</td><td>李四</td><td>C002</td><td>语文</td></tr></tbody></table><p>可以看到，新得到的关系中多了“2 | 李四 | C002 | 语文”这条在原始关系中不存在的数据，并且无法准确还原出原始关系中每个学生具体选修了哪些课程，这就是有损分解，丢失了学生与课程之间准确的对应信息。</p><h2 id="无损分解"><a href="#无损分解" class="headerlink" title="无损分解"></a>无损分解</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>无损分解是指将一个关系模式 (R) 分解为多个关系模式 (R1, R2, \cdots, Rn) 后，通过对这些分解后的关系进行自然连接，能够精确地还原出原始关系 (R)，不会丢失任何信息。这种分解保证了数据的完整性，是数据库设计中较为理想的分解方式。</p><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>还是以刚才的 <code>StudentCourse(SID, SName, CID, CName)</code> 关系模式为例，这次进行无损分解。</p><p>将其分解为以下三个关系模式：</p><ul><li><code>Student(SID, SName)</code></li><li><code>Course(CID, CName)</code></li><li><code>Enrollment(SID, CID)</code></li></ul><p>分解后的 <code>Student</code> 关系：</p><table><thead><tr><th>SID</th><th>SName</th></tr></thead><tbody><tr><td>1</td><td>张三</td></tr><tr><td>2</td><td>李四</td></tr></tbody></table><p>分解后的 <code>Course</code> 关系：</p><table><thead><tr><th>CID</th><th>CName</th></tr></thead><tbody><tr><td>C001</td><td>数学</td></tr><tr><td>C002</td><td>语文</td></tr></tbody></table><p>分解后的 <code>Enrollment</code> 关系：</p><table><thead><tr><th>SID</th><th>CID</th></tr></thead><tbody><tr><td>1</td><td>C001</td></tr><tr><td>1</td><td>C002</td></tr><tr><td>2</td><td>C001</td></tr></tbody></table><p>当对这三个关系进行自然连接时：</p><ul><li>首先 <code>Student</code> 和 <code>Enrollment</code> 进行自然连接，基于 <code>SID</code> 属性连接得到中间结果：</li></ul><table><thead><tr><th>SID</th><th>SName</th><th>CID</th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>C001</td></tr><tr><td>1</td><td>张三</td><td>C002</td></tr><tr><td>2</td><td>李四</td><td>C001</td></tr></tbody></table><ul><li>然后这个中间结果再与 <code>Course</code> 进行自然连接，基于 <code>CID</code> 属性连接，最终得到：</li></ul><table><thead><tr><th>SID</th><th>SName</th><th>CID</th><th>CName</th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>C001</td><td>数学</td></tr><tr><td>1</td><td>张三</td><td>C002</td><td>语文</td></tr><tr><td>2</td><td>李四</td><td>C001</td><td>数学</td></tr></tbody></table><p>可以看到，通过自然连接精确还原了原始的 <code>StudentCourse</code> 关系，没有丢失任何信息，这就是无损分解。</p><h2 id="区别总结"><a href="#区别总结" class="headerlink" title="区别总结"></a>区别总结</h2><ul><li><strong>数据还原</strong>：有损分解无法通过自然连接还原原始关系的所有信息，而无损分解能够精确还原。</li><li><strong>数据完整性</strong>：有损分解会破坏数据的完整性，导致信息丢失；无损分解则能保证数据完整性不受损害。</li><li><strong>设计影响</strong>：在数据库设计中，无损分解通常是我们追求的目标，因为它能确保在对关系模式进行分解以优化数据库结构时，数据的准确性和一致性不受影响。而有损分解一般应尽量避免，因为它可能会给数据处理和应用带来错误和不便。</li></ul><p>理解有损分解和无损分解的概念及区别，对于数据库设计师在进行关系模式分解时做出正确决策至关重要，有助于设计出高效且数据准确的数据库系统。 </p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一文搞懂数据库设计范式：1NF、2NF、3NF 和 BCNF</title>
      <link href="/2025/09/05/14-%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F%EF%BC%9A1NF%E3%80%812NF%E3%80%813NF-%E5%92%8C-BCNF/"/>
      <url>/2025/09/05/14-%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F%EF%BC%9A1NF%E3%80%812NF%E3%80%813NF-%E5%92%8C-BCNF/</url>
      
        <content type="html"><![CDATA[<p>在数据库设计的领域中，设计范式是构建高效、规范数据库的关键准则。遵循这些范式，能有效避免数据冗余、插入异常、删除异常等问题，提升数据库的性能与数据完整性。今天，咱们就来深入探讨 1NF、2NF、3NF 和 BCNF 这几种常见的数据库设计范式，并通过具体例子加深理解。</p><h2 id="第一范式（1NF）"><a href="#第一范式（1NF）" class="headerlink" title="第一范式（1NF）"></a>第一范式（1NF）</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>第一范式要求数据库表的每一列都是不可分割的原子值，即表中的每个单元格都只能包含单一的数据项，不能有重复组或嵌套结构。简单来说，就是确保每列都是最基本的数据单元。</p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>假设我们要设计一个学生信息表，初始设计可能如下：</p><table><thead><tr><th>学号</th><th>姓名</th><th>课程（重复组）</th></tr></thead><tbody><tr><td>1001</td><td>张三</td><td>[数学, 语文]</td></tr><tr><td>1002</td><td>李四</td><td>[英语, 物理]</td></tr></tbody></table><p>这个设计不符合 1NF，因为“课程”列包含了重复组。按照 1NF 的要求，应将其拆分为：</p><table><thead><tr><th>学号</th><th>姓名</th><th>课程</th></tr></thead><tbody><tr><td>1001</td><td>张三</td><td>数学</td></tr><tr><td>1001</td><td>张三</td><td>语文</td></tr><tr><td>1002</td><td>李四</td><td>英语</td></tr><tr><td>1002</td><td>李四</td><td>物理</td></tr></tbody></table><p>这样，每个单元格都只包含单一数据项，满足了 1NF。</p><h2 id="第二范式（2NF）"><a href="#第二范式（2NF）" class="headerlink" title="第二范式（2NF）"></a>第二范式（2NF）</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>在满足 1NF 的基础上，2NF 要求表中的每一个非主属性完全依赖于主键，而不能部分依赖于主键。也就是说，如果一个表有复合主键（由多个字段组成的主键），那么非主属性不能只依赖于主键中的一部分字段。</p><h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>以学生选课系统为例，假设有一个表结构如下：</p><table><thead><tr><th>学号</th><th>课程号</th><th>学生姓名</th><th>课程名称</th><th>成绩</th></tr></thead><tbody><tr><td>1001</td><td>C001</td><td>张三</td><td>数学</td><td>90</td></tr><tr><td>1002</td><td>C002</td><td>李四</td><td>英语</td><td>85</td></tr></tbody></table><p>这里主键是（学号，课程号）。“学生姓名”只依赖于“学号”，“课程名称”只依赖于“课程号”，存在部分依赖，不满足 2NF。</p><p>拆分后的设计为：</p><p><strong>学生表（Student）</strong>：</p><table><thead><tr><th>学号</th><th>学生姓名</th></tr></thead><tbody><tr><td>1001</td><td>张三</td></tr><tr><td>1002</td><td>李四</td></tr></tbody></table><p><strong>课程表（Course）</strong>：</p><table><thead><tr><th>课程号</th><th>课程名称</th></tr></thead><tbody><tr><td>C001</td><td>数学</td></tr><tr><td>C002</td><td>英语</td></tr></tbody></table><p><strong>选课表（Enrollment）</strong>：</p><table><thead><tr><th>学号</th><th>课程号</th><th>成绩</th></tr></thead><tbody><tr><td>1001</td><td>C001</td><td>90</td></tr><tr><td>1002</td><td>C002</td><td>85</td></tr></tbody></table><p>这样，每个表中的非主属性都完全依赖于主键，满足了 2NF。</p><h2 id="第三范式（3NF）"><a href="#第三范式（3NF）" class="headerlink" title="第三范式（3NF）"></a>第三范式（3NF）</h2><h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p>在满足 2NF 的基础上，3NF 要求表中的每一个非主属性既不部分依赖于主键，也不传递依赖于主键。传递依赖指的是如果存在 (A \rightarrow B) 和 (B \rightarrow C)，那么 (C) 传递依赖于 (A)。</p><h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><p>还是以学生选课系统为例，假设在“学生表（Student）”中增加“系别”和“系主任”字段，表结构如下：</p><table><thead><tr><th>学号</th><th>学生姓名</th><th>系别</th><th>系主任</th></tr></thead><tbody><tr><td>1001</td><td>张三</td><td>计算机系</td><td>王老师</td></tr><tr><td>1002</td><td>李四</td><td>数学系</td><td>李老师</td></tr></tbody></table><p>这里“系主任”通过“系别”间接依赖于“学号”，存在传递依赖，不满足 3NF。</p><p>拆分后的设计为：</p><p><strong>学生表（Student）</strong>：</p><table><thead><tr><th>学号</th><th>学生姓名</th><th>系别</th></tr></thead><tbody><tr><td>1001</td><td>张三</td><td>计算机系</td></tr><tr><td>1002</td><td>李四</td><td>数学系</td></tr></tbody></table><p><strong>系表（Department）</strong>：</p><table><thead><tr><th>系别</th><th>系主任</th></tr></thead><tbody><tr><td>计算机系</td><td>王老师</td></tr><tr><td>数学系</td><td>李老师</td></tr></tbody></table><p>此时，消除了传递依赖，满足 3NF。</p><h2 id="巴斯-科德范式（BCNF）"><a href="#巴斯-科德范式（BCNF）" class="headerlink" title="巴斯 - 科德范式（BCNF）"></a>巴斯 - 科德范式（BCNF）</h2><h3 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h3><p>BCNF 是 3NF 的增强版本，它要求每一个非平凡的函数依赖 (X \rightarrow Y)（(Y) 不属于 (X)），(X) 都必须是一个候选键。也就是说，不仅非主属性要依赖于候选键，主属性也要完全依赖于候选键。</p><h3 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h3><p>假设有一个图书借阅表，表结构如下：</p><table><thead><tr><th>借阅编号</th><th>图书编号</th><th>读者编号</th><th>借阅日期</th><th>还书日期</th><th>图书作者</th></tr></thead><tbody><tr><td>001</td><td>B001</td><td>R001</td><td>2023 - 01 - 01</td><td>2023 - 01 - 10</td><td>作者 A</td></tr><tr><td>002</td><td>B002</td><td>R002</td><td>2023 - 02 - 01</td><td>2023 - 02 - 15</td><td>作者 B</td></tr></tbody></table><p>这里候选键是（借阅编号），但存在函数依赖“图书编号 → 图书作者”，而“图书编号”不是候选键，不满足 BCNF。</p><p>拆分后的设计为：</p><p><strong>借阅表（Borrow）</strong>：</p><table><thead><tr><th>借阅编号</th><th>图书编号</th><th>读者编号</th><th>借阅日期</th><th>还书日期</th></tr></thead><tbody><tr><td>001</td><td>B001</td><td>R001</td><td>2023 - 01 - 01</td><td>2023 - 01 - 10</td></tr><tr><td>002</td><td>B002</td><td>R002</td><td>2023 - 02 - 01</td><td>2023 - 02 - 15</td></tr></tbody></table><p><strong>图书表（Book）</strong>：</p><table><thead><tr><th>图书编号</th><th>图书作者</th></tr></thead><tbody><tr><td>B001</td><td>作者 A</td></tr><tr><td>B002</td><td>作者 B</td></tr></tbody></table><p>此时，每个非平凡函数依赖的左边都是候选键，满足 BCNF。</p><p>在实际的数据库设计中，理解并遵循这些范式能让我们设计出更优化、更稳定的数据库结构，有效减少数据冗余和异常情况的发生，提升数据库的整体性能和数据管理效率。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 范式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库中的 Armstrong 定律：理解数据依赖的基石</title>
      <link href="/2025/09/05/13-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84-Armstrong-%E5%AE%9A%E5%BE%8B%EF%BC%9A%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96%E7%9A%84%E5%9F%BA%E7%9F%B3/"/>
      <url>/2025/09/05/13-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84-Armstrong-%E5%AE%9A%E5%BE%8B%EF%BC%9A%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96%E7%9A%84%E5%9F%BA%E7%9F%B3/</url>
      
        <content type="html"><![CDATA[<p>在数据库设计领域，Armstrong定律是一组用于推理和分析关系数据库中数据依赖（尤其是函数依赖）的重要规则。它由W. W. Armstrong于1974年提出，为关系数据库理论提供了坚实的逻辑基础，帮助数据库设计师确保数据库模式的正确性和高效性。</p><h2 id="1-函数依赖基础概念"><a href="#1-函数依赖基础概念" class="headerlink" title="1. 函数依赖基础概念"></a>1. 函数依赖基础概念</h2><p>在介绍Armstrong定律之前，需要先理解函数依赖的概念。假设有关系模式 (R(U))，其中 (U) 是属性集， (X) 和 (Y) 是 (U) 的子集。如果对于 (R) 的任意两个元组 (t1) 和 (t2)，只要 (t1[X] &#x3D; t2[X])，就有 (t1[Y] &#x3D; t2[Y])，那么称 (Y) 函数依赖于 (X)，记作 (X→Y)。例如，在学生信息表（包含学号、姓名、年龄等属性）中，学号唯一确定了学生的姓名和年龄，即“学号→姓名”，“学号→年龄”。</p><h2 id="2-Armstrong定律内容"><a href="#2-Armstrong定律内容" class="headerlink" title="2. Armstrong定律内容"></a>2. Armstrong定律内容</h2><h3 id="自反律（Reflexivity）"><a href="#自反律（Reflexivity）" class="headerlink" title="自反律（Reflexivity）"></a>自反律（Reflexivity）</h3><ul><li><strong>描述</strong>：若 $(Y \subseteq X \subseteq U)$ ，则 (X → Y) 成立。这意味着一组属性总是能够函数决定它的任何子集。</li><li><strong>示例</strong>：在关系模式 $(R(A, B, C))$ 中，如果有属性集 $(X &#x3D; {A, B})，(Y &#x3D; {A})$，因为 $(Y$) 是 $(X$) 的子集，所以根据自反律，$(${A, B} → ${A}$) 是必然成立的。直观理解就是，当知道 (A) 和 (B) 的值时，必然也就知道 (A) 的值。</li></ul><h3 id="增广律（Augmentation）"><a href="#增广律（Augmentation）" class="headerlink" title="增广律（Augmentation）"></a>增广律（Augmentation）</h3><ul><li><strong>描述</strong>：若 (X → Y) 成立，且 $(Z \subseteq U)$，那么 $((X \cup Z) → (Y \cup Z))$ 也成立。即在函数依赖的两边同时增加相同的属性，函数依赖依然成立。</li><li><strong>示例</strong>：已知在学生选课关系模式 $(R(学号, 课程号, 成绩))$ 中，“学号 → 姓名”成立（假设姓名与学号存在一对一的函数依赖关系），若增加属性“所在班级”（记为 $(Z)$），那么“(学号, 所在班级) → (姓名, 所在班级)”也成立。这是因为学号能唯一确定姓名，当加上所在班级属性后，学号与所在班级共同依然能唯一确定姓名与所在班级。</li></ul><h3 id="传递律（Transitivity）"><a href="#传递律（Transitivity）" class="headerlink" title="传递律（Transitivity）"></a>传递律（Transitivity）</h3><ul><li><strong>描述</strong>：若 (X → Y) 和 (Y → Z) 都成立，那么 (X → Z) 也成立。它体现了函数依赖之间的传递关系。</li><li><strong>示例</strong>：在一个学校的数据库关系模式中，假设存在函数依赖“学号 → 所在系”和“所在系 → 系主任”，那么根据传递律，可以得出“学号 → 系主任”。即通过学号可以确定学生所在系，而所在系又确定了系主任，所以学号可以间接确定系主任。</li></ul><h2 id="3-由Armstrong定律导出的推论"><a href="#3-由Armstrong定律导出的推论" class="headerlink" title="3. 由Armstrong定律导出的推论"></a>3. 由Armstrong定律导出的推论</h2><h3 id="合并律（Union-Rule）"><a href="#合并律（Union-Rule）" class="headerlink" title="合并律（Union Rule）"></a>合并律（Union Rule）</h3><ul><li><strong>描述</strong>：若 (X → Y) 且 (X → Z)，则 (X → (Y \cup Z))。</li><li><strong>示例</strong>：在员工信息表关系模式 (R(员工编号, 姓名, 年龄, 部门)) 中，如果“员工编号 → 姓名”且“员工编号 → 年龄”，那么根据合并律可得“员工编号 → (姓名, 年龄)”，即员工编号可以同时确定姓名和年龄。</li></ul><h3 id="分解律（Decomposition-Rule）"><a href="#分解律（Decomposition-Rule）" class="headerlink" title="分解律（Decomposition Rule）"></a>分解律（Decomposition Rule）</h3><ul><li><strong>描述</strong>：若 $(X → (Y \cup Z))$，那么 $(X → Y)$ 且 $(X → Z)$。它是合并律的逆过程。</li><li><strong>示例</strong>：若在关系模式中有“订单编号 → (商品名称, 商品价格)”，根据分解律，可得到“订单编号 → 商品名称”以及“订单编号 → 商品价格”，即订单编号既能确定商品名称，也能确定商品价格。</li></ul><h3 id="伪传递律（Pseudo-Transitivity-Rule）"><a href="#伪传递律（Pseudo-Transitivity-Rule）" class="headerlink" title="伪传递律（Pseudo - Transitivity Rule）"></a>伪传递律（Pseudo - Transitivity Rule）</h3><ul><li><strong>描述</strong>：若 (X → Y) 且 $((Y \cup W) → Z)$，那么 $((X \cup W) → Z)$。</li><li><strong>示例</strong>：在一个涉及学生、课程和教师的关系模式中，已知“学生编号 → 所在班级”且“(所在班级, 课程名称) → 授课教师”，根据伪传递律可得“(学生编号, 课程名称) → 授课教师”。这是因为学生编号确定所在班级，而所在班级与课程名称共同确定授课教师，所以学生编号与课程名称共同能确定授课教师。</li></ul><h2 id="4-Armstrong定律的作用"><a href="#4-Armstrong定律的作用" class="headerlink" title="4. Armstrong定律的作用"></a>4. Armstrong定律的作用</h2><ul><li><strong>模式规范化</strong>：在数据库设计过程中，通过应用Armstrong定律及其推论，可以对关系模式进行规范化处理，消除数据冗余和异常，提高数据库的性能和数据完整性。例如，通过分解律和合并律，可以将复杂的关系模式分解为更简单、规范化的形式，同时保证函数依赖的正确性。</li><li><strong>依赖关系推导</strong>：帮助数据库设计师从已知的函数依赖推导出其他隐含的函数依赖，全面理解数据之间的内在联系。这对于发现数据库模式中潜在的问题以及优化数据库设计非常重要。例如，通过传递律可以发现一些间接的函数依赖关系，避免在设计中遗漏重要的约束。</li></ul><p>Armstrong定律是数据库理论中不可或缺的一部分，它为处理函数依赖提供了一套严谨的逻辑规则，无论是在数据库设计的初期分析，还是在后期的优化和维护阶段，都发挥着关键作用。理解和掌握Armstrong定律，对于设计出高效、稳定且符合业务需求的数据库系统至关重要。 </p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入理解模块内聚类型：概念、实例与 UML 图示</title>
      <link href="/2025/09/04/06-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9D%97%E5%86%85%E8%81%9A%E7%B1%BB%E5%9E%8B%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E5%AE%9E%E4%BE%8B%E4%B8%8E-UML-%E5%9B%BE%E7%A4%BA/"/>
      <url>/2025/09/04/06-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9D%97%E5%86%85%E8%81%9A%E7%B1%BB%E5%9E%8B%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E5%AE%9E%E4%BE%8B%E4%B8%8E-UML-%E5%9B%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<p>在软件开发过程中，模块的内聚类型对于系统的设计和维护至关重要。它决定了模块内部元素的紧密程度和功能相关性。以下将详细介绍各种内聚类型，并通过实例和 UML 图示来帮助理解。</p><h2 id="一、功能内聚"><a href="#一、功能内聚" class="headerlink" title="一、功能内聚"></a>一、功能内聚</h2><blockquote><p>功能内聚是指模块完成一个单一功能，各个部分协同工作，缺一不可。这意味着<strong>模块内部的所有元素都紧密围绕着实现一个具体且独立的功能</strong>。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901160849072.png" alt="image.png"></p><p>例如，在一个计算器软件中，加法运算模块就是功能内聚的。这个模块只负责将输入的两个数字相加并返回结果。模块内部的算法、数据处理等元素都只为了实现加法运算这一功能。</p><h2 id="二、顺序内聚"><a href="#二、顺序内聚" class="headerlink" title="二、顺序内聚"></a>二、顺序内聚</h2><blockquote><p>顺序内聚是指模块中的处理元素相关，而且必须顺序执行。也就是说，<strong>模块内部的操作有明确的先后顺序，前一个操作的结果是后一个操作的输入</strong>。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901160956326.png" alt="image.png"></p><p>以在线购物系统中的订单处理模块为例。订单处理流程包括接收订单、验证订单信息、扣减库存、生成支付链接等步骤。这些步骤必须按顺序执行，属于顺序内聚。</p><h2 id="三、通信内聚"><a href="#三、通信内聚" class="headerlink" title="三、通信内聚"></a>三、通信内聚</h2><blockquote><p>通信内聚是指<strong>所有处理元素集中在一个数据结构的区域上。模块内的操作主要是对特定的数据结构进行处理</strong>。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901161051591.png" alt="image.png"></p><p>在一个学生管理系统中，成绩统计模块就是通信内聚的。该模块主要对学生成绩的数据结构进行操作，例如计算平均分、最高分、最低分等操作都围绕学生成绩数据展开。</p><h2 id="四、过程内聚"><a href="#四、过程内聚" class="headerlink" title="四、过程内聚"></a>四、过程内聚</h2><blockquote><p>过程内聚是指<strong>处理元素相关，而且必须按特定的次序执行</strong>。<strong>与顺序内聚类似，但更强调处理过程的整体性</strong>。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901161247440.png" alt="image.png"></p><p>比如在一个文件处理系统中，文件上传模块就是过程内聚的。它包括选择文件、压缩文件、加密文件、上传文件等步骤，这些步骤有特定的次序且紧密相关。</p><h2 id="五、瞬时内聚（时间内聚）"><a href="#五、瞬时内聚（时间内聚）" class="headerlink" title="五、瞬时内聚（时间内聚）"></a>五、瞬时内聚（时间内聚）</h2><blockquote><p>瞬时内聚是指<strong>所包含的任务必须在同一时间间隔内执行。模块内的操作在时间上具有紧密的关联性。</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901161353817.png" alt="image.png"></p><p>在一个定时备份系统中，每天凌晨 2 点进行数据备份操作的模块就是瞬时内聚的。在凌晨 2 点这个特定时间点，系统会同时执行数据读取、压缩、存储等操作来完成备份。</p><h2 id="六、逻辑内聚"><a href="#六、逻辑内聚" class="headerlink" title="六、逻辑内聚"></a>六、逻辑内聚</h2><blockquote><p>逻辑内聚是指<strong>完成逻辑上相关的一组任务</strong>。模块内的操作在逻辑上是相关的，但可能涉及不同的数据和操作类型。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901161456695.png" alt="image.png"></p><p>在一个数据分析系统中，数据筛选模块就是逻辑内聚的。它可能包括筛选出销售额大于一定数值的数据、筛选出特定地区的数据等操作，这些操作在逻辑上都属于数据筛选范畴。</p><h2 id="七、偶然内聚（巧合内聚）"><a href="#七、偶然内聚（巧合内聚）" class="headerlink" title="七、偶然内聚（巧合内聚）"></a>七、偶然内聚（巧合内聚）</h2><blockquote><p>偶然内聚是指<strong>完成一组没有关系或松散关系的任务</strong>。这种内聚类型的模块内部元素关联性最弱。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901161545074.png" alt="image.png"></p><p>假设在一个软件中有一个杂项工具模块，它包含了计算圆面积、转换文件格式、生成随机数等操作，这些操作之间没有紧密的联系，属于偶然内聚。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>深入理解模块耦合类型：从概念到实例</title>
      <link href="/2025/09/04/05-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9D%97%E8%80%A6%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%9A%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E5%AE%9E%E4%BE%8B/"/>
      <url>/2025/09/04/05-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9D%97%E8%80%A6%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%9A%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E5%AE%9E%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<p>在软件开发过程中，模块耦合类型是一个至关重要的概念，它直接影响着软件系统的可维护性、可扩展性和可靠性。作为一个系统分析师或者架构设计师，需要深刻理解相关的概念，才能设计好系统，以下将详细介绍各种模块耦合类型及其具体示例。</p><h2 id="一、非直接耦合"><a href="#一、非直接耦合" class="headerlink" title="一、非直接耦合"></a>一、非直接耦合</h2><blockquote><p>非直接耦合是指两个模块之间没有直接关系，它们之间的联系完全是<strong>通过主模块的控制和调用</strong>来实现的。这种耦合方式使得模块之间相对独立，一个模块的变动对其他模块的影响较小。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901153801526.png" alt="image.png"></p><p>假设我们有一个电商系统，其中有一个用户模块和一个订单模块。用户模块负责用户的注册、登录和信息管理等功能，订单模块负责处理用户订单的生成、支付和发货等操作。<br>这两个模块并没有直接的交互，它们都通过主控制模块（比如系统的核心业务逻辑处理模块）来进行间接的联系。<br>例如，当用户在前端界面进行下单操作时，前端会将请求发送给主控制模块，主控制模块先调用用户模块验证用户身份，然后再调用订单模块来生成订单。用户模块和订单模块本身并不直接交互，这种设计就是非直接耦合。</p><h2 id="二、数据耦合"><a href="#二、数据耦合" class="headerlink" title="二、数据耦合"></a>二、数据耦合</h2><blockquote><p>数据耦合是指一组模块<strong>借助参数表传递简单数据</strong>。这种耦合方式在模块之间传递的数据较为简单，<strong>通常是基本的数据类型，如整数、字符串等</strong>。</p></blockquote><p> <img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901154005828.png" alt="image.png"></p><p>还是以电商系统为例，在订单模块中有一个计算订单总价的子模块和一个显示订单详情的子模块。<br>计算订单总价的子模块会根据商品价格、数量等信息计算出总价，然后将总价这个简单数据作为参数传递给显示订单详情的子模块，这样显示订单详情的子模块就可以将总价展示给用户。这里就是通过参数传递简单数据，属于数据耦合。</p><h2 id="三、标记耦合"><a href="#三、标记耦合" class="headerlink" title="三、标记耦合"></a>三、标记耦合</h2><blockquote><p>标记耦合是指一组模块<strong>通过参数表传递记录信息（数据结构）</strong>。与数据耦合不同的是，<strong>这里传递的数据是有一定结构的数据</strong>。</p></blockquote><p>  <img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901154148175.png" alt="image.png"></p><p>在一个企业资源管理（ERP）系统中，有员工管理模块和工资计算模块。<br>员工管理模块会维护员工的基本信息，这些信息以员工信息结构体（包含员工编号、姓名、入职时间等）的形式存在。<br>当工资计算模块需要计算员工工资时，员工管理模块会将员工信息结构体作为参数传递给工资计算模块。这种通过传递数据结构来实现模块间联系的方式就是标记耦合。</p><h2 id="四、控制耦合"><a href="#四、控制耦合" class="headerlink" title="四、控制耦合"></a>四、控制耦合</h2><blockquote><p>控制耦合是指模块之间<strong>传递的信息中包含用于控制模块内部逻辑的信息</strong>。也就是说，一个模块通过传递控制信息来影响另一个模块的执行逻辑。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901154352956.png" alt="image.png"></p></blockquote><p>比如：在一个自动化生产线上的控制系统中，有一个生产调度模块和一个设备控制模块。<br>生产调度模块根据生产计划决定当前需要生产哪种产品，然后将生产指令（如产品类型、生产数量等控制信息）传递给设备控制模块。<br>设备控制模块根据接收到的生产指令来控制生产设备的运行，比如选择不同的生产模具、调整生产速度等。这里生产调度模块传递给设备控制模块的生产指令就是控制信息，这种模块间的耦合就是控制耦合。</p><h2 id="五、外部耦合"><a href="#五、外部耦合" class="headerlink" title="五、外部耦合"></a>五、外部耦合</h2><blockquote><p>外部耦合是指<strong>一组模块都访问同一全局简单变量而不是同一全局数据结构</strong>，而且不是通过参数表传递该全局变量的信息。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901154559915.png" alt="image.png"></p><p>比如：考虑一个简单的多线程应用程序，有多个线程模块在运行。<br>这些线程模块都需要访问一个全局的计数器变量，用于记录系统中某个事件发生的次数。每个线程模块在执行过程中都会读取和更新这个全局计数器变量，但并没有通过参数传递这个变量，这种情况就是外部耦合。</p><h2 id="六、公共耦合"><a href="#六、公共耦合" class="headerlink" title="六、公共耦合"></a>六、公共耦合</h2><blockquote><p>公共耦合是指多个模块都访问同一个公共数据环境，公共的数据环境可以是全局数据结构、共享的通信区、内存的公共覆盖区等。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901154820574.png" alt="image.png"></p><p>比如：在一个网络聊天系统中，有多个客户端模块和一个服务器模块。所有客户端模块和服务器模块都需要访问一个公共的消息队列。客户端模块将用户发送的消息放入消息队列，服务器模块从消息队列中取出消息并进行转发。这里的消息队列就是公共数据环境，客户端模块和服务器模块之间的这种耦合就是公共耦合。</p><h2 id="七、内容耦合"><a href="#七、内容耦合" class="headerlink" title="七、内容耦合"></a>七、内容耦合</h2><blockquote><p>内容耦合是耦合程度最高的一种，包括一个模块直接访问另一个模块的内部数据；一个模块不通过正常入口转到另一个模块的内部；两个模块有一部分程序代码重叠；一个模块有多个入口等情况。这种耦合方式会使得模块之间的独立性极差，不利于软件的维护和扩展。</p></blockquote><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901155255988.png" alt="image.png"></p><p>假设我们有一个简单的图形绘制系统，其中有一个绘制圆形的模块和一个绘制矩形的模块。在绘制矩形的模块中，直接访问了绘制圆形模块中的圆心坐标数据来确定矩形的一个顶点位置。这种一个模块直接访问另一个模块内部数据的情况就是内容耦合。</p><p>了解和合理运用这些模块耦合类型，能够帮助我们在软件开发中设计出结构更加合理、维护更加方便的软件系统。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模块耦合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电商订单 12 小时自动流转：拆解 WFMS 的 6 大模块 + 5 大接口，看懂企业流程自动化的核心逻辑</title>
      <link href="/2025/09/04/04-%E7%94%B5%E5%95%86%E8%AE%A2%E5%8D%95-12-%E5%B0%8F%E6%97%B6%E8%87%AA%E5%8A%A8%E6%B5%81%E8%BD%AC%EF%BC%9A%E6%8B%86%E8%A7%A3-WFMS-%E7%9A%84-6-%E5%A4%A7%E6%A8%A1%E5%9D%97-5-%E5%A4%A7%E6%8E%A5%E5%8F%A3%EF%BC%8C%E7%9C%8B%E6%87%82%E4%BC%81%E4%B8%9A%E6%B5%81%E7%A8%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91/"/>
      <url>/2025/09/04/04-%E7%94%B5%E5%95%86%E8%AE%A2%E5%8D%95-12-%E5%B0%8F%E6%97%B6%E8%87%AA%E5%8A%A8%E6%B5%81%E8%BD%AC%EF%BC%9A%E6%8B%86%E8%A7%A3-WFMS-%E7%9A%84-6-%E5%A4%A7%E6%A8%A1%E5%9D%97-5-%E5%A4%A7%E6%8E%A5%E5%8F%A3%EF%BC%8C%E7%9C%8B%E6%87%82%E4%BC%81%E4%B8%9A%E6%B5%81%E7%A8%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<p>你有没有想过：当你在电商平台下单一台笔记本，从付款到收到快递的 12 小时里，为什么订单能精准走过 “审核→备货→出库→物流”4 个环节，还没出过错？​</p><p>其实这不是 “运气好”，而是 WFMS（工作流管理系统）在背后做 “流程操盘手”。作为帮企业搞定 “流程自动化” 的核心工具，WFMS 的工作流参考模型里，6 大模块和 5 大接口才是关键 —— 但很多人要么只知其名，要么觉得 “太技术看不懂”。​</p><p>今天，咱们不用专业术语堆料，就以 “一笔电商订单” 为例子，把 WFMS 的核心逻辑讲透。不管你是企业里负责流程优化的运营，还是想了解 “系统如何帮人省事” 的普通人，都能看懂，甚至能直接套用到自己的工作里。</p><h2 id="一、先搞懂：WFMS-的-6-大模块，是如何让订单-“自动跑”-的？"><a href="#一、先搞懂：WFMS-的-6-大模块，是如何让订单-“自动跑”-的？" class="headerlink" title="一、先搞懂：WFMS 的 6 大模块，是如何让订单 “自动跑” 的？"></a>一、先搞懂：WFMS 的 6 大模块，是如何让订单 “自动跑” 的？</h2><p>很多人觉得 WFMS 复杂，其实它的核心是 “先搭骨架，再填内容”。6 大模块就像搭建流程的 6 个核心部件，少一个都玩不转。</p><h3 id="1-工作流执行服务：订单全生命周期的-“总指挥官”"><a href="#1-工作流执行服务：订单全生命周期的-“总指挥官”" class="headerlink" title="1. 工作流执行服务：订单全生命周期的 “总指挥官”"></a>1. 工作流执行服务：订单全生命周期的 “总指挥官”</h3><blockquote><p>流程定义工具是用于<strong>创建、修改和存储工作流流程定义的软件组件</strong>，它以一种计算机可理解和处理的形式描述业务流程的结构、步骤、规则等信息 。</p></blockquote><p>在订单流程上线前，产品经理要做的第一件事，就是用 “流程定义工具” 把整个流程画出来 —— 不是随便画，而是要明确 3 个关键信息：</p><ul><li>步骤顺序：用户下单→系统审核→仓库备货→出库校验→物流对接→签收完成；​</li><li>责任到人：谁负责备货（仓库 A 区管理员老王）、谁处理异常（客服小美）；​</li><li>时间限制：备货超 2 小时自动提醒，审核超 10 分钟触发预警。</li></ul><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901144241116.png" alt="image.png"></p><p>这一步就像给订单装了 “导航”，后续不管多少笔订单，都按这个图走，不会出现 “有人不知道该做什么”“步骤跳着来” 的问题。<br>举个反例：我之前接触过一家小电商，没做流程定义，全靠人工传消息 —— 有次订单被漏审，直到用户催单才发现，最后赔了 200 元优惠券。这就是没做好 “流程定义” 的坑。</p><h3 id="2-工作流引擎：订单的-“自动调度员”，不用人盯"><a href="#2-工作流引擎：订单的-“自动调度员”，不用人盯" class="headerlink" title="2. 工作流引擎：订单的 “自动调度员”，不用人盯"></a>2. 工作流引擎：订单的 “自动调度员”，不用人盯</h3><blockquote><p>工作流引擎是工作流管理系统的核心执行模块，它负责解释和执行流程定义，创建和管理流程实例，按照流程规则推进流程的运行，为流程中的活动分配资源，并在需要时触发相关的应用程序或服务 。</p></blockquote><p>当用户小李付款后，WFMS 里最核心的 “工作流引擎” 就启动了：​</p><ul><li>它先去 “资源库”（后面会讲）里调之前画好的订单流程；​</li><li>生成一个 “专属订单实例”（相当于给这笔订单发了个 “身份证”）；​</li><li>按步骤派任务：先让系统自动审核订单（比如有没有填错地址、库存够不够），审核过了，立刻把 “备货任务” 推给老王，还附带上 “2 小时内完成” 的提醒。​</li></ul><p>整个过程不用人工干预 —— 你可以理解成，引擎就是 “看不见的调度员”，不用人盯着，就能把任务精准派到每个人头上。</p><h3 id="3-工作流客户端应用：一线员工的-“任务清单”，不用记流程"><a href="#3-工作流客户端应用：一线员工的-“任务清单”，不用记流程" class="headerlink" title="3. 工作流客户端应用：一线员工的 “任务清单”，不用记流程"></a>3. 工作流客户端应用：一线员工的 “任务清单”，不用记流程</h3><blockquote><p>工作流客户端应用是工作流管理系统与最终用户交互的接口，它为用户提供了参与工作流活动的操作界面，使用户能够接收任务、执行任务、提交任务结果以及获取与任务相关的信息等 。</p></blockquote><p>老王是怎么知道有新订单的？靠的就是 “工作流客户端应用”—— 也就是他每天打开的仓库管理 APP。​<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901144840365.png" alt="image.png"></p><p>打开 APP 后，首页直接弹出待办任务：“商品：笔记本电脑；数量：1；库位：A 区 3 排；截止时间：2 小时内”。他不用记 “下一步该做什么”，点 “开始处理”，扫码确认商品，再提交 “备货完成”，流程就自动往下走了。​</p><p>对一线员工来说，这个<strong>客户端的价值就是 “不用背流程”</strong>—— 我之前见过一家公司，让仓库员记 “先核对库存，再填出库单，再报财务”，结果新人经常漏步骤；用上客户端后，错误率直接降了 70%。</p><h3 id="4-流程监控与管理工具：运营的-“监控屏”，异常早发现"><a href="#4-流程监控与管理工具：运营的-“监控屏”，异常早发现" class="headerlink" title="4. 流程监控与管理工具：运营的 “监控屏”，异常早发现"></a>4. 流程监控与管理工具：运营的 “监控屏”，异常早发现</h3><blockquote><p>流程监控与管理工具是用于实时监控工作流流程的运行状态、分析流程性能、管理流程实例以及对流程进行优化的工具集合。它能够跟踪流程中各个活动的执行情况，收集和展示流程相关的数据，帮助管理人员及时发现流程中的问题和瓶颈 。</p></blockquote><p>运营经理张姐每天上班第一件事，就是打开 “流程监控与管理工具”—— 屏幕上能看到所有订单的进度：​</p><ul><li>正常流程的订单：显示 “备货中”“已出库” 等状态；​</li><li>异常订单：比如 3 笔订单 “审核超时”，标红提醒。​</li></ul><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901145047899.png" alt="image.png"></p><p>她点开标红的订单，发现是用户没填详细地址，立刻通过工具把任务重新派给客服，让客服联系用户补全 —— 不用等用户投诉，就能把问题解决。​</p><p>这一步的核心价值是 “不被动”：以前要等用户催单才知道流程卡了，现在实时监控，异常能早处理。</p><h3 id="5-组织模型工具：给任务-“贴标签”，不派错人​"><a href="#5-组织模型工具：给任务-“贴标签”，不派错人​" class="headerlink" title="5. 组织模型工具：给任务 “贴标签”，不派错人​"></a>5. 组织模型工具：给任务 “贴标签”，不派错人​</h3><blockquote><p>组织模型工具是工作流管理系统中用于定义和管理组织架构、人员角色、权限以及它们之间关系的组件，它为工作流流程中的任务分配和执行提供了人员和组织方面的基础支持 。</p></blockquote><p>为什么小李的订单会精准派给老王，而不是其他仓库的人？靠的是 “组织模型工具”。​</p><p>在 WFMS 里，这个工具早就定义好了企业的组织架构：​</p><ul><li>部门对应：仓库 A 区→负责家电类商品；​</li><li>人员对应：仓库 A 区→管理员老王（权限：只能处理 A 区备货，不能改订单金额）；​</li><li>角色权限：客服→能改地址，不能改商品型号。​</li></ul><p>简单说，就是给每个任务 “贴好标签”，确保 “该谁做的谁做，不该做的做不了”。我之前见过一家公司，因为没设权限，仓库员误改了订单价格，最后亏了钱 —— 这就是组织模型工具没用好的教训。</p><h3 id="6-资源库：流程的-“数据库”，数据不丢失​"><a href="#6-资源库：流程的-“数据库”，数据不丢失​" class="headerlink" title="6. 资源库：流程的 “数据库”，数据不丢失​"></a>6. 资源库：流程的 “数据库”，数据不丢失​</h3><blockquote><p>资源库在工作流管理系统中扮演着存储和管理与流程相关的各种信息资源的角色，包括流程定义文档、流程实例数据、组织模型信息、用户信息、应用程序相关数据以及流程运行过程中产生的历史数据等 。</p></blockquote><p>小李的订单信息（地址、商品型号）、流程定义图、老王的操作记录，最后都存在 “资源库” 里。​</p><p>比如物流环节需要核对订单信息，直接从资源库调；订单完成后，这些数据存档，后续用户查单、财务对账，都能随时调出来。​</p><p>资源库的作用就像 “保险柜”—— 把流程相关的所有数据存好，不丢失、不混乱。对企业来说，这不仅是 “方便查”，更是合规要求（比如电商要保存订单数据 3 年以上）。​</p><h2 id="二、再打通：5-大接口，解决-“系统孤岛”-问题​"><a href="#二、再打通：5-大接口，解决-“系统孤岛”-问题​" class="headerlink" title="二、再打通：5 大接口，解决 “系统孤岛” 问题​"></a>二、再打通：5 大接口，解决 “系统孤岛” 问题​</h2><p>光有模块还不够 —— 企业里还有支付系统、物流系统、企业微信这些工具，WFMS 要和它们打通，靠的就是 5 大接口。​</p><h3 id="1-流程定义接口：一次设计，多端复用，省时间​"><a href="#1-流程定义接口：一次设计，多端复用，省时间​" class="headerlink" title="1. 流程定义接口：一次设计，多端复用，省时间​"></a>1. 流程定义接口：一次设计，多端复用，省时间​</h3><blockquote><p>流程定义接口是工作流管理系统与外部流程设计工具或其他系统进行流程定义交互的通道，它允许将在外部创建的流程定义导入到工作流管理系统中，也支持将工作流管理系统中的流程定义导出或共享给其他相关系统 。</p></blockquote><p>产品经理最初画订单流程时，用的是专业的流程建模软件（比如 Visio），画好后，通过 “流程定义接口” 直接导入 WFMS—— 不用在 WFMS 里重新画一遍，省了 2 天时间。​</p><p>后来平台新增 “家电类订单需二次质检” 的规则，产品经理在建模软件里改好，再通过接口同步到 WFMS，10 分钟就完成了更新。​</p><p>这个接口的价值就是 “不重复劳动”：很多企业以前改流程，要在多个系统里改，容易出错；现在一次设计，多端复用，效率高还不容易错。​</p><h3 id="2-工作流客户端应用接口：提醒-“追着人跑”，不遗漏​"><a href="#2-工作流客户端应用接口：提醒-“追着人跑”，不遗漏​" class="headerlink" title="2. 工作流客户端应用接口：提醒 “追着人跑”，不遗漏​"></a>2. 工作流客户端应用接口：提醒 “追着人跑”，不遗漏​</h3><blockquote><p>工作流客户端应用接口用于实现工作流管理系统与各种客户端应用（如企业即时通讯工具、移动 APP 等）之间的集成和交互，使得工作流相关的任务提醒、操作功能等能够无缝地推送到用户常用的客户端环境中 。</p></blockquote><p>老王在仓库理货时，没看仓库 APP，为什么还能收到新订单提醒？因为 “工作流客户端应用接口” 把 WFMS 和企业微信打通了。​</p><p>有新任务时，接口会自动把提醒推到老王的企业微信：“有 1 笔笔记本订单需备货，截止 2 小时内”。他点提醒就能跳转到仓库 APP 处理，不用频繁刷 APP。​</p><p>对员工来说，这个接口解决了 “漏看任务” 的问题 —— 我之前问过老王，没打通企业微信时，他每天要刷 5 次 APP 看有没有新任务；现在不用刷，提醒直接来，效率高了不少。​</p><h3 id="3-应用程序调用接口：数据同步，流程自动触发​"><a href="#3-应用程序调用接口：数据同步，流程自动触发​" class="headerlink" title="3. 应用程序调用接口：数据同步，流程自动触发​"></a>3. 应用程序调用接口：数据同步，流程自动触发​</h3><blockquote><p>应用程序调用接口是工作流管理系统与其他应用系统进行数据交互和功能调用的接口，通过该接口，工作流管理系统能够在流程执行过程中触发其他应用程序的功能，实现数据的共享和业务逻辑的协同，同时也能接收来自其他应用系统的数据和事件反馈 。</p></blockquote><p>小李付款后，为什么 WFMS 会立刻启动流程？因为 “应用程序调用接口” 把支付系统和 WFMS 连起来了。​</p><p>支付成功的瞬间，支付系统通过这个接口 “告诉” WFMS：“订单已付款，编号 XXX”，WFMS 就自动启动订单流程 —— 不用人工手动录入订单、点 “启动流程”，完全自动化。​</p><p>这个接口是 “流程自动化的关键”：如果没有它，每天几千笔订单，需要专人录入启动，不仅慢，还容易错。​</p><h3 id="4-工作流引擎互操作接口：跨系统协同，不用人工传数据​"><a href="#4-工作流引擎互操作接口：跨系统协同，不用人工传数据​" class="headerlink" title="4. 工作流引擎互操作接口：跨系统协同，不用人工传数据​"></a>4. 工作流引擎互操作接口：跨系统协同，不用人工传数据​</h3><blockquote><p>工作流引擎互操作接口是用于实现不同工作流引擎之间相互通信和协作的接口规范，它使得基于不同工作流引擎构建的系统能够在流程层面进行交互、共享流程实例信息、协同推进流程执行，从而打破不同工作流系统之间的壁垒 。</p></blockquote><p>小李的订单要对接顺丰物流，而顺丰用的是自己的工作流系统 —— 两个系统怎么协同？靠的是 “工作流引擎互操作接口”。​</p><p>WFMS 通过这个接口，把 “订单出库信息” 传给顺丰的系统；顺丰生成物流单号后，再通过接口把单号回传给 WFMS—— 不用仓库员在两个系统间复制粘贴数据，全程自动。​</p><p>这个接口解决了 “跨系统不通” 的痛点：很多企业对接第三方系统（比如物流、支付）时，靠人工传数据，每天花 1 小时不说，还容易录错单号；用上接口后，这些工作全省了。​</p><h3 id="5-系统管理与监控接口：运维的-“工具箱”，保障系统稳定​"><a href="#5-系统管理与监控接口：运维的-“工具箱”，保障系统稳定​" class="headerlink" title="5. 系统管理与监控接口：运维的 “工具箱”，保障系统稳定​"></a>5. 系统管理与监控接口：运维的 “工具箱”，保障系统稳定​</h3><blockquote><p>系统管理与监控接口为工作流管理系统的运维人员提供了对系统进行管理、监控和维护的途径，通过该接口可以获取系统的运行状态信息、性能指标，执行系统配置、故障诊断、数据备份与恢复等管理操作 。</p></blockquote><p>运维工程师小陈每天要做的，就是通过 “系统管理与监控接口” 查看 WFMS 的状态：​</p><ul><li><p>性能数据：CPU 使用率、内存占用、接口响应速度；​</p></li><li><p>异常报警：比如 “资源库读取速度变慢”。​</p></li></ul><p>有次他发现资源库读取慢，立刻通过接口调整数据库参数，10 分钟就恢复了 —— 如果没这个接口，要等到订单处理卡顿，用户投诉，才会发现问题，影响就大了。</p><h2 id="三、最后：普通人该如何理解-WFMS？3-个实用视角​"><a href="#三、最后：普通人该如何理解-WFMS？3-个实用视角​" class="headerlink" title="三、最后：普通人该如何理解 WFMS？3 个实用视角​"></a>三、最后：普通人该如何理解 WFMS？3 个实用视角​</h2><p>讲完模块和接口，可能有人会问：我不是做技术的，也不是做运营的，了解 WFMS 有什么用？其实可以从 3 个视角看：​</p><h3 id="1-对企业：WFMS-不是-“奢侈品”，是-“效率刚需”​"><a href="#1-对企业：WFMS-不是-“奢侈品”，是-“效率刚需”​" class="headerlink" title="1. 对企业：WFMS 不是 “奢侈品”，是 “效率刚需”​"></a>1. 对企业：WFMS 不是 “奢侈品”，是 “效率刚需”​</h3><p>很多中小企业觉得 “WFMS 太贵，没必要”，但实际上：​</p><ul><li>能省人工：以前要 3 个人盯订单流程，现在 1 个人管监控就行；​</li><li>能降错误：人工传数据容易错，系统自动化后错误率大降；​</li><li>能快响应：用户有问题，能快速定位流程节点，不用查半天。​</li></ul><p>我接触过一家 50 人规模的电商，用上 WFMS 后，订单处理效率提了 40%，客服投诉降了 60%—— 算下来，半年就收回了系统成本。​</p><h3 id="2-对职场人：懂-WFMS，能帮你解决-“流程痛点”​"><a href="#2-对职场人：懂-WFMS，能帮你解决-“流程痛点”​" class="headerlink" title="2. 对职场人：懂 WFMS，能帮你解决 “流程痛点”​"></a>2. 对职场人：懂 WFMS，能帮你解决 “流程痛点”​</h3><p>如果你在工作中遇到 “流程混乱”“总漏步骤”“异常难发现” 的问题，其实可以想想：​</p><ul><li>是不是没做好 “流程定义”？​</li><li>是不是缺了 “监控工具”？​</li></ul><p>比如你是行政，负责报销流程，总有人漏填发票信息 —— 其实可以建议公司用 WFMS 的 “流程定义工具”，把 “填发票信息” 设为必填步骤，没填就提交不了，问题就解决了。​</p><h3 id="3-对用户：知道-“背后有系统”，能更理性维权​"><a href="#3-对用户：知道-“背后有系统”，能更理性维权​" class="headerlink" title="3. 对用户：知道 “背后有系统”，能更理性维权​"></a>3. 对用户：知道 “背后有系统”，能更理性维权​</h3><p>比如你下单后，订单一直显示 “备货中”，可以先联系客服，让他们查 WFMS 的 “流程监控工具”，看看是卡在仓库备货，还是物流对接 —— 不用只说 “我的订单怎么还没发”，能更精准地解决问题。​</p><p>其实 WFMS 没那么 “高大上”，它的核心就是 “让流程自动化，让少出错，让人人省事”。下次你在电商下单，或者在公司走审批流程时，不妨想想：这背后，是不是也有 WFMS 在默默工作？​</p><p>如果你的公司正在考虑做流程自动化，或者你在工作中遇到了流程痛点，欢迎在评论区聊聊，我们可以一起分析怎么用 WFMS 解决～</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工作流 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12 软件工程中需求获取手段全解析</title>
      <link href="/2025/09/04/12-%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B8%AD%E9%9C%80%E6%B1%82%E8%8E%B7%E5%8F%96%E6%89%8B%E6%AE%B5%E5%85%A8%E8%A7%A3%E6%9E%90/"/>
      <url>/2025/09/04/12-%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B8%AD%E9%9C%80%E6%B1%82%E8%8E%B7%E5%8F%96%E6%89%8B%E6%AE%B5%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>在软件工程领域，需求获取是项目成功的关键起点，它旨在准确收集和理解用户对软件系统的期望与要求。以下将详细介绍用户访谈、问卷调查、采样技术、情节串联板、联合需求计划（JRP）这五种常见的需求获取手段。</p><h2 id="一、用户访谈"><a href="#一、用户访谈" class="headerlink" title="一、用户访谈"></a>一、用户访谈</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>用户访谈是需求获取人员与用户直接进行面对面交流，通过提问、倾听和互动，深入了解用户的业务流程、工作需求、期望以及痛点等信息的一种需求获取方法。它能建立起需求获取者与用户之间的直接沟通桥梁，获取丰富且详细的一手资料。</p><h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>新系统开发</strong>：当开发全新的软件系统，对业务领域不熟悉时，通过与不同层次、不同岗位的用户进行访谈，全面了解业务全貌。</li><li><strong>复杂业务流程梳理</strong>：对于业务流程复杂、涉及多个环节和角色的项目，访谈能深入挖掘各环节的细节和相互关系。</li><li><strong>个性化需求挖掘</strong>：如果软件需要满足特定用户群体或个体的特殊需求，访谈可针对性地获取这些个性化信息。</li></ul><h3 id="实施步骤"><a href="#实施步骤" class="headerlink" title="实施步骤"></a>实施步骤</h3><ol><li><strong>准备阶段</strong>：明确访谈目标，确定访谈对象（如业务专家、一线操作人员、管理人员等），设计详细的访谈提纲，涵盖业务流程、工作目标、现有问题、期望功能等方面的问题。同时，预约访谈时间和地点，确保访谈环境安静、不受干扰。</li><li><strong>进行阶段</strong>：开场时，简要介绍访谈目的和流程，营造轻松友好的氛围。按照提纲有序提问，鼓励用户充分表达观点，注意倾听用户的回答，不轻易打断，对于模糊或不清楚的回答，及时进行追问和确认。可以使用录音或记录关键信息的方式，确保信息准确完整。</li><li><strong>总结阶段</strong>：访谈结束前，向用户总结本次访谈获取的关键信息，确认是否准确。感谢用户的参与，并告知用户后续可能还会有进一步的沟通。</li></ol><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>假设要开发一款医院的电子病历管理系统。需求获取人员与医生、护士、病案管理人员进行访谈。与医生访谈时，询问日常病历书写流程、所需记录的信息项、对病历检索和调阅的需求等；与护士访谈，了解护理记录的内容和频率、与医生病历信息的交互需求；与病案管理人员访谈，了解病历归档、存储和统计的工作要求。通过这些访谈，全面了解电子病历管理系统的需求。</p><h3 id="遵循原则"><a href="#遵循原则" class="headerlink" title="遵循原则"></a>遵循原则</h3><ul><li><strong>中立原则</strong>：访谈者保持中立态度，不引导用户回答特定答案，确保获取的信息真实客观。</li><li><strong>积极倾听原则</strong>：专注倾听用户表达，理解其背后的真实意图，给予用户充分的表达机会。</li><li><strong>清晰原则</strong>：提问清晰明确，避免使用专业术语或模糊不清的表述，确保用户能够准确理解问题。</li></ul><h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li><strong>优点</strong>：能获取深入、详细且个性化的信息；可以根据用户回答灵活调整问题，进一步挖掘需求；通过面对面交流，建立良好的沟通关系，增加用户对项目的参与感。</li><li><strong>缺点</strong>：耗费时间和人力成本较高，尤其是涉及多个用户时；访谈结果可能受访谈者个人偏见、表达能力以及用户主观因素影响，导致信息不准确或不完整；访谈信息整理和分析工作量较大。</li></ul><h2 id="二、问卷调查"><a href="#二、问卷调查" class="headerlink" title="二、问卷调查"></a>二、问卷调查</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>问卷调查是通过设计一系列书面问题，向大量潜在用户或相关人员发放问卷，收集他们对软件系统的看法、需求、期望等信息的一种需求获取方式。它能在相对短的时间内，广泛收集不同群体的反馈。</p><h3 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>大范围用户调研</strong>：当需要了解众多用户的普遍需求、意见或行为模式时，如面向大众的互联网产品。</li><li><strong>统计性数据收集</strong>：对于一些需要进行量化分析的数据，如用户使用频率、满意度评分等，问卷调查能高效收集大量样本数据。</li><li><strong>初步需求筛选</strong>：在项目初期，对众多可能的需求进行初步筛选和优先级排序，确定重点关注方向。</li></ul><h3 id="实施步骤-1"><a href="#实施步骤-1" class="headerlink" title="实施步骤"></a>实施步骤</h3><ol><li><strong>问卷设计</strong>：明确问卷目的，根据目标受众和需求设计问题。问题应简洁明了、易于回答，包括选择题、简答题、量表题等多种题型。确保问卷逻辑清晰，先易后难，避免诱导性问题。设计完成后，进行小范围预测试，检查问卷的合理性和有效性，根据反馈进行修改。</li><li><strong>问卷发放</strong>：选择合适的发放渠道，如在线问卷平台（问卷星等）、电子邮件、现场发放等。确定发放对象范围，确保涵盖相关的各类用户群体。设定问卷回收期限，鼓励用户及时填写。</li><li><strong>数据整理与分析</strong>：回收问卷后，对数据进行整理，剔除无效问卷（如回答不完整、明显随意作答等）。运用统计学方法对选择题、量表题等量化数据进行分析，对简答题进行分类归纳，提取关键信息。根据分析结果总结用户需求和反馈。</li></ol><h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>要开发一款手机运动健身APP，通过在线问卷向运动爱好者、健身教练等群体发放问卷。问卷中设置问题如“您每周运动的频率是？”“您常用的运动健身方式有哪些？”“您希望APP具备哪些功能（如运动记录、训练计划制定、饮食建议等）”等。通过对大量问卷数据的分析，了解用户对运动健身APP的需求偏好。</p><h3 id="遵循原则-1"><a href="#遵循原则-1" class="headerlink" title="遵循原则"></a>遵循原则</h3><ul><li><strong>目标明确原则</strong>：每个问题都应围绕问卷目的设计，避免无关问题。</li><li><strong>简洁性原则</strong>：问题表述简洁易懂，避免复杂句式和专业术语，尽量减少用户填写时间。</li><li><strong>可靠性原则</strong>：确保问题设计合理，能准确获取所需信息，避免模糊或歧义性问题影响数据可靠性。</li></ul><h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li><strong>优点</strong>：可快速收集大量样本数据，覆盖范围广，成本相对较低；数据易于统计分析，能发现普遍存在的需求和问题；问卷可标准化设计，保证每个用户回答的一致性，便于比较分析。</li><li><strong>缺点</strong>：问题相对固定，难以深入挖掘用户深层次的需求和潜在想法；用户可能因对问题理解偏差、缺乏耐心等原因，导致回答不准确或不完整；无法实时澄清用户的疑问，对于开放式问题的回答质量可能参差不齐，增加分析难度。</li></ul><h2 id="三、采样技术"><a href="#三、采样技术" class="headerlink" title="三、采样技术"></a>三、采样技术</h2><h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p>采样技术是从总体用户或数据中选取一部分有代表性的样本进行研究，通过对样本的分析来推断总体的需求特征。它基于统计学原理，在保证一定准确性的前提下，减少数据收集和分析的工作量。</p><h3 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>总体规模庞大</strong>：当用户群体数量巨大，无法对所有用户进行全面调研时，通过采样选取有代表性的样本进行研究。</li><li><strong>资源有限</strong>：在时间、人力、资金等资源有限的情况下，采样技术能以较小的成本获取关于总体需求的大致信息。</li><li><strong>快速获取初步需求</strong>：在项目初期需要快速了解需求概况，为后续深入调研提供方向时，采样可快速提供一个近似的需求轮廓。</li></ul><h3 id="实施步骤-2"><a href="#实施步骤-2" class="headerlink" title="实施步骤"></a>实施步骤</h3><ol><li><strong>定义总体</strong>：明确需要研究的用户或数据的总体范围，例如某电商平台的所有注册用户、某企业内部所有使用特定办公软件的员工等。</li><li><strong>选择采样方法</strong>：<ul><li><strong>随机采样</strong>：从总体中随机抽取样本，每个个体被选中的概率相等。例如使用随机数生成器选取电商平台注册用户的ID作为样本。</li><li><strong>分层采样</strong>：将总体按照某些特征（如年龄、性别、职业等）分成不同层次，然后从每个层次中独立进行随机采样。如将电商平台用户按年龄分为青年、中年、老年三层，分别从各层中抽取一定数量用户。</li><li><strong>系统采样</strong>：按照一定的抽样距离从总体中抽取样本。例如每隔100个电商平台用户抽取一个作为样本。</li></ul></li><li><strong>确定样本大小</strong>：根据总体规模、可接受的误差范围和置信水平，运用统计学公式计算合适的样本大小。一般来说，总体规模越大、可接受误差越小、置信水平越高，所需样本量越大。</li><li><strong>收集样本数据</strong>：通过用户访谈、问卷调查等方式对选取的样本进行数据收集。</li><li><strong>分析样本并推断总体</strong>：对样本数据进行分析，根据样本特征推断总体的需求特征，如计算样本中用户对某功能的需求比例，以此估计总体中对该功能有需求的用户比例。</li></ol><h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><p>某大型连锁超市要开发一款会员管理系统，其会员数量达数十万。采用分层采样技术，按会员消费金额将会员分为高、中、低消费层，从每层中随机抽取一定数量会员进行访谈和问卷调查，了解他们对会员积分、优惠活动、会员专属服务等方面的需求，进而推断全体会员对会员管理系统的需求。</p><h3 id="遵循原则-2"><a href="#遵循原则-2" class="headerlink" title="遵循原则"></a>遵循原则</h3><ul><li><strong>代表性原则</strong>：选取的样本要能准确代表总体的特征，确保样本与总体在关键属性上分布相似。</li><li><strong>随机性原则</strong>：在采样过程中尽量保证随机性，避免人为偏见对样本选取的影响。</li><li><strong>适度性原则</strong>：样本大小要适中，既不能过大造成资源浪费，也不能过小导致结果不准确。</li></ul><h3 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li><strong>优点</strong>：在资源有限的情况下，能快速、高效地获取总体需求信息，成本较低；基于统计学原理，具有一定的科学性和可靠性；通过合理的采样方法，可以较好地反映总体特征。</li><li><strong>缺点</strong>：如果采样方法不当或样本量过小，可能导致样本不具有代表性，从而使推断结果与实际总体需求偏差较大；对采样人员的统计学知识要求较高，操作不当容易出现误差；无法像全面调研那样获取关于总体的所有细节信息。</li></ul><h2 id="四、情节串联板"><a href="#四、情节串联板" class="headerlink" title="四、情节串联板"></a>四、情节串联板</h2><h3 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h3><p>情节串联板是一种以图形化、故事化的方式展示软件系统使用场景和流程的需求获取方法。它通过一系列连续的画面或场景，描述用户与软件系统在特定情境下的交互过程，帮助需求获取人员和用户直观地理解系统功能和业务流程。</p><h3 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>需求可视化</strong>：当需求较为抽象，难以用文字清晰表述时，通过情节串联板将需求以可视化形式呈现，便于用户和开发团队理解。</li><li><strong>用户体验设计</strong>：在关注用户与系统交互体验的项目中，情节串联板可用于设计和优化用户操作流程，发现潜在的用户体验问题。</li><li><strong>团队沟通协作</strong>：作为一种直观的沟通工具，促进需求获取人员、开发人员、设计人员以及用户之间的沟通与协作，确保各方对需求的理解一致。</li></ul><h3 id="实施步骤-3"><a href="#实施步骤-3" class="headerlink" title="实施步骤"></a>实施步骤</h3><ol><li><strong>确定主题和范围</strong>：明确要描述的软件功能或业务场景，例如电商平台的商品购买流程、在线教育平台的课程学习过程等。</li><li><strong>收集素材</strong>：与用户沟通，了解他们在实际使用场景中的操作步骤、决策点、可能遇到的问题等信息。收集相关的界面设计草图、业务流程图等素材，为绘制情节串联板做准备。</li><li><strong>绘制情节串联板</strong>：使用纸笔、白板、绘图软件（如Axure、Visio等）绘制一系列画面，每个画面展示一个关键的交互步骤或场景。在画面中添加文字说明，描述用户的操作、系统的响应以及相关的业务规则。按照业务流程的先后顺序排列画面，形成一个连贯的故事。</li><li><strong>评审与修改</strong>：邀请用户、开发团队等相关人员对情节串联板进行评审，收集反馈意见。根据反馈对情节串联板进行修改和完善，确保其准确反映用户需求和业务流程。</li></ol><h3 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h3><p>为开发一款在线点餐APP，绘制情节串联板展示点餐流程。第一幅画面展示用户打开APP后的餐厅列表界面，文字说明“用户打开APP，浏览附近餐厅列表”；第二幅画面是用户点击进入某餐厅详情页，展示菜品图片和介绍，文字说明“用户点击餐厅，查看菜品信息”；接着是用户选择菜品加入购物车、确认订单、支付等画面，详细描绘每个步骤中用户与APP的交互过程。</p><h3 id="遵循原则-3"><a href="#遵循原则-3" class="headerlink" title="遵循原则"></a>遵循原则</h3><ul><li><strong>真实性原则</strong>：情节串联板应基于真实的用户使用场景和业务流程，避免虚构或脱离实际。</li><li><strong>简洁性原则</strong>：画面和文字表述要简洁明了，突出关键信息，避免过多细节导致信息过载。</li><li><strong>交互性原则</strong>：重点体现用户与系统之间的交互，包括用户操作和系统反馈，以展示系统的功能逻辑。</li></ul><h3 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li><strong>优点</strong>：以直观、易懂的方式呈现需求，降低沟通成本，提高各方对需求的理解一致性；有助于发现需求中的逻辑漏洞和用户体验问题，提前进行优化；能够激发用户和开发团队的想象力，促进创新设计。</li><li><strong>缺点</strong>：绘制情节串联板需要一定的绘图和设计能力，对于复杂系统的需求描述可能不够全面和精确；由于是图形化表达，难以涵盖所有的需求细节，可能需要结合其他需求获取方法进行补充。</li></ul><h2 id="五、联合需求计划（JRP）"><a href="#五、联合需求计划（JRP）" class="headerlink" title="五、联合需求计划（JRP）"></a>五、联合需求计划（JRP）</h2><h3 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h3><p>联合需求计划（JRP）是一种集中各方利益相关者（如用户、开发人员、管理人员等），通过一系列有组织、有计划的会议，共同讨论、分析和确定软件系统需求的方法。它强调多方协作、面对面沟通，旨在达成对需求的共识，减少误解和偏差。</p><h3 id="适用场景-4"><a href="#适用场景-4" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>需求复杂且多方参与</strong>：当软件项目涉及多个部门、多种角色的利益相关者，需求复杂且各方需求存在差异和冲突时，JRP能促进各方充分沟通，协调需求。</li><li><strong>项目时间紧迫</strong>：需要在较短时间内集中获取需求并达成共识，以加快项目进度。JRP通过集中会议的方式，高效地整合各方意见。</li><li><strong>对需求质量要求高</strong>：期望通过各方深度参与和协作，确保需求的完整性、准确性和一致性，提高需求质量。</li></ul><h3 id="实施步骤-4"><a href="#实施步骤-4" class="headerlink" title="实施步骤"></a>实施步骤</h3><ol><li><strong>准备阶段</strong>：成立JRP小组，包括需求获取人员、用户代表、开发团队成员、管理人员等。确定会议的目标、议程和时间安排。提前收集相关资料，如业务文档、现有系统介绍等，分发给小组成员，让他们做好充分准备。</li><li><strong>会议阶段</strong>：<ul><li><strong>开场</strong>：介绍会议目的、议程和规则，营造开放、合作的氛围。</li><li><strong>需求陈述</strong>：由需求获取人员或业务专家介绍现有业务流程和初步的需求设想，让小组成员对项目有整体了解。</li><li><strong>讨论与分析</strong>：针对需求进行详细讨论，各方发表意见和建议，分析需求的合理性、可行性以及可能存在的冲突。通过提问、澄清、辩论等方式，深入挖掘需求细节。</li><li><strong>达成共识</strong>：对于存在分歧的需求，通过协商、妥协等方式寻求共识。可以采用投票、举手表决等方式对关键需求进行决策。</li><li><strong>记录与总结</strong>：安排专人记录会议讨论内容和达成的共识，在会议结束时，对本次会议的成果进行总结，明确下一步的工作任务。</li></ul></li><li><strong>后续阶段</strong>：整理会议记录，形成需求文档草案，分发给小组成员进行审核。根据反馈意见对需求文档进行修改和完善，最终形成正式的需求规格说明书。</li></ol><h3 id="例子-4"><a href="#例子-4" class="headerlink" title="例子"></a>例子</h3><p>某企业要开发一套集成的企业资源规划（ERP）系统，涉及财务、采购、销售、生产等多个部门。组织JRP会议，各部门代表、开发团队成员和企业高层管理人员参加。在会议上，各部门依次陈述本部门的业务流程和对ERP系统的需求，如财务部门提出财务核算、报表生成的需求，采购部门提出供应商管理、采购订单处理的需求等。然后针对这些需求进行讨论，解决部门间需求冲突，如采购付款流程与财务结算流程的衔接问题，最终达成对ERP系统需求的共识。</p><h3 id="遵循原则-4"><a href="#遵循原则-4" class="headerlink" title="遵循原则"></a>遵循原则</h3><ul><li><strong>平等参与原则</strong>：确保所有小组成员都有平等的发言机会，尊重各方意见，避免一方主导会议。</li><li><strong>开放沟通原则</strong>：鼓励小组成员开放、坦诚地交流，积极提出问题和建议，营造良好的沟通氛围。</li><li><strong>目标导向原则</strong>：会议始终围绕确定软件系统需求这一目标进行，避免讨论偏离主题，提高会议效率。</li></ul><h3 id="优缺点-4"><a href="#优缺点-4" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li><strong>优点</strong>：能快速整合各方需求，减少需求误解和冲突，提高需求的准确性和一致性；促进各方之间的沟通与协作，增强项目的团队凝聚力；由于各方共同参与需求确定过程，对需求的认可度高，有利于后续项目的推进。</li><li><strong>缺点</strong>：组织会议的成本较高，需要协调各方时间，且会议过程需要精心组织和引导，否则容易出现混乱或效率低下的情况；可能存在个别成员因担心影响人际关系而不愿表达真实意见，导致需求收集不全面；对于一些涉及敏感信息或个人隐私的需求，可能不适合在公开会议上讨论。</li></ul><p>综上所述，这五种需求获取手段各有特点和适用场景。在实际的软件工程中，通常需要综合运用多种方法，以全面、准确地获取软件系统的需求，为项目的成功奠定坚实基础。 </p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 需求获取 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用户需求层次划分范式解析：概念、示例</title>
      <link href="/2025/09/03/11-%E7%94%A8%E6%88%B7%E9%9C%80%E6%B1%82%E5%B1%82%E6%AC%A1%E5%88%92%E5%88%86%E8%8C%83%E5%BC%8F%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E7%A4%BA%E4%BE%8B/"/>
      <url>/2025/09/03/11-%E7%94%A8%E6%88%B7%E9%9C%80%E6%B1%82%E5%B1%82%E6%AC%A1%E5%88%92%E5%88%86%E8%8C%83%E5%BC%8F%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%A6%82%E5%BF%B5%E3%80%81%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<p>在软件开发与项目管理过程中，准确理解和把握用户需求至关重要。而用户需求存在多种划分范式，每种范式从不同角度对需求进行剖析，为项目团队提供全面、深入理解需求的途径。下面我们将详细解读三种常见的用户需求层次划分范式。</p><h2 id="一、业务需求、用户需求、系统需求"><a href="#一、业务需求、用户需求、系统需求" class="headerlink" title="一、业务需求、用户需求、系统需求"></a>一、业务需求、用户需求、系统需求</h2><p>把需求划分为业务、用户和系统这三个层次，是一种常规的划分方法。</p><h3 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h3><blockquote><p>反映了组织或企业为达成特定业务目标所提出的高层次需求。它通常由企业高层管理人员或业务负责人提出，着眼于整个业务流程和战略方向。</p></blockquote><p>比如，某电商企业计划拓展海外市场，其业务需求可能是 “在未来一年内，将国际业务销售额提升至总销售额的 30%，通过优化电商平台，支持多语言、多币种结算功能，以满足不同国家和地区用户的购物需求”。</p><p>这类需求<strong>适用于项目规划初期</strong>，帮助项目团队明确项目的商业目标和方向，为后续需求分析和系统设计提供宏观指导。常用于战略决策、资源分配等场景。</p><h3 id="用户需求"><a href="#用户需求" class="headerlink" title="用户需求"></a>用户需求</h3><blockquote><p>用户是从用户角度出发，描述用户在使用软件系统时希望达成的目标或执行的任务。这些需求聚焦于用户的实际操作和体验。</p></blockquote><p>比如，一位电商平台用户希望能够方便地找到心仪商品，其用户需求可能表述为 “用户能够通过搜索框输入关键词，快速筛选出符合需求的商品列表，并可根据价格、销量等条件进行排序”。</p><p>在需求收集阶段，通过与用户直接沟通或观察用户行为获取。有助于设计出符合用户使用习惯和期望的系统界面与操作流程，提高用户满意度。适用于用户体验设计、界面原型制作等场景。</p><h3 id="系统需求"><a href="#系统需求" class="headerlink" title="系统需求"></a>系统需求</h3><blockquote><p>系统需求可以进一步细分为功能需求和非功能需求。功能需求定义了系统必须执行的具体功能，即系统要做什么；非功能需求则描述了系统的性能、可靠性、可用性等方面的特性，是对系统的质量属性要求。</p></blockquote><p>比如，电商平台系统需具备商品展示功能，“系统应能够展示商品的图片、名称、价格、详细描述等信息，确保商品信息准确无误且实时更新”。这是功能需求；而系统需求可能是：在性能方面，“电商平台在促销活动期间，页面加载时间应不超过 3 秒，以保证用户流畅购物体验”。</p><p>系统需求适用于在需求规格说明书撰写阶段，对系统进行详细定义。功能需求指导系统的功能模块设计与开发；非功能需求则影响系统架构选型、技术方案制定等，确保系统满足质量要求。适用于系统设计、开发、测试等全生命周期阶段。</p><h2 id="二、按照质量功能部署（QFD）划分"><a href="#二、按照质量功能部署（QFD）划分" class="headerlink" title="二、按照质量功能部署（QFD）划分"></a>二、按照质量功能部署（QFD）划分</h2><p>质量功能部署将需求划分为：常规需求、期望需求和意外需求。</p><h3 id="常规需求"><a href="#常规需求" class="headerlink" title="常规需求"></a>常规需求</h3><blockquote><p>常规需求是用户认为系统理所当然应具备的基本功能。若这些需求未得到满足，用户会感到不满意，但满足了这些需求，也不会带来额外惊喜。</p></blockquote><p>举例来说，对于一款在线文档编辑工具，能够新建、打开、保存文档是常规需求。用户认为这是工具应有的基本功能，如果不具备，用户将无法接受该产品。</p><p>常规需求是定义产品的基本功能边界，确保产品满足用户的基本使用要求。在产品的基础功能设计与开发阶段重点关注，保证产品的可用性。</p><h3 id="期望需求"><a href="#期望需求" class="headerlink" title="期望需求"></a>期望需求</h3><blockquote><p>期望需求是用户期望系统具备的功能或特性，这些需求的满足程度与用户满意度呈正相关。提供这些需求会提升用户满意度，反之则会降低。</p></blockquote><p>比如，在线文档编辑工具支持多人实时协作编辑，且操作流畅。用户期望在团队协作场景下能高效共同编辑文档，当该功能实现且体验良好时，用户对产品的满意度会提高。</p><p>好的期望需求设计有助于产品在市场竞争中脱颖而出。在产品优化和差异化竞争阶段，通过满足用户期望需求，提升产品竞争力和用户满意度。常用于市场调研、竞品分析后，针对性地完善产品功能。</p><h3 id="意外需求"><a href="#意外需求" class="headerlink" title="意外需求"></a>意外需求</h3><blockquote><p>意外需求又称魅力需求，是用户未曾预期到，但一旦实现会让用户非常惊喜，从而极大提升用户忠诚度的需求。</p></blockquote><p>还是用在线文档编辑工具举例。在线文档编辑工具具备智能纠错、格式美化建议功能，这些功能超出用户常规预期。当用户使用过程中发现这些贴心功能时，会对产品产生好感和依赖。这就是意外需求。</p><p>在创新产品设计或寻求产品突破时，关注意外需求可带来独特的竞争优势。通过挖掘用户潜在需求，为产品创造独特卖点，吸引更多用户并提高用户忠诚度。</p><h2 id="在统一（UP）过程中，按照-FURPS-模型分类"><a href="#在统一（UP）过程中，按照-FURPS-模型分类" class="headerlink" title="在统一（UP）过程中，按照 FURPS + 模型分类"></a>在统一（UP）过程中，按照 FURPS + 模型分类</h2><p>统一过程中将需求按照 FURPS + 模型分类，包括：功能性（特性、功能、安全性）、可用性（人性化因素、帮助、文档）、可靠性（故障频率、可恢复性、可预测性）、性能（响应时间、吞吐量、准确性、有消息、资源利用率）、可支持性（适应性、可维护性、国际化、可配置性），“+” 指辅助和次要因素。</p><h3 id="功能性"><a href="#功能性" class="headerlink" title="功能性"></a>功能性</h3><p>包括以下三个方面</p><ul><li><strong>特性</strong>：系统提供的独特功能或能力，区别于其他竞品的特点。比如，某移动支付 APP 具备指纹支付特性，方便快捷且安全，区别于传统密码支付方式。</li><li><strong>功能</strong>：系统为满足用户需求而执行的具体操作或任务。比如，APP 能够实现扫码支付功能，用户扫描商家二维码完成支付操作。</li><li><strong>安全性</strong>：确保系统和数据免受非法访问、破坏或泄露的能力。比如， 支付过程采用 SSL 加密技术，防止用户支付信息泄露。</li></ul><p>对于功能性需求，在系统功能规划和设计阶段，明确系统要实现的具体功能、特性及安全要求，确保系统满足业务和用户需求。适用于功能模块设计、安全架构规划等场景。</p><h3 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h3><p>它关注用户与系统交互的便捷性和舒适性。包括：</p><ul><li><strong>人性化因素</strong>：包括界面设计是否符合人体工程学、操作是否简便易懂等。比如，移动支付 APP 界面设计简洁，图标清晰，操作按钮大小适合手指点击。</li><li><strong>帮助</strong>：系统为用户提供的操作指导和问题解决支持。比如，在支付页面提供常见问题解答入口，用户遇到问题可快速获取帮助。</li><li><strong>文档</strong>：对系统功能、使用方法等的书面描述，方便用户学习和使用。比如，APP 提供详细的使用指南文档，新用户可通过阅读文档了解各项功能使用方法。</li></ul><p>在用户界面设计和交互设计阶段，重点考虑可用性因素，提升用户体验。常用于原型设计、用户测试等环节，确保系统易用、易理解。</p><h3 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h3><p>是指系统在规定条件下和规定时间内完成规定功能的能力。包括：</p><ul><li><strong>故障频率</strong>：系统出现故障的频繁程度。比如，移动支付 APP 每月故障次数不超过 1 次。</li><li><strong>可恢复性</strong>：系统发生故障后恢复正常运行的能力和速度。比如，若支付过程中出现网络故障，系统在网络恢复后能自动恢复支付流程，且恢复时间不超过 1 分钟。</li><li><strong>可预测性</strong>：系统行为的可预测程度，用户能否预期系统对操作的响应。比如，用户点击支付按钮后，系统会明确显示支付处理进度，用户可预期支付结果。</li></ul><p>在系统架构设计和稳定性测试阶段，关注可靠性指标，保障系统稳定运行。适用于系统部署、压力测试等场景，确保系统在各种情况下可靠工作。</p><h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>性能是衡量系统执行任务的效率和效果。包括：</p><ul><li><strong>响应时间</strong>：系统对用户请求做出响应的时间。比如，用户发起支付请求后，APP 在 2 秒内返回支付结果。</li><li><strong>吞吐量</strong>：系统在单位时间内处理的任务数量。比如，在促销活动高峰时段，APP 每分钟可处理 1000 笔支付交易。</li><li><strong>准确性</strong>：系统输出结果与预期结果的符合程度。比如，支付金额与用户输入金额完全一致，无误差。<br>在系统性能优化阶段，针对性能指标进行分析和改进。适用于性能调优、硬件资源规划等场景，确保系统高效运行。</li></ul><h3 id="可支持性"><a href="#可支持性" class="headerlink" title="可支持性"></a>可支持性</h3><p>可支持性涉及系统在整个生命周期内的维护、调整和适应变化的能力。包括：</p><ul><li><strong>适应性</strong>：系统能够适应不同环境或需求变化的能力。比如，移动支付 APP 可适应不同手机操作系统（如 iOS 和 Android）及各种屏幕分辨率。</li><li><strong>可维护性</strong>：对系统进行修改、修复和优化的难易程度。比如，采用模块化设计，当某个支付功能出现问题时，开发人员可快速定位并修复。</li><li><strong>国际化</strong>：系统支持不同语言、文化和地区的能力。比如，支持多种语言，满足不同国家和地区用户使用。</li><li><strong>可配置性</strong>：系统能够根据不同需求进行灵活配置的特性。比如，商家可根据自身需求配置支付方式、优惠活动等。</li></ul><p>在系统开发全生命周期，尤其是维护和升级阶段，考虑可支持性因素，降低维护成本，提高系统适应性。适用于版本更新、系统迁移等场景。</p><h3 id="辅助因素"><a href="#辅助因素" class="headerlink" title="辅助因素"></a>辅助因素</h3><p>其他的一些辅助因素也要考虑。如实现（涉及技术选型和实现细节）、接口（系统与外部系统交互的规范）、操作（系统运行的操作流程和环境要求）、包装（产品发布的包装形式，如安装包）、授权（使用系统的权限管理）等，用于更全面地描述系统需求。</p><p>在系统开发的各个阶段，从技术实现到产品发布，都需考虑这些辅助因素，确保系统完整、合规且符合项目要求。辅助因素的需求对于技术选型、项目管理等场景非常有用。</p><p>综上所述，不同的用户需求层次划分范式从不同维度对需求进行分类和分析，在软件开发的各个阶段都具有重要指导意义。项目团队应根据实际情况，灵活运用这些范式，全面、准确地把握用户需求，打造出高质量的软件产品。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 需求分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>软件设计中输入设计的七大关键原则：系统分析师的必备指南</title>
      <link href="/2025/09/03/10-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B8%AD%E8%BE%93%E5%85%A5%E8%AE%BE%E8%AE%A1%E7%9A%84%E4%B8%83%E5%A4%A7%E5%85%B3%E9%94%AE%E5%8E%9F%E5%88%99%EF%BC%9A%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E7%9A%84%E5%BF%85%E5%A4%87%E6%8C%87%E5%8D%97/"/>
      <url>/2025/09/03/10-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B8%AD%E8%BE%93%E5%85%A5%E8%AE%BE%E8%AE%A1%E7%9A%84%E4%B8%83%E5%A4%A7%E5%85%B3%E9%94%AE%E5%8E%9F%E5%88%99%EF%BC%9A%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E7%9A%84%E5%BF%85%E5%A4%87%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>在软件设计领域，输入设计如同大厦的基石，虽看似基础，却深刻影响着整个软件系统的稳定性、可用性与安全性。对于系统分析师而言，精准把握输入设计原则，是打造卓越软件产品的关键所在。接下来，让我们深入剖析软件输入设计需遵循的七大原则。</p><h2 id="1-确定输入数据的类型和格式"><a href="#1-确定输入数据的类型和格式" class="headerlink" title="1. 确定输入数据的类型和格式"></a>1. 确定输入数据的类型和格式</h2><p>为何要确定输入数据的类型和格式？软件系统接收的数据需被准确处理和存储，若类型与格式不明确，可能导致数据解析错误、存储异常，甚至引发系统崩溃。<br>例如在开发财务管理软件时，金额数据必须明确为数值类型，且要规定好小数位数格式，如两位小数。若不明确，用户输入类似 “100,5”（欧美习惯的千分位分隔写法），系统可能无法正确识别，导致计算错误。遵循这一原则，可以确保数据一致性与准确性，为后续数据处理、存储及业务逻辑执行提供可靠基础。</p><h2 id="2-确定输入数据的来源"><a href="#2-确定输入数据的来源" class="headerlink" title="2.确定输入数据的来源"></a>2.确定输入数据的来源</h2><p>明确输入数据来源至关重要。不同来源的数据在准确性、可靠性及安全性上存在差异。<br>以电商系统为例，用户注册信息可能来自用户手动输入，而商品库存数据或许源于仓库管理系统接口。若不清楚来源，可能将不可靠数据引入系统，比如从一个未及时更新的库存接口获取数据，导致显示库存与实际不符。<br>明确来源有助于系统分析师评估数据质量，制定相应处理策略，保证数据可靠性与适用性。</p><h2 id="3-设计良好的输入界面"><a href="#3-设计良好的输入界面" class="headerlink" title="3. 设计良好的输入界面"></a>3. 设计良好的输入界面</h2><p>良好的输入界面不可或缺。输入界面是用户与软件交互的桥梁，若设计不佳，会降低用户体验与操作效率，甚至导致用户流失。<br>以在线表单填写为例，若界面布局混乱，字段标签不清晰，必填项无明显标识，用户在注册或提交订单时会感到困惑，增加操作失误率。设计良好的输入界面，能提升用户满意度，提高数据录入效率与准确性，例如采用清晰的表单布局，合理分组字段，设置实时提示信息等。</p><h2 id="4-设计系统输入验证机制"><a href="#4-设计系统输入验证机制" class="headerlink" title="4. 设计系统输入验证机制"></a>4. 设计系统输入验证机制</h2><p>输入验证机制是软件的安全保障。用户输入可能包含错误、非法或恶意数据，若无验证机制，这些数据进入系统会破坏数据完整性、引发安全漏洞。如在登录界面，若不验证用户名和密码长度、格式，黑客可能通过输入超长字符串进行溢出攻击。设计输入验证机制，可在数据进入系统前进行过滤，确保只有合法数据被接受，有效保护系统安全与数据完整性。</p><h2 id="5-设计输入处理流程"><a href="#5-设计输入处理流程" class="headerlink" title="5. 设计输入处理流程"></a>5. 设计输入处理流程</h2><p>输入处理流程是软件的 “数据加工厂”。合理的输入处理流程能高效处理数据，将原始输入转化为符合业务需求的可用信息。<br>以图像识别软件为例，输入的原始图像需经过降噪、特征提取、分类识别等一系列处理流程。若处理流程混乱，可能导致处理时间过长、结果不准确。精心设计输入处理流程，能提高系统性能与处理效率，保障业务逻辑顺利执行。</p><h2 id="6-设计输入存储的方案"><a href="#6-设计输入存储的方案" class="headerlink" title="6. 设计输入存储的方案"></a>6. 设计输入存储的方案</h2><p>设计输入存储方案是数据管理的关键。输入数据需长期保存以备后续查询、分析与审计，若存储方案不合理，会造成数据冗余、存储效率低下、查询困难等问题。<br>如在日志管理系统中，若将大量日志数据无结构地存储，不仅占用大量空间，后期查询特定日志时也会耗费大量时间。合理的存储方案，如采用数据库分区、数据归档等技术，可优化存储结构，提高数据存储与检索效率。</p><h2 id="7-设计输入安全机制"><a href="#7-设计输入安全机制" class="headerlink" title="7. 设计输入安全机制"></a>7. 设计输入安全机制</h2><p>输入安全机制是软件的 “防护盾”。在网络环境复杂的今天，输入数据面临诸多安全威胁，如数据泄露、篡改等。以金融交易软件为例，用户输入的交易金额、账号等敏感信息若未加密传输与存储，一旦被窃取，后果不堪设想。<br>设计输入安全机制，如采用加密算法、访问控制等技术，可保护数据安全，防止敏感信息泄露与非法篡改。</p><p>在软件设计中，输入设计的这七大原则相互关联、缺一不可。从数据类型格式的精准界定，到来源的审慎确认；从输入界面的精心雕琢，到验证机制的严格把关；从处理流程的合理规划，到存储方案的科学设计，再到安全机制的严密构建。我们在进行系统设计师可以把这7个原则作为一种检查清单，逐步优化完善自己的设计。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 系统分析师 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09 认知、经验、运气与赚钱的关系</title>
      <link href="/2025/09/03/09-%E8%AE%A4%E7%9F%A5%E3%80%81%E7%BB%8F%E9%AA%8C%E3%80%81%E8%BF%90%E6%B0%94%E4%B8%8E%E8%B5%9A%E9%92%B1%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
      <url>/2025/09/03/09-%E8%AE%A4%E7%9F%A5%E3%80%81%E7%BB%8F%E9%AA%8C%E3%80%81%E8%BF%90%E6%B0%94%E4%B8%8E%E8%B5%9A%E9%92%B1%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<p>生活中，我们可能会发现，有些人明明对很多常识一窍不通，甚至是让人很无语，可是偏偏他在某些领域很成功，比如投资股票或者其他金融产品赚了很多钱，或者自己的生意做的红红火火。<br>经常听到一句话：“靠运气赚到的钱，最后都考认知亏掉了”。那么，高认知真的可以赚到钱吗？或者说认知不高就一定会亏钱吗？带着这个问题，问了AI，以下是它的回答。你认同吗？</p><h2 id="一、认知和经验有什么异同？"><a href="#一、认知和经验有什么异同？" class="headerlink" title="一、认知和经验有什么异同？"></a>一、认知和经验有什么异同？</h2><h3 id="（一）比喻解释"><a href="#（一）比喻解释" class="headerlink" title="（一）比喻解释"></a>（一）比喻解释</h3><p>如果把人比作一台电脑：</p><ul><li><strong>经验（Experience）</strong>：像是硬盘里存储的数据和已经安装的软件。通过亲身实践、重复操作、观察模仿而获得的具体知识和技能，是关于“what”（是什么）和“how”（怎么做）的。</li><li><strong>认知（Cognition）</strong>：则是这台电脑的操作系统（OS）和中央处理器（CPU）。它决定了如何处理、分析、归类和运用硬盘里的数据（经验）。认知是关于事物底层逻辑、规律和相互关系的深刻理解，是关于“why”（为什么）的。</li></ul><h3 id="（二）异同点总结"><a href="#（二）异同点总结" class="headerlink" title="（二）异同点总结"></a>（二）异同点总结</h3><h4 id="相同点："><a href="#相同点：" class="headerlink" title="相同点："></a>相同点：</h4><ol><li>都来源于实践与学习：两者都不是凭空产生的，都需要通过与外部世界的互动来获得和提升。</li><li>相互促进：丰富的经验可以为认知提供素材和验证，帮助形成更深刻的认知模型。而高质量的认知可以指导人更高效地获取有价值的经验，避免重复犯错。</li></ol><h4 id="不同点："><a href="#不同点：" class="headerlink" title="不同点："></a>不同点：</h4><table><thead><tr><th>特征</th><th>经验（Experience）</th><th>认知（Cognition）</th></tr></thead><tbody><tr><td>范畴</td><td>具体、领域化（Specific）</td><td>抽象、普适性（Abstract &amp; General）</td></tr><tr><td>适用范围</td><td>经验通常与特定任务或环境绑定，换个领域可能就不适用了。例如一个优秀的木匠，他的经验在编程领域几乎无用。</td><td>高水平的认知是可迁移的。比如，理解了“复利”这个认知模型，可以把它应用到投资、健康等多个领域。</td></tr></tbody></table><h2 id="二、赚钱到底是和经验强相关，还是和认知强相关，或是和运气所谓的命中注定相关？"><a href="#二、赚钱到底是和经验强相关，还是和认知强相关，或是和运气所谓的命中注定相关？" class="headerlink" title="二、赚钱到底是和经验强相关，还是和认知强相关，或是和运气所谓的命中注定相关？"></a>二、赚钱到底是和经验强相关，还是和认知强相关，或是和运气所谓的命中注定相关？</h2><h3 id="（一）三者关系"><a href="#（一）三者关系" class="headerlink" title="（一）三者关系"></a>（一）三者关系</h3><p>答案是：三者都强相关，它们共同作用，且在不同阶段、不同领域，其权重各不相同。<br>可以用一个简化的公式来理解这个关系：<br>$$<br>财富≈(认知 \times 经验)^{运气}<br>$$</p><h3 id="（二）公式解释"><a href="#（二）公式解释" class="headerlink" title="（二）公式解释"></a>（二）公式解释</h3><ol><li><strong>认知×经验（Cognition × Experience）</strong><ul><li><strong>有经验无认知（0.1×100 &#x3D; 10）</strong>：你可能是一个熟练的执行者，像一个高级技工。你能在既定的规则里把事情做得很好，赚到辛苦钱或安稳钱，但很难实现数量级的突破，也容易被时代淘汰。因为你不知道为什么要这样做，当规则改变时，你的经验就不值钱了。</li><li><strong>有认知无经验（100×0.1 &#x3D; 10）</strong>：你可能是个“纸上谈兵”的理论家。你懂很多底层逻辑，但因为缺乏实践，无法将认知落地，也抓不住具体的机会。听起来头头是道，但一做就错。</li><li><strong>认知和经验兼备（100×100 &#x3D; 10,000）</strong>：这是最强大的组合。你知道底层的“why”，也知道具体的“how”。你能洞察趋势（认知），也能动手执行（经验）。这是企业家、顶级投资人和行业领袖的特征。</li></ul></li><li><strong>运气（Luck &#x2F; Timing）</strong><ul><li><strong>当运气＞1（好运&#x2F;时代红利）</strong>：即使你的“认知×经验”的基数一般，一个巨大的时代浪潮（比如2010年的房地产、2015年的移动互联网、2020年的加密货币牛市）也能把你推到难以想象的高度。你提到的那个炒币者，很可能就是（中等偏上的领域经验 + 较低的通用认知）叠加上了巨大的运气指数。他在正确的时间，用或许并不完美的技能，踏入了一个指数级增长的市场。</li><li><strong>当运气 &#x3D; 1（不好不坏）</strong>：你的收益基本就等于你“认知×经验”的乘积，一分耕耘一分收获。这是大多数人、大多数时候的状态。</li><li><strong>当运气＜1（坏运气&#x2F;行业衰退）</strong>：即使你认知和经验都很强，但生不逢时，或者遭遇了黑天鹅事件，你的成果也会被大大压缩。比如一个非常有能力的煤炭行业专家，在新能源革命的浪潮下，他的价值就会被削弱。</li></ul></li></ol><h2 id="三、结论与反思"><a href="#三、结论与反思" class="headerlink" title="三、结论与反思"></a>三、结论与反思</h2><ol><li><strong>世界确实荒诞，但有其内在逻辑</strong>：你观察到的现象，恰恰说明单一领域的成功并不需要全方位的“高认知”。那个炒币者在“识别和相信阴谋论”上认知为零，但在“感受市场情绪并下注”这个能赚钱的技能上，他的经验和直觉（一种内隐的认知）可能超过了99％的普通人。财富系统奖励的是能产生结果的认知和经验，而不是通识知识竞赛。</li><li><strong>赚钱的本质</strong>：从根本上说，赚钱是在特定的时间点，用正确的杠杆（认知和经验的产物），做出了符合趋势（运气）**的决策。你的朋友可能无意中满足了所有条件。</li><li><strong>我们能做什么</strong>：<ul><li><strong>不要强求因果的纯粹性</strong>：不要因为看到“傻人”赚钱就否定提升认知的价值。他的成功可能无法复制，因为最大的变量“运气”已经时过境迁。而你通过提升认知，虽然不一定能抓住下一个风口，但能让你更大概率地避开陷阱，并有能力在机会来临时识别它。</li><li><strong>持续提升底层认知</strong>：这是唯一具有长期复利效应的事情。它可以帮助你在变化的世界中保持判断力。</li><li><strong>在“小领域”积累深厚经验</strong>：选择一个你看好的领域，持续投入，成为专家，让你的经验变得值钱。</li><li><strong>耐心等待，并把自己暴露在“好运气”之下</strong>：多尝试、多连接、多学习，增加你遇到好运的概率。当时代的机会来临时，你的认知和经验储备才能让你抓得住它。</li></ul></li></ol><p>最后，<strong>不必因为世界的荒诞而沮丧，看清这背后的复杂关系，然后专注于自己能掌控的部分，就是最好的答案。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 思考 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 认知 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一文搞懂 GoF 的 23 种设计模式：从概念到代码实现</title>
      <link href="/2025/09/03/08%20%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82-GoF-%E7%9A%84-23-%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9A%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/"/>
      <url>/2025/09/03/08%20%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82-GoF-%E7%9A%84-23-%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9A%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>在程序设计领域，GoF 的 23 种设计模式堪称经典中的经典。无论是创建型、结构型还是行为型模式，每种都蕴含着解决特定编程问题的智慧。对于技术人员来说，掌握这些模式，就如同手握利刃，能在复杂的代码世界中披荆斩棘，提升代码的可维护性、可扩展性与复用性。本文将从模式名称、概念、问题、解决方案及实现代码这几个关键维度，全方位剖析这 23 种设计模式，助你快速精通，进阶为设计模式高手。</p><h2 id="一、创建型模式"><a href="#一、创建型模式" class="headerlink" title="一、创建型模式"></a>一、创建型模式</h2><p>创建型模式对类的实例化过程(即对象的创建过程)进行了抽象,能够使软件模块做到与 对象的创建和组织无关。创建型模式隐藏了对象是如何被创建和组合在一起的,以达到使整个  系统独立的目的。</p><p>创建型模式包括：<strong>工厂方法模式、抽象工厂模式、原型模式、单例模式和建造者模式</strong>等。</p><h3 id="1-工厂方法模式-Factory-Method"><a href="#1-工厂方法模式-Factory-Method" class="headerlink" title="1. 工厂方法模式 (Factory Method)"></a>1. 工厂方法模式 (Factory Method)</h3><ul><li><p><strong>概念</strong>：定义一个创建对象的接口，但让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p></li><li><p><strong>问题</strong>：需要创建对象，但不希望指定具体的类，以增加灵活性。</p></li><li><p><strong>解决方案</strong>：定义一个工厂方法接口，让子类实现这个方法来创建对象。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902172207359.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 产品接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    String <span class="title function_">operation</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Result of ConcreteProductA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Result of ConcreteProductB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建者抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Creator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">someOperation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> factoryMethod();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Creator: &quot;</span> + product.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体创建者A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCreatorA</span> <span class="keyword">extends</span> <span class="title class_">Creator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductA</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体创建者B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCreatorB</span> <span class="keyword">extends</span> <span class="title class_">Creator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductB</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-抽象工厂模式-Abstract-Factory"><a href="#2-抽象工厂模式-Abstract-Factory" class="headerlink" title="2. 抽象工厂模式 (Abstract Factory)"></a>2. 抽象工厂模式 (Abstract Factory)</h3><ul><li><p><strong>概念</strong>：提供一个接口，用于创建相关或依赖对象的家族，而不需要明确指定具体类。</p></li><li><p><strong>问题</strong>：需要创建一系列相关或依赖的对象。</p></li><li><p><strong>解决方案</strong>：定义一个抽象工厂接口，包含多个工厂方法，每个方法创建一个不同类型的对象。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902172459853.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品A</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品B</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品A1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Windows Button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品A2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Mac Button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品B1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Windows Checkbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品B2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Mac Checkbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line">    Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WinFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WinButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WinCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-原型模式-Prototype"><a href="#3-原型模式-Prototype" class="headerlink" title="3. 原型模式 (Prototype)"></a>3. 原型模式 (Prototype)</h3><ul><li><p><strong>概念</strong>：通过复制现有对象来创建新对象，而不是通过新建类的方式。</p></li><li><p><strong>问题</strong>：需要创建与现有对象类似的新对象，但希望避免重复的初始化代码。</p></li><li><p><strong>解决方案</strong>：实现一个克隆方法，返回当前对象的副本。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902172920020.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    Prototype <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getDetails</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体原型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcretePrototype</span> <span class="keyword">implements</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcretePrototype</span><span class="params">(String name, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 复制构造函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcretePrototype</span><span class="params">(ConcretePrototype prototype)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = prototype.name;</span><br><span class="line">        <span class="built_in">this</span>.value = prototype.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototype</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDetails</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Name: &quot;</span> + name + <span class="string">&quot;, Value: &quot;</span> + value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrototypeRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Prototype&gt; prototypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrototype</span><span class="params">(String key, Prototype prototype)</span> &#123;</span><br><span class="line">        prototypes.put(key, prototype);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">getClone</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototype</span> <span class="operator">=</span> prototypes.get(key);</span><br><span class="line">        <span class="keyword">return</span> prototype != <span class="literal">null</span> ? prototype.clone() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-单例模式-Singleton"><a href="#4-单例模式-Singleton" class="headerlink" title="4. 单例模式 (Singleton)"></a>4. 单例模式 (Singleton)</h3><ul><li><p><strong>概念</strong>：确保一个类只有一个实例，并提供一个全局访问点。</p></li><li><p><strong>问题</strong>：需要确保一个类只有一个实例，并控制对其的访问。</p></li><li><p><strong>解决方案</strong>：将构造函数私有化，提供一个静态方法获取唯一实例。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902173141293.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线程安全的单例模式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// volatile确保多线程环境下的可见性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 私有构造函数防止外部实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 双重检查锁定实现线程安全</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someBusinessLogic</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Executing business logic with value: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举实现单例（推荐方式）</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Doing something with value: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-建造者模式-Builder"><a href="#5-建造者模式-Builder" class="headerlink" title="5. 建造者模式 (Builder)"></a>5. 建造者模式 (Builder)</h3><ul><li><p><strong>概念</strong>：将一个复杂对象的构建与其表示分离，使得同样的构建过程可以创建不同的表示。</p></li><li><p><strong>问题</strong>：需要创建复杂对象，但构造过程可能涉及多个步骤或参数。</p></li><li><p><strong>解决方案</strong>：使用建造者类来逐步构建对象，最后返回完整对象。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902173352195.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 产品类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String CPU;</span><br><span class="line">    <span class="keyword">private</span> String RAM;</span><br><span class="line">    <span class="keyword">private</span> String storage;</span><br><span class="line">    <span class="keyword">private</span> String GPU;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Setters</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCPU</span><span class="params">(String CPU)</span> &#123; <span class="built_in">this</span>.CPU = CPU; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRAM</span><span class="params">(String RAM)</span> &#123; <span class="built_in">this</span>.RAM = RAM; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStorage</span><span class="params">(String storage)</span> &#123; <span class="built_in">this</span>.storage = storage; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGPU</span><span class="params">(String GPU)</span> &#123; <span class="built_in">this</span>.GPU = GPU; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Computer [CPU=&quot;</span> + CPU + <span class="string">&quot;, RAM=&quot;</span> + RAM + </span><br><span class="line">               <span class="string">&quot;, Storage=&quot;</span> + storage + <span class="string">&quot;, GPU=&quot;</span> + GPU + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建造者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildCPU</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildRAM</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildStorage</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildGPU</span><span class="params">()</span>;</span><br><span class="line">    Computer <span class="title function_">getComputer</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GamingComputerBuilder</span> <span class="keyword">implements</span> <span class="title class_">ComputerBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Computer computer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GamingComputerBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.computer = <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildCPU</span><span class="params">()</span> &#123;</span><br><span class="line">        computer.setCPU(<span class="string">&quot;Intel i9&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildRAM</span><span class="params">()</span> &#123;</span><br><span class="line">        computer.setRAM(<span class="string">&quot;32GB DDR4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildStorage</span><span class="params">()</span> &#123;</span><br><span class="line">        computer.setStorage(<span class="string">&quot;1TB SSD + 2TB HDD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildGPU</span><span class="params">()</span> &#123;</span><br><span class="line">        computer.setGPU(<span class="string">&quot;NVIDIA RTX 4080&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">getComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> computer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指挥者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerDirector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">construct</span><span class="params">(ComputerBuilder builder)</span> &#123;</span><br><span class="line">        builder.buildCPU();</span><br><span class="line">        builder.buildRAM();</span><br><span class="line">        builder.buildStorage();</span><br><span class="line">        builder.buildGPU();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuilderExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ComputerDirector</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComputerDirector</span>();</span><br><span class="line">        <span class="type">ComputerBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GamingComputerBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        director.construct(builder);</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> builder.getComputer();</span><br><span class="line">        </span><br><span class="line">        System.out.println(computer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、结构型模式"><a href="#二、结构型模式" class="headerlink" title="二、结构型模式"></a>二、结构型模式</h2><h3 id="6-适配器模式-Adapter"><a href="#6-适配器模式-Adapter" class="headerlink" title="6. 适配器模式 (Adapter)"></a>6. 适配器模式 (Adapter)</h3><ul><li><p><strong>概念</strong>：将一个类的接口转换成客户期望的另一个接口，使接口不兼容的类可以一起工作。</p></li><li><p><strong>问题</strong>：需要使用现有的类，但其接口与需要的接口不匹配。</p></li><li><p><strong>解决方案</strong>：创建适配器类，实现目标接口并包装被适配者。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902173645669.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String audioType, String fileName)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被适配者</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AdvancedMediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">playVlc</span><span class="params">(String fileName)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">playMp4</span><span class="params">(String fileName)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VlcPlayer</span> <span class="keyword">implements</span> <span class="title class_">AdvancedMediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playVlc</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Playing vlc file: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playMp4</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="comment">// 什么都不做</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mp4Player</span> <span class="keyword">implements</span> <span class="title class_">AdvancedMediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playVlc</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="comment">// 什么都不做</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playMp4</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Playing mp4 file: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediaAdapter</span> <span class="keyword">implements</span> <span class="title class_">MediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AdvancedMediaPlayer advancedMusicPlayer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MediaAdapter</span><span class="params">(String audioType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>)) &#123;</span><br><span class="line">            advancedMusicPlayer = <span class="keyword">new</span> <span class="title class_">VlcPlayer</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>)) &#123;</span><br><span class="line">            advancedMusicPlayer = <span class="keyword">new</span> <span class="title class_">Mp4Player</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String audioType, String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>)) &#123;</span><br><span class="line">            advancedMusicPlayer.playVlc(fileName);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>)) &#123;</span><br><span class="line">            advancedMusicPlayer.playMp4(fileName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioPlayer</span> <span class="keyword">implements</span> <span class="title class_">MediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MediaAdapter mediaAdapter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String audioType, String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;mp3&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Playing mp3 file: &quot;</span> + fileName);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>) || </span><br><span class="line">                   audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>)) &#123;</span><br><span class="line">            mediaAdapter = <span class="keyword">new</span> <span class="title class_">MediaAdapter</span>(audioType);</span><br><span class="line">            mediaAdapter.play(audioType, fileName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Invalid media type: &quot;</span> + audioType);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-桥接模式-Bridge"><a href="#7-桥接模式-Bridge" class="headerlink" title="7. 桥接模式 (Bridge)"></a>7. 桥接模式 (Bridge)</h3><ul><li><p><strong>概念</strong>：将抽象部分与其实现部分分离，使它们都可以独立地变化。</p></li><li><p><strong>问题</strong>：当一个类存在多个维度的变化时，使用继承会导致类爆炸。</p></li><li><p><strong>解决方案</strong>：使用组合代替继承，将抽象和实现分离。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902174233399.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> percent)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TV</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">on</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123; <span class="keyword">return</span> on; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span> &#123; on = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span> &#123; on = <span class="literal">false</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span> &#123; <span class="keyword">return</span> volume; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span> &#123; <span class="built_in">this</span>.volume = volume; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span> &#123; <span class="keyword">return</span> channel; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span> &#123; <span class="built_in">this</span>.channel = channel; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Radio</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">on</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123; <span class="keyword">return</span> on; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span> &#123; on = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span> &#123; on = <span class="literal">false</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span> &#123; <span class="keyword">return</span> volume; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span> &#123; <span class="built_in">this</span>.volume = volume; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span> &#123; <span class="keyword">return</span> channel; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span> &#123; <span class="built_in">this</span>.channel = channel; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象层</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Device device;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RemoteControl</span><span class="params">(Device device)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.device = device;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">togglePower</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">volumeUp</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">volumeDown</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">channelUp</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">channelDown</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 精确抽象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicRemote</span> <span class="keyword">extends</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicRemote</span><span class="params">(Device device)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(device);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">togglePower</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (device.isEnabled()) &#123;</span><br><span class="line">            device.disable();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            device.enable();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">volumeUp</span><span class="params">()</span> &#123;</span><br><span class="line">        device.setVolume(device.getVolume() + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">volumeDown</span><span class="params">()</span> &#123;</span><br><span class="line">        device.setVolume(device.getVolume() - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelUp</span><span class="params">()</span> &#123;</span><br><span class="line">        device.setChannel(device.getChannel() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelDown</span><span class="params">()</span> &#123;</span><br><span class="line">        device.setChannel(device.getChannel() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-组合模式-Composite"><a href="#8-组合模式-Composite" class="headerlink" title="8. 组合模式 (Composite)"></a>8. 组合模式 (Composite)</h3><ul><li><p><strong>概念</strong>：将对象组合成树形结构以表示”部分-整体”的层次结构，使得用户对单个对象和组合对象的使用具有一致性。</p></li><li><p><strong>问题</strong>：需要处理树形结构数据，且希望对叶子节点和复合节点进行统一处理。</p></li><li><p><strong>解决方案</strong>：定义统一的组件接口，让叶子节点和复合节点都实现该接口。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902174436372.png" alt="image.png"></p></li><li><p><strong>实现代码：</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">showDetails</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 叶子节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> <span class="keyword">implements</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">File</span><span class="params">(String name, <span class="type">long</span> size)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showDetails</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File: &quot;</span> + name + <span class="string">&quot; (&quot;</span> + size + <span class="string">&quot; bytes)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span> <span class="keyword">implements</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemComponent&gt; components = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Directory</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addComponent</span><span class="params">(FileSystemComponent component)</span> &#123;</span><br><span class="line">        components.add(component);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeComponent</span><span class="params">(FileSystemComponent component)</span> &#123;</span><br><span class="line">        components.remove(component);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showDetails</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Directory: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">for</span> (FileSystemComponent component : components) &#123;</span><br><span class="line">            component.showDetails();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (FileSystemComponent component : components) &#123;</span><br><span class="line">            totalSize += component.getSize();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-装饰器模式-Decorator"><a href="#9-装饰器模式-Decorator" class="headerlink" title="9. 装饰器模式 (Decorator)"></a>9. 装饰器模式 (Decorator)</h3><ul><li><p><strong>概念</strong>：动态地给一个对象添加一些额外的职责，就增加功能来说，装饰器模式比生成子类更为灵活。</p></li><li><p><strong>问题</strong>：需要在不修改现有代码的情况下，动态地给对象添加功能。</p></li><li><p><strong>解决方案</strong>：创建装饰器类，包装原始对象并提供额外的功能。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902174638850.png" alt="image.png"></p></li><li><p><strong>实现代码：</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCoffee</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Simple coffee&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Coffee decoratedCoffee;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CoffeeDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.decoratedCoffee = coffee;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decoratedCoffee.getCost();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decoratedCoffee.getDescription();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MilkDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getCost() + <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getDescription() + <span class="string">&quot;, with milk&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SugarDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SugarDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getCost() + <span class="number">0.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getDescription() + <span class="string">&quot;, with sugar&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WhippedCreamDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WhippedCreamDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getCost() + <span class="number">0.7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getDescription() + <span class="string">&quot;, with whipped cream&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-外观模式-Facade"><a href="#10-外观模式-Facade" class="headerlink" title="10. 外观模式 (Facade)"></a>10. 外观模式 (Facade)</h3><ul><li><p><strong>概念</strong>：为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p></li><li><p><strong>问题</strong>：子系统过于复杂，客户端需要与多个类交互，导致耦合度高。</p></li><li><p><strong>解决方案</strong>：创建外观类，提供简化的接口来访问子系统的功能。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902174853211.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CPU</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">freeze</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPU freeze&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">jump</span><span class="params">(<span class="type">long</span> position)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPU jump to position: &quot;</span> + position);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPU execute&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">load</span><span class="params">(<span class="type">long</span> position, <span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Memory load at position: &quot;</span> + position);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HardDrive</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] read(<span class="type">long</span> lba, <span class="type">int</span> size) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HardDrive read LBA: &quot;</span> + lba + <span class="string">&quot;, size: &quot;</span> + size);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[size];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerFacade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CPU processor;</span><br><span class="line">    <span class="keyword">private</span> Memory ram;</span><br><span class="line">    <span class="keyword">private</span> HardDrive hd;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BOOT_ADDRESS</span> <span class="operator">=</span> <span class="number">0x0000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BOOT_SECTOR</span> <span class="operator">=</span> <span class="number">0x0000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SECTOR_SIZE</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ComputerFacade</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.processor = <span class="keyword">new</span> <span class="title class_">CPU</span>();</span><br><span class="line">        <span class="built_in">this</span>.ram = <span class="keyword">new</span> <span class="title class_">Memory</span>();</span><br><span class="line">        <span class="built_in">this</span>.hd = <span class="keyword">new</span> <span class="title class_">HardDrive</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        processor.freeze();</span><br><span class="line">        ram.load(BOOT_ADDRESS, hd.read(BOOT_SECTOR, SECTOR_SIZE));</span><br><span class="line">        processor.jump(BOOT_ADDRESS);</span><br><span class="line">        processor.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ComputerFacade</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComputerFacade</span>();</span><br><span class="line">        computer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-享元模式-Flyweight"><a href="#11-享元模式-Flyweight" class="headerlink" title="11. 享元模式 (Flyweight)"></a>11. 享元模式 (Flyweight)</h3><ul><li><p><strong>概念</strong>：运用共享技术有效地支持大量细粒度的对象。</p></li><li><p><strong>问题</strong>：需要创建大量相似对象，导致内存占用过高。</p></li><li><p><strong>解决方案</strong>：将对象的内部状态（不变部分）和外部状态（可变部分）分离，共享内部状态。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902174956157.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 享元接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, String color)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体享元</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color; <span class="comment">// 内部状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = <span class="string">&quot;Circle&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, String borderColor)</span> &#123; <span class="comment">// 外部状态作为参数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing &quot;</span> + type + <span class="string">&quot; of color &quot;</span> + color + </span><br><span class="line">                          <span class="string">&quot; at (&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;) with border &quot;</span> + borderColor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Shape&gt; circleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title function_">getCircle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> (Circle) circleMap.get(color);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (circle == <span class="literal">null</span>) &#123;</span><br><span class="line">            circle = <span class="keyword">new</span> <span class="title class_">Circle</span>(color);</span><br><span class="line">            circleMap.put(color, circle);</span><br><span class="line">            System.out.println(<span class="string">&quot;Creating circle of color: &quot;</span> + color);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> circle;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getTotalObjects</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> circleMap.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyweightPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] colors = &#123;<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;White&quot;</span>, <span class="string">&quot;Black&quot;</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">            <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> (Circle) ShapeFactory.getCircle(getRandomColor());</span><br><span class="line">            circle.draw(getRandomX(), getRandomY(), getRandomBorderColor());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;Total circle objects created: &quot;</span> + </span><br><span class="line">                          ShapeFactory.getTotalObjects());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getRandomColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> colors[(<span class="type">int</span>)(Math.random() * colors.length)];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getRandomX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)(Math.random() * <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getRandomY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)(Math.random() * <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getRandomBorderColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> colors[(<span class="type">int</span>)(Math.random() * colors.length)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-代理模式-Proxy"><a href="#12-代理模式-Proxy" class="headerlink" title="12. 代理模式 (Proxy)"></a>12. 代理模式 (Proxy)</h3><ul><li><p><strong>概念</strong>：为其他对象提供一种代理以控制对这个对象的访问。</p></li><li><p><strong>问题</strong>：需要控制对某个对象的访问，或者在访问对象时添加额外功能。</p></li><li><p><strong>解决方案</strong>：创建代理类，实现与真实对象相同的接口，并在代理类中控制对真实对象的访问。</p></li><li><p><strong>UML图</strong>：</p></li></ul><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175038797.png" alt="image.png"></p><ul><li><strong>实现代码</strong>：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getFileName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RealImage</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">        loadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadFromDisk</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loading image: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying image: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RealImage realImage;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyImage</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (realImage == <span class="literal">null</span>) &#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> <span class="title class_">RealImage</span>(fileName);</span><br><span class="line">        &#125;</span><br><span class="line">        realImage.display();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 虚拟代理（延迟加载）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyImageLoader</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> RealImage realImage;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LazyImageLoader</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (realImage == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Placeholder for image: &quot;</span> + fileName);</span><br><span class="line">            <span class="comment">// 实际加载可以延迟到真正需要时</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            realImage.display();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">load</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (realImage == <span class="literal">null</span>) &#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> <span class="title class_">RealImage</span>(fileName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保护代理</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ProtectedImage</span> <span class="keyword">extends</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">authenticate</span><span class="params">(String password)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProtectedRealImage</span> <span class="keyword">implements</span> <span class="title class_">ProtectedImage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProtectedRealImage</span><span class="params">(String fileName, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying protected image: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">authenticate</span><span class="params">(String inputPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password.equals(inputPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImageProxy</span> <span class="keyword">implements</span> <span class="title class_">ProtectedImage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ProtectedRealImage realImage;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImageProxy</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (realImage != <span class="literal">null</span>) &#123;</span><br><span class="line">            realImage.display();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Access denied. Please authenticate first.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">authenticate</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="comment">// 在实际应用中，这里会有更复杂的认证逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;secret&quot;</span>.equals(password)) &#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> <span class="title class_">ProtectedRealImage</span>(fileName, password);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、行为型模式"><a href="#三、行为型模式" class="headerlink" title="三、行为型模式"></a>三、行为型模式</h2><h3 id="13-职责链模式-Chain-of-Responsibility"><a href="#13-职责链模式-Chain-of-Responsibility" class="headerlink" title="13. 职责链模式 (Chain of Responsibility)"></a>13. 职责链模式 (Chain of Responsibility)</h3><ul><li><p><strong>概念</strong>：避免请求发送者与接收者耦合在一起，让多个对象都有机会处理请求，将这些对象连成一条链，并沿着这条链传递请求，直到有一个对象处理它为止。</p></li><li><p><strong>问题</strong>：需要让多个对象都有机会处理请求，但不明确指定接收者。</p></li><li><p><strong>解决方案</strong>：创建处理者链，每个处理者决定是否处理请求或传递给下一个处理者。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175512611.png" alt="image.png"><br><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PurchaseRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> amount;</span><br><span class="line">    <span class="keyword">private</span> String purpose;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PurchaseRequest</span><span class="params">(<span class="type">double</span> amount, String purpose)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">        <span class="built_in">this</span>.purpose = purpose;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getAmount</span><span class="params">()</span> &#123; <span class="keyword">return</span> amount; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPurpose</span><span class="params">()</span> &#123; <span class="keyword">return</span> purpose; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理者抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Approver successor;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Approver</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Approver successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(PurchaseRequest request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">APPROVAL_LIMIT</span> <span class="operator">=</span> <span class="number">10000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Director</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(PurchaseRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &lt; APPROVAL_LIMIT) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Director &quot;</span> + name + <span class="string">&quot; approved request #&quot;</span> + </span><br><span class="line">                             request.getAmount() + <span class="string">&quot; for &quot;</span> + request.getPurpose());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.processRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VicePresident</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">APPROVAL_LIMIT</span> <span class="operator">=</span> <span class="number">25000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VicePresident</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(PurchaseRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &lt; APPROVAL_LIMIT) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;VicePresident &quot;</span> + name + <span class="string">&quot; approved request #&quot;</span> + </span><br><span class="line">                             request.getAmount() + <span class="string">&quot; for &quot;</span> + request.getPurpose());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.processRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">President</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">APPROVAL_LIMIT</span> <span class="operator">=</span> <span class="number">50000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">President</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(PurchaseRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getAmount() &lt; APPROVAL_LIMIT) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;President &quot;</span> + name + <span class="string">&quot; approved request #&quot;</span> + </span><br><span class="line">                             request.getAmount() + <span class="string">&quot; for &quot;</span> + request.getPurpose());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Request #&quot;</span> + request.getAmount() + </span><br><span class="line">                             <span class="string">&quot; requires board meeting approval!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-命令模式-Command"><a href="#14-命令模式-Command" class="headerlink" title="14. 命令模式 (Command)"></a>14. 命令模式 (Command)</h3><ul><li><p><strong>概念</strong>：将一个请求封装为一个对象，从而使你可以用不同的请求对客户进行参数化，对请求排队或记录请求日志，以及支持可撤销的操作。</p></li><li><p><strong>问题</strong>：需要将请求发送者和接收者解耦，支持请求的排队、记录、撤销等操作。</p></li><li><p><strong>解决方案</strong>：将请求封装为命令对象，包含执行操作的所有信息。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175555767.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Light</span><span class="params">(String location)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">on</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(location + <span class="string">&quot; light is ON&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">off</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(location + <span class="string">&quot; light is OFF&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LightOnCommand</span><span class="params">(Light light)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        light.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightOffCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LightOffCommand</span><span class="params">(Light light)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        light.off();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Command[] onCommands;</span><br><span class="line">    <span class="keyword">private</span> Command[] offCommands;</span><br><span class="line">    <span class="keyword">private</span> Command undoCommand;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RemoteControl</span><span class="params">()</span> &#123;</span><br><span class="line">        onCommands = <span class="keyword">new</span> <span class="title class_">Command</span>[<span class="number">7</span>];</span><br><span class="line">        offCommands = <span class="keyword">new</span> <span class="title class_">Command</span>[<span class="number">7</span>];</span><br><span class="line">        undoCommand = <span class="keyword">new</span> <span class="title class_">NoCommand</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            onCommands[i] = <span class="keyword">new</span> <span class="title class_">NoCommand</span>();</span><br><span class="line">            offCommands[i] = <span class="keyword">new</span> <span class="title class_">NoCommand</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(<span class="type">int</span> slot, Command onCommand, Command offCommand)</span> &#123;</span><br><span class="line">        onCommands[slot] = onCommand;</span><br><span class="line">        offCommands[slot] = offCommand;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onButtonWasPushed</span><span class="params">(<span class="type">int</span> slot)</span> &#123;</span><br><span class="line">        onCommands[slot].execute();</span><br><span class="line">        undoCommand = onCommands[slot];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offButtonWasPushed</span><span class="params">(<span class="type">int</span> slot)</span> &#123;</span><br><span class="line">        offCommands[slot].execute();</span><br><span class="line">        undoCommand = offCommands[slot];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoButtonWasPushed</span><span class="params">()</span> &#123;</span><br><span class="line">        undoCommand.undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-解释器模式-Interpreter"><a href="#15-解释器模式-Interpreter" class="headerlink" title="15. 解释器模式 (Interpreter)"></a>15. 解释器模式 (Interpreter)</h3><ul><li><p><strong>概念</strong>：给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。</p></li><li><p><strong>问题</strong>：需要解释特定领域语言的句子或表达式。</p></li><li><p><strong>解决方案</strong>：定义语法的类层次结构，并实现解释操作。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175639289.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVariable</span><span class="params">(String variable, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        variables.put(variable, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVariable</span><span class="params">(String variable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> variables.getOrDefault(variable, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表达式接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Variable</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Variable</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.getVariable(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> number;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Number</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Add</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.interpret(context) + right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subtract</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Subtract</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.interpret(context) - right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Multiply</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Multiply</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.interpret(context) * right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExpressionParser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title function_">parse</span><span class="params">(String expression)</span> &#123;</span><br><span class="line">        Stack&lt;Expression&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        String[] tokens = expression.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String token : tokens) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isOperator(token)) &#123;</span><br><span class="line">                <span class="type">Expression</span> <span class="variable">right</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                <span class="type">Expression</span> <span class="variable">left</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">switch</span> (token) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">                        stack.push(<span class="keyword">new</span> <span class="title class_">Add</span>(left, right));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">                        stack.push(<span class="keyword">new</span> <span class="title class_">Subtract</span>(left, right));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">                        stack.push(<span class="keyword">new</span> <span class="title class_">Multiply</span>(left, right));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (Character.isDigit(token.charAt(<span class="number">0</span>))) &#123;</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Number</span>(Integer.parseInt(token)));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Variable</span>(token));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isOperator</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token.equals(<span class="string">&quot;+&quot;</span>) || token.equals(<span class="string">&quot;-&quot;</span>) || token.equals(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="16-迭代器模式-Iterator"><a href="#16-迭代器模式-Iterator" class="headerlink" title="16. 迭代器模式 (Iterator)"></a>16. 迭代器模式 (Iterator)</h3><ul><li><p><strong>概念</strong>：提供一种方法顺序访问一个聚合对象中的各个元素，而又不暴露该对象的内部表示。</p></li><li><p><strong>问题</strong>：需要遍历聚合对象而不暴露其内部结构。</p></li><li><p><strong>解决方案</strong>：定义迭代器接口，提供遍历方法。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175715869.png" alt="image.png"><br><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 迭代器接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Container</span>&lt;T&gt; &#123;</span><br><span class="line">    Iterator&lt;T&gt; <span class="title function_">getIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体聚合</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NameRepository</span> <span class="keyword">implements</span> <span class="title class_">Container</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String[] names = &#123;<span class="string">&quot;Robert&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Julie&quot;</span>, <span class="string">&quot;Lora&quot;</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;String&gt; <span class="title function_">getIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NameIterator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 具体迭代器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">NameIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;String&gt; &#123;</span><br><span class="line">        <span class="type">int</span> index;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> index &lt; names.length;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (hasNext()) &#123;</span><br><span class="line">                <span class="keyword">return</span> names[index++];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用迭代器实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayIterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayIterator</span><span class="params">(T[] array)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> position &lt; array.length &amp;&amp; array[position] != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!hasNext()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[position++];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-中介者模式-Mediator"><a href="#17-中介者模式-Mediator" class="headerlink" title="17. 中介者模式 (Mediator)"></a>17. 中介者模式 (Mediator)</h3><ul><li><p><strong>概念</strong>：用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p></li><li><p><strong>问题</strong>：对象之间存在复杂的引用关系，导致系统结构复杂且难以复用。</p></li><li><p><strong>解决方案</strong>：引入中介者来协调对象之间的交互。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175755476.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中介者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String msg, User user)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRoom</span> <span class="keyword">implements</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatRoom</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.users.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String msg, User user)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (User u : users) &#123;</span><br><span class="line">            <span class="comment">// 消息不应该发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> (u != user) &#123;</span><br><span class="line">                u.receive(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同事类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ChatMediator mediator;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(ChatMediator med, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = med;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String msg)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicUser</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicUser</span><span class="params">(ChatMediator med, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(med, name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; sends: &quot;</span> + msg);</span><br><span class="line">        mediator.sendMessage(msg, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; receives: &quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PremiumUser</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PremiumUser</span><span class="params">(ChatMediator med, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(med, name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; sends: &quot;</span> + msg);</span><br><span class="line">        mediator.sendMessage(msg, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; receives: &quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-备忘录模式-Memento"><a href="#18-备忘录模式-Memento" class="headerlink" title="18. 备忘录模式 (Memento)"></a>18. 备忘录模式 (Memento)</h3><ul><li><p><strong>概念</strong>：在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后恢复对象到原先保存的状态。</p></li><li><p><strong>问题</strong>：需要保存对象状态并在以后恢复，但不希望暴露对象内部细节。</p></li><li><p><strong>解决方案</strong>：创建备忘录类来保存状态，由原发器管理备忘录。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902175909231.png" alt="image.png"><br><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 备忘录</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Memento</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原发器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        System.out.println(<span class="string">&quot;State set to: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">saveStateToMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getStateFromMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        state = memento.getState();</span><br><span class="line">        System.out.println(<span class="string">&quot;State restored to: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CareTaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Memento&gt; mementoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Memento state)</span> &#123;</span><br><span class="line">        mementoList.add(state);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mementoList.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mementoList.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本编辑器示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">StringBuilder</span> <span class="variable">text</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">private</span> TextEditorMemento lastSavedState;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.text.append(text);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TextEditorMemento <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextEditorMemento</span>(text.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restore</span><span class="params">(TextEditorMemento memento)</span> &#123;</span><br><span class="line">        text = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(memento.getSavedText());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 内部备忘录类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TextEditorMemento</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String text;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">TextEditorMemento</span><span class="params">(String text)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.text = text;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> String <span class="title function_">getSavedText</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> text;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-观察者模式-Observer"><a href="#19-观察者模式-Observer" class="headerlink" title="19. 观察者模式 (Observer)"></a>19. 观察者模式 (Observer)</h3><ul><li><p><strong>概念</strong>：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p></li><li><p><strong>问题</strong>：需要实现对象之间的动态依赖关系，当一个对象状态改变时，其他相关对象能够自动更新。</p></li><li><p><strong>解决方案</strong>：定义主题和观察者接口，主题维护观察者列表并在状态改变时通知它们。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902180018356.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示元素接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DisplayElement</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherData</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeatherData</span><span class="params">()</span> &#123;</span><br><span class="line">        observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update(temperature, humidity, pressure);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">measurementsChanged</span><span class="params">()</span> &#123;</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMeasurements</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        measurementsChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurrentConditionsDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>, DisplayElement &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CurrentConditionsDisplay</span><span class="params">(Subject weatherData)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Current conditions: &quot;</span> + temperature + </span><br><span class="line">                         <span class="string">&quot;°C and &quot;</span> + humidity + <span class="string">&quot;% humidity&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StatisticsDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>, DisplayElement &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">maxTemp</span> <span class="operator">=</span> <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">minTemp</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">tempSum</span> <span class="operator">=</span> <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> numReadings;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StatisticsDisplay</span><span class="params">(Subject weatherData)</span> &#123;</span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        tempSum += temperature;</span><br><span class="line">        numReadings++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (temperature &gt; maxTemp) &#123;</span><br><span class="line">            maxTemp = temperature;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (temperature &lt; minTemp) &#123;</span><br><span class="line">            minTemp = temperature;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Avg/Max/Min temperature = &quot;</span> + (tempSum / numReadings) +</span><br><span class="line">                         <span class="string">&quot;/&quot;</span> + maxTemp + <span class="string">&quot;/&quot;</span> + minTemp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Java内置的Observable类（已过时，但为了完整性展示）</span></span><br><span class="line"><span class="keyword">import</span> java.util.Observable;</span><br><span class="line"><span class="keyword">import</span> java.util.Observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherDataObservable</span> <span class="keyword">extends</span> <span class="title class_">Observable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">measurementsChanged</span><span class="params">()</span> &#123;</span><br><span class="line">        setChanged();</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMeasurements</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        measurementsChanged();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getTemperature</span><span class="params">()</span> &#123; <span class="keyword">return</span> temperature; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getHumidity</span><span class="params">()</span> &#123; <span class="keyword">return</span> humidity; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getPressure</span><span class="params">()</span> &#123; <span class="keyword">return</span> pressure; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20-状态模式-State"><a href="#20-状态模式-State" class="headerlink" title="20. 状态模式 (State)"></a>20. 状态模式 (State)</h3><ul><li><p><strong>概念</strong>：允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。</p></li><li><p><strong>问题</strong>：对象的行为依赖于它的状态，并且必须在运行时根据状态改变行为。</p></li><li><p><strong>解决方案</strong>：将状态封装为独立的类，并将行为委托给当前状态对象。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902180104179.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 状态接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertQuarter</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ejectQuarter</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">turnCrank</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dispense</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoQuarterState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> GumballMachine gumballMachine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NoQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You inserted a quarter&quot;</span>);</span><br><span class="line">        gumballMachine.setState(gumballMachine.getHasQuarterState());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ejectQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You haven&#x27;t inserted a quarter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnCrank</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You turned, but there&#x27;s no quarter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispense</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You need to pay first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HasQuarterState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> GumballMachine gumballMachine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HasQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You can&#x27;t insert another quarter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ejectQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Quarter returned&quot;</span>);</span><br><span class="line">        gumballMachine.setState(gumballMachine.getNoQuarterState());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnCrank</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;You turned...&quot;</span>);</span><br><span class="line">        gumballMachine.setState(gumballMachine.getSoldState());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispense</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;No gumball dispensed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SoldState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> GumballMachine gumballMachine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SoldState</span><span class="params">(GumballMachine gumballMachine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Please wait, we&#x27;re already giving you a gumball&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ejectQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sorry, you already turned the crank&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnCrank</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Turning twice doesn&#x27;t get you another gumball!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispense</span><span class="params">()</span> &#123;</span><br><span class="line">        gumballMachine.releaseBall();</span><br><span class="line">        <span class="keyword">if</span> (gumballMachine.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            gumballMachine.setState(gumballMachine.getNoQuarterState());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Oops, out of gumballs!&quot;</span>);</span><br><span class="line">            gumballMachine.setState(gumballMachine.getSoldOutState());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GumballMachine</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> State soldOutState;</span><br><span class="line">    <span class="keyword">private</span> State noQuarterState;</span><br><span class="line">    <span class="keyword">private</span> State hasQuarterState;</span><br><span class="line">    <span class="keyword">private</span> State soldState;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GumballMachine</span><span class="params">(<span class="type">int</span> numberGumballs)</span> &#123;</span><br><span class="line">        soldOutState = <span class="keyword">new</span> <span class="title class_">SoldOutState</span>(<span class="built_in">this</span>);</span><br><span class="line">        noQuarterState = <span class="keyword">new</span> <span class="title class_">NoQuarterState</span>(<span class="built_in">this</span>);</span><br><span class="line">        hasQuarterState = <span class="keyword">new</span> <span class="title class_">HasQuarterState</span>(<span class="built_in">this</span>);</span><br><span class="line">        soldState = <span class="keyword">new</span> <span class="title class_">SoldState</span>(<span class="built_in">this</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.count = numberGumballs;</span><br><span class="line">        <span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            state = noQuarterState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            state = soldOutState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        state.insertQuarter();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ejectQuarter</span><span class="params">()</span> &#123;</span><br><span class="line">        state.ejectQuarter();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnCrank</span><span class="params">()</span> &#123;</span><br><span class="line">        state.turnCrank();</span><br><span class="line">        state.dispense();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">releaseBall</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A gumball comes rolling out the slot...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">            count = count - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Getter methods for states</span></span><br><span class="line">    <span class="keyword">public</span> State <span class="title function_">getSoldOutState</span><span class="params">()</span> &#123; <span class="keyword">return</span> soldOutState; &#125;</span><br><span class="line">    <span class="keyword">public</span> State <span class="title function_">getNoQuarterState</span><span class="params">()</span> &#123; <span class="keyword">return</span> noQuarterState; &#125;</span><br><span class="line">    <span class="keyword">public</span> State <span class="title function_">getHasQuarterState</span><span class="params">()</span> &#123; <span class="keyword">return</span> hasQuarterState; &#125;</span><br><span class="line">    <span class="keyword">public</span> State <span class="title function_">getSoldState</span><span class="params">()</span> &#123; <span class="keyword">return</span> soldState; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="21-策略模式-Strategy"><a href="#21-策略模式-Strategy" class="headerlink" title="21. 策略模式 (Strategy)"></a>21. 策略模式 (Strategy)</h3><ul><li><p><strong>概念</strong>：定义一系列的算法，把它们一个个封装起来，并且使它们可相互替换。策略模式使得算法可独立于使用它的客户而变化。</p></li><li><p><strong>问题</strong>：需要在运行时选择不同的算法或行为。</p></li><li><p><strong>解决方案</strong>：定义策略接口，将每个算法封装为独立的策略类。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902180145003.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String cardNumber;</span><br><span class="line">    <span class="keyword">private</span> String cvv;</span><br><span class="line">    <span class="keyword">private</span> String dateOfExpiry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CreditCardStrategy</span><span class="params">(String name, String cardNumber, String cvv, String dateOfExpiry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.cardNumber = cardNumber;</span><br><span class="line">        <span class="built_in">this</span>.cvv = cvv;</span><br><span class="line">        <span class="built_in">this</span>.dateOfExpiry = dateOfExpiry;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(amount + <span class="string">&quot; paid with credit/debit card&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PayPalStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String emailId;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PayPalStrategy</span><span class="params">(String emailId, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emailId = emailId;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(amount + <span class="string">&quot; paid using PayPal&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CryptoStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String walletAddress;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CryptoStrategy</span><span class="params">(String walletAddress)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.walletAddress = walletAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(amount + <span class="string">&quot; paid with cryptocurrency&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Item&gt; items;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.items = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeItem</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        items.remove(item);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculateTotal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Item item : items) &#123;</span><br><span class="line">            sum += item.getPrice();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(PaymentStrategy paymentMethod)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">amount</span> <span class="operator">=</span> calculateTotal();</span><br><span class="line">        paymentMethod.pay(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String upcCode;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Item</span><span class="params">(String upcCode, <span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.upcCode = upcCode;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUpcCode</span><span class="params">()</span> &#123; <span class="keyword">return</span> upcCode; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123; <span class="keyword">return</span> price; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序策略示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BubbleSortStrategy</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sorting using bubble sort&quot;</span>);</span><br><span class="line">        <span class="comment">// 实现冒泡排序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QuickSortStrategy</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sorting using quick sort&quot;</span>);</span><br><span class="line">        <span class="comment">// 实现快速排序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MergeSortStrategy</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sorting using merge sort&quot;</span>);</span><br><span class="line">        <span class="comment">// 实现归并排序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sorter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> SortStrategy strategy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStrategy</span><span class="params">(SortStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortArray</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        strategy.sort(array);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="22-模板方法模式-Template-Method"><a href="#22-模板方法模式-Template-Method" class="headerlink" title="22. 模板方法模式 (Template Method)"></a>22. 模板方法模式 (Template Method)</h3><ul><li><p><strong>概念</strong>：定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p></li><li><p><strong>问题</strong>：有多个类包含相同的算法，但某些步骤的实现不同。</p></li><li><p><strong>解决方案</strong>：在抽象类中定义模板方法，将可变步骤声明为抽象方法。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902180233742.png" alt="image.png"></p></li><li><p><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">()</span> &#123;</span><br><span class="line">        readData();</span><br><span class="line">        processData();</span><br><span class="line">        writeData();</span><br><span class="line">        <span class="keyword">if</span> (needValidation()) &#123;</span><br><span class="line">            validateData();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 具体方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Reading data from source...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Writing data to destination...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 抽象方法（必须由子类实现）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 钩子方法（可选重写）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needValidation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validateData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Validating data...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体子类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSVDataProcessor</span> <span class="keyword">extends</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Processing CSV data...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needValidation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validateData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Validating CSV data format...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XMLDataProcessor</span> <span class="keyword">extends</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Processing XML data...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSONDataProcessor</span> <span class="keyword">extends</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Processing JSON data...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needValidation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮料制作示例</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">prepareRecipe</span><span class="params">()</span> &#123;</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        pourInCup();</span><br><span class="line">        <span class="keyword">if</span> (customerWantsCondiments()) &#123;</span><br><span class="line">            addCondiments();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">boilWater</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Boiling water&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">pourInCup</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Pouring into cup&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 钩子方法</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">customerWantsCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coffee</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dripping coffee through filter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding sugar and milk&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">customerWantsCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 可以通过用户输入决定是否添加调料</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tea</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Steeping the tea&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding lemon&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="23-访问者模式-Visitor"><a href="#23-访问者模式-Visitor" class="headerlink" title="23. 访问者模式 (Visitor)"></a>23. 访问者模式 (Visitor)</h3><ul><li><p><strong>概念</strong>：表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。</p></li><li><p><strong>问题</strong>：需要在不同对象上执行不同的操作，但不希望修改这些对象的类。</p></li><li><p><strong>解决方案</strong>：将操作封装在访问者对象中，对象接受访问者并调用相应方法。</p></li><li><p><strong>UML图</strong>：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250902180312958.png" alt="image.png"><br><strong>实现代码</strong>：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元素接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerPart</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Keyboard</span> <span class="keyword">implements</span> <span class="title class_">ComputerPart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Keyboard&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monitor</span> <span class="keyword">implements</span> <span class="title class_">ComputerPart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Monitor&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">implements</span> <span class="title class_">ComputerPart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Mouse&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span> <span class="keyword">implements</span> <span class="title class_">ComputerPart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ComputerPart&gt; parts;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">()</span> &#123;</span><br><span class="line">        parts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        parts.add(<span class="keyword">new</span> <span class="title class_">Mouse</span>());</span><br><span class="line">        parts.add(<span class="keyword">new</span> <span class="title class_">Keyboard</span>());</span><br><span class="line">        parts.add(<span class="keyword">new</span> <span class="title class_">Monitor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ComputerPart part : parts) &#123;</span><br><span class="line">            part.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerPartVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Computer computer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Mouse mouse)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Keyboard keyboard)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Monitor monitor)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerPartDisplayVisitor</span> <span class="keyword">implements</span> <span class="title class_">ComputerPartVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Computer computer)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying Computer&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Mouse mouse)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying Mouse&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Keyboard keyboard)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying Keyboard&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Monitor monitor)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying Monitor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerPartMaintenanceVisitor</span> <span class="keyword">implements</span> <span class="title class_">ComputerPartVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Computer computer)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Maintaining Computer&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Mouse mouse)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cleaning Mouse&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Keyboard keyboard)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cleaning Keyboard&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Monitor monitor)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Calibrating Monitor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象结构</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectStructure</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ComputerPart&gt; parts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPart</span><span class="params">(ComputerPart part)</span> &#123;</span><br><span class="line">        parts.add(part);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(ComputerPartVisitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ComputerPart part : parts) &#123;</span><br><span class="line">            part.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VisitorPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">        <span class="type">ComputerPartVisitor</span> <span class="variable">displayVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComputerPartDisplayVisitor</span>();</span><br><span class="line">        <span class="type">ComputerPartVisitor</span> <span class="variable">maintenanceVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComputerPartMaintenanceVisitor</span>();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;=== Displaying Computer Parts ===&quot;</span>);</span><br><span class="line">        computer.accept(displayVisitor);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== Maintaining Computer Parts ===&quot;</span>);</span><br><span class="line">        computer.accept(maintenanceVisitor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>GoF的23种设计模式为我们提供了解决常见软件设计问题的经典方案。通过合理运用这些模式，我们可以：</p><ol><li><strong>提高代码的可维护性和可扩展性</strong></li><li><strong>降低模块间的耦合度</strong></li><li><strong>增强代码的复用性</strong></li><li><strong>使系统更加灵活和易于理解</strong></li></ol><p>每种模式都有其适用的场景，在实际开发中应该根据具体需求选择合适的设计模式，而不是为了使用模式而使用模式。希望这篇博客能帮助您更好地理解和应用这些经典的设计模式。</p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>系统分析师必看！OOD 六大设计原则拆解，附 Java 代码示例（从概念到落地一次搞懂）</title>
      <link href="/2025/09/02/07-%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E5%BF%85%E7%9C%8B%EF%BC%81OOD-%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E6%8B%86%E8%A7%A3%EF%BC%8C%E9%99%84-Java-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E8%90%BD%E5%9C%B0%E4%B8%80%E6%AC%A1%E6%90%9E%E6%87%82%EF%BC%89/"/>
      <url>/2025/09/02/07-%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E5%BF%85%E7%9C%8B%EF%BC%81OOD-%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E6%8B%86%E8%A7%A3%EF%BC%8C%E9%99%84-Java-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88%E4%BB%8E%E6%A6%82%E5%BF%B5%E5%88%B0%E8%90%BD%E5%9C%B0%E4%B8%80%E6%AC%A1%E6%90%9E%E6%87%82%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>作为一名常年和系统设计打交道的开发者，每次都会被 OOD（面向对象设计）的六大原则戳中 —— 这六条看似抽象的规则，其实是避开 “代码越写越烂” 陷阱的核心心法。</p><p>很多人刚接触时会觉得 “这些原则太理论，实际开发用不上”，但只要真正理解并落地，你会发现代码的扩展性、可维护性会发生质的变化。今天就用大白话拆解这六大原则，每个原则都配了 Java 代码示例，从概念到实践一步到位，新手也能看懂。</p><h2 id="一、开闭原则：对扩展开放，对修改关闭"><a href="#一、开闭原则：对扩展开放，对修改关闭" class="headerlink" title="一、开闭原则：对扩展开放，对修改关闭"></a>一、开闭原则：对扩展开放，对修改关闭</h2><p><strong>核心概念</strong>：这是 OOD 原则的 “老大”，核心思想是 —— 当需要给系统新增功能时，尽量通过 “扩展已有代码” 实现，而不是 “修改已有代码”。这样能避免改动旧代码时，不小心引入新 Bug，也能让系统更稳定。</p><p>举个例子：比如你开发了一个电商系统的 “订单折扣” 功能，初期只有 “会员折扣”，后来要加 “节日折扣”，如果一开始就遵循开闭原则，就不用改原来的会员折扣代码，直接加个新的折扣类就行。</p><p>下面给出一个示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 先定义一个抽象的折扣接口（稳定的抽象层）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Discount</span> &#123;</span><br><span class="line">    <span class="comment">// 计算折扣后的价格</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">calculateDiscount</span><span class="params">(<span class="type">double</span> originalPrice)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 会员折扣实现类（已有的功能，无需修改）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberDiscount</span> <span class="keyword">implements</span> <span class="title class_">Discount</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateDiscount</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="comment">// 会员打9折</span></span><br><span class="line">        <span class="keyword">return</span> originalPrice * <span class="number">0.9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 新增节日折扣（扩展新类，不修改旧代码）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HolidayDiscount</span> <span class="keyword">implements</span> <span class="title class_">Discount</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateDiscount</span><span class="params">(<span class="type">double</span> originalPrice)</span> &#123;</span><br><span class="line">        <span class="comment">// 节日打8折</span></span><br><span class="line">        <span class="keyword">return</span> originalPrice * <span class="number">0.8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 订单服务（依赖抽象接口，而非具体实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">// 接收 Discount 接口，不管是哪种折扣，这里都不用改</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateFinalPrice</span><span class="params">(<span class="type">double</span> originalPrice, Discount discount)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> discount.calculateDiscount(originalPrice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：新增功能时，直接传新的实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">OrderService</span> <span class="variable">orderService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderService</span>();</span><br><span class="line">        <span class="type">double</span> <span class="variable">originalPrice</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 会员订单</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">memberPrice</span> <span class="operator">=</span> orderService.calculateFinalPrice(originalPrice, <span class="keyword">new</span> <span class="title class_">MemberDiscount</span>());</span><br><span class="line">        System.out.println(<span class="string">&quot;会员价：&quot;</span> + memberPrice); <span class="comment">// 输出 90.0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 节日订单（新增功能，旧代码没动）</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">holidayPrice</span> <span class="operator">=</span> orderService.calculateFinalPrice(originalPrice, <span class="keyword">new</span> <span class="title class_">HolidayDiscount</span>());</span><br><span class="line">        System.out.println(<span class="string">&quot;节日价：&quot;</span> + holidayPrice); <span class="comment">// 输出 80.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面的代码中我们可以看到，对于折扣这个对象我们抽象出一个接口，然后对于不同类型的折扣通过接口的实现了创建具体的类。这样一来，创建订单时，我们只要区分现在要用的折扣是哪个类型的就可以了。以后要新增一个折扣类型（比如“618折扣”）只要扩展Discount这个接口就行了。</p><h2 id="二、里氏替换原则：子类能无缝替代父类，且不破坏程序逻辑"><a href="#二、里氏替换原则：子类能无缝替代父类，且不破坏程序逻辑" class="headerlink" title="二、里氏替换原则：子类能无缝替代父类，且不破坏程序逻辑"></a>二、里氏替换原则：子类能无缝替代父类，且不破坏程序逻辑</h2><p><strong>核心概念</strong>：简单说就是 “<strong>子类是父类的加强版，但不能颠覆父类的原有功能</strong>”。如果一个程序里用了父类对象，把它换成子类对象后，程序还能正常跑，这就符合里氏替换；反之如果换了之后程序崩了，那就是违反了这个原则。</p><p>最典型的反例就是 “正方形不是长方形”—— 如果把长方形的 “宽” 和 “长” 分开设置，子类正方形强制让宽 &#x3D; 长，那用子类替换父类后，修改长或宽的逻辑就会出错。</p><p>我们看下面的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 父类：鸟类（有“飞”的基础功能）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">    <span class="comment">// 飞行速度</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> speed;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算飞行时间（基础逻辑）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateFlyTime</span><span class="params">(<span class="type">double</span> distance)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> distance / speed;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置飞行速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSpeed</span><span class="params">(<span class="type">double</span> speed)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.speed = speed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 子类：麻雀（继承鸟类，不破坏父类逻辑）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sparrow</span> <span class="keyword">extends</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">    <span class="comment">// 麻雀的飞行速度有默认值，也可以通过父类方法修改</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Sparrow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.speed = <span class="number">50</span>; <span class="comment">// 假设麻雀默认飞行速度50km/h</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 子类：老鹰（继承鸟类，扩展功能但不颠覆）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Eagle</span> <span class="keyword">extends</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Eagle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.speed = <span class="number">150</span>; <span class="comment">// 老鹰飞得更快</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新增“俯冲”功能（扩展，不修改父类方法）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dive</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老鹰正在俯冲捕猎！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：子类替换父类，程序正常运行</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">distance</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 父类对象</span></span><br><span class="line">        <span class="type">Bird</span> <span class="variable">bird</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bird</span>();</span><br><span class="line">        bird.setSpeed(<span class="number">80</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;普通鸟飞行时间：&quot;</span> + bird.calculateFlyTime(distance)); <span class="comment">// 100/80=1.25</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 子类麻雀替换父类</span></span><br><span class="line">        <span class="type">Bird</span> <span class="variable">sparrow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sparrow</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;麻雀飞行时间：&quot;</span> + sparrow.calculateFlyTime(distance)); <span class="comment">// 100/50=2.0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 子类老鹰替换父类</span></span><br><span class="line">        <span class="type">Bird</span> <span class="variable">eagle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Eagle</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;老鹰飞行时间：&quot;</span> + eagle.calculateFlyTime(distance)); <span class="comment">// 100/150≈0.666</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 老鹰还能调用自己的扩展方法</span></span><br><span class="line">        ((Eagle) eagle).dive(); <span class="comment">// 输出“老鹰正在俯冲捕猎！”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，Sparrow和Eagle都继承自Bird这个类，是Bird的“特例”，但是本质上她们都是鸟，所以都有fly这个能力。因此就算是在另一个地方把Sparrow替换成Bird，程序也不会报错，因为它没有破坏Bird的逻辑。</p><h2 id="三、依赖倒置原则：依赖抽象，不依赖具体实现"><a href="#三、依赖倒置原则：依赖抽象，不依赖具体实现" class="headerlink" title="三、依赖倒置原则：依赖抽象，不依赖具体实现"></a>三、依赖倒置原则：依赖抽象，不依赖具体实现</h2><p><strong>核心概念</strong>：这条原则<strong>其实是开闭原则的 “支撑”</strong>，核心是 “高低层模块都要依赖抽象，抽象不能依赖具体”。简单说就是 —— <strong>不要让你的代码依赖某个具体的类，而是依赖接口或抽象类，这样高层模块（比如服务类）就不会被低层模块（比如工具类）的变动影响</strong>。</p><p>比如你开发一个 “消息通知” 功能，高层模块是 “通知服务”，低层模块是 “短信通知”“邮件通知”。如果通知服务直接依赖 “短信通知” 这个具体类，后来要加 “邮件通知”，就得改通知服务的代码；但如果依赖 “通知接口”，加新功能时只需要加个接口实现类就行。</p><p>我们还是来看代码示范：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象接口：消息通知（稳定的抽象层）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String content)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 低层模块1：短信通知（具体实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsNotification</span> <span class="keyword">implements</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;通过短信发送：&quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 低层模块2：邮件通知（新增的具体实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailNotification</span> <span class="keyword">implements</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;通过邮件发送：&quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 高层模块：通知服务（依赖抽象接口，不依赖具体实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="comment">// 构造方法注入抽象接口（而非具体类）</span></span><br><span class="line">    <span class="keyword">private</span> Notification notification;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotificationService</span><span class="params">(Notification notification)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.notification = notification;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息的核心逻辑（不用改）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyUser</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        notification.send(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：高层模块无需修改，就能切换不同的通知方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 短信通知</span></span><br><span class="line">        <span class="type">NotificationService</span> <span class="variable">smsService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotificationService</span>(<span class="keyword">new</span> <span class="title class_">SmsNotification</span>());</span><br><span class="line">        smsService.notifyUser(<span class="string">&quot;您的验证码是123456&quot;</span>); <span class="comment">// 输出“通过短信发送：您的验证码是123456”</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 邮件通知（高层模块没改，只换了实现类）</span></span><br><span class="line">        <span class="type">NotificationService</span> <span class="variable">emailService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotificationService</span>(<span class="keyword">new</span> <span class="title class_">EmailNotification</span>());</span><br><span class="line">        emailService.notifyUser(<span class="string">&quot;您有一封新邮件，请查收&quot;</span>); <span class="comment">// 输出“通过邮件发送：您有一封新邮件，请查收”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中：NotificationService 的notifyUser实际上是调用了Notification的send方法，但是由于它是一个抽象方法，具体的实现都在不同的通知类中，因此当服务方法调用时，只要指派不同的通知类即可。<br>这里的核心是NotificationService 依赖的只是 Notification 这个抽象接口，这样方便后续的扩展。假设未来如果有了新的通知类型，比如微信通知，那么创建一个WeChatNotification并实现Notification即可。</p><h2 id="四、组合-聚合原则：优先用组合-聚合，少用继承"><a href="#四、组合-聚合原则：优先用组合-聚合，少用继承" class="headerlink" title="四、组合 &#x2F; 聚合原则：优先用组合 &#x2F; 聚合，少用继承"></a>四、组合 &#x2F; 聚合原则：优先用组合 &#x2F; 聚合，少用继承</h2><p><strong>核心概念</strong>：继承的问题在于 “强耦合”—— 子类会依赖父类的实现，如果父类改了，子类可能跟着崩；而组合 &#x2F; 聚合是 “弱耦合”—— <strong>一个类通过 “包含另一个类的对象” 来使用其功能，双方可以独立变化</strong>。所以设计时要优先选组合 &#x2F; 聚合，实在适合继承（比如子类是父类的 “is-a” 关系）再用继承。</p><p>比如 “汽车” 和 “发动机” 的关系：汽车需要发动机才能跑，但汽车不是 “继承” 发动机（因为汽车不是发动机的一种），而是 “组合” 发动机（汽车里包含一个发动机对象）；而 “轿车” 和 “汽车” 是 “is-a” 关系，适合用继承。</p><p>我们来看代码的示范：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 发动机类（被组合的类）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Engine</span> &#123;</span><br><span class="line">    <span class="comment">// 发动机启动</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发动机启动，开始提供动力&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发动机停止</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发动机停止，动力中断&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 汽车类（组合发动机，而非继承）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="comment">// 汽车包含一个发动机对象（组合关系：汽车销毁时，发动机也跟着销毁）</span></span><br><span class="line">    <span class="keyword">private</span> Engine engine;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法初始化发动机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.engine = <span class="keyword">new</span> <span class="title class_">Engine</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 汽车启动：调用发动机的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startCar</span><span class="params">()</span> &#123;</span><br><span class="line">        engine.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;汽车成功启动，可以行驶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 汽车停止：调用发动机的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopCar</span><span class="params">()</span> &#123;</span><br><span class="line">        engine.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;汽车成功停止&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 轿车类（继承汽车，因为轿车是汽车的一种）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sedan</span> <span class="keyword">extends</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="comment">// 轿车的特有功能：自动泊车</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoParking</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;轿车正在自动泊车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：组合和继承的正确使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Sedan</span> <span class="variable">sedan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sedan</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用继承自Car的方法（依赖组合的Engine）</span></span><br><span class="line">        sedan.startCar(); </span><br><span class="line">        <span class="comment">// 输出：</span></span><br><span class="line">        <span class="comment">// 发动机启动，开始提供动力</span></span><br><span class="line">        <span class="comment">// 汽车成功启动，可以行驶</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用Sedan的特有方法</span></span><br><span class="line">        sedan.autoParking(); <span class="comment">// 输出“轿车正在自动泊车”</span></span><br><span class="line">        </span><br><span class="line">        sedan.stopCar();</span><br><span class="line">        <span class="comment">// 输出：</span></span><br><span class="line">        <span class="comment">// 发动机停止，动力中断</span></span><br><span class="line">        <span class="comment">// 汽车成功停止</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五、接口隔离原则：接口要小而专，不要大而全"><a href="#五、接口隔离原则：接口要小而专，不要大而全" class="headerlink" title="五、接口隔离原则：接口要小而专，不要大而全"></a>五、接口隔离原则：接口要小而专，不要大而全</h2><p><strong>核心概念</strong>：这条原则是说 —— <strong>不要设计一个 “万能接口”，把所有功能都塞进去，而是要把接口拆成多个 “专用接口”，让类只实现自己需要的接口。</strong> 这样能避免 “类实现了接口，但被迫重写不需要的方法”（比如空实现），也能减少接口变动的影响。 </p><p>比如 “用户系统” 里，普通用户只需要 “登录、注册” 功能，管理员需要 “用户管理、权限管理” 功能。如果设计一个 “UserInterface” 包含所有 4 个方法，普通用户类就得空实现 “用户管理、权限管理”，这就很不合理；拆成两个接口后，各自实现需要的方法即可。</p><p>还是来看示范代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 拆分成专用接口：普通用户接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NormalUserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span>; <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String username, String password)</span>; <span class="comment">// 注册</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 拆分成专用接口：管理员接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">manageUser</span><span class="params">(String userId)</span>; <span class="comment">// 管理用户</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">managePermission</span><span class="params">(String roleId)</span>; <span class="comment">// 管理权限</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 普通用户类：只实现自己需要的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NormalUser</span> <span class="keyword">implements</span> <span class="title class_">NormalUserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 管理员类：实现管理员接口，也可以实现普通用户接口（如果需要）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Admin</span> <span class="keyword">implements</span> <span class="title class_">NormalUserService</span>, AdminService &#123;</span><br><span class="line">    <span class="comment">// 实现普通用户接口的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;管理员&quot;</span> + username + <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="comment">// 管理员可能不需要注册，或有特殊逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;管理员账号需通过审批注册&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现管理员接口的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">manageUser</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;成功管理用户：&quot;</span> + userId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">managePermission</span><span class="params">(String roleId)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;成功管理角色权限：&quot;</span> + roleId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：每个类只处理自己需要的功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NormalUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NormalUser</span>();</span><br><span class="line">        user.login(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;123456&quot;</span>); <span class="comment">// 输出“zhangsan登录成功”</span></span><br><span class="line">        user.register(<span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;654321&quot;</span>); <span class="comment">// 输出“lisi注册成功”</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Admin</span>();</span><br><span class="line">        admin.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin123&quot;</span>); <span class="comment">// 输出“管理员admin登录成功”</span></span><br><span class="line">        admin.manageUser(<span class="string">&quot;1001&quot;</span>); <span class="comment">// 输出“成功管理用户：1001”</span></span><br><span class="line">        admin.managePermission(<span class="string">&quot;admin_role&quot;</span>); <span class="comment">// 输出“成功管理角色权限：admin_role”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="六、最少知识原则：一个类只和-“直接朋友”-通信，别和-“陌生人”-说话"><a href="#六、最少知识原则：一个类只和-“直接朋友”-通信，别和-“陌生人”-说话" class="headerlink" title="六、最少知识原则：一个类只和 “直接朋友” 通信，别和 “陌生人” 说话"></a>六、最少知识原则：一个类只和 “直接朋友” 通信，别和 “陌生人” 说话</h2><p><strong>核心概念</strong>：也叫 “迪米特法则”，核心是 “降低类之间的耦合”—— <strong>一个类应该只和它的 “直接朋友”（比如成员变量、方法参数、返回值里的类）交互，不要主动去调用 “朋友的朋友” 的方法</strong>。这样能减少类之间的依赖，让系统更稳定。</p><p>比如 “老板要统计部门的员工数量”：老板的直接朋友是 “部门”，部门的直接朋友是 “员工”。如果老板直接去遍历部门里的员工列表，就是和 “员工”（陌生人）通信了；正确的做法是老板让部门自己统计人数，然后把结果返回给老板。</p><p>看下面的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 员工类（部门的直接朋友，老板的陌生人）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="comment">// 员工的基本信息（不需要暴露给老板）</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 部门类（老板的直接朋友，员工的直接朋友）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    <span class="comment">// 部门里有员工列表</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employees;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Department</span><span class="params">()</span> &#123;</span><br><span class="line">        employees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 模拟添加3个员工</span></span><br><span class="line">        employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>));</span><br><span class="line">        employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">28</span>));</span><br><span class="line">        employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">30</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 部门自己提供“统计人数”的方法（对外隐藏员工列表）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getEmployeeCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> employees.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 老板类（只和部门通信，不和员工通信）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> &#123;</span><br><span class="line">    <span class="comment">// 老板统计部门人数：只调用部门的方法（直接朋友）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countDepartmentEmployees</span><span class="params">(Department department)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> department.getEmployeeCount();</span><br><span class="line">        System.out.println(<span class="string">&quot;当前部门员工数量：&quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：符合最少知识原则，耦合度低</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Boss</span> <span class="variable">boss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boss</span>();</span><br><span class="line">        <span class="type">Department</span> <span class="variable">department</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 老板只和部门交互，不知道员工的存在</span></span><br><span class="line">        boss.countDepartmentEmployees(department); <span class="comment">// 输出“当前部门员工数量：3”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="写在最后：六大原则不是-“教条”，而是-“工具”"><a href="#写在最后：六大原则不是-“教条”，而是-“工具”" class="headerlink" title="写在最后：六大原则不是 “教条”，而是 “工具”"></a>写在最后：六大原则不是 “教条”，而是 “工具”</h2><p>很多人学完这些原则后会陷入 “过度设计” 的误区 —— 为了凑齐原则，写了一堆复杂的接口和类，反而让代码更难维护。</p><p>其实这六大原则的核心目标是一致的：<strong>降低耦合、提高内聚、让代码更易扩展和维护</strong>。实际开发中，不需要强行遵守每一条，而是要根据场景灵活取舍（比如简单的工具类，用继承可能比组合更简单）。</p><p>记住：<strong>好的设计不是 “符合多少原则”，而是 “能解决当前问题，且能应对未来的合理变化”。</strong> </p>]]></content>
      
      
      <categories>
          
          <category> 设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从“不会用”到“离不开”：Theo Mandel人机交互设计“黄金三原则”</title>
      <link href="/2025/09/02/03%20Mandel%E4%BA%BA%E6%9C%BA%E4%BA%A4%E4%BA%92%E8%AE%BE%E8%AE%A1%E9%BB%84%E9%87%91%E4%B8%89%E5%8E%9F%E5%88%99/"/>
      <url>/2025/09/02/03%20Mandel%E4%BA%BA%E6%9C%BA%E4%BA%A4%E4%BA%92%E8%AE%BE%E8%AE%A1%E9%BB%84%E9%87%91%E4%B8%89%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p>上周去办理携号转网，营业厅工作人员告诉我，要给10086发一串文字，然后获得一个授权码才行。这是我忽然发现，自己名下要转网的那个手机号卡在女儿的手机上。当时我想：“女儿才12岁，以前只是用微信，从来没发过短信，让她现在操作一下，行不行啊”。我还是决定试一试，因为从营业厅跑回家里有点折腾。我编辑好短信内容，然后在微信发给女儿，并告诉她要发短信给10086。然后，拿出另一个手机，准备打开微信视频一步步告诉女儿怎么做。没想到，还没有打通微信视频电话，女儿就回复了她收到的客服短信。我一边夸她真厉害，一边有点惊讶。<br>这让我想起了Theo Mandel的人机交互三原则，我猜也许就是这套设计原则，让没有发过短信的女儿能快速的知道怎么用短信APP。现在就让我们来看看它们是什么吧。</p><p>先说个反面教材。你有没有过这样的经历：打开一款 APP，翻来覆去找不到想要的功能；操作软件时，误点一步就陷入 “无法回头” 的困境；明明是同品牌的产品，不同界面的按钮位置、操作逻辑却大相径庭……</p><p>起始，这些让人 “抓狂” 的体验，本质上都是人机交互设计的缺失。而早在多年前，人机交互领域的专家 Theo Mandel 就提出了被誉为界面设计 “黄金法则” 的三原则，为解决这些问题提供了清晰的方向。这三个原则其实很简单。</p><h2 id="置于用户控制之下：让用户做-“主人”"><a href="#置于用户控制之下：让用户做-“主人”" class="headerlink" title="置于用户控制之下：让用户做 “主人”"></a>置于用户控制之下：让用户做 “主人”</h2><blockquote><p>[!quote]<br>“用户应该是控制系统的人，而不是被系统支配的人”</p></blockquote><p>这是 Theo Mandel “置于用户控制之下” 原则的核心。比如，当你在编辑文档时，不小心删除了大段文字，若没有 “撤销” 功能，之前的心血可能瞬间白费。又或者，当你下载文件时，看不到进度、无法暂停或取消，估计会焦虑吧，这种 “失控感” 会直接拉低产品好感度。​</p><p><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901130146014.png" alt="image.png"></p><p>真正符合这一原则的设计，会时刻给用户 “掌控感”：点击按钮后，按钮会变色、震动或弹出提示，告知用户 “操作已被接收”；提供明确的 “撤销 &#x2F; 重做” 选项，允许用户修正错误；支持自定义设置，比如调整字体大小、更改界面主题、设置常用功能快捷键等。</p><p>就像我们常用的办公软件，无论是 Word 的 Ctrl+Z 撤销，还是 Excel 的自定义快速访问工具栏，都在践行这一原则，让用户能按照自己的节奏和习惯使用产品。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901130325626.png" alt="image.png"></p><h2 id="减轻用户记忆负担：别让用户-“费脑子”"><a href="#减轻用户记忆负担：别让用户-“费脑子”" class="headerlink" title="减轻用户记忆负担：别让用户 “费脑子”"></a>减轻用户记忆负担：别让用户 “费脑子”</h2><blockquote><p>[!quote]<br>“人的记忆是有限的，好的设计不该让用户拼命记东西”</p></blockquote><p>这是 “减轻用户记忆负担” 原则的关键。生活中，我们很难记住每一个 APP 的登录密码，所以 “记住密码”“短信验证码登录” 功能成了标配。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901132032634.png" alt="image.png"></p><p>这一原则要求设计师将 “需要用户记忆的信息” 转化为 “界面上直观可见的提示”：在搜索框输入关键词时，自动补全可能的选项；使用大众熟悉的图标，比如用 “垃圾桶” 代表删除、用 “信封” 代表邮件；减少操作步骤，比如购物 APP 的 “一键下单”，避免让用户在多个页面间反复跳转。</p><h2 id="保持界面的一致性：让用户-“不迷路”"><a href="#保持界面的一致性：让用户-“不迷路”" class="headerlink" title="保持界面的一致性：让用户 “不迷路”"></a>保持界面的一致性：让用户 “不迷路”</h2><blockquote><p>[!quote]<br>“当用户在一个地方学会的操作，在另一个地方也能适用”</p></blockquote><p>这是 “保持界面一致性” 原则的核心逻辑。<br>我女儿之所以会发短信，是因为短信的发送操作逻辑和微信的是一样的（当然，这个是微信向短信学习的，但是这也符合“减轻用户记忆原则”）。<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250901131722067.png" alt="image.png"></p><p>如果你在微信里习惯了 “长按消息弹出菜单”，到了另一款社交软件，却需要 “双击消息” 才能触发相同功能；如果你在手机系统里用 “上滑关闭 APP”，到了某款应用内，却需要 “点击叉号” 关闭页面，这种 “割裂感” 会让用户频繁出错，甚至放弃使用产品。<br>符合一致性原则的设计，会在视觉和逻辑上保持统一：同一产品内，导航栏要么都在顶部，要么都在底部；相同功能的按钮，颜色、形状、位置要固定，比如 “确认” 按钮多为蓝色、放在右侧，“取消” 按钮多为灰色、放在左侧；遵循平台通用规范，比如电脑端 Ctrl+C 复制、Ctrl+V 粘贴，手机端点击返回键回到上一页。这种 “熟悉感” 能降低用户的学习成本，让用户快速适应产品，就像无论用哪款主流浏览器，“前进 &#x2F; 后退” 按钮的位置和功能都基本一致，无需重新学习就能上手。</p><h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>Theo Mandel 的这三原则，看似简单，却精准击中了人机交互的核心 ——“以用户为中心”。对于设计师而言，它们不是死板的规则，而是检验设计是否 “好用” 的标尺；对于用户而言，这些原则背后的设计，藏着产品 “是否懂我” 的细节。当一款产品能让用户感受到 “掌控感”“轻松感”“熟悉感” 时，从 “难用” 到 “离不开” 的转变，也就水到渠成了。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>用Streamlit快速搭建ChatBot</title>
      <link href="/2025/09/02/02%20%E7%94%A8Streamlit%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAChatBot/"/>
      <url>/2025/09/02/02%20%E7%94%A8Streamlit%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAChatBot/</url>
      
        <content type="html"><![CDATA[<p>如果你是一个开发人员，或者一个计算机专业的老师或学生，有时候你需要验证或者展示某个技术或者应用场景。比如，我们想要验证一些某个大模型的对话交互能力，或者基于这个大模型开发一个Agent。此时我们可以通过调用大模型的API或者通过ollama这样的工具在命令行中和它交互。<br>但是，有的时候我们要跟直观的展示或者验证，这是就离不开搭建一个前端UI。</p><p>你能想到什么？Vue、React、Angular等等这些前端技术，然后搭建一个UI界面吗？当然可以，但是还是有点麻烦，且不说假设你是一个后端开发人员，掌握这个前端技术需要一点时间。即便是你本来就是一个全站工程师，啥都会，但是也许你只是临时验证或者演示一下你的技术，这个前端用完就会被抛弃掉。再辛辛苦苦搭建一个前端展示页面就显得有点得不偿失了。</p><p>那如果你懂python开发，有没有一种技术可以满足下面的要求：</p><ul><li>极低的开发门槛：几行Python代码就能创建一个包含各种组件的网页前端</li><li>部署打包简单：一行命令就可以本地启动，也可以快速部署到主流的云服务器上托管</li><li>支持热重载：修改代码后页面自动刷新，无需重启服务器</li><li>内置丰富的UI组件：主流的滑块、按钮、表格、表单等等组件都支持</li><li>强大的数据可视化展示支撑：完美支持pandas、matplotlib、seaborn、Plotly、scikit-learn等这些数据分析和展示功能。</li></ul><p>答案是streamlit。今天通过一个简单的例子展示Streamlit提供的强大的原型开发能力，几行代码搭建出一个AI ChatBot。</p><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>可以通过pip conda等安装streamlit，但是我建议使用uv，如果你不熟悉uv，可以参考我之前写的这篇文章：<a href="https://zhuanlan.zhihu.com/p/1944731086295900442">强大的Python包和项目管理工具 uv快速入门 - 知乎</a>。</p><p>现在假设我们创建好了uv项目，接下来执行下面的命令安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv add streamlit </span><br></pre></td></tr></table></figure><p>uv会分析依赖，然后安装streamlit。</p><h2 id="ChatBot开发"><a href="#ChatBot开发" class="headerlink" title="ChatBot开发"></a>ChatBot开发</h2><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><p>我们的需求很简单：以网页的形式显示一个聊天对话框，页面包含三个部分：</p><ol><li>标题：ChatBot</li><li>消息显示区域：用于显示用户的提问和Bot的回答</li><li>聊天输入窗口：用于用户输入和发送提问</li></ol><p>整个逻辑是：</p><ol><li>用户输入聊天内容</li><li>聊天内容被后端的大模型（这里使用智谱AI）接收，然后返回问题</li><li>前端接收到返回的文本内容后，显示在消息区域。</li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>为了完成上面的需求，我们需要安装两个依赖：</p><ol><li>streamlit: 用于快是实现前端窗口布局</li><li>zhipuai: 用于调用智谱AI的大模型能量。<br>因此，我们首先在uv项目的依赖中添加如下：</li></ol><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies</span> = [</span><br><span class="line">    <span class="string">&quot;streamlit&gt;=1.49.0&quot;</span>,</span><br><span class="line">     <span class="string">&quot;zhipuai&gt;=2.0.0&quot;</span>, </span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>然后执行下面的uv安装命令来安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv sync</span><br></pre></td></tr></table></figure><p>接下来编写主程序main.py实现上述需求：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> zhipuai</span><br><span class="line"><span class="keyword">from</span> zhipuai <span class="keyword">import</span> ZhipuAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化智谱AI客户端（请将API_KEY替换为您自己的密钥）</span></span><br><span class="line">client = ZhipuAI(api_key=<span class="string">&quot;YOUR_API_KEY&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 设置页面标题</span></span><br><span class="line">    st.title(<span class="string">&quot;ChatBot&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化会话状态以存储聊天历史</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">        st.session_state.messages = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 显示聊天历史</span></span><br><span class="line">    <span class="keyword">for</span> message <span class="keyword">in</span> st.session_state.messages:</span><br><span class="line">        <span class="keyword">with</span> st.chat_message(message[<span class="string">&quot;role&quot;</span>]):</span><br><span class="line">            st.markdown(message[<span class="string">&quot;content&quot;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 聊天输入框</span></span><br><span class="line">    <span class="keyword">if</span> prompt := st.chat_input(<span class="string">&quot;请输入您的问题...&quot;</span>):</span><br><span class="line">        <span class="comment"># 添加用户消息到会话状态</span></span><br><span class="line">        st.session_state.messages.append(&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, </span><br><span class="line">            <span class="string">&quot;content&quot;</span>: prompt</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 显示用户消息</span></span><br><span class="line">        <span class="keyword">with</span> st.chat_message(<span class="string">&quot;user&quot;</span>):</span><br><span class="line">            st.markdown(prompt)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用智谱AI API并流式输出结果</span></span><br><span class="line">        <span class="keyword">with</span> st.chat_message(<span class="string">&quot;assistant&quot;</span>):</span><br><span class="line">            <span class="comment"># 创建一个占位符用于流式更新</span></span><br><span class="line">            response_placeholder = st.empty()</span><br><span class="line">            full_response = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 调用智谱AI的聊天接口，启用流式响应</span></span><br><span class="line">            response = client.chat.completions.create(</span><br><span class="line">                model=<span class="string">&quot;glm-4&quot;</span>,  <span class="comment"># 使用智谱AI的GLM-4模型</span></span><br><span class="line">                messages=[&#123;</span><br><span class="line">                    <span class="string">&quot;role&quot;</span>: m[<span class="string">&quot;role&quot;</span>], </span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: m[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">                &#125; <span class="keyword">for</span> m <span class="keyword">in</span> st.session_state.messages],</span><br><span class="line">                stream=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 处理流式响应</span></span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> response:</span><br><span class="line">                <span class="keyword">if</span> chunk.choices[<span class="number">0</span>].delta.content:</span><br><span class="line">                    full_response += chunk.choices[<span class="number">0</span>].delta.content</span><br><span class="line">                    <span class="comment"># 更新占位符内容</span></span><br><span class="line">                    response_placeholder.markdown(full_response + <span class="string">&quot;▌&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 最终更新显示完整响应</span></span><br><span class="line">            response_placeholder.markdown(full_response)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添加助手响应到会话状态</span></span><br><span class="line">        st.session_state.messages.append(&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, </span><br><span class="line">            <span class="string">&quot;content&quot;</span>: full_response</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>代码说明：</p><ol><li>client &#x3D; ZhipuAI(api_key&#x3D;”YOUR_API_KEY”) 这里创建了智谱AI的对象，用于链接后端的大模型，这里记得输入你的API KEY</li><li>st.session_state.messages ：是一个streamlit的消息显示组件，它支持流式输出</li><li>st.chat_input：是一个消息输入组件</li><li>st.markdown(prompt)： 将我们的输入内容转化为markdown形式，这样更有利于LLM理解</li></ol><h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><p>执行下面的命令求可以启动streamlit服务，同时它会打开浏览器并定位到  <a href="http://localhost:8501/">http://localhost:8501</a> 网址。<br>最终的显示效果如下：<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250829141419739.png" alt="image.png"></p><p>可以看到，我们只需要几行Python代码就可以快速的实现一个聊天机器人。这对于技术验证和演示甚至是产品的快速原型设计都非常的高效。</p><p>详细的streamlit 使用参考可以查看其官网的文档：<a href="https://docs.streamlit.io/develop/tutorials">Tutorials - Streamlit Docs</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ai </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强大的python包和项目管理工具-uv快速入门</title>
      <link href="/2025/09/02/01%20uv%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2025/09/02/01%20uv%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>一个Rust编写的极速Python包和项目管理工具。</p><p>uv据说是一个工具替代 pip、pip-tools、pipx、poetry、pyenv、twine、virtualenv 等，而且比pip快10-100倍，支持对不同版本Python的安装和管理，今天就来安装实验一下。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Windows 下用下面的脚本安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -ExecutionPolicy ByPass -c &quot;irm https://astral.sh/uv/install.ps1 | iex&quot;</span><br></pre></td></tr></table></figure><p>Mac 和Linux用下面的脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LsSf https://astral.sh/uv/install.sh | sh</span><br></pre></td></tr></table></figure><p>脚本命令成功执行之后，还要根据提示将安装目录的bin放到系统的环境变量中，这样就可以在命令行中使用uv命令了。然后重启命令行工具就可以使用uv命令了。</p><h2 id="几个常用的uv功能"><a href="#几个常用的uv功能" class="headerlink" title="几个常用的uv功能"></a>几个常用的uv功能</h2><p>如果你想了解它详细的使用功能，可以看在线的中文文档。<a href="https://uv.doczh.com/">https://uv.doczh.com/</a> 。这里说几个常用的uv功能。</p><h3 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h3><p>如果使用pip或者conda管理项目，通常是创建一个文件夹，然后在下面创建虚拟环境。但是在uv中，可以通过下面的命令创建一个项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv init myuvproject</span><br></pre></td></tr></table></figure><p>执行上述命令后会在当前目录下生成一个名为myuvproject文件夹，这就是我们项目的根目录，其中包含下面几个文件:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.gitignore</span><br><span class="line">.python-version</span><br><span class="line">main.py</span><br><span class="line">pyproject.toml</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure><ul><li>.gitignore: git的忽略配置文件</li><li>.python-version: 指定了项目的python版本</li><li>main.py: 保护一个简单的main函数，用于测试项目是否可以运行</li><li>README.md : 生成一个简单的项目介绍的markdown文件</li><li>pyproject.toml: 这个是uv管理项目的核心文件，通过它可以组织项目的依赖、定义运行的python版本等等。初始的结构如下</li></ul><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span> = <span class="string">&quot;myuvproject&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;Add your description here&quot;</span></span><br><span class="line"><span class="attr">readme</span> = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"><span class="attr">requires-python</span> = <span class="string">&quot;&gt;=3.13&quot;</span></span><br><span class="line"><span class="attr">dependencies</span> = []</span><br></pre></td></tr></table></figure><p>创建好项目后，要做的第一件事是同步项目依赖，执行下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uv sync</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>你会看到类似下面的输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Using CPython 3.13.5 interpreter at: C:\Python313\python.exe</span><br><span class="line">Creating virtual environment at: .venv</span><br><span class="line">Resolved 1 package in 8ms                                                                        </span><br><span class="line">Audited in 0.04ms</span><br></pre></td></tr></table></figure><p>很明显，它帮我们创建python虚拟环境。那么接下来我们来做一些实验，理解uv是如何管理依赖的。</p><h3 id="管理依赖"><a href="#管理依赖" class="headerlink" title="管理依赖"></a>管理依赖</h3><p>假设我们有一个项目需求，要访问某个网址来抓取网页。此时可能要用到requests这个依赖。在uv中新增一个依赖可以用下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv add requests</span><br></pre></td></tr></table></figure><p>其输出结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Resolved 6 packages in 581ms</span><br><span class="line">Prepared 5 packages in 934ms</span><br><span class="line">Installed 5 packages in 23ms</span><br><span class="line"> + certifi==2025.8.3                                                                        </span><br><span class="line"> + charset-normalizer==3.4.3                                                                     </span><br><span class="line"> + idna==3.10                                                                                    </span><br><span class="line"> + requests==2.32.5                                                                              </span><br><span class="line"> + urllib3==2.5.0</span><br></pre></td></tr></table></figure><p>可以看到它自动计算requests这个包的依赖并进行安装，而且速度比pip和conda都要快很多。<br>此时，我们再看project.toml文件就会发现dependences中增加了这个包的描述</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies</span> = [</span><br><span class="line">    <span class="string">&quot;requests&gt;=2.32.5&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>在.venv的虚拟机目录下也正确的增加了依赖包<br><img src="https://raw.githubusercontent.com/bsneric/note-gen-image-sync/main/20250829115101936.png" alt="image.png"></p><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p>现在我们在main.py中增加一段验证代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    response = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.status_code)</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>通过uv命令运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv run main.py</span><br></pre></td></tr></table></figure><p>结果显示如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">200</span><br></pre></td></tr></table></figure><p>说明uv正确的加载了依赖并执行了代码。</p><p>如果我们拿到一个已有的python项目，可能其已经提供了一个requirements.txt来包含所需要的依赖，那么可以通过下面的命令导入这些依赖</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv add -r requirements.txt</span><br></pre></td></tr></table></figure><h3 id="一些常用的命令"><a href="#一些常用的命令" class="headerlink" title="一些常用的命令"></a>一些常用的命令</h3><p>下列一些常用的uv命令</p><ul><li>uv init: 创建新 Python 项目</li><li>uv add: 为项目添加依赖</li><li>uv remove: 从项目移除依赖</li><li>uv sync: 同步项目依赖到环境</li><li>uv lock: 为项目依赖创建锁文件</li><li>uv run: 在项目环境中运行命令</li><li>uv tree: 查看项目依赖树</li><li>uv build: 构建项目为分发包</li><li>uv publish: 发布项目到包索引</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> uv </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
